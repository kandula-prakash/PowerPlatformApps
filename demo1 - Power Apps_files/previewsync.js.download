(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/previewsync.js?v=1.4.3886-master"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[48],{SWt9:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var s=a("K7RF");function n(e){return{type:s.a,payload:e}}},q5Ef:function(e,t,a){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var s;a.r(t),a.d(t,"UCISyncMessageType",(function(){return k})),a.d(t,"PreviewSync",(function(){return H})),function(e){e[e.SyncMessageRequest=0]="SyncMessageRequest",e[e.SyncMessageResponse=1]="SyncMessageResponse",e[e.HandshakeRequest=2]="HandshakeRequest",e[e.HandshakeAck=3]="HandshakeAck"}(s||(s={}));class n{constructor(e,t,a,n,i){this._outboundMessageHandlers=new Map,this._targetDomain=t,this._channelId=e,this._targetWindow=n,this._displayName=a,this._logger=i,this.Ready=new Promise((e,t)=>{this._onReady={resolve:e,reject:t}}),this._outboundMessageId=1,window.addEventListener("message",e=>{if(this._validateMessageOrigin(e)&&e.data&&void 0!==e.data.messageType&&e.data.messageType in s){const t=e.data;switch(this._logInfo(this._displayName,"received message of type"+t.messageType+", message id is"+t.messageId),t.messageType){case s.HandshakeRequest:if(t.messageData&&t.messageData.channelId===this._channelId){this._targetWindow=e.source;const a=this._createMessage({channelId:this._channelId},s.HandshakeAck);a.sourceId=t.messageId,this._logInfo(this._displayName,"Sending handshake ack"),this._send(a),this._onReady.resolve("")}break;case s.HandshakeAck:t.messageData&&t.messageData.channelId===this._channelId&&t.sourceId&&this._outboundMessageHandlers.get(t.sourceId)&&(this._outboundMessageHandlers.get(t.sourceId).resolve(t.messageData),this._onReady.resolve(""));break;case s.SyncMessageRequest:this._messageHandler.call({},t.messageData).then(e=>{const a=this._createMessage(e,s.SyncMessageResponse);a.sourceId=t.messageId,this._logInfo(this._displayName,"Sending response"+a.messageId),this._send(a)});break;case s.SyncMessageResponse:t.sourceId&&this._outboundMessageHandlers.get(t.sourceId)&&(this._logInfo(this._displayName,"Received response"+t.messageData),this._outboundMessageHandlers.get(t.sourceId).resolve(t.messageData),this._outboundMessageHandlers.delete(t.sourceId));break;default:throw this._logger.info("Channel:"+a+" => "+t),"Unsupported message type"}}}),n&&this._handshake()}_logInfo(e,t){this._logger&&this._logger.info&&this._logger.info("Channel:"+e+" => "+t)}_logError(e,t){this._logger&&this._logger.error&&this._logger.error("Channel:"+e+" => "+t)}send(e){return this.Ready.then(()=>{const t=this._createMessage(e,s.SyncMessageRequest),a=new Promise((e,a)=>{this._outboundMessageHandlers.set(t.messageId,{resolve:e,reject:a})});return this._logInfo(this._displayName,"sending message Id "+t.messageId+"of type "+t.messageType),this._send(t),a})}onReceive(e){this._messageHandler=e}_validateMessageOrigin(e){return"*"===this._targetDomain||e.origin===this._targetDomain}_handshake(){const e={channelId:this._channelId},t=this._createMessage(e,s.HandshakeRequest),a=new Promise((e,a)=>{this._outboundMessageHandlers.set(t.messageId,{resolve:e,reject:a})});return this._send(t),a}_createMessage(e,t){return{messageId:this._outboundMessageId++,messageType:t,messageData:e}}_send(e){if(!this._targetWindow)throw this._logError(this._displayName,"The channel lost the target window"),"The channel lost the target window";this._targetWindow.postMessage(e,this._targetDomain)}}var i=a("zsAz"),o=a("odYE"),c=a("D+Bz"),r=a("fWyz"),d=a("ZUzm");function h(e,t){const a=Object(i.d)(t);return e.error(a.message),Promise.reject(a)}var p=a("0FMG");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function l({containingAreaId:e,subAreaDescriptor:t}){return{type:"preview.sitemap.navigate",execute:({dispatch:a},s)=>(s.TraceManager.getTracer("SiteMaps.Preview.Navigate").info("Navigating via subarea descriptor"),a(Object(p.e)(e)),a(Object(r.b)(t,!1,null,c.b.SiteMapSubArea)),Promise.resolve())}}var u=a("eXjw"),g=a("+VD1"),m=a("SWt9");function _(e){return{type:"preview.metadata.update",execute({dispatch:t},a){const s=a.TraceManager.getTracer("AppModule.Preview.Metadata.Update");if(s.info("Updating app preview metadata"),e){const a=Object(g.b)(e,[]);s.info("serializeAppInfo done");const n={appContext:{initialized:u.a.Initialized,app:a}};t(Object(m.a)(n))}else s.error("No incoming app descriptor to update");return Promise.resolve()}}}var y=a("g0tL"),b=a("i1f0"),f=a("ueZM"),w=a("Or4W"),v=a("SAYH"),M=a("dHD5"),D=a("59++"),I=a("pF61"),S=a("arV0"),N=a("Gn6i");function T(e){return{type:"preview.metadata.update",execute:async({dispatch:t,getState:a},s,n)=>{const i=s.TraceManager.getTracer(Object(b.V)(!1,"preview.metadata.update"));if(i.info("Updating form preview metadata"),e){const o=Object(y.g)([e],y.b.Form,a(),void 0,void 0,void 0,void 0);let c;if(o&&o.forms)for(const e in o.forms){c=e;break}i.info("serializeFormDescriptors done. ");const r=new v.a(c);let d="0";switch(e.FormType){case 2:d=Object(I.c)(a());break;case 9:d=Object(I.b)(a());break;default:d="0"}const h=Object(S.j)(a(),d),p=h.entityTypeName;await function(e,t,a,s,n,i,o){e.info("Loading custom control manifests for new added custom control.");const c=Object(w.b)(t,a,s,n,i,o);return Promise.all(c).then(()=>{e.info("Custom control manifests loading done for new added custom control.")}).catch(t=>{const a="Loading manifests for new added custom control failed.";throw e.error(a,t),a})}(i,a(),t,o.forms[e.FormId],p,s,n),t(Object(m.a)(o)),await t(Object(f.a)(r));const l=Object(M.j)(a(),d);await t(Object(D.b)(r,d,l)),await Object(N.b)(a,h,d,l,t)}i.error("No descriptor to update")}}}var C=a("WNuT"),j=a("7HpW");function O(e){return{type:"preview.metadata.update",execute({dispatch:t},a){const s=a.TraceManager.getTracer("SiteMaps.Preview.Metadata.Update");if(s.info("Updating sitemap preview metadata"),e){const a=Object(C.a)([e]),n={siteMap:Object(j.d)(a,s)};s.info("serializeSiteMapDescriptor done"),t(Object(m.a)(n))}else s.error("No incoming sitemap descriptor to update");return Promise.resolve()}}}var k,U=a("Wiik"),A=a("WZ96"),R=a("hBJV"),E=a("TYIz");!function(e){e[e.UCISyncMessage=0]="UCISyncMessage"}(k||(k={}));class H{constructor(e,t){this._store=e,this._tracer=t,this._domElementCache={},setInterval(()=>{this._domElementCache={}},18e5),this._debouncedSendDimensions=this._debounce(this.SendDimensions,this,100)}initializeChannel(e){if(this._tracer.info("PreviewSync: Initializing sync channel with id"+e),!this._previewChannel||this._channelId!==e)return this._previewChannel=new n(e,"*","UCI_Sync",window.parent,this._tracer),this._previewChannel.onReceive(this.HandleRequest.bind(this)),this.RegisterMutationObserver(),this._previewChannel}HandleRequest(e){return new Promise((t,a)=>{if(e&&e.type===k.UCISyncMessage&&e.actionName)switch(this._tracer.info("PreviewSync: Received request with action name: "+e.actionName),e.actionName){case"ScrollUpdated":this._updateScrollPosition(e.actionData),t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage}),this._debouncedSendDimensions();break;case"ElementClicked":this._handleElementClick(e.actionData),t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage});break;case"FormMetadataUpdated":this._store&&(e.actionData.consistencyStrong?(this._store.dispatch(Object(U.b)(!0)),this._store.dispatch(Object(R.a)()).then(()=>{this._store.dispatch(Object(U.b)(!0)),this._store.dispatch(T(e.actionData.formDescriptor)),t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage})})):(this._store.dispatch(T(e.actionData)),t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage})));break;case"SelectFormTab":const a=this._store.getState(),n=Object(I.c)(a),i=e.actionData.tabId,p=Object(M.j)(a,n);this._store.dispatch(Object(E.b)(n,i,p)),t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage});break;case"AppModuleMetadataUpdated":this._store&&(e.actionData.consistencyStrong?(this._store.dispatch(Object(U.b)(!0)),this._store.dispatch(Object(R.a)()).then(()=>{this._store.dispatch(Object(U.b)(!0)),this._store.dispatch(_(e.actionData.appModuleDescriptor)),t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage})})):(this._store.dispatch(_(e.actionData)),t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage})));break;case"NavigateToSiteMapSubArea":this._store&&(this._store.dispatch(l(e.actionData)),t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage}));break;case"SiteMapMetadataUpdated":this._store&&(e.actionData.consistencyStrong?(this._store.dispatch(Object(U.b)(!0)),this._store.dispatch(Object(R.a)()).then(()=>{this._store.dispatch(Object(U.b)(!0)),this._store.dispatch(O(e.actionData.siteMapDescriptor)),t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage})})):(this._store.dispatch(O(e.actionData)),t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage})));break;case"NavigateToSiteMapSubArea":this._store&&(this._store.dispatch(l(e.actionData)),t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage}));break;case"NavigateToAppComponent":this._store&&this._store.dispatch((s=e.actionData,{type:"preview.app.navigate",execute({dispatch:e},t){const a=t.TraceManager.getTracer("App.Preview.Navigate");if(a.info("Navigating via app component"),!(null==s?void 0:s.componentType))return h(a,"No component type was provided to navigateToAppComponent");switch(s.componentType){case"EntityView":case"Dashboard":case"Page":return s.subAreaDescriptor?(e(Object(r.b)(s.subAreaDescriptor,!1,null,c.b.Other)),a.info("Successfully navigated to componentType "+s.componentType),Promise.resolve()):h(a,"No subAreaDescriptor was provided to navigateToAppComponent even though one was expected with component type "+s.componentType);case"EntityForm":return s.entityLogicalName?(e(Object(d.a)(new o.a(s.entityLogicalName))),a.info("Successfully navigated to componentType "+s.componentType),Promise.resolve()):h(a,"No entityLogicalName was provided to navigateToAppComponent even though one was expected with component type "+s.componentType);default:return h(a,`Component type ${s.componentType} was not in list of expected component types for app component navigation`)}}})).then(()=>t({actionName:e.actionName,actionData:{},success:!0,type:k.UCISyncMessage})).catch(a=>t({actionName:e.actionName,actionData:a,success:!1,type:k.UCISyncMessage}));break;default:this._tracer.error("PreviewSync: Received request with unsupported action "),t(void 0)}else t(void 0);var s})}GetDimensions(){this._tracer.info("PreviewSync: Getting Dimensions ");const e=document.documentElement.scrollLeft,t=document.documentElement.scrollTop,a=function(s){let n;for(const e of Array.from(s.children)){const t=a(e);t&&(n?n.push(...t):n=[...t])}const i=s.getAttribute("data-"+A.e);if(i){const a=s.getBoundingClientRect(),o={top:a.top+t,left:a.left+e,height:a.height,width:a.width,scrollTop:s.scrollTop,scrollLeft:s.scrollLeft,scrollHeight:s.scrollHeight,scrollWidth:s.scrollWidth},c=s.getAttribute("role"),r=s.getAttribute("data-"+A.b),d=s.getAttribute("data-"+A.f),h=s.getAttribute("data-"+A.d),p=s.getAttribute("data-"+A.c);return[{id:s.id,previewId:i,dimensions:o,role:c||"none",clickthrough:"true"===r,dontShowBorders:"true"===h,dontShowBadges:"true"===p,orientation:d,children:n}]}return n};return{actionName:"DimensionsUpdated",actionData:{elementMetadata:a(document.body)},type:k.UCISyncMessage}}RegisterMutationObserver(){this._previewChannel.Ready.then(()=>{const e=document;new MutationObserver(this._debouncedSendDimensions).observe(e,{attributes:!0,childList:!0,subtree:!0})})}SendDimensions(){this._previewChannel.send(this.GetDimensions())}_updateScrollPosition(e){const t=P(e.scrollLeft),a=P(e.scrollTop);if(e&&e.id&&(t||a)){const s=this._findDOMElement(e.id);s&&(t&&(s.scrollLeft=e.scrollLeft),a&&(s.scrollTop=e.scrollTop))}}_handleElementClick(e){const t=this._findDOMElement(e.id);t&&t.click()}_findDOMElement(e){const t=this._domElementCache[e];if(t&&t.clientWidth)return t;const a=document.getElementById(e);return this._domElementCache[e]=a,a}_debounce(e,t,a){let s;return function(){const n=t,i=arguments,o=function(){s=null,e.apply(n,i)};clearTimeout(s),s=setTimeout(o,a)}}}function P(e){return!isNaN(parseFloat(e))}}}]),window.bundleExecutionMarkers["scripts/previewsync.js?v=1.4.3886-master"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();