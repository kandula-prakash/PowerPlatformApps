/*! For license information please see 59.f3ab9696.chunk.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{3602:function(e,t,n){"use strict";n.r(t);var r=n(3603);n.d(t,"DefaultOptInOptions",(function(){return r.DefaultOptInOptions})),n.d(t,"enrollmentAndUserPlanDetailsDefaults",(function(){return r.enrollmentAndUserPlanDetailsDefaults}));var a=n(3604);n.d(t,"getDefaultEnrollmentContext",(function(){return a.getDefaultEnrollmentContext})),n.d(t,"isTeams",(function(){return a.isTeams})),n.d(t,"ConnectedEnrollmentProvider",(function(){return a.ConnectedEnrollmentProvider})),n.d(t,"EnrollmentProvider",(function(){return a.EnrollmentProvider})),n.d(t,"withEnrollment",(function(){return a.withEnrollment}));var o=n(3606);n.d(t,"_EnrollmentDemo",(function(){return o._EnrollmentDemo})),n.d(t,"EnrollmentDemo",(function(){return o.EnrollmentDemo}));var i=n(3605);n.d(t,"shouldShowEnrollmentConsent",(function(){return i.shouldShowEnrollmentConsent})),n.d(t,"getTenantCountryCode",(function(){return i.getTenantCountryCode})),n.d(t,"userHasMakerPlans",(function(){return i.userHasMakerPlans})),n.d(t,"userHasPlans",(function(){return i.userHasPlans}));var l=n(3607);n.d(t,"useTenantCapacity",(function(){return l.useTenantCapacity}));var s=n(3608);n.d(t,"featureGates",(function(){return s.featureGates}));var c=n(3611);n.d(t,"getEnforcementLevelFromPercentage",(function(){return c.getEnforcementLevelFromPercentage})),n.d(t,"getCapacityUsePercentageForTenant",(function(){return c.getCapacityUsePercentageForTenant})),n.d(t,"getEnforcementLevelForTenant",(function(){return c.getEnforcementLevelForTenant})),n.d(t,"hasReachedCapacity",(function(){return c.hasReachedCapacity}))},3603:function(e,t,n){"use strict";var r;n.r(t),n.d(t,"DefaultOptInOptions",(function(){return r})),n.d(t,"enrollmentAndUserPlanDetailsDefaults",(function(){return a})),function(e){e.Yes="Yes",e.No="No",e.NotSpecified="NotSpecified"}(r||(r={}));var a={graphTenantDetails:[],tenant:{displayName:"",isTenantWhitelisted:!1,defaultLocation:"",isGccTenant:!1,isDisallowedForInternalPlans:!1},activeUserPlans:[],expiredUserPlans:[],enrollmentOptions:{}}},3604:function(e,t,n){"use strict";n.r(t),n.d(t,"getDefaultEnrollmentContext",(function(){return O})),n.d(t,"isTeams",(function(){return S})),n.d(t,"ConnectedEnrollmentProvider",(function(){return T})),n.d(t,"EnrollmentProvider",(function(){return D})),n.d(t,"withEnrollment",(function(){return L}));var r,a=n(215),o=n(1195),i=n(2687),l=n(1072),s=n(252),c=n(481),u=n(1144),d=n(922),f=n(1156),p=n(1077),m=n(245),v=n(3603),g=n(3605);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t,n,r,a,o,i){try{var l=e[o](i),s=l.value}catch(c){return void n(c)}l.done?t(s):Promise.resolve(s).then(r,a)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){C(o,r,a,i,l,"next",e)}function l(e){C(o,r,a,i,l,"throw",e)}i(void 0)}))}}function O(){return{enrollmentAndUserDetails:v.enrollmentAndUserPlanDetailsDefaults,enrollmentLoadingStatus:l.ProviderLoadingStatus.NotLoaded,enrollmentLoadingError:null,enrollmentFullyLoaded:!1,shouldShowEnrollmentConsent:!1,getTenantCountryCode:"",hasUserEnrolledAtLeastOnce:!1}}function S(){return Object(a.isTeamsRoute)()}var P=m.createContext(O());class T extends m.Component{constructor(e){var t;super(e),t=this,this.userHasEnrolledCacheKey="HasEnrolled",this.enrollDataPersistentStorageKey="enrollment",this.setStateFromEnrollData=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.setState({enrollmentAndUserDetails:e,enrollmentLoadingStatus:l.ProviderLoadingStatus.Loaded,shouldShowEnrollmentConsent:Object(g.shouldShowEnrollmentConsent)(e),getTenantCountryCode:Object(g.getTenantCountryCode)(e),hasUserEnrolledAtLeastOnce:!0,enrollmentFullyLoaded:!n})};var n=O();n.hasUserEnrolledAtLeastOnce=this.getCachedUserHasEnrolled(),this.state=n}componentDidMount(){var e=this;return b((function*(){if(!Object(c.isInWidgetMode)()||Object(a.isTeamsRoute)())try{e.tryLoadFromPersistentStorage(),yield e.loadFromEnrollCall()}catch(t){e.setErrorState(t)}}))()}render(){if(this.state.enrollmentLoadingError)throw this.state.enrollmentLoadingError;return m.createElement(P.Provider,{value:E({},this.state)},m.createElement(m.Fragment,null,this.props.children))}tryLoadFromPersistentStorage(){var e=this;return b((function*(){var t=yield e.props.persistentStorage.getItemAsync(e.enrollDataPersistentStorageKey);t&&e.state.enrollmentLoadingStatus===l.ProviderLoadingStatus.NotLoaded&&e.isSupportedTenant(t)&&e.setStateFromEnrollData(t,!0)}))()}loadFromEnrollCall(){var e=this;return b((function*(){var t,n,s=Object(o.URI)(r||(t=["https://pa-rp/api/providers/Microsoft.PowerApps/enroll?",""],n||(n=t.slice(0)),r=Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(n)}}))),{"api-version":"".concat("2017-06-01"),"source-identifier":Object(a.isTeamsRoute)()?"PowerAppsTeams":void 0}),c=!1;try{var u=(yield e.props.httpClient.post(s)).data;if(!e.isSupportedTenant(u))throw c=!0,new i.ShellError(!0,e.props.t("EnrollmentProvider.errorTextGCCDisallowed"));e.setStateFromEnrollData(u),u.activeUserPlans&&u.activeUserPlans.length>0?(e.props.persistentStorage.setItemAsync(e.enrollDataPersistentStorageKey,u),e.setCachedUserHasEnrolled(!0)):(e.props.persistentStorage.removeItemAsync(e.enrollDataPersistentStorageKey),e.setCachedUserHasEnrolled(!1))}catch(d){if(e.state.enrollmentLoadingStatus===l.ProviderLoadingStatus.NotLoaded||c)throw d}}))()}setErrorState(e){this.props.persistentStorage.removeItemAsync(this.enrollDataPersistentStorageKey),this.state.enrollmentLoadingError||this.setState({enrollmentLoadingStatus:this.state.enrollmentLoadingStatus===l.ProviderLoadingStatus.Loaded?l.ProviderLoadingStatus.Loaded:l.ProviderLoadingStatus.Error,enrollmentLoadingError:Object(i.getShellError)(e instanceof Error?e:new Error(e))})}isSupportedTenant(e){var{tenant:t}=e,n=!Object(g.userHasMakerPlans)(e)&&t.isDisallowedForInternalPlans,r=t&&t.isGccTenant&&!Object(s.isGCCEnv)(),a=t&&!t.isGccTenant&&Object(s.isGCCEnv)();return!(r&&n||a)}getCachedUserHasEnrolled(){return!!p.StorageHelper.transientWithGlobalFallback.getItem(this.userHasEnrolledCacheKey)}setCachedUserHasEnrolled(e){e?p.StorageHelper.transientWithGlobalFallback.setItem(this.userHasEnrolledCacheKey,"true"):p.StorageHelper.transientWithGlobalFallback.removeItem(this.userHasEnrolledCacheKey)}}var D=Object(f.withPersistentStorage)(Object(u.withHttpClient)(Object(d.translateService)("Enrollment")(T))),L=Object(l.getWithProviderFunction)(P,"enrollmentLoadingStatus")},3605:function(e,t,n){"use strict";n.r(t),n.d(t,"shouldShowEnrollmentConsent",(function(){return a})),n.d(t,"getTenantCountryCode",(function(){return o})),n.d(t,"userHasMakerPlans",(function(){return i})),n.d(t,"userHasPlans",(function(){return l}));var r=n(3603);function a(e){return e.enrollmentOptions&&!!e.enrollmentOptions.powerApps&&e.enrollmentOptions.powerApps.promotionalEmailOption===r.DefaultOptInOptions.NotSpecified}function o(e){return e.graphTenantDetails&&e.graphTenantDetails.length>0?e.graphTenantDetails[0].countryLetterCode:""}function i(e){return l(e.activeUserPlans)||l(e.expiredUserPlans)}function l(e){return!!e&&!!e.length}},3606:function(e,t,n){"use strict";n.r(t),n.d(t,"_EnrollmentDemo",(function(){return i})),n.d(t,"EnrollmentDemo",(function(){return l}));var r=n(245),a=n(3603),o=n(3604);class i extends r.Component{constructor(e){super(e),this.setState({enrollAndUserDetails:a.enrollmentAndUserPlanDetailsDefaults})}render(){var{tenant:e,activeUserPlans:t}=this.props.enrollmentAndUserDetails;return r.createElement("div",null,r.createElement("h3",null,"EnrollmentDemo (Displaying Tenant Info)"),r.createElement("div",null,"Tenant DisplayName: ","->"+e.displayName),r.createElement("div",null,"IsTenantWhiteListed: ","-> "+e.isTenantWhitelisted),r.createElement("div",null,"Tenant DefaultLocation ","-> "+e.defaultLocation),r.createElement("div",null,"Number of Active plans: ","-> "+t.length))}}var l=Object(o.withEnrollment)(i)},3607:function(e,t,n){"use strict";n.r(t),n.d(t,"useTenantCapacity",(function(){return l}));var r=n(3144),a=n(245),o=n(3608),i=n(3609);function l(){var{genericClient:e}=a.useContext(r.ApolloClientContext),[t,n]=a.useState(void 0),l=Object(i.useTenantCapacityQueryWithTelemetryScenario)(e,"tenantCapacity",!o.featureGates.enableOakdaleTenantEnforcementMessaging||!t);return a.useEffect(()=>{l.tenantCapacity&&n(l.tenantCapacity)},[l.tenantCapacity]),{tenantCapacity:t}}},3608:function(e,t,n){"use strict";n.r(t),n.d(t,"featureGates",(function(){return a}));var r=n(250),a=Object(r.createFeatureGatesConfig)({packageName:"powerappsEnrollment",features:{enableOakdaleTenantEnforcementMessaging:{owner:"ryleen",description:"Enables enforcement warnings/errors when DfT tenants approach/exceed their capacity limits",createdDate:"01/25/2021",enabledFor:{test:!1,preprod:!1,preview:!1,prod:!1,gov:!1,high:!1,dod:!1,mooncake:!1}}}})},3609:function(e,t,n){"use strict";n.r(t),n.d(t,"useTenantCapacityQueryWithTelemetryScenario",(function(){return c}));var r=n(217),a=n(245),o=n(3186),i=n(3192),l=n(3193),s=n(3610);function c(e,t){var n=l.TelemetryScenarioNames.TenantCapacity,[c,u]=Object(a.useState)(),{loading:d,data:f}=Object(o.useQuery)(s.TenantCapacityQuery,{client:e||void 0,onCompleted:e=>{var t;c&&(c.complete({tenantCapacityId:e&&(null==e?void 0:e.tenantCapacity)&&(null==e||null===(t=e.tenantCapacity)||void 0===t?void 0:t.tenantId)}),u(void 0))},onError:e=>{if(c){var t=Object(i.getResponseMessageFromApolloError)(e,"Tenant Capacity Failed");c.failure({error:t,clientError:e&&(null==e?void 0:e.message)}),u(void 0)}}});return Object(a.useEffect)(()=>{d&&u(Object(r.trackLoadScenario)(t,n))},[d]),{loading:d,tenantCapacity:null==f?void 0:f.tenantCapacity}}},3610:function(e,t,n){"use strict";n.r(t),n.d(t,"TenantCapacityQuery",(function(){return l}));var r,a=n(3128);var o,i,l=n.n(a)()(r||(o=["\n  query GetTenantCapacity {\n    tenantCapacity {\n      tenantId\n      tenantCapacities {\n        CapacityType\n        CapacityUnits\n        TotalCapacity\n        Consumption {\n          Actual\n          Rated\n        }\n      }\n    }\n  }\n"],i||(i=o.slice(0)),r=Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(i)}}))))},3611:function(e,t,n){"use strict";n.r(t),n.d(t,"getEnforcementLevelFromPercentage",(function(){return i})),n.d(t,"getCapacityUsePercentageForTenant",(function(){return l})),n.d(t,"getEnforcementLevelForTenant",(function(){return s})),n.d(t,"hasReachedCapacity",(function(){return c}));var r=n(3612),a=n(1188),o=n(3608);function i(e){return e>=1?r.EnforcementLevel.Severe:e>=.8?r.EnforcementLevel.Warn:r.EnforcementLevel.None}function l(e){var t=0;if(e)for(var n of e.tenantCapacities)if(n.CapacityType===r.CapacityType.M365Database){t=0!==n.TotalCapacity?n.Consumption.Rated/n.TotalCapacity:1;break}return t}function s(e){return i(l(e))}function c(e,t,n){var i=a.featureGates.enableOakdaleEnforcementMessaging?Object(r.getEnforcementLevelForEnvironment)(t,n):r.EnforcementLevel.None,l=o.featureGates.enableOakdaleTenantEnforcementMessaging?s(e):r.EnforcementLevel.None;return i===r.EnforcementLevel.Severe||l===r.EnforcementLevel.Severe}},3612:function(e,t,n){"use strict";var r,a;n.r(t),n.d(t,"EnforcementLevel",(function(){return r})),n.d(t,"CapacityType",(function(){return a})),n.d(t,"getEnforcementLevelForEnvironment",(function(){return o})),function(e){e.Warn="Warn",e.Severe="Severe",e.None="None"}(r||(r={})),function(e){e.Database="Database",e.M365Database="M365Database",e.File="File",e.Log="Log"}(a||(a={}));function o(e,t){return function(e){return e>=1?r.Severe:e>=.8?r.Warn:r.None}(function(e,t){if(e&&e.properties){var n=null==t?void 0:t.get(e.name),r=e.properties.environmentSku;if(n&&"Teams"===r){var o=0;for(var i of n)if(i.capacityType===a.Database){o=i.ratedConsumption/2048;break}return o}}return 0}(e,t))}}}]);
//# sourceMappingURL=https://sourcemaps.powerapps.com/srcmaps/static/js/module/59.f3ab9696.chunk.js.map