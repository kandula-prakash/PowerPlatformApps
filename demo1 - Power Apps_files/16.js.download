(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/16.js?v=1.4.3886-master"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[16],{"0PSL":function(t,e,a){"use strict";a.d(e,"a",(function(){return F}));var s,n=a("SAYH"),i=a("hvSt");!function(t){t[t.Active=0]="Active",t[t.Inactive=1]="Inactive",t[t.Completed=2]="Completed"}(s||(s={}));var r=a("CPoS"),o=a("xMtD"),c=a("odYE"),l=a("2SCk"),u=a("g03H"),d=a("LbMF"),h=a("+nNZ"),g=a("i1f0"),p=a("dHD5"),f=a("iZ7K"),_=a("504W"),m=a("Lyxw"),b=a("9fGf"),v=a("arV0"),P=a("WRF3"),S=a("fU7K"),I=a("H+1e"),y=a("fh2P"),O=a("LDK4"),w=a("zrcT"),C=a("3/02");class F{constructor(t,e,a){this._memorizedExtraFilters=[],this._getState=t,this._businessProcessFlowWrapperIdentifierFactory=e,this._context=a}generate(t,e){return e?this._getBusinessProcessFlowWrapper(t,e):null}getSelectedStageSteps(t,e){if(!e)return[];const a=Object(o.c)(this._getState(),e.getProcessId(),n.a.tryParseOrNull(e.getSelectedStageId()));return a&&this._getSteps(a,t,e)||[]}_getBusinessProcessFlowWrapper(t,e){const a=this._getState(),s=this._businessProcessFlowWrapperIdentifierFactory.generate(t,e);if(!s||!e||!e.getProcessId())return null;const i=e.getCurrentFormEntity(),c=Object(v.j)(a,t);this._navigationEntities=e.getNavigationEntities();const l=Object(h.g)(a,i);return{id:e.getProcessId(),instanceId:e.getProcessInstanceId(),name:Object(r.c)(a,e.getProcessId()),bpfEntityLogicalName:e.getBpfEntityLogicalName(),stages:this._getStages(s.data.activePath,s.activeStageId,s.data.selectedStageId,t,e),relationships:Object(o.e)(this._getState(),e.getProcessId()),activeStageId:s.activeStageId,selectedStageId:s.data.selectedStageId,activePath:s.data.activePath,displayState:s.displayState,currentEntity:new P.a(i.etn,n.a.toLegacyGuid(i.id),i.name),processState:e.getProcessState(),state:e.getState(),status:e.getStatus(),statusName:e.getStatusName(),isFormInactive:Object(g.Rb)(a,c.entityTypeName,c.id),delegates:this._getActions(e),isVisible:e.isVisible(),actionLogs:s.data.actionLogCollection,instanceModifiedTimestamp:l,instanceName:e.getProcessInstanceName(),isCustomControlsPresent:e.getCustomControlIndicator(),isRenderedFromFormXml:e.getFormXmlRenderingIndicator(),isImmersiveBPF:e.isImmersiveBPF(),pageId:t,outerHeaderContainerId:Object(O.b)(t),processControlBreadCrumbId:Object(O.a)(w.b.BreadCrumb,t)}}_getStages(t,e,a,s,i){if(!t||0===t.length)return null;const r={},o=[];return t.forEach((t,c)=>{r[t.guid]=c;const l=n.a.equals(t,a),u=this._getStageWrapper(t,l,e,r,s,i);u&&o.push(u)}),o}_getStageWrapper(t,e,a,s,i,r){const c=Object(o.c)(this._getState(),r.getProcessId(),t);if(!c)return null;let l=e&&this._getSteps(c,i,r)||[];if(Object(m.f)(this._getState(),C.Sb)){const t="BusinessProcessFlow.CustomControlConfiguration",e=this._context.TraceManager.getTracer(t),a=Object(o.a)(this._getState(),r.getProcessId(),e);if(!Object(_.a)(a)&&!Object(_.a)(a.ControlConfigurations)){const s=r.getTelemetryParams();if(s.push({name:"BPFEntityFormId",value:a.Id.guid},{name:"BPFEntityFormType",value:a.FormType}),Object(_.a)(a.ControlConfigurations)||s.push({name:"CustomControls",value:Object.keys(a.ControlConfigurations).length}),r.isBpfFormDescriptorValid(this._getState(),r.getProcessId(),a,e))try{if(!Object(_.a)(a.ControlConfigurations)){const u=Object(o.b)(a,e),d=a.ControlConfigurations,h=this._getNonDefaultControlConfiguration(d);if(Object(m.f)(this._getState(),C.Ub)){const e=this._buildStepsFromFormXml(c,a,h,s,i,r);e&&e.length>0&&(l=e,r.setFormXmlRenderingIndicator(!0),this._context.EventManager.ReportComponentSuccess(t,s))}else Object(_.a)(u)||Object.keys(u).forEach(a=>{if(u[a].ParentCellId){const i=new n.a(u[a].ParentCellId);if((c&&c.stage&&c.stage.steps?c.stage.steps.map(t=>t.stepId.guid).indexOf(i.guid):-1)>=0&&i){const o=[];o.push({name:"StepId",value:i.guid},{name:"NonDefaultControlUniqueId",value:u[a].UniqueId}),e.info("Non-default control found for step",o);let d=null;h&&u[a].UniqueId&&(r.setFormXmlRenderingIndicator(!0),d=h[u[a].UniqueId]?h[u[a].UniqueId]:null);const g={attributeName:u[a].DataFieldName,isRequired:this._getIsStepRequired(i.guid,c),name:u[a].Label,stepId:new n.a(i.guid),stepType:"field",attributeType:this._getMetadataTypeByAttribute(c.entityLogicalName,u[a].DataFieldName),controlName:y.c+u[a].Label,isVisible:u[a].Visible,isControlDisabled:u[a].Disabled,nonDefaultConfiguration:d};l.push(g),Object(_.a)(g.stepId.guid)||g.stepId.guid===n.a.EMPTY.guid||s.push({name:"StepId",value:g.stepId.guid}),s.push({name:"AttributeName",value:g.attributeName},{name:"AttributeType",value:g.attributeType},{name:"IsRequired",value:g.isRequired},{name:"NonDefaultControlUniqueId",value:u[a].UniqueId}),Object(_.a)(d)?this._context.EventManager.ReportComponentFailure(t,new Error("CustomControlConfiguration is null or undefined even though the BPF entity form XML is valid and contains non-default custom control descriptors"),null,s):(r.setCustomControlIndicator(!0),s.push({name:"CustomControlId",value:d.CustomControlId}),!Object(_.a)(d.Name)&&d.Name.indexOf("MscrmControls")>=0&&s.push({name:"CustomControlName",value:d.Name}),this._context.EventManager.ReportComponentSuccess(t,s))}}})}}catch(a){e.error(`Message: ${a.message}, Stack: ${a.stack}`,s),this._context.EventManager.ReportComponentFailure(t,a,null,s)}else this._context.EventManager.ReportComponentFailure(t,new Error("Invalid FormXML - Fallback invoked"),null,s)}}return{id:c.stage.stageId,name:c.stage.stageDisplayName,entityName:c.entityLogicalName,entityDisplayName:Object(f.f)(this._getState(),c.entityLogicalName)||c.entityDisplayName,relatedEntityReference:this._getRelatedEntityReference(c.entityLogicalName),referencingAttributeName:c.referencingAttributeName,status:this._getStageStatus(s[t.guid],s[a.guid],r),steps:l}}_buildStepsFromFormXml(t,e,a,s,i,r){const o=[],c=e.Controls;return!Object(_.a)(c)&&this._areStepsValid(t,e,s)&&Object.keys(c).forEach(l=>{if(!Object(_.a)(c[l])&&c[l].ParentCellId){const u=new n.a(c[l].ParentCellId),d=e.Tabs.find(t=>t.Id===c[l].ParentTabId);if(d&&!Object(_.a)(d.RawTabId)&&t.stage.stageId.guid===new n.a(d.RawTabId).guid){let d=null;a&&c[l].UniqueId!==n.a.EMPTY.guid&&(d=a[c[l].UniqueId]?a[c[l].UniqueId]:null);const h=this._retrieveControlName(c[l],t.stage.steps),p=this._getUIControl(i,h),f={attributeName:c[l].DataFieldName,isRequired:c[l].IsRequired,name:this._retrieveStepLabel(c[l],p,t.stage.steps),stepId:new n.a(u.guid),stepType:this._getStepTypeFromControlKey(l),attributeType:this._getMetadataTypeByAttribute(t.entityLogicalName,c[l].DataFieldName),controlName:h,isVisible:p&&!Object(_.a)(p.visible)?p.visible:c[l].Visible,isControlDisabled:c[l].Disabled||Object(g.v)(this._getState(),{id:i,controlName:h},r.getContextToken()),viewId:p&&p.parameters&&p.parameters.defaultviewid?p.parameters.defaultviewid:null,nonDefaultConfiguration:Object(_.a)(d)?null:d};f.config=this._getConfig(e,r,c[l],i,s),f.viewId&&f.config&&f.config.Parameters&&(this._setLookupViewIdParam(f),this._setLookupExtraFilterParam(f,p)),f.descriptor=Object(I.b)()(this._getState(),{controlName:h,id:i},e.Id),o.push(f),s.push({name:"StepId",value:f.stepId.guid},{name:"AttributeName",value:f.attributeName},{name:"AttributeType",value:f.attributeType},{name:"IsRequired",value:f.isRequired},{name:"NonDefaultControlUniqueId",value:c[l].UniqueId}),Object(_.a)(d)||c[l].UniqueId===n.a.EMPTY.guid||(r.setCustomControlIndicator(!0),s.push({name:"CustomControlId",value:d.CustomControlId}),!Object(_.a)(d.Name)&&d.Name.indexOf("MscrmControls")>=0&&s.push({name:"CustomControlName",value:d.Name}))}}}),o}_setLookupViewIdParam(t){const e=t.config.Parameters.valueSpecification;if(e){const a=JSON.parse(e.Value);a&&(a.ViewId=t.viewId,e.Value=JSON.stringify(a))}t.config.Parameters.value&&(t.config.Parameters.value.ViewId=t.viewId)}_setLookupExtraFilterParam(t,e){t.config.Parameters.value&&e&&e.customFilter&&e.customFilter.length>0&&(this._applyLookupFilter(t,e),t.config.Parameters.value.ExtraFilters=t.extraFilters)}_areStepsValid(t,e,a){if(!(Object(_.a)(e)||Object(_.a)(t)||Object(_.a)(t.stage)||Object(_.a)(t.stage.stageId))){const s=e.Controls,i=t.stage.stageId.guid.toLowerCase(),r=t.stage.steps,o=[];if(!Object(_.a)(s)){if(Object.keys(s).forEach(t=>{if(!Object(_.a)(s[t].ParentCellId)){const a=new n.a(s[t].ParentCellId).guid.toLowerCase(),r=e.Tabs.find(e=>e.Id===s[t].ParentTabId);if(!Object(_.a)(r)&&!Object(_.a)(r.RawTabId)){const t=new n.a(r.RawTabId).guid.toLowerCase();i===t&&o.indexOf(a)<0&&o.push(a)}}}),r.length!==o.length)return a.push({name:"StepFallback",value:"No. of steps in BPF stage don't match no. of cells in corresponding tab"},{name:"BPFStageStepCount",value:r.length},{name:"TabCellCount",value:o.length}),!1;for(let t=0;t<r.length;t++)if(o.indexOf(r[t].stepId.guid.toLowerCase())<0)return a.push({name:"StepFallback",value:"BPF stage stepId does not match corresponding tab's cellId"},{name:"MissingBPFStepId",value:r[t].stepId.guid.toLowerCase()}),!1;return!0}}return!1}_retrieveStepLabel(t,e,a){if(!Object(_.a)(e)&&!Object(_.a)(e.label)&&""!==e.label)return e.label;if(!Object(_.a)(t.Label)&&""!==t.Label)return t.Label;if(!Object(_.a)(a)&&a.length>0)for(const e of a)if(e.stepId.guid===new n.a(t.ParentCellId).guid&&!Object(_.a)(e.label)&&""!==e.label)return e.label;return""}_retrieveControlName(t,e){if(!Object(_.a)(e)&&e.length>0)for(const a of e)if(a.stepId.guid===new n.a(t.ParentCellId).guid&&!Object(_.b)(a.controlName))return a.controlName;return Object(_.a)(t.DataFieldName)||""===t.DataFieldName?"":y.c+t.DataFieldName}_getConfig(t,e,a,s,n){try{const i=Object(g.i)(),r=t&&t.Id,o=e.getCurrentFormEntity();n.push({name:"ControlDescriptorName",value:a&&a.Name});const c=i(this._getState(),a,s,r,o&&o.etn,!1);return n.push({name:"CCFControlConfigID",value:c&&c.CustomControlId},{name:"CCFControlConfigName",value:c&&c.Name},{name:"CCFControlConfigParams",value:c&&c.Parameters&&Object.keys(c.Parameters).join(",")}),c}catch(t){n.push({name:"CCFControlConfigError",value:t})}return null}_getStageStatus(t,e,a){if(null==e||t<e)return s.Completed;if(t===e){return a.getStatus()===i.a.Finished?s.Completed:s.Active}return s.Inactive}_getSteps(t,e,a){const s=[];if(!t.stage||!t.stage.steps||0===t.stage.steps.length)return null;for(const n of t.stage.steps){const i=this._getUIControl(e,n.controlName);let r=null;if(n.name&&n.stepType&&"field"===n.stepType.toLowerCase()){if(r=this._getMetadataTypeByAttribute(t.entityLogicalName,n.name),!r)continue;if(Object(m.f)(this._getState(),C.Sb)){const t="BpfCustomControlSupport",e=this._context.TraceManager.getTracer(t),s=Object(o.a)(this._getState(),a.getProcessId(),e);if(!Object(_.a)(s)&&!Object(_.a)(s.ControlConfigurations)&&a.isBpfFormDescriptorValid(this._getState(),a.getProcessId(),s,e)){const t=Object(o.b)(s,e),a=this._getNonDefaultControlStepIds(t);if(!Object(_.a)(a)&&a.map(t=>t.guid).indexOf(n.stepId.guid)>=0)continue}}}const c=this._getState(),l={attributeName:n.name,controlName:n.controlName,isRequired:n.required,isVisible:!i||i.visible,name:i?i.label:n.label,stepId:n.stepId,stepType:n.stepType,attributeType:r,viewId:i&&i.parameters&&i.parameters.defaultviewid?i.parameters.defaultviewid:n.viewId,isControlDisabled:Object(g.v)(c,{id:e,controlName:n.controlName},a.getContextToken())};l.viewId&&i&&i.customFilter&&i.customFilter&&i.customFilter.length>0&&this._applyLookupFilter(l,i),s.push(l)}return s}_applyLookupFilter(t,e){let a;a=!1;const s=[];if(t&&e){for(let t=0;t<e.customFilter.length;t++){if("END_FLAG"===e.customFilter[t].customFilter){a=!0;break}if("START_FLAG"!==e.customFilter[t].customFilter){const a=Object(l.i)(Object(S.CrmHtmlDecode)(e.customFilter[t].customFilter));a&&(a.conditions&&a.conditions.length>0||a.filters&&a.filters.length>0)&&s.push(JSON.stringify(a))}}a?(this._memorizedExtraFilters=s,t.extraFilters=this._memorizedExtraFilters):t.extraFilters=this._memorizedExtraFilters?this._memorizedExtraFilters:[]}}_getMetadataTypeByAttribute(t,e){const a=this._getState(),s=Object(d.a)(a,t,e);if(!s)return null;const n=`${s.Type}.${s.Format}`;return Object(u.p)(n)}_getActions(t){return{completeProcess:()=>t.completeProcess(),moveNext:()=>t.moveToNextStage(),movePrevious:()=>t.moveToPreviousStage(),setActiveStage:e=>t.setActiveStage(e.guid),setSelectedStage:(e,a=!1)=>{t.setSelectedStage(e?e.guid:null,a)},triggerActionStepClick:e=>{t.triggerActionStepClick(e)},triggerFlowStepClick:(e,a)=>{t.triggerFlowStepClick(e,a)},refreshFlowStepClick:e=>{t.refreshFlowStepClick(e)},setIsUserSelectedStage:e=>{t.setIsUserSelectedStage(e)},setDisplayState:e=>{t.setDisplayState(e)},getForwardNavigationEntities:(e,a,s,n)=>t.getForwardNavigationEntities(e,a,s,n),navigateToNextEntity:(e,a,s,n)=>t.navigateToNextEntity(c.a.fromLegacyEntityReference(e),c.a.fromLegacyEntityReference(a),s,n),executePreEvent:(e,a,s,n,i)=>t.executePreEvent(e,a,s,n,i),validateRequiredFieldsForNavigation:()=>t.ValidateRequiredFieldsForNavigation(),waitForOngoingWork:()=>t.waitForOngoingWork(),getActiveStageActiveFor:()=>t.getActiveStageActiveFor(),getBpfInstanceActiveFor:()=>t.getBpfInstanceActiveFor(),getBpfInstanceCompletedIn:()=>t.getBpfInstanceCompletedIn(),getBpfNavigationBehavior:()=>t.getBpfNavigationBehavior(),setBpfNavigationBehavior:e=>{t.setBpfNavigationBehavior(e)},getBpfNavigationBehaviorAllowCreateNew:e=>t.getBpfNavigationBehaviorAllowCreateNew(e),getActiveStage:()=>{const e=t.getContextToken(),a=t.getScriptContainer().getEventManager().getClientApiForm(e);return a?a.data.process.getActiveStage():null},reportStageNavigationBlockedToBpfChecker:e=>t.reportStageNavigationBlockedToBpfChecker(e)}}_getRelatedEntityReference(t){if(!this._navigationEntities)return null;const e=this._navigationEntities.find(e=>e.entityLogicalName===t);return e?new P.a(e.entityLogicalName,n.a.toLegacyGuid(n.a.parse(e.id))):null}_getUIControl(t,e){if(e){const a=this._getState(),s=Object(p.j)(a,t),n={controlName:e,id:t};return Object(g.Vc)(this._getState(),n,s)}return null}_getNonDefaultControlConfiguration(t){const e={};if(t){const a=Object.keys(t);for(let s=0;s<a.length;s++){let n=null;const i=Object(b.b)(this._getState());n=t[a[s]].CustomControls[i],n&&(e[a[s]]={FormFactor:n.FormFactor,CustomControlId:n.CustomControlId,Name:n.Name,Version:n.Version,Parameters:n.Parameters,ShouldOverrideControlVisible:n.ShouldOverrideControlVisible,DisplayNameKey:n.DisplayNameKey})}}return e}_getNonDefaultControlStepIds(t){const e=[];return t&&Object.keys(t).forEach(a=>{t[a].ParentCellId&&e.push(new n.a(t[a].ParentCellId))}),e}_getIsStepRequired(t,e){const a=e.stage.steps,s=a?a.map(t=>t.stepId.guid).indexOf(t):-1;return s>=0&&!Object(_.a)(a[s].required)&&a[s].required}_getStepTypeFromControlKey(t){return t.endsWith(y.a)?"action":t.endsWith(y.d)?"modernflow":"field"}}},"1ZrY":function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var s=a("XhkN");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function n(t){return{type:s.c,payload:{displayState:t}}}},"23K5":function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var s=a("SAYH");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class n{generate(t,e){if(!e||!e.getProcessId())return null;return{businessProcessFlowInstanceId:e.getProcessInstanceId(),activeStageId:s.a.tryParseOrNull(e.getActiveStageId()),displayState:e.getDisplayState(),processState:e.getProcessState(),state:e.getState(),status:e.getStatus(),isVisible:e.isVisible(),data:{activePath:e.getActivePath(),selectedStageId:s.a.tryParseOrNull(e.getSelectedStageId()),businessProcessFlowId:e.getProcessId(),actionLogCollection:e.getActionLogCollection(),processNavigationBehavior:{navigationBehavior:e.getBpfNavigationBehavior()}}}}}},"8O0c":function(t,e,a){"use strict";a.d(e,"a",(function(){return f}));var s=a("Lyxw"),n=a("INOZ"),i=a("Nb1E"),r=a("7tM0"),o=a("504W"),c=a("3/02");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const l="ProcessControl_ActionExecuter_ExecutionTimeTooltip",u="ProcessControl_ActionExecuter_ErrorMessageTooltip",d="cc_MscrmControls.Containers.ProcessBreadCrumb/strings/ProcessControlResources";var h;function g(t){switch(t){case h.InProgress:case h.Waiting:return 1;case h.Succeeded:return 2;case h.Failed:case h.Canceled:return 3;default:return 0}}function p(t,e,a,s){let n="";if(Object(o.b)(t)||(n=String.format(s[l],new Date(t).toLocaleString())),a===h.Failed){const t=Object(o.b)(e)?s.Crm_GenericErrorMessage:e;n+="\n"+String.format(s[u],t)}return""===n?e:n}function f(t,e,a){return{type:"businessProcessFlow.actionLogs.retrieve",execute({dispatch:o,getState:h},f){const _=String.format("?$select=workflowlogid,message,status,modifiedon,stepname,activityname,_asyncoperationid_value&$filter=activityname%20eq%20'{0}'%20and%20_asyncoperationid_value%20eq%20{1}&$orderby=modifiedon%20desc&$top=500",e.guid,a.id.guid),m=h();if(function(t){return Object(s.f)(t,c.B)}(m))return o(Object(i.e)("workflowlog",_)).then(e=>{if(e.value&&e.value.length){const s={};s[l]=Object(r.a)(m,d,l),s[u]=Object(r.a)(m,d,u),s.Crm_GenericErrorMessage=Object(r.a)(m,d,"Crm_GenericErrorMessage");const i={};e.value.forEach(t=>{if(t.stepname&&-1===Object.keys(i).indexOf(t.stepname)){const e={actionLogId:t.workflowlogid,status:g(t.status),modifiedOn:t.modifiedon,stepId:t.stepname,processDefinitionid:t.activityname,processInstanceid:t._asyncoperationid_value,message:p(t.modifiedon,t.message,t.status,s)};i[t.stepname]=e}});const c={actionLogCollection:i};return o(Object(n.a)(t,c,a))}})}}}!function(t){t[t.InProgress=1]="InProgress",t[t.Succeeded=2]="Succeeded",t[t.Failed=3]="Failed",t[t.Canceled=4]="Canceled",t[t.Waiting=5]="Waiting"}(h||(h={}))},"9x9u":function(t,e,a){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function s(t){return t.businessProcessFlowDisplayState}a.d(e,"a",(function(){return s}))},Co7m:function(t,e,a){"use strict";a.d(e,"a",(function(){return T}));var s=a("TAjd"),n=a("SAYH"),i=a("504W"),r=a("WPtp"),o=a("CPoS"),c=a("5Oca"),l=a("+nNZ"),u=a("odYE"),d=a("0PSL"),h=a("23K5"),g=a("bJaF"),p=a("KGWS"),f=a("ccIw"),_=a("arV0"),m=a("rodW"),b=a("eXjw"),v=a("k1f1"),P=a("AFlp"),S=a("c7jw"),I=a("INOZ"),y=a("PUjk"),O=a("i1f0"),w=a("7LBy"),C=a("2Ct/"),F=a("iZ7K"),j=a("D4Jo"),E=a("JF0K");let N;class T{static get Instance(){return N||(N=new T,Object(y.c)(N)),N}init(t,e,s){return this._getState&&this._businessProcessPerPageWrapper?Promise.resolve():(this._applicationContext=t,this._reloadDataCount=0,this._getState=e,this._dispatch=s,this._processManager=new g.a(t,e,s,new f.a,new p.a),this._businessProcessFlowWrapperIdentifierFactory=new h.a,this._businessProcessFlowWrapperFactory=new d.a(e,this._businessProcessFlowWrapperIdentifierFactory,t),a.e(101).then(a.bind(null,"esKF")).then(({BusinessProcessPageWrapper:t})=>{this._businessProcessPerPageWrapper=new t(this._applicationContext,this._getState,this._dispatch)}))}getBusinessProcessFlowWrapper(t,e){return Object(C.g)(this._getState())?this._businessProcessPerPageWrapper.getBusinessProcessFlowWrapper(t,e):(this._reloadDataIfRequired(t,e),this._businessProcessFlowWrapperFactory.generate(t,this._processManager))}getProcessManager(t,e){return Object(C.g)(this._getState())?this._businessProcessPerPageWrapper.getProcessManager(t,e):(this._reloadDataIfRequired(t,e),this._processManager)}getCurrentProcessManagerWithoutInit(t){if(!Object(C.g)(this._getState()))return this._processManager;if(this._businessProcessPerPageWrapper)return this._businessProcessPerPageWrapper.getCurrentProcessManagerWithoutInit(t);const e=Object(_.j)(this._getState(),t),a=e&&e.entityTypeName?new u.a(e.entityTypeName,e.id):null,s=this._applicationContext.TraceManager.getTracer("BusinessProcessWrapperManager.GetProcessManagerWithoutinit"),n=Object(j.a)(this._getState(),a,t,this._applicationContext);return s.warn("BusinessProcessWrapperManager: BusinessProcessPerPageWrapper is not initialized",n),null}hasChanged(t,e,a,s){if(!Object(C.g)(this._getState())){if(Object(C.h)(t,null==e?void 0:e.entityTypeName)&&(!Object(C.e)(t)||Object(C.d)(t,s)))return!0;if(!e)return!1;const n=new u.a(e.entityTypeName,e.id),r=Object(l.g)(t,n);return!Object(i.a)(r)&&(!a||r>a.instanceModifiedTimestamp)||this._needsDockedModeRefresh(a,e)||Object(C.c)(a,()=>this._getSelectedStageSteps(s))}return this._businessProcessPerPageWrapper.hasChanged(t,e,a,s)}_needsDockedModeRefresh(t,e){return this._processManager.getDisplayState()===s.a.expanded&&t.isFormInactive!==Object(O.Rb)(this._getState(),e.entityTypeName,e.id)}_getSelectedStageSteps(t){return this._businessProcessFlowWrapperFactory.getSelectedStageSteps(t,this._processManager)}_reloadData(t,e){const a=this._getState();this._pageId=t,this._pageInfo=e;const s=Object(_.j)(a,t);if(!s)return;const d=s.id,h=new u.a(s.entityTypeName,d);if(this._processIdInState=Object(c.e)(a,h),Object(C.h)(a,s.entityTypeName)&&(!Object(C.e)(a)||Object(C.d)(a,t))){const e=this._processManager.getTelemetryParams();return this._processManager.isVisible()&&this._processManager.setVisible(!1),this._processManager.initializeWithFormEntityOnly(h,t),void Object(j.c)(E.g,e,this._applicationContext)}const g=Object(w.a)(s),p=Object(w.b)(s);if(n.a.equals(h.id,n.a.EMPTY)&&g&&p){const e=Object(o.b)(a,g),n=new u.a(e.businessProcessFlowUniqueName,p),r=Object(l.b)(a,n);return Object(i.a)(this._lastPageEntityFromCrossEntity)||Object(i.a)(h)||this._lastPageEntityFromCrossEntity.etn===h.etn||this._moveToNextStageForCrossEntityBPF(r,s),void this._processManager.initializeWithProcessAndFormEntity(r,e,h,g,n,t)}if(this._processIdInState){const e=Object(o.b)(a,this._processIdInState);if(!Object(i.a)(e)&&Object(b.b)(e.initialized)){const s=new u.a(e.businessProcessFlowUniqueName,Object(c.f)(a,h)),o=Object(l.b)(a,s);if(n.a.equals(h.id,n.a.EMPTY)){const a=Object(C.b)(e);if(this._lastPageIdInNewForm!==t&&(this._lastPageIdInNewForm=t,this._dispatch(Object(I.a)(t,null,s))),a&&a.stage&&a.stage.stageId){const n=Object(C.a)(a);return this._dispatch(Object(S.b)(s,n)),void this._processManager.initializeWithProcessAndFormEntity(n.fields,e,h,this._processIdInState,s,t)}}else if(Object(i.a)(o))return;const d=Object(F.h)(a,h.etn);if(d&&d.IsBPFEntity)return void this._processManager.initializeWithProcessAndFormEntity(o,e,h,this._processIdInState,s,t);for(const a in o)if(Object(r.k)(o[a])&&o[a].reference&&o[a].reference.id&&o[a].reference.etn===h.etn&&(n.a.equals(o[a].reference.id,h.id)||n.a.equals(o[a].reference.id,n.a.EMPTY))&&Object(C.f)(a))return void this._processManager.initializeWithProcessAndFormEntity(o,e,h,this._processIdInState,s,t);const g=this._dispatch(Object(v.b)(n.a.EMPTY,h)),p=this._dispatch(Object(P.b)(n.a.EMPTY,h));Promise.all([g,p]).then(e=>{this._processManager.initializeWithFormEntityOnly(h,t)})}else this._processManager.initializeWithFormEntityOnly(h,t)}else this._processManager.initializeWithFormEntityOnly(h,t)}_reloadDataIfRequired(t,e){const a=this._getState(),s=this._processManager.getCurrentFormEntity();this._lastPageEntityFromCrossEntity=s;let i=null,r=!1;if(s&&(i=Object(c.b)(s)(a,s.etn),i&&(r=i.refreshGlobalNavigationData)),!Object(C.h)(a,null==s?void 0:s.etn)&&(!this._pageInfo||!n.a.equals(this._pageInfo.id,e.id)||this._pageId!==t||this._hasProcessChanged(e)||r)||Object(C.h)(a,null==s?void 0:s.etn)&&this._processManager.getProcessId()){if(i&&i.refreshGlobalNavigationData&&this._dispatch(Object(m.b)(!1,s)),this._reloadDataCount<30)this._reloadData(t,e);else if(this._pageId!==t&&(this._reloadDataCount=0),30===this._reloadDataCount){const t=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ReachMaxBpfReloadDataCount"),e=this._processManager.getTelemetryParams();t.error("Max BPF reloadData count reached limit of 30. Root cause may be infinite loop when rendering the ProcessControl.",e)}this._reloadDataCount++}else this._reloadDataCount=0}_hasProcessChanged(t){const e=this._processIdInState||n.a.EMPTY,a=this._getState(),s=new u.a(t.entityTypeName,t.id),i=Object(_.j)(a,this._pageId),r=Object(w.a)(i),l=n.a.equals(s.id,n.a.EMPTY)&&r?r:Object(c.e)(a,s)||n.a.EMPTY;if(!n.a.equals(l,e))return!0;if(n.a.equals(l,n.a.EMPTY))return!1;const d=Object(o.b)(a,l);return!!d&&this._processManager.getVersion()<d.businessProcessFlowProcessVersion}_moveToNextStageForCrossEntityBPF(t,e){const a=t.activestageid,s=t.traversedpath;let i=e.data.nextStageId;if(!i){const t=Object(w.a)(e),a=Object(w.b)(e);if(!n.a.equals(t,this._processManager.getProcessId())||!n.a.equals(a,this._processManager.getProcessInstanceId()))return;i=this._processManager.getStageMetadata().getNextStageId(this._processManager.getActiveStageId())}if(!n.a.equals(a.reference.id,new n.a(i))){a.reference=new u.a("processstage",new n.a(i)),s.value=s.value+","+i;t.activestagestartedon.value=new Date}}}},D4Jo:function(t,e,a){"use strict";a.d(e,"a",(function(){return h})),a.d(e,"c",(function(){return g})),a.d(e,"b",(function(){return p}));var s=a("+QYJ"),n=a("Uv1Y"),i=a("bT7G"),r=a("JF0K"),o=a("SAYH"),c=a("5Oca"),l=a("+nNZ"),u=a("arV0"),d=a("504W");function h(t,e,a,s){const n=[];try{const s=e&&Object(c.e)(t,e)?Object(c.e)(t,e):o.a.EMPTY,i=e&&Object(c.f)(t,e)?Object(c.f)(t,e):o.a.EMPTY,r=s&&!o.a.equals(s,o.a.EMPTY)?function(t,e){const a=Object(l.a)(t,e);if(a)return a.businessProcessFlowProcessState;return null}(t,s):0,d=Object(u.p)(t,a),h={name:"ProcessId",value:s?o.a.toString(s):o.a.EMPTYGUIDSTRING},g={name:"ProcessInstanceId",value:i?o.a.toString(i):o.a.EMPTYGUIDSTRING},p={name:"CurrentFormEntityType",value:e&&e.etn?e.etn:""},f={name:"CurrentFormEntityId",value:e&&e.id?o.a.toString(e.id):""},_={name:"ProcessState",value:r},m={name:"PageId",value:a||""},b={name:"PageType",value:d};n.push(h),n.push(g),n.push(p),n.push(f),n.push(_),n.push(m),n.push(b)}catch(t){s.TraceManager.getTracer("BusinessProcessFlow.TelemetryGeneration").error("Exception while generating businessprocess telemetry parameters: "+t.message,n)}return n}function g(t,e,a){a.EventManager.ReportComponentSuccess(t,e)}function p(t,e,a,o,c,l,u){!function(t,e){if(!Object(s.c)(t)){const a=Object(n.c)(t);if(!Object(s.c)(a)){const t=a.errorCode;if(!Object(s.c)(t)){const a={name:"ErrorCode",value:"0x"+t.toString(16)};e.push(a)}}}}(e,o),function(t,e,a,o){if(!Object(s.c)(t)){const c=Object(n.c)(t);if(!Object(s.c)(c)&&!Object(s.c)(c.FaultedSnapshotId)){const t={name:r.v,value:c.FaultedSnapshotId};if(e.push(t),!Object(s.c)(a)&&!Object(s.c)(o)){const t=Object(i.c)(o,a);if(!Object(s.c)(t)){const a=t.snapshotId;if(!Object(s.c)(a)&&!Object(d.b)(a)&&a===c.FaultedSnapshotId){const t={name:r.w,value:"serverSideCurrentForm"};e.push(t)}}}}}}(e,o,l,u),c.EventManager.ReportComponentFailure(t,e,a,o)}},"H+1e":function(t,e,a){"use strict";a.d(e,"a",(function(){return M})),a.d(e,"b",(function(){return x})),a.d(e,"d",(function(){return B})),a.d(e,"c",(function(){return A}));var s=a("2YQW"),n=a("+QYJ"),i=a("y60j"),r=a("i1f0"),o=a("Z/4N"),c=a("arV0"),l=a("WIoD"),u=a("izYK"),d=a("unFF"),h=a("ZGH+"),g=a("Oyec"),p=a("Lyxw"),f=a("3/02");var _=a("jRy5"),m=a("dHD5"),b=a("iZ7K"),v=a("69Qu"),P=a("BFlg"),S=a("P6DH"),I=a("GYEz"),y=a("SAYH"),O=a("sZ+8"),w=a("LbMF"),C=a("4leG"),F=a("zmL5"),j=a("YxC/"),E=a("1fn7");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const N=[u.a.LookupSimple,u.a.LookupPartyList,u.a.LookupRegarding,u.a.LookupOwner,u.a.LookupCustomer,u.a.LookupMultiEntity],T=[l.c,l.i,l.h];var M;function x(){let t=null,e=null,a=null,s=null;return(o,l,u)=>{if(!l.controlName)return e;if(null===s&&(s=Object(p.f)(o,f.fg)),u=u||Object(F.b)(o,l.id)){const d=Object(m.j)(o,l.id);let h=Object(i.a)(o,l.id,u,l.controlName);if(h){let i=h.Visible,u=h.Label,g=h.Disabled,p=h.Parameters&&h.Parameters.DisableMru,f=h.Url;const _=Object(r.y)(o,l,d);n.c(_)||(u=_);const b=Object(r.I)(o,l,d);n.c(b)||(i=b);const I=Object(r.v)(o,l,d);n.c(I)||(g=I);const O=Object(r.F)(o,l,d);n.c(O)||(f=O);const w=Object(r.z)(o,l,d);n.c(w)||(p=w);let C=y.a.tryParseOrNull(Object(r.N)(o,l.id,l.controlName,d));if(C&&y.a.equals(C,a)){const t=Object(m.q)(d,l.controlName),e=Object(m.w)(t),a=Object(m.h)(e);C=Object(S.V)(o,l.id,a,l.controlName)||C}if(!y.a.equals(C,a)){a=C;for(const t in h.Parameters)if(h.Parameters[t].Name===P.T){h=Object.assign({},h),s&&(h.Parameters=Object.assign({},h.Parameters),h.Parameters[t]=Object.assign({},h.Parameters[t])),h.Parameters[t].Value=y.a.toString(C);break}h.Parameters[P.T]=y.a.toString(C)}if("TaskBasedFlow"!==Object(c.p)(o,l.id)||Object(v.c)(o)||(g=!0),h!==t||i!==e.Visible||u!==e.Label||g!==e.Disabled||f!==e.Url||p!==e.Parameters.DisableMru){t=h;const a=f?Object.assign(Object.assign({},t.Parameters),{Url:f,isCustomSrc:Object(r.G)(o,l,d),length:t.Parameters.length}):t.Parameters;e=Object.assign(Object.assign({},h),{Visible:i,Label:u,Disabled:g,Url:f,Parameters:a}),e.Parameters.DisableMru=p}}else t=null,e=null}return e}}function B(){let t=null,e=null,a=null,i=null,S=null,M=null,B=null,D=null,k=null,R=null,L=null,V=null,q=!1,U=0,W=null,z=!1,H={descriptor:null,configuration:null,configurations:null,contextKey:null,defaultCellStyle:null,spacerCellStyle:null,extraSidePaddingStyle:null,parentContextToken:null,formInfo:null,clientHost:null,clientHostSubtype:null,isRemoteAvailable:!1,isEntityEnabledForOffline:!1,informationAvailableToRender:!1,cellControlMode:0,isCreateForm:!1,isRelatedDataSetControl:!1,isPreviewMode:!1,isReactInstancePageCachingEnabled:!1};const G=Object(r.i)(),Y=x(),X=function(){let t=null;return(e,a,s)=>{const i=s;if(i&&i.Relationship){const s=Object(r.X)(e,a,i.Relationship);if(s)t&&t.EntityName===s.etn&&t.RecordId===s.id.guid||(t={EntityName:s.etn,RecordId:s.id.guid});else{const s=Object(c.j)(e,a.id);if(s){const a=Object(b.y)(e,s.entityTypeName,i.Relationship);a&&a.ReferencedEntity&&(t&&t.EntityName===a.ReferencedEntity&&n.c(t.RecordId)||(t={EntityName:a.ReferencedEntity}))}}}return t}}(),$=A(),J=
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function(){let t=null,e=null;return function(a,s){const n=Object(d.a)(a);if(e!==n){e=n;const s=Object(g.a)(n),i=Object(p.f)(a,f.uc)?36:Object(h.a)(n.sizes.Section.cellHeightInRem);t={defaultCellStyle:{flex:"1 1 auto",width:"100%",whiteSpace:"nowrap",overflowX:"hidden",overflowY:"hidden",minHeight:i+"px"},spacerCellStyle:{height:n.sizes.Measures.Measure350},extraSidePaddingStyle:{paddingLeft:s.paddingLeft,paddingRight:s.paddingRight,width:"auto"}}}return t}}();return(h,g)=>{const b=Y(h,g);let x=e,A=i,K=S,Z=M;const Q=X(h,g,b),tt=Object(I.a)(h),et=Object(I.e)(h);let at=!0;b&&b.Relationship&&Q&&n.c(Q.RecordId)&&(b.Disabled=!0);const st=Object(F.b)(h,g.id),nt=b?Object(o.b)(h,b.UniqueId,st):null;if(b||1!==U||(U=0,x=null),(b&&(b!==t||b.Parameters.hasOwnProperty(r.e))||0!==U)&&(x=G(h,b,g.id,st,Q&&Q.EntityName,!1,K)),0===U&&x&&b&&b.Parameters&&Object(p.f)(h,f.O)){const t=b.Parameters,e=y.a.tryParse(t.VisualizationId);y.a.isNullOrEmpty(e)||"Chart"!==t.ChartGridMode||(U=2)}!A&&x&&(Z=Object(m.j)(h,g.id),K=Object(m.q)(Z,g.controlName),A=Object(m.w)(K));const it=Object(r.w)(h,{id:g.id,controlName:g.controlName},Z)?Object(j.b)(h,E.d)||"The control has been disabled with a URL parameter":null;if(0===U&&x){const t=b&&b.ClassId&&b.ClassId.guid?b.ClassId.guid:null;t&&u.a.ClassIdControlMap[t.toLowerCase()]===P.J&&(U=1),0===U&&x&&x.Parameters&&Object.keys(x.Parameters).map(t=>x.Parameters[t]).filter(t=>t.Type===u.a.Grid).length>0&&(U=1)}if(1===U)K=Object(m.q)(Z,b.Name),A=Object(m.w)(K);else if(x&&x.Parameters&&x.Parameters.value){const t=x.Parameters.value;if(N.indexOf(t.Type)>-1){const e=t;if(e){const t=Object(r.E)(h,g.id,x.Name,Object(m.j)(h,g.id)),a=t&&t.parameters&&t.parameters.DefaultViewId,s=t&&t.parameters&&t.parameters.defaultviewid;s?e.ViewId=s:a&&(e.ViewId=a)}}}D=$(g,h,K);const rt=Object(s.e)(M,Z),ot=Object(s.e)(S,K),ct=Object(v.c)(h),lt=!(!Q||!Q.EntityName)&&Object(O.n)(h,Q.EntityName);if(K&&K.parentContextToken&&K.parentContextToken.contextTokenType===_.a.MainForm&&Object(r.dd)(h,g.id,b)){let t=K.parentContextToken.entityTypeName;if(Q&&Q.EntityName)t=Q.EntityName;else{const e=Object(c.j)(h,g.id);e&&e.entityTypeName&&(t=e.entityTypeName)}Object(w.a)(h,t,b.DataFieldName)||(at=!1)}const ut=Object(r.kd)(h,g.id);let dt=!1;1!==U&&2!==U||(dt=!!(b&&b.Parameters&&b.Parameters.RelationshipName));const ht=Object(p.f)(h,f.gg);if(b!==t||x!==e||Q!==B||a!==nt||!rt||!ot||k!==tt||R!==et||L!==ct||V!==lt||q!==at||U!==H.cellControlMode||ut!==H.isCreateForm||dt!==H.isRelatedDataSetControl||W!==it||z!==ht){const s=J(h,g);if(b&&b.ClassId&&(y.a.equals(b.ClassId,l.e)&&(s.defaultCellStyle.overflowX="visible",s.defaultCellStyle.overflowY="visible"),gt=b.ClassId,T.filter(t=>y.a.equals(gt,t)).length>0)){const t=Object(d.a)(h);s.defaultCellStyle.minHeight=(g.rowSpan?g.rowSpan:1)*t.sizes.Section.cellHeightInRem+"rem"}H={descriptor:b,configuration:x,configurations:nt,contextKey:A,contextToken:K,defaultCellStyle:s.defaultCellStyle,spacerCellStyle:s.spacerCellStyle,extraSidePaddingStyle:s.extraSidePaddingStyle,parentContextToken:Z,customControlPropertyBag:D,formInfo:Q,clientHost:tt,clientHostSubtype:et,isRemoteAvailable:ct,isEntityEnabledForOffline:lt,informationAvailableToRender:at,cellControlMode:U,isCreateForm:ut,isRelatedDataSetControl:dt,isPreviewMode:Object(C.e)(h),controlDisabledByConfigFlagMessage:it,isReactInstancePageCachingEnabled:ht},t=b,e=x,i=A,S=K,M=Z,B=Q,a=nt,k=tt,R=et,L=ct,V=lt,q=at,W=it,z=ht}var gt;return H}}function A(){const t={Usage:1,Static:!0,Type:"WholeNumber.None",Value:0,Primary:!1},e={Usage:1,Static:!0,Type:"WholeNumber.None",Value:0,Primary:!1},a={Usage:1,Static:!0,Type:"WholeNumber.None",Value:M.EditForm,Primary:!1},s={Usage:1,Static:!0,Type:"TwoOptions",Value:!1,Primary:!1},n={Usage:1,Static:!0,Type:"TwoOptions",Value:!1,Primary:!1},i={Usage:1,Static:!0,Type:"TwoOptions",Value:!0,Primary:!1},o={Usage:1,Static:!0,Type:"TwoOptions",Value:!1,Primary:!1};let l={deviceSizeMode:t,viewportSizeMode:e,syncError:s,isEmpty:i,scope:a,forceColumnLayout:n,autoExpand:o};return(u,h,g)=>{const p=Object(r.Lc)(h,u,g),f=function(t,e){var a;const s=Object(d.a)(t),n=s.sizes.Breakpoints.DimensionM,i=s.sizes.Breakpoints.DimensionS,r=null===(a=Object(c.q)(t,e))||void 0===a?void 0:a.width;return r<i?2:r<n?1:0}(h,u.id),_=1===u.cellLabelPosition;return u.cellSizeMode===t.Value&&p===s.Value&&u.scope===a.Value&&f===e.Value&&_===n.Value&&u.autoExpand===o.Value||(t.Value=u.cellSizeMode,e.Value=f,a.Value=u.scope,s.Value=p,n.Value=_,o.Value=u.autoExpand,l={deviceSizeMode:t,viewportSizeMode:e,scope:a,isEmpty:i,syncError:s,forceColumnLayout:n,autoExpand:o}),l}}!function(t){t[t.Header=0]="Header",t[t.EditForm=1]="EditForm",t[t.Footer=2]="Footer"}(M||(M={}))},INOZ:function(t,e,a){"use strict";a.d(e,"a",(function(){return u}));var s=a("SAYH"),n=a("XhkN"),i=a("Lyxw"),r=a("dpM5"),o=a("lq82"),c=a("arV0");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const l=n.a+".sync";function u(t,e,a){return{type:l,sync:!0,execute(l,u){if(l.dispatch(function(t,e,a){const i={dataById:{[s.a.toString(a.id)]:e}};return{type:n.a,payload:i,meta:{pageId:t}}}(t,e,a)),!s.a.isNullOrEmpty(null==e?void 0:e.selectedStageId)&&Object(i.f)(l.getState(),r.x)){const a=Object(c.j)(l.getState(),t),n=s.a.tryParse(null==a?void 0:a.selectedStageId);if(!s.a.isNullOrEmpty(n)&&!s.a.equals(e.selectedStageId,n)){const s=Object.assign(Object.assign({},a),{selectedStageId:e.selectedStageId.guid});l.dispatch(Object(o.c)(s,t))}}}}}},JF0K:function(t,e,a){"use strict";a.d(e,"j",(function(){return s})),a.d(e,"k",(function(){return n})),a.d(e,"t",(function(){return i})),a.d(e,"a",(function(){return r})),a.d(e,"m",(function(){return o})),a.d(e,"d",(function(){return c})),a.d(e,"h",(function(){return l})),a.d(e,"i",(function(){return u})),a.d(e,"b",(function(){return v})),a.d(e,"f",(function(){return P})),a.d(e,"p",(function(){return S})),a.d(e,"q",(function(){return I})),a.d(e,"g",(function(){return y})),a.d(e,"w",(function(){return O})),a.d(e,"v",(function(){return w})),a.d(e,"r",(function(){return d})),a.d(e,"s",(function(){return h})),a.d(e,"n",(function(){return g})),a.d(e,"o",(function(){return p})),a.d(e,"c",(function(){return f})),a.d(e,"u",(function(){return _})),a.d(e,"e",(function(){return m})),a.d(e,"l",(function(){return b}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const s="BusinessProcessFlow.MoveToNextStage",n="BusinessProcessFlow.MoveToPreviousStage",i="BusinessProcessFlow.SetActiveStage",r="BusinessProcessFlow.AbandonProcess",o="BusinessProcessFlow.ReactivateProcess",c="BusinessProcessFlow.CompleteProcess",l="BusinessProcessFlow.InitializeWithFormEntityOnly",u="BusinessProcessFlow.InitializeWithProcessAndFormEntity",d="BusinessProcessFlow.SetActiveProcess",h="BusinessProcessFlow.SetActiveProcessInstance",g="BusinessProcessFlow.Branching.Reflow",p="BusinessProcessFlow.Branching.ReflowInternal",f="BusinessProcessFlow.ProcessManager.CallPblToEvaluateBranching",_="BusinessProcessFlow.DefaultPathManager.UpdateDefaultPath",m="BusinessProcessFlow.ProcessManager.CreateActiveStageSnapshot",b="BusinessProcessFlow.ProcessManager.GenerateBPFInstanceSnapshotId",v="BusinessProcessFlow.ActionStep",P="BusinessProcessFlow.FlowStepWidget",S="BusinessProcessFlow.RefreshFlowStep",I="BusinessProcessFlow.RenderProcessControl",y="BusinessProcessFlow.HideProcessControlForUciOffline",O="SaveFailureReason",w="faultedSnapshotId"},KGWS:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class s{constructor(t,e){this._traversedPath=t,this._stageId=e}get traversedPath(){return this._traversedPath}set traversedPath(t){this._traversedPath=t}get stageId(){return this._stageId}set stageId(t){this._stageId=t}}var n=a("sxfa"),i=a("SAYH");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class r{get globalPathAndActiveStage(){return this._globalPathAndActiveStage}get navigationEntities(){return this._navigationEntities}get navigationEntityIdsByEntityLogicalName(){return this._navigationEntityIdsByEntityLogicalName}set globalPathAndActiveStage(t){(t||this._globalPathAndActiveStage||this._globalPathAndActiveStage.stageId===t.stageId)&&(this._globalPathAndActiveStage=t)}InitGlobalPathAndActiveStage(t){this._updateNavigationDictionary(t.navigationEntities),this.UpdateGlobalPathAndActiveStage(t.traversedPath,t.activeStageId)}UpdateGlobalPathAndActiveStage(t,e){this.globalPathAndActiveStage=new s(new n.a(t),e)}_updateNavigationDictionary(t){if(t){this._navigationEntities=t,this._navigationEntityIdsByEntityLogicalName={};for(let e=0;e<t.length;e++)this._navigationEntityIdsByEntityLogicalName[t[e].entityLogicalName]=new i.a(t[e].id)}}}},LDK4:function(t,e,a){"use strict";a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return r}));var s=a("zrcT"),n=a("O7zD");function i(t,e){return Object(n.h)("processControl"+s.b[t],e)}function r(t){return Object(n.h)("outerHeaderContainer",t)}},OWbt:function(t,e,a){"use strict";a.d(e,"f",(function(){return Et})),a.d(e,"i",(function(){return ht})),a.d(e,"j",(function(){return Pt})),a.d(e,"k",(function(){return St})),a.d(e,"l",(function(){return It})),a.d(e,"c",(function(){return ft})),a.d(e,"d",(function(){return _t})),a.d(e,"a",(function(){return ut})),a.d(e,"b",(function(){return dt})),a.d(e,"e",(function(){return gt})),a.d(e,"g",(function(){return jt})),a.d(e,"h",(function(){return Ft}));var s=a("4leG"),n=a("SAYH"),i=a("y60j"),r=a("Uv1Y"),o=a("i1f0"),c=a("nC8a"),l=a("Z/4N"),u=a("arV0"),d=a("odYE"),h=a("/A0C"),g=a("LbMF"),p=a("IqkD"),f=a("mIxf"),_=a("1qQb"),m=a("FZDd"),b=a("WY/A"),v=a("Dea/"),P=a("iZ7K"),S=a("5Oca"),I=a("IVVt"),y=a("zJrS"),O=a("Oawc"),w=a("aRLb");var C=a("3hnk"),F=a("qTme"),j=a("dMZy"),E=a("lLEV"),N=a("5ZBI");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const T="CustomControlFramework.Selectors.DynamicDataSelectors.CustomControlTimelineWallSelector";var M=a("E5qG"),x=a("dHD5"),B=a("EY5k"),A=a("YGjz"),D=a("3mEc"),k=a("8nT0"),R=a("Co7m"),L=a("bT7G"),V=a("AF/G"),q=a("1usl"),U=a("4Us1"),W=a("99zj"),z=a("E8F2"),H=a("YxC/"),G=a("HfZT"),Y=a("74Tm"),X=a("9fGf"),$=a("/qEh"),J=a("ldGr"),K=a("NUHF"),Z=a("3/02"),Q=a("Lyxw"),tt=a("N6E8"),et=a("izYK"),at=a("p8cR"),st=a("pF61"),nt=a("jq7Z"),it=a("wL2W"),rt=a("iTMV"),ot=a("pEXn"),ct=a("+Qpx");var lt=a("5iTp");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */const ut="form.initialize",dt="form.xrmready";function ht(t,e,a,s,c){const l=[{name:"formId",value:n.a.toString(t)},{name:"pageId",value:e},{name:"contextKey",value:Object(x.w)(a)}];return{type:"form.initialize.async",execute({dispatch:_,getState:m},b,v){var S;const I=m(),y=Object(u.j)(I,e),{entityTypeName:O,data:w,recordSetQueryKey:F}=y,j=b.TraceManager.getTracer("Forms.InitializeForm"),B=[];let A;if(l.push({name:"isPreview",value:y&&y.isPreview}),l.push({name:"EntityName",value:y&&y.entityTypeName}),j.info("initializeForm started.",l),Object(at.b)(function(t){return()=>{const e={},a={},s={};return(n,i,r,o,c)=>{N.a.info(T+r.controlId+": createGetTimelineWallData started");let l=!1;a.hasOwnProperty(n)&&a[n]||(a[n]=new E.a(t,n,r.id));const u=a[n],d=u.retrieveTimelineWallObject(i,r,o,c,t);s.hasOwnProperty(n)&&s[n]&&d===s[n]||(s[n]=d,l=!0);const h=u;return l&&(e[n]=h),N.a.info(T+r.controlId+": createGetTimelineWallData finished"),e[n]}}}(_),et.a.TimelineWall),j.info("BusinessProcessWrapperManager.Instance.init started.",l),B.push(R.a.Instance.init(b,m,_).then(()=>j.info("BusinessProcessWrapperManager.Instance.init completed.",l))),Object(C.a)(I,t))if(Object(o.kd)(I,e)){if(!Object(C.g)(I,O,1,0)&&!(null==y?void 0:y.isPreview))return pt(22e8,_,j,v,I,e)}else{if(!Object(C.g)(I,O,2,0))return pt(2147746342,_,j,v,I,e)}const L=Object(i.h)(I,t),U=jt(I,L,t,e,a,_),H=wt(I,O,L),X=function(t,e,a,s){const n={};if(e&&e.RelatedEntityAttributes&&s)for(const i in e.RelatedEntityAttributes){const r=Object(P.y)(t,s,i);if(r&&r.ReferencedEntity){const s={},o=Ct(t,r.ReferencedEntity,e.RelatedEntityAttributes[i]),c=Object(x.n)(a,i);n[Object(x.w)(c)]={attributes:o,submitModes:s}}}return n}(I,L,a,O),st=Object(Y.a)(I),nt=Object(p.s)(I);Nt(I,_,t,U,H,e,a,X,nt),F&&!st&&_(Object(G.h)(e,F)),j.info("Update quick view forms started.",l);for(const s in L.InlineQuickForms){const n=L.InlineQuickForms[s];for(const r in n){const o=n[r],c=Object(i.h)(I,o),l=jt(I,c,o,e,a,_),u=wt(I,r,c),d=Object(x.m)(a,s,r);Nt(I,_,t,l,u,e,d,null,nt)}}if(j.info("Update quick view forms completed.",l),w&&0!==Object.keys(w).length){const{createFromEntity:s,createFromRelationship:i,lookupAttributeName:c}=y,{initWithEntity:u}=y;let p=s;!p&&u&&(p=u),A=function(t,e,a,s,i,c,l,u,p,_,m,b,v){var S;a&&a.info("initializeFormWithDefaultValue started.",s);const I=Object(g.d)(t,c);let y=null;const O={},w=Object(o.kd)(t,i),C=n.a.toString(u);let F,j;const E=[];C&&(y=Object(g.l)(t,C));for(const r of Object.keys(l)){if("processid"===r)continue;let g=I[r];if(!g&&y&&(g=y[r]),g&&!g.AttributeOf){const o=g.Type;switch(o){case h.a.Customer:case h.a.Owner:case h.a.Lookup:case h.a.Regarding:if("string"==typeof l[r]){const d=mt(l,r,g);if(!d){vt(a,r);continue}if(O[r]=d,!n.a.equals(n.a.EMPTY,d.id)&&o!==h.a.Owner&&w&&(_||m))if(j){const t=j.then(()=>e(Object($.b)(i,u)).then(()=>{a&&a.info("updateSnapshotWithOptions completed (1).",s)}));E.push(t)}else j=Ot(t,e,d,c,i,a,s,_,m,null,b),E.push(j)}else{let t;t=Array.isArray(l[r])?l[r][0]:l[r],t&&t.id&&n.a.tryParseOrNull(t.id)&&t.entityType&&(O[r]=new d.a(t.entityType,new n.a(t.id),t.name))}break;case h.a.PartyList:const p=l[r];let f=p;const v=[];try{"string"==typeof p&&(f=JSON.parse(p));for(const t of f)v.push(new d.a(t.entityType,new n.a(t.id),t.name))}catch(t){vt(a,r,"partylist")}O[r]=v;break;case h.a.Boolean:case h.a.PickList:case h.a.Status:O[r]=l[r];break;case h.a.UniqueIdentifier:O[r]=new n.a(l[r]);break;default:O[r]=l[r]}}else if(-1!==r.indexOf(tt.d)||"_CreateFromId"===r){let n=null;if(-1!==r.indexOf(tt.d)&&(n=mt(l,tt.d,g)),!n&&"_CreateFromId"===r){const e=Object(P.m)(t,l._CreateFromType),a=Object(P.h)(t,e);a&&(n=bt(e,l._CreateFromId,a.DisplayName))}if(!n){vt(a,tt.d);continue}let d=null;if(d=Object(P.t)(t,c,n,v),null==a||a.info("Parental relationship mapping is getting skipped for "+c+": "+d),!F&&(F=n,w))if(j){const t=j.then(()=>e(Object($.b)(i,u)).then(()=>{a&&a.info("updateSnapshotWithOptions completed (2).",s)}));E.push(t)}else j=Ot(t,e,F,c,i,a,s,_,m,d,b),E.push(j);if(Object(P.h)(t,c).IsActivity&&-1===Object.keys(O).indexOf(k.v)&&Object(P.A)(t,c,F.etn,k.v)){const e=Object(o.db)(t,i,p);e&&e[k.v]&&(O[k.v]=n)}}else{vt(a,r);if(Object(Q.f)(t,Z.tf))return Promise.reject(Object(z.b)(t,i,2200000009))}}const N=Object(Q.f)(t,Z.pb);let T=O;N&&(T=function(t,e,a,s,n){const i={},r=Object(x.x)(s),c=Object(o.S)(t,r,e,a);for(const r in n){if(!c||!c.hasOwnProperty(r)){i[r]=n[r];continue}const o=Object(g.a)(t,e,r);if(!(o&&o.ParentPicklistLogicalName)&&!Object(J.a)(t,s,a,e,c,r,{name:r,value:0})){i[r]=n[r];let c=[];for(o&&o.ChildPicklistLogicalNames&&(c=c.concat(o.ChildPicklistLogicalNames));c&&c.length>0;){const r=c.pop();if(n.hasOwnProperty(r)){const o=Object(g.a)(t,e,r),l=JSON.parse(n[o.ParentPicklistLogicalName]),u=JSON.parse(n[r]);Object(K.a)(t,a,s,o,e,l,u)&&(i[r]=n[r],o.ChildPicklistLogicalNames&&o.ChildPicklistLogicalNames.length>0&&(c=c.concat(o.ChildPicklistLogicalNames)))}}}}return i}(t,c,i,p,O));const M=yt(T);if(Object(it.a)()&&T&&(null===(S=Object.keys(T))||void 0===S?void 0:S.length)>0){const t={};for(const e in T)"entity_record"!==e&&(t[e]={value:T[e],source:"Value passed by a page input data passed via URL"});Object(rt.c)(t)}if(E.length>0)return Promise.all(E).catch(t=>{if(2147749377===t.errorCode||-2147093999===t.errorCode)return null;Object(r.b)(t)}).then(()=>(e(Object(f.a)(i,M,!0,!0)),a&&a.info("initializeFormWithDefaultValue completed at snapshotPromiseList.length > 0.",s),null));return e(Object(f.a)(i,M,!0,!0)),a&&a.info("initializeFormWithDefaultValue completed at snapshotPromiseList.length == 0.",s),Promise.resolve(null)}(m(),_,j,l,e,O,w,t,a,p,i,m,c)}const ot=Object(o.Hb)(I,e);if((null===(S=null==L?void 0:L.Controls)||void 0===S?void 0:S.notescontrol)&&!ot){const t=Object(u.j)(I,e);_(Object(M.b)(L.Controls,e,j,l,t,s))}if(L&&L.Controls)for(const t in L.Controls)if(L.Controls[t]){if(L.Controls[t].Id&&L.Controls[t].Id.startsWith("WebResource"))for(const e of L.Controls[t].Parameters)if("Url"===e.Name){let t=!1;if(c)for(const a of c){const s=e.Value&&e.Value.toLowerCase()||"";if(s.length>=a.length&&s.length-a.length===s.lastIndexOf(a)){t=!0;break}}if(!t){const t=Object(D.j)(I,e.Value);t&&!t.Name&&(j.info("retrieveWebResourceDescriptorByName started.",l),_(Object(W.c)(e.Value)).then(()=>{j.info("retrieveWebResourceDescriptorByName completed.",l)}))}}n.a.equals(L.Controls[t].ClassId,V.rb)&&I&&void 0===I.currentServerTime.serverTimeDiffInSeconds&&(j.info("retrieveServerTime started.",l),_(Object(q.b)(new d.a(O))).then(()=>{j.info("retrieveServerTime completed.",l)}))}return null!=A?A:(j.info("initializeForm completed.",l),Promise.all(B))},getFailureParameters:(t,e)=>l}}function gt(t,e,a,n,i,r,c){const l=e(Object(m.f)(r,!1,[])).then(()=>{const a=Object(P.h)(t(),r);if(a.IsChildEntity){const s=Object(C.d)(t(),a);return e(Object(m.f)(s.EntityLogicalName,!1,[]))}}),u=()=>{const i=t();if(!Object(C.b)(i,r))return pt(2200000001,e,a,n,i,c);const l=Object(C.c)(i,r),u=Object(s.e)(i);return l&&Object(o.kd)(i,c)&&!u?pt(2200000002,e,a,n,i,c):void 0};return l?l.then(u):Promise.resolve(u())}function pt(t,e,a,s,n,i){const r=Object(z.d)(t);return e(Object(B.e)(r)).then(()=>{const e=Object(z.c)(t);if(a){const t=[{name:"CorrelationId",value:s.correlationId},{name:"ContextId",value:s.contextId},{name:"ActionStack",value:s.stack}];a.debug(e,t)}const o=Object(H.e)(n,r),c=Object(H.c)(o,r[0]),l=Object(H.c)(o,r[1]);throw Object(z.b)(n,i,t,e,c,l)})}function ft(t,e,a,s,n,i,r,c,l){const h={};l.push({name:"AutoPopulateFieldsTimeStamp",value:Date.now()}),c&&c.info("autoPopulateFields started.",l);const _=Object(g.d)(t,a);if(!_)return void(c&&c.warn("attributes is null.",l));const m=t=>t&&t.OptionSet&&Object.keys(t.OptionSet).length>0,{id:b}=Object(u.j)(t,s),v=new d.a(a,b),P={},S=Object(o.hc)(t,s,r);for(const e of n){const a=_[e];if(a&&(n.indexOf(e)>=0&&i.indexOf(e)>=0||m(a))){if(!Object(o.ab)(t,s,r,S,v,a.LogicalName)){switch(e){case k.s:const a=Object(p.q)(t),s=Object(p.t)(t);if(a&&s){const t=new d.a(A.a,a,s);P[e]=t,Object(it.a)()&&(h[e]={value:t,source:"Autopopulated based on the user id"})}break;case k.z:if(!Object(L.e)(t,S,null,k.z)){const a=Object(p.b)(t);if(a){const t=new d.a(A.b,a.transactionCurrencyId,a.currencyName);P[e]=t,Object(it.a)()&&(h[e]={value:t,source:"Autopopulated with a transaction currency as there is not one inherited"})}}}if(m(a)){const s=Object(L.e)(t,S,new d.a(a.EntityLogicalName),e),i=s?parseInt(s.valueString,10):null!=a.DefaultValue?a.DefaultValue:e===k.x?0:void 0;if(void 0!==i&&!(i<0)&&(P[e]=i,Object(it.a)())){const t=s?"Autopopulated with value passed by a page input data passed via URL":null!=a.DefaultValue?"Autopopulated with the field's default value":e===k.x?"Autopopulated with 0, as a default value for a state code":"Autopopulated with a default or first optionset value";h[e]={value:i,source:t}}if(e===k.x&&n.includes(k.y)){const e=_[k.x];if((null==e?void 0:e.OptionSet)&&Object.keys(e.OptionSet).length>0){if(!Object(L.e)(t,S,new d.a(a.EntityLogicalName),k.y)){const t=e.OptionSet.find(t=>t.Value===i),a=t?t.DefaultStatus:_[k.y].DefaultValue||0;if(!(a<0)&&(P[k.y]=a,Object(it.a)())){const e=t?"Autopopulated with the default status":_[k.y].DefaultValue?"Autopopulated with the field's default value":"Autopopulated with 0, as a default value for a status code";h[k.y]={value:a,source:e}}}}}}}}}const I=yt(P);Object(it.a)()&&Object(rt.c)(h),e(Object(f.a)(s,I,!0,!0)),c.info("autoPopulateFields completed.",l)}function _t(t,e,a,s,i,r,o){const{id:c}=Object(u.j)(t,s),l=new d.a(a,c),h={};if(n.a.isNullOrEmpty(l.id)&&!o)return function(t,e,a,s,i){const r=Object(S.d)(t,a);if(null!=r)return Promise.resolve(r);return e(Object(U.a)(n.a.EMPTY,new d.a(a,n.a.EMPTY))).then(t=>t&&t.businessProcessFlows?n.a.tryParse(Object.keys(t.businessProcessFlows)[0]):null).catch(t=>{const e=[{name:"CorrelationId",value:i.correlationId},{name:"ContextId",value:i.contextId},{name:"ActionStack",value:i.stack},{name:"entityName",value:a},{name:"reason",value:t&&t.message?t.message:JSON.stringify(t)}];return s.EventManager.ReportComponentFailure("Forms.InitializeForm",Error("Catch block of InitializeForm.retrieveBusinessProcessFlow"),void 0,e),s.TraceManager.getTracer("Forms.InitializeForm").error("Error while executing getBusinessProcessFlowDefaultIdForEntity in the retrieveBusinessProcessFlow promise.",e),null})}(t,e,a,i,r).then(t=>{t&&(h.processid=t.guid);const a=yt(h);e(Object(f.a)(s,a,!0,!0))});o&&(h.processid=o);const g=yt(h);return e(Object(f.a)(s,g,!0,!0)),Promise.resolve()}function mt(t,e,a){let s=e;!e.match(/id$/i)&&e.indexOf(tt.d)>-1&&(s+="id");const i=t[s];if(null!=i){if(n.a.validate(i)){const s=i,n=t[e+"name"];let r=t[e+"type"]||t[e+"target"];return!r&&a.Targets&&a.Targets.length>0&&(r=a.Targets[0]),bt(r,s,n)}try{const t=JSON.parse(i);if(t)return bt(t.entityType,t.id,t.name)}catch(t){}}return null}function bt(t,e,a){if(t&&e&&n.a.validate(e)){const s=new n.a(e);if(!n.a.isNullOrEmpty(s))return new d.a(t,s,a)}return null}function vt(t,e,a){if(t){const s=[{name:"key",value:e},{name:"source",value:a}];t.warn("Value passed is not in correct syntax.",s)}}function Pt(t,e,a,s,n,i,r,o){return St(t,e,a,n,s,i,r,o).then(()=>It(t,e,a,n,i,r,o))}function St(t,e,a,s,n,i,r,o){if(!Object(c.a)(t,i)&&Object(st.m)(t,i))return r&&r.warn("pageId"+i+" is dead so rejecting loadScripts"),Promise.reject(Object(z.b)(t,i,2200000008,"Page has expired."));r&&r.info("loadScripts started.",o);return a(e.ScriptManager.getContainer(i).getEventManager().loadScripts(n,i,s)).then(()=>{r&&r.info("loadScripts completed",o)})}async function It(t,e,a,s,n,i,r){if(!Object(c.a)(t,n)&&Object(st.m)(t,n))return void(i&&i.warn("pageId "+n+" is dead so won't run runFormOnLoadScripts",r));i&&i.info("runFormOnLoadScripts started.",r);const o=e.ScriptManager.getContainer(n).getEventManager();a(o.addBusinessRuleEventDuringFormLoad(s)),await a(o.runOnLoad(s,1)),a(o.runOnDataLoad(s,1)),i&&i.info("runFormOnLoadScripts completed.",r)}function yt(t){const e={};for(const a in t){const s={fieldName:a,value:t[a]};e[a]=s}return e}function Ot(t,e,a,s,n,i,o,c,l,h,g){const p=Object(x.j)(t,n),f=Object(x.y)(p),C=Object(u.j)(t,n),j=null==C?void 0:C.lookupAttributeName;return i&&i.info("createAndSetDataSnapshotFrom started.",o),e(function(t,e,a,s,n,i,o,c){return{type:"snapshot.from.async",async execute({dispatch:l,getState:u},h){let g=null,p=null,f=null;const C=new y.a(d.a.toExternalEntityReference(t),e,I.a.All,!0,i);try{const t=await l(Object(w.b)(C,c)),a=(await l(Object(O.a)(t,C,c))).get_entity();g=Object(_.a)(a,u()),p=g.fields,f=g.identifier,l(Object(m.f)(e,!1,Object.keys(g.fields),c))}catch(t){const a=Object(r.c)(t);if(t&&t.get_ErrorCode&&(-2147093999===t.get_ErrorCode()||a&&-2147217919===a.getNegativeErrorCode())&&s){const t=[];if(p={},s.etn){const a=Object(P.c)(u(),s.etn,e);let n=null;if(a)for(const i of a)n=Object(P.t)(u(),e,s,o),!i.ReferencingAttribute||n&&i.ReferencingAttribute===o||t.push(i.ReferencingAttribute)}else n&&t.push(n.attributeName);for(const e of t){if(!s.name&&s.id){const t=Object(S.h)(u(),s.etn,s.id.guid);if(t&&t.fields){const e=Object(P.H)(u(),s.etn);let a=t.fields[e];a&&a.value||(a=t.fields.name),a&&a.value&&(s={etn:s.etn,id:s.id,name:a.value})}}p[e]={reference:s,timestamp:new Date,validationResult:{errorId:null,errorMessage:null,isValueValid:!0,userInput:null,isOfflineSyncError:!1}}}f=new d.a(e),l(Object(m.f)(e,!1,t,c))}else Object(r.b)(t)}const F=Object(b.b)(u(),f,p,a,v.a.Create),j=F.payload.snapshotId;return l(F),j}}}(a,s,f,c,l,h,j)).then(t=>{var a;if(Object(it.a)()){const e={},s=null===(a=Object(L.b)(g(),t))||void 0===a?void 0:a.activeChanges;for(const t in s)e[t]={value:s[t],source:"Relationship field mapping"};Object(rt.c)(e)}i&&(o.push({name:"newSnapshotId",value:t?t.toString():"<null>"}),i.info("initializeCreateDataSnapshotFrom completed.",o)),e(Object(F.b)(n,t,p)).then(()=>{i&&i.info("createAndSetDataSnapshotFrom completed.",o)})})}function wt(t,e,a){let s={};if(a&&a.Attributes&&e){const n=Object(D.d)(t,a.FormLibraries,[e]);if(a.Attributes||n){const i=[].concat(a.Attributes,n);-1===i.indexOf(k.x)&&i.push(k.x),s=Ct(t,e,i)}}return{attributes:s,submitModes:{}}}function Ct(t,e,a){const s={};if(a&&e)for(let n=0;n<a.length;n++){const i=a[n];if(i){const a=Object(o.O)(t,e,i);a&&(s[i]=a)}}return s}function Ft(t){return Array.isArray(t)?t:t.Controls?t.Controls:null}function jt(t,e,a,s,n,i){const r={},c={},u={},d={bodyVisible:!0,commandBarVisible:!0,tabNavigatorVisible:!0},h={visible:!0};let g={navBarAreas:{},navPaneIsvItems:{},navBarByRelationshipItems:{},navBarItems:{}};const p=Object(o.o)(t,e,s);if(null==p?void 0:p.length){let i=!1;const d=Object(o.rb)(t,s,n,a);for(const a of p){const s={collapsed:!!i||!(a.Expanded&&a.Visible),visible:a.Visible,label:a.Label,sectionNames:[],domId:a.DomId,showLabel:a.ShowLabel,contentType:null};switch(a.ContentType){case"expandAvailableSpace":case"singleComponent":s.contentType="singleComponent";break;default:s.contentType="cardSections"}i=i||a.Expanded&&a.Visible;const n=[];if(a.Columns)for(let s=0;s<a.Columns.length;s++){const i=a.Columns[s];if(i.SectionNames)for(let s=0;s<i.SectionNames.length;s++){const r=i.SectionNames[s];if(null==d?void 0:d[r]){const s=d[r];n.push(r);const i=[];for(const t of d[r].Rows)for(const e of t.Cells)e.ControlName&&i.push(e.ControlName);const o={parentTabId:a.Id,visible:s.Visible,label:s.Label,controlNames:i,domId:s.DomId,semanticZoomDomId:s.SemanticZoomDomId};c[r]=o;for(let a=0;a<i.length;a++){const s=i[a];if(e.Controls[s]){const a=e.Controls[s],n=Et(a,r,!0),i=Object(l.a)(a,e,Object(X.b)(t));null!=i&&(n.visible=n.visible||i.ShouldOverrideControlVisible),Tt(n),u[s]=n}}}}}if(a.Header)for(const t of a.Header)u[t.Name]=Et(t,null,!0);if(a.Footer)for(const t of a.Footer)u[t.Name]=Et(t,null,!0);s.sectionNames=n,r[a.Id]=s}}if(e&&e.Navigation&&(g=e.Navigation),e&&e.Header){const t=Ft(e.Header);if(t)for(const e of t)u[e.Name]=Et(e,null,!0),Tt(u[e.Name]);d.bodyVisible=!1!==e.Header.BodyVisible,d.commandBarVisible=!1!==e.Header.CommandBarVisible,d.tabNavigatorVisible=!1!==e.Header.TabNavigatorVisible}if(e&&e.Footer){const a=Ft(e.Footer);if(a)for(const t of a)u[t.Name]=Et(t,null,!0),Tt(u[t.Name]);h.visible=!1!==e.Footer.Visible,Object(lt.b)(t)&&a.length>0&&Object(it.a)()&&i(function(t){return{type:"formChecker.FooterControls.async",execute({},e){var a;const s=null===(a=null==e?void 0:e.TraceManager)||void 0===a?void 0:a.getTracer(`${ct.u}${ct.v}`);if(!s)return Promise.resolve();const n=[];for(const e of t)n.push({controlLabel:e.Label});const i={Message:"Form footer is deprecated. Remove all controls in the footer using form designer.","Footer controls":n,"Record status":"The record status has been removed from OOB forms as part of the footer deprecation."};s.warn(ct.B,[{name:ot.l,value:ct.v},{name:ct.v,value:JSON.stringify(i)}])}}}(a))}return{formId:a,tabs:r,sections:c,controls:u,selectedTab:Object(j.a)(),selectedRelatedEntity:null,isSaving:!1,invalidControls:{},invalidAttributes:{},controlUnboundOutputs:{},inlineQuickForms:e&&e.InlineQuickForms?e.InlineQuickForms:null,xrmReady:!1,label:"",navigation:g,viewportWidth:0,viewportHeight:0,showHeaderFieldsInSection:!1,headerFieldsInFlyout:new Set,isAutoSaving:!1,header:d,footer:h}}function Et(t,e,a){return t?{parentSectionName:e,visible:t.Visible,label:t.Label,valid:a,labelSource:t.LabelSource,domId:t.DomId,parameters:t.Parameters,dataFieldName:t.DataFieldName,relationship:t.Relationship}:null}function Nt(t,e,a,s,i,r,c,l=null,u){const d=Object(o.fb)(t,r,c),h=Object(nt.a)(t,r);n.a.equals(null==d?void 0:d.formId,null==s?void 0:s.formId)&&n.a.equals(a,null==h?void 0:h.formId)||e(function(t,e,a,s,n,i=null,r){return{type:ut,payload:{formId:t,formUIState:e,formMetadataState:a,relatedEntityMetadataState:i,currentLanguageId:r},meta:{pageId:s,contextToken:n}}}(a,s,i,r,c,l,u))}function Tt(t){t&&t.parameters&&t.parameters.DefaultViewId&&(t.parameters.defaultviewid=t.parameters.DefaultViewId)}},Oyec:function(t,e,a){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function s(t){return{paddingLeft:t.sizes.Measures.Measure100,paddingRight:t.sizes.Measures.Measure100}}a.d(e,"a",(function(){return s}))},TAjd:function(t,e,a){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var s;a.d(e,"a",(function(){return s})),function(t){t.collapsed="collapsed",t.expanded="expanded",t.floating="floating",t.getDefaultDisplayState=function(){return t.collapsed}}(s||(s={}))},WRDA:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var s=a("504W");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function n(t){return Object(s.b)(t)?null:("{"===(t=t.trim())[0]&&"}"===t[t.length-1]&&(t=t.substring(1,t.length-1)),t.toLowerCase())}},bJaF:function(t,e,a){"use strict";a.d(e,"a",(function(){return Ee}));var s,n=a("fMBw"),i=a.n(n),r=a("arV0"),o=a("TAjd"),c=a("/t1C"),l=a("uNu9"),u=a("uNLT"),d=a("tT9w"),h=a("ofgb"),g=a("+hq9"),p=a("Uv1Y"),f=a("SAYH"),_=a("+nNZ"),m=a("7tM0");!function(t){t[t.None=0]="None",t[t.Processing=1]="Processing",t[t.Completed=2]="Completed",t[t.Failure=3]="Failure",t[t.Invalid=4]="Invalid"}(s||(s={}));class b{constructor(t,e){this._getState=t,this._processId=e}GenerateMessageForAction(t){let e="";const a="cc_MscrmControls.Containers.ProcessBreadCrumb/strings/ProcessControlResources",n=this._getState(),i=Object(m.a)(n,a,"ProcessControl_ActionExecuter_ExecutionTimeTooltip"),r=Object(m.a)(n,a,"ProcessControl_ActionExecuter_ErrorMessageTooltip"),o=Object(m.a)(n,a,"Crm_GenericErrorMessage");switch(t){case s.Completed:e=String.format(i,(new Date).toLocaleString());break;case s.Failure:e=String.format(i,(new Date).toLocaleString())+"\n"+String.format(r,o)}return e}GetActionMetadata(t){const e=Object(_.a)(this._getState(),new f.a(this._processId.guid));let a;return e&&e.businessProcessFlowActions&&e.businessProcessFlowActions[t]&&(a=e.businessProcessFlowActions[t]),a}InvokeProcessAction(t,e,a){return Xrm.Utility.invokeProcessActionInternal(t,a,e)}}var v=a("i1f0");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function P(t){if(!t)return null;const e=function(t){const e=[];return t.forEach(t=>{const a={id:f.a.tryParse(t.Id),primaryField:t.PrimaryField,entityTypeCode:t.EntityTypeCode,entityLogicalName:t.EntityLogicalName,primaryKeyName:t.PrimaryKeyName};e.push(a)}),e}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */(t.NavigationEntities);return{entityDisplayName:t.EntityDisplayName,entityLogicalName:t.EntityLogicalName,entityTypeCode:t.entityTypeCode,showCreate:t.ShowCreate,navigationEntities:e}}function S(t,e,a,s){return{type:"businessProcessFlow.retrieveNavigationEntities.async",execute:({dispatch:n,getState:i},r)=>function(t,e,a,s,n){return t.retrieveNavigationEntities(e,a,s,n,null).nativePromise().then(P,p.b)}(r.DataSource,t,e,a,s)}}var I=a("rodW"),y=a("bCAK"),O=a("AsoW");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class w{constructor(t,e){this.Target=t,this.NewProcess=e}getMetadata(){return{boundParameter:null,parameterTypes:{Target:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},NewProcess:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"SetProcess",operationType:0}}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class C{constructor(t,e,a){this.Target=t,this.NewProcess=e,this.NewProcessInstance=a}getMetadata(){return{boundParameter:null,parameterTypes:{Target:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},NewProcess:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},NewProcessInstance:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"SetProcess",operationType:0}}}var F=a("w72X"),j=a("EHQq");function E(t,e,a,s,n,i){return{type:"businessProcessFlow.navigateToNextEntity.async",execute:({dispatch:r,getState:o},c)=>function(t,e,a,s,n,i,r){const o=new j.a(f.a.toLegacyGuid(e.id),e.etn,f.a.toLegacyGuid(a.id),a.etn,f.a.toLegacyGuid(s),n,f.a.toLegacyGuid(i),f.a.toLegacyGuid(r));return t.execute(o,null).nativePromise()}(c.DataSource,t,e,a,s,n,i)}}var N=a("sNgR");class T{constructor(t,e){this.EntityId=t,this.EntityLogicalName=e}getMetadata(){return{boundParameter:null,parameterTypes:{EntityId:{typeName:"Edm.Guid",structuralProperty:1},EntityLogicalName:{typeName:"Edm.String",structuralProperty:1}},operationName:"RetrieveProcessInstances",operationType:1}}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */var M=a("E5IU");class x{constructor(t,e){this.EntityLogicalName=t,this.AppModuleId=e}getMetadata(){return{boundParameter:null,parameterTypes:{EntityLogicalName:{typeName:"Edm.String",structuralProperty:1},AppModuleId:{typeName:"Edm.Guid",structuralProperty:1}},operationName:"RetrieveFilteredProcesses",operationType:1}}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class B{constructor(t,e,a){this._name=t,this._uniqueName=e,this._workflowId=a}get workflowId(){return this._workflowId}set workflowId(t){this._workflowId=t}get uniqueName(){return this._uniqueName}set uniqueName(t){this._uniqueName=t}get name(){return this._name}set name(t){this._name=t}}var A=a("WPtp");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class D{get activeStageId(){return this._activeStageId}set activeStageId(t){this._activeStageId=t}set businessProcessInstanceId(t){this._businessProcessInstanceId=t}get businessProcessInstanceId(){return this._businessProcessInstanceId}get businessProcessInstanceName(){return this._businessProcessInstanceName}set businessProcessInstanceName(t){this._businessProcessInstanceName=t}get businessProcessState(){return this._businessProcessState}set businessProcessState(t){this._businessProcessState=t}get businessProcessStatus(){return this._businessProcessStatus}set businessProcessStatus(t){this._businessProcessStatus=t}get navigationEntities(){return this._navigationEntities}set navigationEntities(t){this._navigationEntities=t}get traversedPath(){return this._traversedPath}set traversedPath(t){this._traversedPath=t}get bpfDefinitionVersionNumber(){return this._bpfDefinitionVersionNumber}set bpfDefinitionVersionNumber(t){this._bpfDefinitionVersionNumber=t}}var k,R=a("sxfa"),L=a("hvSt");!function(t){t[t.Active=0]="Active",t[t.Inactive=1]="Inactive"}(k||(k={}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class V{constructor(t){this._stageManager=t,this._populateTraversedPath()}getTraversedPath(){return this._traversedPath}_populateTraversedPath(){this._traversedPath=this._stageManager.globalPathAndActiveStage.traversedPath.path}}var q=a("a8GW"),U=a("odYE"),W=a("mL5Q"),z=a("f/sd"),H=a("INOZ"),G=a("1ZrY"),Y=a("quej"),X=a("ijzp"),$=a("WY/A"),J=a("sX6v"),K=a("P+kM"),Z=a("SFvV"),Q=a("srnJ"),tt=a("5Oca"),et=a("Dea/"),at=a("dHD5"),st=a("bT7G"),nt=a("e3W2"),it=a("WePp");class rt extends it.a{constructor(t,e,a){super("BusinessProcessFlow_"+t),this.addEventParameter("ProcessId",e),this.addEventParameter("ProcessInstanceId",a)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class ot extends rt{constructor(t,e){super("Initialized",t,e)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class ct extends rt{constructor(t,e,a){super("SetActiveStageEvent",t,e),this.addEventParameter("ActiveStageId",a)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class lt extends rt{constructor(t,e,a){super("DisplayStateEvent",t,e),this.addEventParameter("CurrentDisplayState",a)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class ut extends rt{constructor(t,e,a,s){super("StatusEvent",t,e),this.addEventParameter("ProcessStatus",a),this.addEventParameter("CurrentDisplayState",s)}}var dt=a("504W"),ht=a("pEXn"),gt=a("+Qpx");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class pt{getMetadata(){return{boundParameter:"entity",operationName:"ExecuteWorkflow",operationType:0,parameterTypes:{entity:{typeName:"Microsoft.Dynamics.CRM.workflow",structuralProperty:5},EntityId:{typeName:"Edm.Guid",structuralProperty:1},InputArguments:{typeName:"Microsoft.Dynamics.CRM.InputArgumentCollection",structuralProperty:2}}}}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class ft{getMetadata(){return{boundParameter:null,operationName:null,operationType:null,parameterTypes:{Type:{typeName:"Edm.String",structuralProperty:1},Value:{typeName:"Edm.String",structuralProperty:1}}}}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class _t{getMetadata(){return{boundParameter:null,operationName:null,operationType:null,parameterTypes:{Count:{typeName:"Edm.Int32",structuralProperty:1},IsReadOnly:{typeName:"Edm.Boolean",structuralProperty:1},Keys:{typeName:"Edm.String",structuralProperty:4},Values:{typeName:"mscrm.AnyComplexType",structuralProperty:4}}}}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class mt{getMetadata(){return{boundParameter:null,operationName:null,operationType:null,parameterTypes:{Arguments:{typeName:"Microsoft.Dynamics.CRM.InputArgument",structuralProperty:2}}}}}var bt,vt=a("+XGO"),Pt=a("mIxf"),St=a("AFlp"),It=a("k1f1");!function(t){t[t.ProcessAction=0]="ProcessAction",t[t.TaskFlow=1]="TaskFlow",t[t.SyncWorkflow=2]="SyncWorkflow",t[t.AsyncWorkflow=3]="AsyncWorkflow",t[t.MessageAction=4]="MessageAction"}(bt||(bt={}));var yt=a("D4Jo"),Ot=a("JF0K"),wt=a("iZ7K"),Ct=a("JP46");var Ft=a("ghNp");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */var jt=a("+QYJ");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class Et{constructor(t,e){this._getState=t,this._applicationContext=e}setBpfInstance(t){return this._processInstance=t,this}setBpfInstanceName(t){return this._processInstanceName=t,this}setProcess(t){return this._process=t,this}setProcessId(t){return this._processId=t,this}setFormEntity(t){return this._formEntity=t,this}GetFlowStepMetadata(t,e){const a=e.TraceManager.getTracer("businessProcessFlow.flowStepManager"),s=this._processId&&this._processId.guid||null,n=Object(_.a)(this._getState(),f.a.tryParse(s));if(Object(jt.c)(n))return a.warn("Failure in FlowStepManager GetFlowStepMetadata: IsNullOrUndefined bpfDescriptor: "+n),null;const i=n.businessProcessFlowFlows;if(Object(jt.c)(i))return a.warn("Failure in FlowStepManager GetFlowStepMetadata: IsNullOrUndefined businessProcessFlowFlows: "+i),null;const r=i[t];return Object(jt.c)(i)?(a.warn("Failure in FlowStepManager GetFlowStepMetadata: IsNullOrUndefined flowStepDescriptor: "+r),null):r}openFlowWidget(t,e){if(f.a.tryParse(t.flowStepId)===f.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty flowStepId: "+t.flowStepId);const a=this._populateFlowDialogParams(t,e),s={height:600,width:600,position:1};Xrm.Navigation.openDialog("MicrosoftFlowsDialog",s,a)}_populateFlowDialogParams(t,e){const a=this.GetFlowStepMetadata(t.flowStepId,this._applicationContext);if(Object(jt.c)(a))throw new Error("BPF Flow Step Failure: null metadata");const s={},n=a.flowId;if(Object(jt.c)(n))throw new Error("BPF Flow Step Failure: null metadata.flowId");if(!this._processInstance&&!this._processInstance.id){const t=[];t.push(this._processInstance.id.guid);const e=JSON.stringify(t);s.entity_ids=e}s.flow_id=n,s.org_unique_name=Xrm.Utility.getGlobalContext().getOrgUniqueName(),s.bpf_step_id=t.flowStepId;const i=Xrm.Page.data.entity.getEntityName(),r=this._getState().metadata.entities[i].EntitySetName,o=Xrm.Utility.getGlobalContext().getAdvancedConfigSetting("MicrosoftFlowDestinationUrl");s.entity_logical_collection_name=r,s.entity_logical_name=i,s.flows_destination_url=o,s.dynamics365_access_token=sessionStorage.getItem("dynamics365AccessToken");const c=Xrm.Utility.getGlobalContext().getAdvancedConfigSetting("MicrosoftFlowFirstPartyIntegrationSiteUrl");s.flows_fpi_site_url=c+"&flowsEnableWidgetV2=true",s.flows_authentication_string=this._getLocalizedLabel("SystemCustomization.SystemSettingsDialog.PreviewTab.IsMicrosoftFlowEnabled.AuthenticateButton.Text"),s.flows_enable_widget_v2=!0,Et.UpdateEventParameter(e,"flows_destination_url",o),Et.UpdateEventParameter(e,"flow_id",n),Object(jt.c)(t.workflowLogId)||t.workflowLogId===f.a.EMPTY||(s.flows_wflog_id=f.a.toString(t.workflowLogId));const l=this._processInstance&&this._processInstance.id;if(Object(jt.c)(l)||l===f.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty processInstanceId: "+l);s.bpf_instance_id=f.a.toString(l);const u=this._processInstance&&this._processInstance.etn;if(Object(dt.b)(u))throw new Error("BPF Flow Step On-Click Failure: null or empty processInstanceEntityLogicalName: "+u);s.bpf_instance_entity_name=u;const d=this._processId&&this._processId.guid||null;if(f.a.tryParse(d)===f.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty processId: "+d);s.bpf_definition_id=d,s.bpf_definition_entity_name="workflow";const h=this._process&&this._process.get_Name();if(Object(dt.b)(h))throw new Error("BPF Flow Step On-Click Failure: null or undefined bpfDefinitionName: "+h);if(s.bpf_definition_name=h,Object(dt.b)(this._processInstanceName))throw new Error("BPF Flow Step On-Click Failure: null or undefined processInstanceName: "+this._processInstanceName);s.bpf_instance_name=this._processInstanceName;const g=t.selectedStage&&t.selectedStage.get_Description();if(Object(dt.b)(g))throw new Error("BPF Flow Step On-Click Failure: null or undefined flowStageName: "+g);s.bpf_flowstage_localized_name=g,s.bpf_flowstage_entity_name=i,s.bpf_flowstage_entity_collection_name=r;const p=this._formEntity&&this._formEntity.id;if(Object(jt.c)(p)||p===f.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty flowStageRecordId: "+p);s.bpf_flowstage_entity_record_id=f.a.toString(p);const _=f.a.tryParseOrNull(t.activeStage&&t.activeStage.get_Id()||"");if(Object(jt.c)(_)||_===f.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty activeStageId: "+_);s.bpf_activestage_id=f.a.toString(_);const m=t.activeStage&&t.activeStage.get_Description();if(Object(dt.b)(m))throw new Error("BPF Flow Step On-Click Failure: null or undefined activeStageName: "+m);return s.bpf_activestage_localized_name=m,s.bpf_activestageentity_name="processstage",s}_getLocalizedLabel(t){return Xrm.Utility.getResourceString("Main_system_library",t)}static getTelemetryParamsForFlowStep(t,e,a,s,n){const i=n||[],r={name:"flow_id",value:t},o={name:"environment_id",value:e},c={name:"flows_destination_url",value:a},l={name:"bpf_step_id",value:s};return i.push(r),i.push(o),i.push(c),i.push(l),i}static UpdateEventParameter(t,e,a){t&&0!==t.length&&t.some(t=>{if(t.name===e)return t.value=a,!0})}}var Nt=a("Lyxw"),Tt=a("7LBy"),Mt=a("ftQm"),xt=a("2Ct/"),Bt=a("84PK"),At=a("Exmh"),Dt=a("cfbi"),kt=a("pF61");var Rt=a("8O0c"),Lt=a("g6bs"),Vt=a("zmL5"),qt=a("jq7Z"),Ut=a("xMtD"),Wt=a("7Sr4"),zt=a("1uZV"),Ht=a("tICD"),Gt=a("E8F2"),Yt=a("dpM5"),Xt=a("UqQu"),$t=a("fh2P");var Jt=a("wL2W"),Kt=a("XhkN"),Zt=a("YxC/"),Qt=a("DBoP");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class te{get id(){return this._id}set id(t){this._id=t}get primaryField(){return this._primaryField}set primaryField(t){this._primaryField=t}get entityTypeCode(){return this._entityTypeCode}set entityTypeCode(t){this._entityTypeCode=t}get entityLogicalName(){return this._entityLogicalName}set entityLogicalName(t){this._entityLogicalName=t}get primaryKeyName(){return this._primaryKeyName}set primaryKeyName(t){this._primaryKeyName=t}}var ee=a("/q/W"),ae=a("ZXdP"),se=a("IaGr"),ne=a("Tz6o"),ie=a("9x9u"),re=a("3/02"),oe=a("RrRQ");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const ce=i.a.createEvent("Initialize","BusinessProcessFlow.ProcessManager"),le=i.a.createEvent("SetActiveStage","BusinessProcessFlow.ProcessManager"),ue=i.a.createEvent("ValidateRequiredFields","BusinessProcessFlow.ProcessManager"),de=i.a.createEvent("CreateActiveStageSnapshot","BusinessProcessFlow.ProcessManager"),he=i.a.createEvent("SaveFormAndActiveStage","BusinessProcessFlow.ProcessManager"),ge="ProcessId",pe="ProcessInstanceId",fe="ActiveStageId",_e="SelectedStageId",me="TraversedPath",be="ActivePath",ve="CurrentFormEntityType",Pe="CurrentFormEntityId",Se="ProcessState",Ie="PageType",ye="SavedPageType",Oe="CustomControlsPresent",we="RenderedFromFormXML",Ce="IsImmersiveBPF",Fe="Last stage in the active path reached. Next stage does not exist.";var je;!function(t){t[t.ProcessControlMissing=0]="ProcessControlMissing",t[t.LastStageReached=1]="LastStageReached",t[t.FirstStageReached=2]="FirstStageReached",t[t.InvalidStageId=3]="InvalidStageId",t[t.StageNotInActivePath=4]="StageNotInActivePath",t[t.StageNotInTraversedPath=5]="StageNotInTraversedPath",t[t.TraversedPathMissing=6]="TraversedPathMissing",t[t.RequiredFieldsMissing=7]="RequiredFieldsMissing"}(je||(je={}));class Ee{constructor(t,e,a,s,n){this._customControlsPresent=!1,this._renderedFromFormXml=!1,this._isBpfFormValid=null,this._applicationContext=t,this._getState=e,this._dispatch=a,this._stageMetadata=s,this._activeStageManager=n}initializeWithProcessAndFormEntity(t,e,a,s,n,i){var o;const c=ce.startStopwatch({processId:f.a.toString(s),processInstanceId:f.a.toString(n.id)});this._currentPageId=i,this._processId=s,this._version=e.businessProcessFlowProcessVersion,this._currentFormEntity=a,this._currentBpfInstance=n,this._stageMetadata.setPrimaryModel(this._currentFormEntity.etn),this._stageMetadata.setObjectModel(e),this._instanceModifiedTimestamp=Object(_.g)(this._getState(),this._currentFormEntity),this._instanceModifiedTimestamp||(this._instanceModifiedTimestamp=(new Date).getTime());const l=this._createGlobalNavigationData(t);this._activeStageManager.InitGlobalPathAndActiveStage(l),this._stageMetadata.initializeDefaultPathManager(new V(this._activeStageManager),this),this._customControlsPresent=!1,this._renderedFromFormXml=!1,this._isBpfFormValid=null;const u=Object(r.j)(this._getState(),this._currentPageId),d={};if(null===(o=Object(O.c)(this._getState(),this._currentPageId,this.getProcessInstanceId()))||void 0===o?void 0:o.isUserSelectedStage)d.selectedStageId=f.a.tryParseOrNull(this.getSelectedStageId());else if((null==u?void 0:u.isCrossEntityNavigate)&&(null==u?void 0:u.selectedStageId))d.selectedStageId=f.a.tryParseOrNull(u.selectedStageId);else{const t=this.getActiveStageId();this._isActiveStageInCurrentEntity(t)?d.selectedStageId=f.a.tryParseOrNull(t):d.selectedStageId=this._getDefaultSelectedStageId()||f.a.tryParseOrNull(t)}this._dispatch(Object(H.a)(this._currentPageId,d,this._currentBpfInstance));const h=new ot(f.a.toString(s),f.a.toString(n.id));this._applicationContext.EventManager.ReportEvent(h),this._savedPageId!==i&&(this._savedPageId=i,this.getScriptContainerPromise().then(t=>{t&&t.getEventManager().addOnProcessChangeEvent(this.getContextToken(),()=>{this._saveCrossEntityBpf()})})),Object(xt.g)(this._getState())||this._updateProcessInstanceModifiedTime(),this._actionStepManager=new b(this._getState,s),this._flowStepManager=new Et(this._getState,this._applicationContext).setBpfInstance(this._currentBpfInstance).setProcess(this.getProcess()).setProcessId(this.getProcessId()).setFormEntity(this._currentFormEntity).setBpfInstanceName(this.getProcessInstanceName()),Object(xt.g)(this._getState())&&Mt.a.Instance.setProcessManagerByPageId(this._currentPageId,this);const g=this.getTelemetryParams();if(!this._currentFormEntity){this._applicationContext.TraceManager.getTracer(Ot.i).error("ProcessManager is initialized with current entity as null",g)}Object(yt.c)(Ot.i,g,this._applicationContext),c()}_saveCrossEntityBpf(){var t,e;const a=this._getState(),s=Object(r.j)(a,this._currentPageId),n=Object(Tt.a)(s),i=Object(Tt.b)(s);if(n&&i&&(null===(t=s.data)||void 0===t?void 0:t.parentrecordtype)&&(null===(e=s.data)||void 0===e?void 0:e.parentrecordid)){const t=new U.a(s.data.parentrecordtype,new f.a(s.data.parentrecordid)),e=new U.a(s.entityTypeName,s.id);this._dispatch(Object(St.b)(n,e)),this._dispatch(Object(It.b)(i,e)),this.navigateToNextEntityForCrossEntityBpf(t,e,n,i)}}initializeWithFormEntityOnly(t,e){this._currentPageId=e,this._currentFormEntity=t,this._processId=null,this._version=-1,this._currentBpfInstance=null,this._customControlsPresent=!1,this._renderedFromFormXml=!1,this._isBpfFormValid=null,Object(xt.g)(this._getState())||this._updateProcessInstanceModifiedTime(),Object(xt.g)(this._getState())&&Mt.a.Instance.setProcessManagerByPageId(this._currentPageId,this);const a=this.getTelemetryParams();if(!this._currentFormEntity){this._applicationContext.TraceManager.getTracer(Ot.h).error("ProcessManager is initialized with current entity as null",a)}Object(yt.c)(Ot.h,a,this._applicationContext)}setActiveProcess(t,e="Unknown"){return new Promise((a,s)=>{const n=this.getTelemetryParams(e);if(!this.getCurrentFormEntity()){const t=new p.a("Current form entity is not initialized.",2147877745);return Object(yt.b)(Ot.r,t,null,n,this._applicationContext,null,this._getState()),void s(new p.a("Current form entity is not initialized",2147877745))}const i=f.a.tryParseOrNull(t);if(!i)return Object(yt.c)(Ot.r,n,this._applicationContext),void s(new Error("Invalid process id"));const r=Object(ae.b)(this._getState(),this._currentPageId);(Object(v.Ub)(this._getState(),this._currentPageId,this.getContextToken())?r?this._saveFormBeforeSwitchProcess():this._dispatch(Object(ee.a)(this._currentPageId)):Promise.resolve(!0)).then(t=>{if(t){if(Object(v.kd)(this._getState(),this._currentPageId))a();else{const t=new w({id:f.a.toString(this.getCurrentFormEntity().id),entityType:this.getCurrentFormEntity().etn},{id:f.a.toString(i),entityType:l.dc});this._dispatch(Object(F.b)(t)).then(()=>{this._executePostEvent("runOnProcessChange","setActiveProcess"),Object(yt.c)(Ot.r,n,this._applicationContext),a()},t=>{this._dispatch(Object(d.b)(t,!0)).then(()=>s(t)),Object(yt.b)(Ot.r,t,null,n,this._applicationContext,null,this._getState())})}}else s("Form save failed. Switch process is cancelled")})})}_saveFormBeforeSwitchProcess(){return this._dispatch(Object(u.e)(this._currentPageId,70,null,null,"This save event is invoked by Business Process Flow.")).then(()=>!0,t=>!1)}setActiveProcessInstance(t,e="Unknown"){return new Promise((a,s)=>{const n=this.getTelemetryParams(e);if(n.push({name:"processInstanceId (input)",value:t}),!this.getCurrentFormEntity()){const t=new p.a("Current form entity is not initialized.",2147877745);return Object(yt.b)(Ot.s,t,null,n,this._applicationContext,null,this._getState()),void s(new p.a("Current form entity is not initialized",2147877745))}const i=f.a.tryParseOrNull(t);i?this.getProcessInstances().then(t=>{if(!t||!t.value)return void s(new Error("No process instances found for current entity"));let e="";for(const a of t.value)if(a&&a.businessprocessflowinstanceid&&a.businessprocessflowinstanceid.toLowerCase()===f.a.toString(i).toLowerCase()){e=a["a_processid_value".substring(1)];break}if(Object(dt.b)(e))return void s(new p.a("Supplied process instance does not match any existing instance on this entity",2147877744));const n=f.a.tryParseOrNull(e);if(!n)return void s(new Error("Invalid process id"));const r=new C({id:f.a.toString(this.getCurrentFormEntity().id),entityType:this.getCurrentFormEntity().etn},{id:f.a.toString(n),entityType:l.dc},{id:f.a.toString(i),entityType:l.dc});this._dispatch(Object(F.b)(r)).then(()=>{this._executePostEvent("runOnProcessChange","setActiveProcessInstance"),a(e)},t=>{this._dispatch(Object(d.b)(t,!0)).then(()=>s(t))})},t=>{this._dispatch(Object(d.b)(t,!0)).then(()=>s(t))}):s(new Error("Invalid process instance id"))})}setCurrentInstance(t){this._currentBpfInstance=t}setStatus(t){return new Promise((e,a)=>{let s;if(t||a(new Error("setStatus can only be called with a valid status (active, finished, aborted")),t===L.a.Active)s=this.reactivateProcess();else if(t===L.a.Finished)s=this.completeProcess();else{if(t!==L.a.Aborted)return a(new Error("Invalid status passed to setStatus"));s=this.abandonProcess()}s.then(()=>{const a=new ut(f.a.toString(this._processId),f.a.toString(this.getProcessInstanceId()),t,this.getDisplayState());this._applicationContext.EventManager.ReportEvent(a),e()},t=>{a(t)})})}setVisible(t){if(Object(dt.a)(this._currentBpfInstance)||Object(dt.a)(this._currentFormEntity)||Object(dt.a)(this._currentFormEntity.etn))return;const e=Object(at.h)(this._currentFormEntity.etn);this._dispatch(Object(nt.c)(this._currentPageId,$t.b,e,!0===t)),this._updateProcessInstanceModifiedTime()}isVisible(){if(!this._currentBpfInstance)return!1;const t=Object(at.h)(this._currentFormEntity.etn);return!0===Object(v.I)(this._getState(),{id:this._currentPageId,controlName:$t.b},t)}getCurrentFormEntity(t=!1){return this._currentFormEntity&&t?new U.a(this._currentFormEntity.etn,this._currentFormEntity.id):this._currentFormEntity}getActiveStageEntityRef(){const t=this._getStage(this.getActiveStageId()),e=t&&t.get_parent()&&t.get_parent().get_Name()||null,a=this._getNavigationEntityIdsByEntityLogicalName();return e&&a&&a.hasOwnProperty(e)?new U.a(e,a[e]):null}getProcess(){return this._currentBpfInstance&&this._stageMetadata.getProcessObjectModel()}getProcessInstanceName(){return this._currentBpfInstance&&Object(y.e)(this._getState(),this._currentBpfInstance)}getTraversedPath(){var t,e;const a=Object(y.h)(this._getState(),this._currentBpfInstance);if(this.isBusinessProcessCompleted())return a;const s=null===(t=new R.a(a))||void 0===t?void 0:t.path,n=null===(e=null==s?void 0:s.split(","))||void 0===e?void 0:e.map(t=>f.a.tryParseOrNull(t)),i=this.getActivePath();return n&&n.length&&!n.some(t=>f.a.isNullOrEmpty(t)||!this._isStageOnPath(t,i))?s:f.a.isNullOrEmpty(null==i?void 0:i[0])?null:f.a.toString(null==i?void 0:i[0])}getProcessId(){return this._processId}getVersion(){return this._version}getProcessInstanceId(){return this._currentBpfInstance&&this._currentBpfInstance.id}getBpfEntityLogicalName(){return this._currentBpfInstance&&this._currentBpfInstance.etn}getEntityStages(){return this._stageMetadata.getEntityStages()}getActiveStage(){return this._getStage(this.getActiveStageId())}getProcessInstances(){return new Promise((t,e)=>{var a,s;this._dispatch((a=this._currentFormEntity.id,s=this._currentFormEntity.etn,{type:"businessProcessFlow.retrieveProcessInstancesRequest.async",async execute({dispatch:t,getState:e},n){if(!s||f.a.isNullOrEmpty(a))return{};const i=new T(a,s),r=await t(Object(N.b)(i));return null==r?void 0:r.json()}})).then(e=>{t(e)},t=>{e(t)})})}getSelectedStage(){return this._getStage(this.getSelectedStageId())}isCrossEntityNavigation(t){const e=t?this._stageMetadata.getNextStageId(this.getActiveStageId()):this._stageMetadata.getPreviousStageId(this.getActiveStageId());if(!e)return!1;const a=this._stageMetadata.getStage(e);if(!a)return!1;const s=a.get_parent();return this._currentFormEntity&&this._currentFormEntity.etn&&s&&s.get_EntityLogicalName()!==this._currentFormEntity.etn}_updateFormInputBeforeMovingStage(t){const e=Object(r.j)(this._getState(),this._currentPageId);if((null==e?void 0:e.isCrossEntityNavigate)&&!this.isCrossEntityNavigation(t)){const t=Object.assign(Object.assign({},e),{isCrossEntityNavigate:!1});this._dispatch(Object(ne.d)(t,this._currentPageId))}}_isStageOnPath(t,e){for(const a of e)if(f.a.equals(a,t))return!0;return!1}getProcessState(){const t=Object(_.a)(this._getState(),this.getProcessId());return t?t.businessProcessFlowProcessState:null}getState(){if(this._currentBpfInstance){const t=Object(y.f)(this._getState(),this._currentBpfInstance);if(t){const e=parseInt(t.valueString,10);return isNaN(e)?null:e}}return null}getStatusName(){if(this._currentBpfInstance){const t=Object(y.g)(this._getState(),this._currentBpfInstance);if(t){return t.label}}return null}getStatus(){if(this._currentBpfInstance){const t=Object(y.g)(this._getState(),this._currentBpfInstance);if(t){const e=parseInt(t.valueString,10);return isNaN(e)?null:e}}return null}getActiveStageId(){var t,e,a;if(this._currentBpfInstance){let s=this._currentBpfInstance&&Object(y.a)(this._getState(),this._currentBpfInstance);const n=this.getActivePath();if(f.a.isNullOrEmpty(s)&&this._currentBpfInstance&&this._activeStageManager&&this._activeStageManager.globalPathAndActiveStage){const a=this._activeStageManager.globalPathAndActiveStage.stageId;if(!a){const a=null===(t=this._applicationContext.TraceManager)||void 0===t?void 0:t.getTracer("BusinessProcessFlow.ActiveStageFallback"),s=this.getTelemetryParams("Unknown",[fe]);return null==a||a.warn("ActiveStageId is null thus falling back to first stage id.",s),null===(e=null==n?void 0:n[0])||void 0===e?void 0:e.guid}s=f.a.tryParseOrNull(a)}if(!f.a.isNullOrEmpty(s)&&n&&n.length>0){if(this._isStageOnPath(s,n))return s.guid;if(Object(Jt.a)()){const t=[{name:"Message",value:"The active stage is not part of the active path. This can happen when a stage is deleted from a bpf definition."},{name:"Record Active Stage",value:s.guid},{name:"Active Path",value:n},{name:"BPF Instance Id",value:this._currentBpfInstance.id.guid},{name:"BPF Entity Name",value:this._currentBpfInstance.etn},{name:"Process Id",value:this._processId.guid},{name:"Is BPF Finished",value:this.isBusinessProcessCompleted()}];null===(a=se.a.getInstance().traceManager.getTracer(`${gt.b}${gt.c}`))||void 0===a||a.error(gt.d,[{name:ht.l,value:gt.c},{name:gt.c,value:JSON.stringify(t)}])}return this.isBusinessProcessCompleted()?s.guid:n[0].guid}}return null}getActivePathStages(){const t=this.getActivePath();if(t){const e=new Array(t.length);for(let a=0;a<t.length;a++)e[a]=this._getStage(t[a].guid);return e}return null}getActivePath(){var t;if(!this._currentBpfInstance)return null;let e=null===(t=Object(O.c)(this._getState(),this._currentPageId,this.getProcessInstanceId()))||void 0===t?void 0:t.activePath;return e||(e=this._getDefaultActivePath()),e}getDisplayState(){return this._currentBpfInstance?Object(ie.a)(this._getState())||o.a.getDefaultDisplayState():null}getSelectedStageId(){var t;if(!this._currentBpfInstance)return null;const e=null===(t=Object(O.c)(this._getState(),this._currentPageId,this.getProcessInstanceId()))||void 0===t?void 0:t.selectedStageId;return e?e.guid:this.getActiveStageId()}_getDefaultSelectedStageId(){var t;if(!this._currentBpfInstance)return null;const e=null===(t=Object(O.c)(this._getState(),this._currentPageId,f.a.EMPTY))||void 0===t?void 0:t.selectedStageId;return e&&!this._stageMetadata.getStage(e.guid)?null:e}_isActiveStageInCurrentEntity(t){try{return this._stageMetadata.getStage(t).get_parent().get_Name()===this._currentFormEntity.etn}catch(t){this._applicationContext.EventManager.ReportComponentFailure("ProcessManager._isActiveStageInCurrentEntity",t)}return!0}getStageMetadata(){return this._stageMetadata}isBusinessProcessAborted(){return this.getStatus()===L.a.Aborted}isBusinessProcessCompleted(){return this.getStatus()===L.a.Finished}moveToNextStage(t=!1,e="Unknown"){const a=this.getTelemetryParams(e),s=new Promise((e,s)=>{if(Object(dt.a)(this._currentBpfInstance))return this.reportStageNavigationBlockedToBpfChecker("Process Control does not exist on the form."),s(new p.a("Process Control does not exist on the form.",2147877746));const n=this._stageMetadata.getNextStageId(this.getActiveStageId());if(a.push({name:"NextStageId",value:n}),!n)return this.reportStageNavigationBlockedToBpfChecker(Fe),void s(new q.f(Fe));this._updateFormInputBeforeMovingStage(!0);e(this._saveMainFormIfImmersiveBpfAndNewRecord().then(()=>this._saveFormDataAndActiveStage(f.a.tryParseOrNull(n),0,"MoveToNextStage",t)))});return s.then(()=>{Object(yt.c)(Ot.j,a,this._applicationContext)},t=>{this.reportStageNavigationBlockedToBpfChecker((null==t?void 0:t.message)||""+t),this._shouldReportErrorAsSuccess(t)?Object(yt.c)(Ot.j,a,this._applicationContext):Object(yt.b)(Ot.j,t,null,a,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),s}_showProcessControlError(t){let e;switch(t){case je.ProcessControlMissing:e=new p.a("Process Control does not exist on the form.",2147877746);break;case je.FirstStageReached:e=new q.e("The first stage in the traversed path reached. Previous stage does not exist.");break;case je.InvalidStageId:e=new q.d("The stage id passed is not valid");break;case je.LastStageReached:e=new q.f(Fe);break;case je.RequiredFieldsMissing:e=new q.h("Unable to navigate to next stage as required fields have not been set");break;case je.StageNotInActivePath:e=new q.i("stage id does not exist on the current active path of the instance.");break;case je.StageNotInTraversedPath:e=new q.d("The stage is not in traversed path. Only navigating backwards is supported.");break;case je.TraversedPathMissing:e=new q.d("Traversed Path is not present")}return Object(Nt.f)(this._getState(),Yt.c)&&!this._shouldReportErrorAsSuccess(e)?this._dispatch(Object(d.b)(e,!0)).then(()=>e):e}moveToPreviousStage(t=!1,e="Unknown"){const a=this.getTelemetryParams(e),s=new Promise((e,s)=>{if(Object(dt.a)(this._currentBpfInstance))return s(this._showProcessControlError(je.ProcessControlMissing));const n=this._stageMetadata.getPreviousStageId(this.getActiveStageId());if(a.push({name:"PreviousStageId",value:n}),!n)return s(this._showProcessControlError(je.FirstStageReached));this._updateFormInputBeforeMovingStage(!1);e(this._saveFormDataAndActiveStage(f.a.tryParseOrNull(n),1,"MoveToPreviousStage",t))}).then(t=>(this._stageMetadata.getDefaultPathManager().triggerSubsequentDefaultPathCalculation(this.getActiveStageId()),t));return s.then(()=>{Object(yt.c)(Ot.k,a,this._applicationContext)},t=>{this._shouldReportErrorAsSuccess(t)?Object(yt.c)(Ot.k,a,this._applicationContext):Object(yt.b)(Ot.k,t,null,a,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),s}setActiveStage(t,e=!1,a="Unknown"){const s=le.startStopwatch({processId:f.a.toString(this.getProcessId()),processInstanceId:f.a.toString(this.getProcessInstanceId()),stageId:t}),n=this.getTelemetryParams(a);n.push({name:"stageId (input)",value:t});const i=new Promise((a,s)=>{const n=f.a.tryParseOrNull(t),i=this.getTraversedPath();if(Object(dt.a)(this._currentBpfInstance))return s(this._showProcessControlError(je.ProcessControlMissing));if(!n||!this._stageMetadata.getStage(n.guid))return s(this._showProcessControlError(je.InvalidStageId));if(!i)return s(this._showProcessControlError(je.TraversedPathMissing));if(this.getActiveStageId()===n.guid)return a({status:0});const r=new R.a(i);if(!r||!r.isInTraversedPath(t)){return s(this.getActivePath().some(t=>f.a.equals(t,n))?this._showProcessControlError(je.StageNotInTraversedPath):this._showProcessControlError(je.StageNotInActivePath))}a(this._saveFormDataAndActiveStage(n,1,"SetActiveStage",e))}).then(e=>{const a=new ct(f.a.toString(this._processId),f.a.toString(this.getProcessInstanceId()),t);return this._applicationContext.EventManager.ReportEvent(a),this._stageMetadata.getDefaultPathManager().triggerSubsequentDefaultPathCalculation(t),e});return i.then(()=>{s(),Object(yt.c)(Ot.t,n,this._applicationContext)},t=>{s(),this._shouldReportErrorAsSuccess(t)?Object(yt.c)(Ot.t,n,this._applicationContext):Object(yt.b)(Ot.t,t,null,n,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),i}switchProcess(){}abandonProcess(){const t=this.getTelemetryParams(),e=new Promise((t,e)=>Object(dt.a)(this._currentBpfInstance)?e(new p.a("Process Control does not exist on form.",2147877746)):this.isBusinessProcessAborted()?t():void t(this._updateStateAndStatusOfProcess(L.a.Aborted,k.Inactive,"AbandonProcess")));return e.then(()=>{Object(yt.c)(Ot.a,t,this._applicationContext)},e=>{this._shouldReportErrorAsSuccess(e)?Object(yt.c)(Ot.a,t,this._applicationContext):Object(yt.b)(Ot.a,e,null,t,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),e}reactivateProcess(){const t=this.getTelemetryParams(),e=new Promise((t,e)=>Object(dt.a)(this._currentBpfInstance)?e(new p.a("Process Control does not exist on form.",2147877746)):this.getStatus()===L.a.Active?t():void t(this._updateStateAndStatusOfProcess(L.a.Active,k.Active,"ReactivateProcess")));return e.then(()=>{Object(yt.c)(Ot.m,t,this._applicationContext)},e=>{this._shouldReportErrorAsSuccess(e)?Object(yt.c)(Ot.m,t,this._applicationContext):Object(yt.b)(Ot.m,e,null,t,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),e}completeProcess(){const t=this.getTelemetryParams(),e=new Promise((t,e)=>Object(dt.a)(this._currentBpfInstance)?e(new p.a("Process Control does not exist on form.",2147877746)):this.isBusinessProcessCompleted()?t():f.a.tryParseOrNull(this._stageMetadata.getNextStageId(this.getActiveStageId()))?e(new p.a("Attempt to finish a process not on last stage.",2148081666)):void t(this._saveMainFormIfImmersiveBpfAndNewRecord().then(()=>this._updateStateAndStatusOfProcess(L.a.Finished,k.Inactive,"CompleteProcess"))));return e.then(()=>{Object(yt.c)(Ot.d,t,this._applicationContext)},e=>{this._shouldReportErrorAsSuccess(e)?Object(yt.c)(Ot.d,t,this._applicationContext):Object(yt.b)(Ot.d,e,null,t,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),e}_shouldReportErrorAsSuccess(t){return t instanceof q.c||(t instanceof q.h||(t instanceof q.f||(t instanceof q.e||(t instanceof q.d||(t instanceof q.i||t instanceof q.b)))))}triggerActionStepClick(t){if(Object(dt.b)(t)){const t=new Error("BPF Action Step Failure: null ControlId");throw Object(yt.b)(Ot.b,t,null,this.getTelemetryParams(),this._applicationContext,this.getCurrentFormEntity(),this._getState()),t}const e=this._actionStepManager.GetActionMetadata(t);if(Object(dt.a)(e)){const t=new Error("BPF Action Step Failure: null metadata");throw Object(yt.b)(Ot.b,t,null,this.getTelemetryParams(),this._applicationContext,this.getCurrentFormEntity(),this._getState()),t}const a=this._getState();if(Object(dt.a)(a)){const t=new Error("BPF Action Step Failure: null state");throw Object(yt.b)(Ot.b,t,null,this.getTelemetryParams(),this._applicationContext,this.getCurrentFormEntity(),this._getState()),t}let s=this._getTelemetryParamsForActionStep(e.actionType,t,e.actionId);try{const a=new f.a(e.actionId);if(e.actionType===bt.AsyncWorkflow||e.actionType===bt.SyncWorkflow){const n=["BusinessProcessFlowId","BusinessProcessFlowInstanceId","ActionStepId"],i=[this._processId.guid,f.a.toString(this.getProcessInstanceId()),a.guid].map(t=>{const e=new ft;return e.Type="System.String",e.Value=t,e}),r=new _t;r.Keys=n,r.Values=i,r.Count=3,r.IsReadOnly=!0;const o=new mt;o.Arguments=r;const c=new pt;c.EntityId=this._currentFormEntity.id,c.InputArguments=o,c.entity={id:e.workflowId,entityType:"workflow"},this.updateActionLog(a,{actionLogId:void 0,status:1}),this._dispatch(Object(F.b)(c)).then(()=>{Object(vt.a)(this._currentPageId,this.getContextToken(),t),this.updateActionLog(a,{actionLogId:void 0,status:2,message:this._actionStepManager.GenerateMessageForAction(2)}),Object(yt.c)(Ot.b,s,this._applicationContext)},e=>{Object(vt.a)(this._currentPageId,this.getContextToken(),t),this.updateActionLog(a,{actionLogId:void 0,status:3,message:this._actionStepManager.GenerateMessageForAction(3)}),Object(yt.b)(Ot.b,e,null,s,this._applicationContext,this.getCurrentFormEntity(),this._getState()),this._dispatch(Object(d.b)(e,!0)).then()})}else if(e.actionType===bt.ProcessAction){const n=e=>{Object(vt.a)(this._currentPageId,this.getContextToken(),t),this.updateActionLog(a,{actionLogId:void 0,status:3,message:this._actionStepManager.GenerateMessageForAction(3)}),Object(yt.b)(Ot.b,e,null,s,this._applicationContext,this.getCurrentFormEntity(),this._getState()),this._dispatch(Object(d.b)(e,!0)).then()},i=n=>{Object(vt.a)(this._currentPageId,this.getContextToken(),t),this.updateActionLog(a,{actionLogId:void 0,status:2,message:this._actionStepManager.GenerateMessageForAction(2)});const i=n.get_outputParameters();e.outputBindings.forEach(t=>{if(t.parameterName in i){const e=i[t.parameterName],a=t.boundAttributeName,s={};s[a]={key:a,value:e},this._dispatch(Object(Pt.a)(this._currentPageId,s,!1,!0,this._currentFormEntity.etn,this._currentFormEntity.id.guid,null,this.getContextToken()))}}),Object(yt.c)(Ot.b,s,this._applicationContext)},r=s=>{if(s=s?s.parameters:{},this._filterInputArguments(s)){const t={id:f.a.toString(this.getCurrentFormEntity().id),entityType:this.getCurrentFormEntity().etn};s.Target=t,s.BusinessProcessFlowId=this._processId.guid,s.BusinessProcessFlowInstanceId=f.a.toString(this.getProcessInstanceId()),s.ActionStepId=e.actionId,this._actionStepManager.InvokeProcessAction(e.uniqueName,e,s).then(i,n)}else Object(vt.a)(this._currentPageId,this.getContextToken(),t),this.updateActionLog(a,{actionLogId:void 0,status:3,message:this._actionStepManager.GenerateMessageForAction(3)})},o={};e.inputBindings.forEach(t=>{const e=Object(A.c)(Object(tt.j)(this._getState(),this.getCurrentFormEntity(),t.boundAttributeName));o["ProcessUnification_Arguments_"+t.parameterName]=e}),this._addInputParametersToParamList(e.inputParameters,o),this.updateActionLog(a,{actionLogId:void 0,status:1,clearOnRestore:!0}),Xrm.Navigation.openDialog(e.workflowId,this._getDialogOptions(),o).then(r,n)}}catch(t){throw 0===s.length&&(s=this.getTelemetryParams()),Object(yt.b)(Ot.b,t,null,s,this._applicationContext,this.getCurrentFormEntity(),this._getState()),t}}triggerFlowStepClick(t,e){e=e;const a=Et.getTelemetryParamsForFlowStep(null,null,null,t,this.getTelemetryParams());try{const e=f.a.newGuid(),s={activeStage:this.getActiveStage(),selectedStage:this.getSelectedStage(),flowStepId:t,workflowLogId:e};this._flowStepManager.openFlowWidget(s,a),this.updateActionLog(new f.a(t),{actionLogId:e,status:1});const n=this.getActionLog(new f.a(t));this.createWorkflowLogRecord(n),Object(yt.c)(Ot.f,a,this._applicationContext)}catch(t){Object(yt.b)(Ot.f,t,null,a,this._applicationContext,this.getCurrentFormEntity(),this._getState())}}refreshFlowStepClick(t){const e=Et.getTelemetryParamsForFlowStep(null,null,null,t,this.getTelemetryParams()),a=this._dispatch(Object(Rt.a)(this._currentPageId,this._processId,this._currentBpfInstance));Promise.resolve(a).then(()=>{this._updateProcessInstanceModifiedTime(),Object(yt.c)(Ot.p,e,this._applicationContext)}).catch(t=>{Object(yt.b)(Ot.p,t,null,e,this._applicationContext,this.getCurrentFormEntity(),this._getState())})}_addInputParametersToParamList(t,e){for(const a of Object.keys(t))"ProcessUnification_Arguments_"+t[a].parameterName in e||(e["ProcessUnification_Arguments_"+t[a].parameterName]=null)}_filterInputArguments(t){if(t&&"last_button_clicked"in t&&"ok_id"===t.last_button_clicked){const e="ProcessUnification_Arguments_";for(const a in t){const s=t[a];if(a.startsWith(e)){t[a.substring(e.length,a.length)]=s}delete t[a]}return!0}return!1}_getDialogOptions(){return{height:450,width:450,position:1}}_createSnapshotRequest(t,e){if(!t)throw new Error("Active stage cannot be null or undefined.");const a=new U.a("processstage",t),s=this._calculateNewTraversedPath(t),n={activestageid:{reference:a,timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null,userInput:t.guid}},traversedpath:{value:s,timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null,userInput:""}}};return this._addFieldsToBPFSnapshotForCreate(n,e)}_addFieldsToBPFSnapshotForCreate(t,e){if(!t||!this._hasBpfInstance())return t;const a=Object(Lt.b)(this._getState(),this._currentFormEntity.etn,this._currentBpfInstance.etn);return a&&(t[a.ReferencingAttribute]={reference:new U.a(this._currentFormEntity.etn,e),timestamp:new Date,validationResult:{errorId:null,errorMessage:null,isValueValid:!0,userInput:null,isOfflineSyncError:!1}}),t.processid={reference:new U.a("workflow",this.getProcessId()),timestamp:new Date,validationResult:{errorId:null,errorMessage:null,isValueValid:!0,userInput:null,isOfflineSyncError:!1}},t}generateBPFInstanceSnapshotId(){var t,e,a,s;let n=this.getTelemetryParams();if(this.isImmersiveBPF()||!Object(Nt.f)(this._getState(),re.Wg)){if(Object(yt.c)(Ot.l,n,this._applicationContext),Object(Nt.f)(this._getState(),Yt.c)){const t=Object(st.c)(this._getState(),this._currentBpfInstance);return null==t?void 0:t.snapshotId}return null}let i=null;try{const o=Object(v.hc)(this._getState(),this._currentPageId,this.getContextToken()),c=Object(st.b)(this._getState(),o);let l=null!==(e=null===(t=null==c?void 0:c.identifier)||void 0===t?void 0:t.id)&&void 0!==e?e:this._currentFormEntity.id;const u=null!==(s=null===(a=null==c?void 0:c.identifier)||void 0===a?void 0:a.etn)&&void 0!==s?s:this._currentFormEntity.etn,d=Object(r.j)(this._getState(),this._currentPageId);if(Object(Lt.e)(d)){Object(Lt.f)(this._getState(),o,l,this._dispatch);const t={name:"IsCrossEntityCreationForm",value:!0};if(n.push(t),Object(yt.c)(Ot.l,n,this._applicationContext),Object(Nt.f)(this._getState(),Yt.c)){const t=Object(st.c)(this._getState(),this._currentBpfInstance);return null==t?void 0:t.snapshotId}return null}if(!this._hasBpfInstance()||f.a.isNullOrEmpty(this.getProcessId())){const t={name:"IsCreateScenarioOnEditForm",value:!0};if(n.push(t),Object(yt.c)(Ot.l,n,this._applicationContext),Object(Nt.f)(this._getState(),Yt.c)){const t=Object(st.c)(this._getState(),this._currentBpfInstance);return null==t?void 0:t.snapshotId}return null}if(Object(Lt.d)(this._getState(),new U.a(u,l),this._currentPageId)){Object(Lt.f)(this._getState(),o,l,this._dispatch);const t={name:"IgnoreBPF",value:!0};return n.push(t),Object(yt.c)(Ot.l,n,this._applicationContext),null}f.a.isNullOrEmpty(l)&&(l=f.a.newGuid(),Object(Lt.f)(this._getState(),o,l,this._dispatch));const h=Object(st.c)(this._getState(),this._currentBpfInstance);if(null==h?void 0:h.snapshotId)return n=this._getBPFSnasphotAndPrimaryEntitySnapshotParams(h,c),this._applicationContext.EventManager.ReportComponentSuccess(Ot.l,n),null==h?void 0:h.snapshotId;i=this._createActiveStageSnapshot(f.a.tryParse(this.getActiveStageId()),l);const g=Object(st.b)(this._getState(),i);n=this._getBPFSnasphotAndPrimaryEntitySnapshotParams(g,c),this._applicationContext.EventManager.ReportComponentSuccess(Ot.l,n)}catch(t){this._applicationContext.EventManager.ReportComponentFailure(Ot.l,t,null,n)}return i}_calculateNewTraversedPath(t){let e="";for(const a of this.getActivePath())if(e+=","+a.guid,f.a.equals(a,t))return e.substring(1);return e+=","+t.guid,e.substring(1)}_createActiveStageSnapshot(t,e){const a=this._createSnapshotRequest(t,e),s=de.startStopwatch({processId:f.a.toString(this.getProcessId()),processInstanceId:f.a.toString(this.getProcessInstanceId())});let n=Object(st.c)(this._getState(),this.getCurrentFormEntity(!0));if(this.isImmersiveBPF()&&!Object(dt.a)(n)){const t=Object(J.b)(this._getState(),n.snapshotId,a);this._dispatch(t),n=Object(st.c)(this._getState(),this.getCurrentFormEntity());const e=this._getSnapshotStateTelemetryParams(n);return Object(yt.c)(Ot.e,e,this._applicationContext),s(),n.snapshotId}const i=Object(at.h)(this._currentFormEntity.etn),r=Object(at.y)(i),o=Object($.b)(this._getState(),this._currentBpfInstance,a,r,this._hasBpfInstance()?et.a.Create:et.a.Update),c=o.payload.snapshotId;this._dispatch(o);const l=this.getTelemetryParams(),u={name:"SnapshotId",value:c};return l.push(u),l.push({name:"Snapshot active changes",value:o&&o.payload.activeChanges&&Object.keys(o.payload.activeChanges).map(t=>"Property: "+t).join("; ")}),Object(yt.c)(Ot.e,l,this._applicationContext),s(),c}_hasBpfInstance(){return!this._currentBpfInstance||f.a.isNullOrEmpty(this._currentBpfInstance.id)}_updateStateAndStatusOfProcess(t,e,a){return new Promise((s,n)=>{const i=this._createStatusAndStateUpdateRequest(t,e);let r=Object(st.c)(this._getState(),this.getCurrentFormEntity(!0)),o=null;if(this.isImmersiveBPF()&&!Object(dt.a)(r)){const t=Object(J.b)(this._getState(),r.snapshotId,i);this._dispatch(t),r=Object(st.c)(this._getState(),this.getCurrentFormEntity())}else{const t=Object(at.h)(this.getCurrentFormEntity().etn),e=Object(at.y)(t),a=Object($.b)(this._getState(),this._currentBpfInstance,i,e);o=a.payload.snapshotId,this._dispatch(a)}if(this.executePreEvent("runOnPreProcessStatusChange",a,null,t,null))return this._discardBPFSnapshot(o),void s();if(this._shouldPerformFormSave()){const e=this._validateSnapshot(r,this._getState()).then(()=>this._validateRequiredFieldsForNavigationOrStateChangeAndThrowOnFailures(a)).then(()=>this._saveFormEntityAndBPFEntitySnapshots(o,r,!1)).then(()=>{this._executePostEvent("runOnProcessStatusChange",a,null,t)}).catch(t=>{const e=Object(p.c)(t);return this._handleDuplicateDetection(e,o)}).catch(t=>{throw this._unlockPrimaryEntityActiveChangesIfMainFormSaveFailure(t),t}).catch(t=>{this._discardBPFSnapshot(o),this._dispatch(Object(d.b)(t,!0)).then(()=>n(t))});s(e)}else{this._validateRequiredFieldsForNavigationOrStateChangeAndThrowOnFailures(a);let e=null;e=this.isImmersiveBPF()&&!Object(dt.a)(r)?r.snapshotId:o;const i=["statuscode","statecode","activestagestartedon","completedon"];this._dispatch(Object(Z.a)(e,!0,i,null,null,0)).then(()=>{this._dispatch(Object(Q.a)(this._currentPageId,this.getCurrentFormEntity(),this._getColumnsToRefresh())).then(()=>{this._updateProcessInstanceModifiedTime(),this._executePostEvent("runOnProcessStatusChange",a,null,t)}),s()}).catch(t=>{this._discardBPFSnapshot(o),this._dispatch(Object(d.b)(t,!0)).then(()=>n(t))})}})}_discardBPFSnapshot(t){Object(Nt.f)(this._getState(),Yt.c)&&!Object(dt.a)(t)&&Object(st.b)(this._getState(),t)&&this._dispatch(Object(oe.b)(t))}_validateRequiredFieldsForNavigationOrStateChangeAndThrowOnFailures(t){const e=this._validateRequiredFieldsForNavigationOrStateChange(t);if(!e.isValid)throw e.value}_validateRequiredFieldsForNavigationOrStateChange(t){const e={isValid:!0};if("CompleteProcess"===t||"MoveToNextStage"===t){const a=this.ValidateRequiredFieldsForNavigation();a&&!a.isValid&&("MoveToNextStage"===t?(e.isValid=!1,e.value=new q.h("Unable to navigate to next stage as required fields have not been set")):"CompleteProcess"===t?(e.isValid=!1,e.value=new q.h("Unable to complete process as required fields have not been set")):(e.isValid=!1,e.value=new Error("validation failed for unexpected BPF operation: "+t)))}return e}_ignorableResultCreator(t){return(null==t?void 0:t.navigationStatus)?{handled:!0,result:new Qt.a(!0,!1,!1,!1)}:{handled:!1}}_saveFormChangesBeforeNavigation(){if(this._shouldPerformFormSave()){const t=Object(st.c)(this._getState(),this.getCurrentFormEntity(!0));return this._validateSnapshot(t,this._getState()).then(()=>this._validateRequiredFieldsForNavigationOrStateChangeAndThrowOnFailures("MoveToNextStage")).then(()=>{const e=this._getColumnsToRefresh();return this._dispatch(Object(Z.a)(t.snapshotId,!0,e,null,null,0))}).catch(e=>(this._unlockPrimaryEntityActiveChangesIfMainFormSaveFailure(e,t.snapshotId),this._dispatch(Object(d.b)(e,!0))))}return Promise.resolve()}_shouldPerformFormSave(){const t=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ShouldPerformFormSave"),e=this.getTelemetryParams(),a=this._getState();if(Object(v.nb)(a,{id:this._currentPageId},this.getContextToken()))return t.info("Skip main form save for BPF state or stage change due to read only form",e),!1;const s=this._dispatch(Object(Ft.b)(this._currentPageId,this.getContextToken()));if(s&&s.data&&s.data.getIsDirty){const a=s.data.getIsDirty(),n={name:"shouldPerformMainFormSave",value:a};return e.push(n),t.info("Checking if main form save should be performed due to dirty form",e),a}return t.error("Unable to determine dirty state of main form - skipping save of main form",e),!1}_saveMainFormIfImmersiveBpfAndNewRecord(){const t=Object(r.p)(this._getState(),this._currentPageId);if(this.isImmersiveBPF()&&t===Dt.b&&f.a.isNullOrEmpty(this.getCurrentFormEntity().id)){const e=1;return this._dispatch(Object(u.f)(this._currentPageId,t,!1,e,!1,!1)).then(t=>{this._currentFormEntity=t})}return Promise.resolve(void 0)}_createPreventDefaultError(t){const e=["Error_Message_0x80060369"],a=Object(Zt.e)(t,e),s=Object(Zt.c)(a,"Error_Message_0x80060369");return new p.a(s||"Unable to save form data due to web resource registered onSave invoking preventDefault",2147877737)}async _validateSnapshot(t,e){const a=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.SnapshotValidation"),s=this._getSnapshotStateTelemetryParams(t),n=this._currentPageId,i=this.getContextToken(),r=this._dispatch(this._getEventManager().runOnSave(i,1,null,null,"This save event is invoked by Business Process Flow."));let o=!1;const c=this._createPreventDefaultError(e);if(o="boolean"==typeof r?r:await r,o)throw this._dispatch(Object(h.b)(n,i,2)),this._dispatch(Object(g.b)(n,i,!1)),a.warn("BPF ProcessManager: Unable to save form data due to web resource registered onSave invoking preventDefault",s),c;for(const e in t.activeChanges){const n=t.activeChanges[e],i=this._applicationContext.DataSource.get_MetadataCache().getAttributeMetadata(t.identifier.etn,e),r=Object(dt.a)(i)?null:i.get_logicalName(),o=Object(dt.a)(i)?Bt.a.get_empty():i.get_id();if(Object(dt.a)(n))throw a.error("BPF ProcessManager: unexpected null or undefined fieldValue for attribute "+r+" with ID: "+o,s),new Error("Internal Client Error - null fieldValue");const c=n.validationResult;if(Object(dt.a)(c)){if(r===Ct.d){a.info("BPF ProcessManager: skipping formEntitySnapshot validation for atttribute: "+r+" with ID: "+o,s);continue}throw a.error("BPF ProcessManager: unexpected null or undefined validationResult for atttribute: "+r+" with ID: "+o,s),new Error("Internal Client Error - null validatorResult")}const l=c.isValueValid;if(Object(dt.a)(l))throw a.error("BPF ProcessManager: unexpected null or undefined validationResult.isValidValue for atttribute: "+r+" with ID: "+o,s),new Error("Internal Client Error - null validationResult.isValidValue");if(!l){const t={name:Ot.w,value:"clientSideCurrentForm"};throw s.push(t),a.warn("BPF ProcessManager: unable to save form due to invalid value for attribute: "+r+" with ID: "+o,s),new q.a("Unable to save form data due to validation errors")}}return!0}_createStatusAndStateUpdateRequest(t,e){return{statuscode:{label:L.a[t],valueString:t.toString(),timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null}},statecode:{label:k[e],valueString:e.toString(),timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null}}}}_isBPFDataStepControlHidden(t,e){if(t&&e){const a=Object.keys(e).find(a=>e[a].Id===t.get_Id()),s=Object(at.h)(this._currentFormEntity.etn);return!1===Object(v.I)(this._getState(),{id:this._currentPageId,controlName:a},s)}return!1}_isBPFDataStepControlDisabled(t,e,a){if(!t||!e||!Object(Nt.f)(a,Yt.f))return!1;const s=Object.keys(e).find(a=>e[a].Id===t.get_Id()),n=Object(at.h)(this._currentFormEntity.etn);return Object(v.v)(this._getState(),{id:this._currentPageId,controlName:s},n)}ValidateRequiredFieldsForNavigation(){var t;const e=ue.startStopwatch({processId:f.a.toString(this.getProcessId()),processInstanceId:f.a.toString(this.getProcessInstanceId())}),a=this._getState(),s=this._stageMetadata.getRequiredDataStepsForStage(this.getActiveStageId(),this._currentPageId,this.getContextToken(),a),n=this._stageMetadata.getRequiredFlowStepsForStage(this.getActiveStageId(),this._currentPageId,this.getContextToken(),a),i={emptySteps:[],errorSteps:[]},o=Object(st.c)(this._getState(),this.getCurrentFormEntity(!0)),c=this._getSnapshotStateTelemetryParams(o),l=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.SnapshotValidation");let d;if((null==s?void 0:s.size)>0){const e=Object(_.a)(this._getState(),this._processId);(null==e?void 0:e.businessProcessFlowStepEntityAttributeControls)&&(d=e.businessProcessFlowStepEntityAttributeControls[null===(t=this.getCurrentFormEntity())||void 0===t?void 0:t.etn])}for(const t of Array.from(s)){const e=t.get_Description();if(this._isBPFDataStepControlHidden(t,d)){l.info("BPF ProcessManager ValidateRequiredFieldsForNavigation: Attribute has been hidden by client API. Skipping validating attribute: "+e,c);continue}if(this._isBPFDataStepControlDisabled(t,d,this._getState())){l.info("BPF ProcessManager ValidateRequiredFieldsForNavigation: Attribute has been disabled by client API. Skipping validating attribute: "+e,c);continue}l.info("BPF ProcessManager ValidateRequiredFieldsForNavigation: validating attribute: "+e,c);let a=Object(tt.j)(this._getState(),this.getCurrentFormEntity(),e);o&&o.activeChanges&&e in o.activeChanges&&(l.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: fieldIsDirty: "+e,c),a=o.activeChanges[e]);Object(O.d)(a,this._getState(),this.getCurrentFormEntity().etn,e)?(l.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: emptyField: "+e,c),i.emptySteps.push(e)):a.validationResult.isValueValid||(l.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: !fieldValue.validationResult.isValueValid: "+e,c),i.errorSteps.push(e))}for(const t of n){const e=f.a.tryParse(t);if(f.a.isNullOrEmpty(e)){l.error("BPF ProcessManager ValidateRequiredFieldsForNavigation: invalid Flow Step ID GUID: "+t,c);continue}const a=this.getActionLog(e);if(a){const e=a.status;2!==e&&(l.info("BPF ProcessManager ValidateRequiredFieldsForNavigation: Required Flow Step not completed for stepId "+t+". The Flow Step Action Log has stauts of : "+e,c),i.errorSteps.push(t))}else l.info("BPF ProcessManager ValidateRequiredFieldsForNavigation: Required Flow Step not completed for stepId "+t+". No action logs were found for this Flow Step",c),i.errorSteps.push(t)}i.isValid=0===i.emptySteps.length&&0===i.errorSteps.length;const h=Object(qt.a)(a,this._currentPageId);if(!Object(v.Mb)(h,a,this._currentPageId,this.getContextToken())){l.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: form is not valid - "+this._currentPageId,c);const t=Object(r.p)(this._getState(),this._currentPageId);this._dispatch(Object(u.f)(this._currentPageId,t,!1,1,!1,!1)),i.isValid=!1}if(!i.isValid){c.push({name:"emptyFields",value:JSON.stringify(i.emptySteps)});const t=String.format("BPF ProcessManager: ValidateRequiredFieldsForNavigation returned invalid");l.warn(t,c)}return e(),i}setSelectedStage(t,e=!1){return new Promise((a,s)=>{const n=f.a.tryParseOrNull(t);if(!n)return s("setSelectedStage can only be called with a valid stage id");const i={selectedStageId:n,isUserSelectedStage:e};this._updateBusinessProcessFlowUIStateData(this._currentBpfInstance,i),e&&this._executePostEvent("runOnStageSelected","setSelectedStage"),a()})}setIsUserSelectedStage(t=!1){const e={isUserSelectedStage:t};this._updateBusinessProcessFlowUIStateData(this._currentBpfInstance,e)}setDisplayState(t){var e;if(this._currentBpfInstance&&(t===o.a.collapsed||t===o.a.expanded||t===o.a.floating)){const a=this._getState(),s=null===(e=Object(r.q)(a,this._currentPageId))||void 0===e?void 0:e.width;if(t===o.a.expanded&&s<a.theme.sizes.Breakpoints.DimensionS){this._applicationContext.TraceManager.getTracer(Kt.c).warn("Set display state to expanded is not supported in small viewports, changing to floating"),t=o.a.floating}this._updateDisplayState(this._currentBpfInstance,t);const n=new lt(f.a.toString(this._processId),f.a.toString(this.getProcessInstanceId()),t);this._applicationContext.EventManager.ReportEvent(n)}}setActivePath(t){if(!t||0===t.length)return;const e=[];for(let a=0;a<t.length;a++)e[a]=new f.a(t[a]);const a={activePath:e};this._updateBusinessProcessFlowUIStateData(this._currentBpfInstance,a)}setBpfNavigationBehavior(t){const e={processNavigationBehavior:{navigationBehavior:t,navigationBehaviorPageId:this._currentPageId}};this._updateBusinessProcessFlowUIStateData(this._currentBpfInstance,e)}getBpfNavigationBehavior(){var t;return this._currentBpfInstance&&(null===(t=Object(O.a)(this._getState(),this._currentPageId,this.getProcessInstanceId()))||void 0===t?void 0:t.navigationBehavior)}shouldReInitializeNavigationBehavior(){var t,e,a;return!(!this._currentBpfInstance||!(null==this.getBpfNavigationBehavior()&&Object(dt.a)(null===(e=null===(t=Object(O.a)(this._getState(),this._currentPageId,this.getProcessInstanceId()))||void 0===t?void 0:t.navigationBehavior)||void 0===e?void 0:e.allowCreateNew)||(null===(a=Object(O.a)(this._getState(),this._currentPageId,this.getProcessInstanceId()))||void 0===a?void 0:a.navigationBehaviorPageId)!==this._currentPageId))}getBpfNavigationBehaviorAllowCreateNew(t){var e,a;const s=this._currentBpfInstance&&(null===(a=null===(e=Object(O.a)(this._getState(),this._currentPageId,this.getProcessInstanceId()))||void 0===e?void 0:e.navigationBehavior)||void 0===a?void 0:a.allowCreateNew);return!s||!t||s(t)}createWorkflowLogRecord(t){if(Object(dt.a)(t))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined actionLog");const e=this._getState();if(Object(dt.a)(e))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined state");const a=e.metadata;if(Object(dt.a)(a))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined metadata");const s=a.entities;if(Object(dt.a)(s))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined entities");const n=this._currentBpfInstance.etn;if(Object(dt.b)(n))throw new Error("BPF Create WorkflowLog Record Failure: null or empty entityLogicalName");const i=s[n];if(Object(dt.a)(i))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined bpfEntity");const r=i.EntitySetName;if(Object(dt.b)(r))throw new Error("BPF Create WorkflowLog Record Failure: null or empty entitySetName");const o=Object(wt.A)(e,"workflowlog",i.EntityLogicalName,"asyncoperationid");if(Object(dt.a)(o))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined relationshipMetadata");if(Object(dt.b)(o.ReferencingEntityNavigationPropertyName))throw new Error("BPF Create WorkflowLog Record Failure: null or empty relationshipMetadata.ReferencingEntityNavigationPropertyName");const c=o.ReferencingEntityNavigationPropertyName+"@odata.bind",l="/"+r+"("+t.processInstanceid.guid+")",u={workflowlogid:t.actionLogId.guid,stepname:t.stepId.guid,[c]:l,activityname:t.processDefinitionid.guid,status:t.status};Xrm.WebApi.createRecord("workflowlog",u)}_getTracer(){return Object(dt.a)(this._applicationContext)||Object(dt.a)(this._applicationContext.TraceManager)?null:this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ProcessManager")}_getDefaultActivePath(){const t=this._getTracer();if(Object(dt.a)(this._stageMetadata))return t&&t.error("ProcessManager _getDefaultActivePath method: NullOrUndefined _stageMetadata"),null;const e=this._stageMetadata.getDefaultPathManager();if(Object(dt.a)(e))return t&&t.error("ProcessManager _getDefaultActivePath method: NullOrUndefined defaultPathManager"),null;const a=e.getDefaultPath();if(Object(dt.a)(a))return t&&t.error("ProcessManager _getDefaultActivePath method: NullOrUndefined stringPath"),null;const s=[];for(const t in a){const e=f.a.parse(a[t]);s.push(e)}return s}_updateBusinessProcessFlowUIStateData(t,e){t&&(this._dispatch(Object(H.a)(this._currentPageId,e,t)),this._updateProcessInstanceModifiedTime())}_updateDisplayState(t,e){this._dispatch(Object(G.a)(e)),this._updateProcessInstanceModifiedTime()}getForwardNavigationEntities(t,e,a,s){return this._saveFormChangesBeforeNavigation().then(()=>this._dispatch(S(t,e,a,s||null)))}navigateToNextEntity(t,e,a,s){return new Promise((n,i)=>{const r=this.ValidateRequiredFieldsForNavigation();if(r&&!r.isValid)return i(this._showProcessControlError(je.RequiredFieldsMissing));const o=this._stageMetadata.getNextStageId(this.getActiveStageId());if(!o)return i(this._showProcessControlError(je.LastStageReached));const c=new f.a(o),l=this.getTraversedPath()+","+o;return this._saveFormChangesBeforeNavigation().then(()=>this._dispatch(E(t,e,c,l,a,s))).then(()=>this.setSelectedStage(o)).then(()=>{this._executePostEvent("runOnStageChange","navigateToNextEntity",0),n()}).catch(t=>{this._dispatch(Object(d.b)(t,!0)).then(()=>i(t))})})}navigateToNextEntityForCrossEntityBpf(t,e,a,s){return new Promise((n,i)=>{this._dispatch(E(t,e,new f.a(this.getActiveStageId()),this.getTraversedPath(),a,s)).then(()=>{this._dispatch(Object(X.b)(e,this._currentBpfInstance)),this._executePostEvent("runOnStageChange","navigateToNextEntityForCrossEntityBpf",0),n()}).catch(t=>{this._dispatch(Object(d.b)(t,!0)).then(()=>i(t))})})}getActiveStageActiveFor(){if(this._currentBpfInstance){const t=Object(y.b)(this._getState(),this._currentBpfInstance);if(t){return(new Date).valueOf()-t.valueOf()}}return null}getBpfInstanceActiveFor(){if(this._currentBpfInstance){const t=Object(y.d)(this._getState(),this._currentBpfInstance);if(t)return(new Date).valueOf()-t.valueOf()}return null}getBpfInstanceCompletedIn(){if(this._currentBpfInstance){const t=Object(y.d)(this._getState(),this._currentBpfInstance),e=Object(y.c)(this._getState(),this._currentBpfInstance);if(e&&t)return e.valueOf()-t.valueOf()}return null}getActionLogCollection(){var t;return this._currentBpfInstance?null===(t=Object(O.c)(this._getState(),this._currentPageId,this.getProcessInstanceId()))||void 0===t?void 0:t.actionLogCollection:null}getActionLog(t){const e=this.getActionLogCollection();return e&&e[t.guid]?e[t.guid]:null}updateActionLog(t,e){var a;if(!this._currentBpfInstance)return null;const{actionLogId:s,status:n,message:i,clearOnRestore:r}=e,o=null===(a=Object(O.c)(this._getState(),this._currentPageId,this.getProcessInstanceId()))||void 0===a?void 0:a.actionLogCollection,c=o&&o[t.guid]?o[t.guid]:null;let l=f.a.EMPTY;l=Object(dt.a)(s)||s===f.a.EMPTY?c?c.actionLogId:f.a.newGuid():s;const u={actionLogId:l,status:n,modifiedOn:(new Date).toLocaleString(),stepId:t,processDefinitionid:this._processId,processInstanceid:this.getProcessInstanceId(),message:i,clearOnRestore:r},d=Object.assign({},o);d[t.guid]=u;const h={actionLogCollection:d};return this._updateBusinessProcessFlowUIStateData(this._currentBpfInstance,h),"success"}getEnabledProcesses(){const t=[];return new Promise((e,a)=>{var s;this._currentFormEntity&&this._currentFormEntity.etn?this._dispatch((s=this._currentFormEntity.etn,{type:"businessProcessFlow.retrieveFilteredProcesses.async",async execute({dispatch:t,getState:e},a){const n=e(),i=f.a.tryParse(Object(M.k)(n)),r=new x(s,i),o=await t(Object(N.b)(r));return null==o?void 0:o.json()}})).then(a=>{for(const e of a.value)t.push(new B(e.name,e.uniquename,e.workflowid));e(t)},t=>{a(t)}):a(new p.a("Current Form Entity cannot be NULL",2147877745))})}getNavigationEntities(){return this._activeStageManager.navigationEntities}_getNavigationEntityIdsByEntityLogicalName(){return this._activeStageManager.navigationEntityIdsByEntityLogicalName}_updateGlobalActiveStage(t,e){this._activeStageManager.UpdateGlobalPathAndActiveStage(t,e)}_createGlobalNavigationData(t){const e=new D,a=Object(A.b)(t.activestageid);e.activeStageId=f.a.toString(a);let s=Object(A.c)(t.traversedpath);Object(dt.b)(s)&&(s=R.a.getCandidateTraversedPathFromStagStep(this._stageMetadata.businessProcessFlowVisitor.get_stages(),e.activeStageId)),e.traversedPath=s,e.navigationEntities=[];const n=this._getNavigationEntityTypesFromWorkflowObjectModel();for(const a of n){const s=new te;s.entityLogicalName=a,s.id=f.a.EMPTY.guid;for(const e in t)if(Object(A.k)(t[e])){const n=t[e],i=[],r="NULL";if(Object(dt.a)(n.reference)||Object(dt.a)(n.reference.etn)){i.push({name:"entityReference.reference",value:r});this._applicationContext.TraceManager.getTracer("CreateGlobalNavigationData").info("Navigation entity should not be null .",i)}n&&n.reference&&n.reference.etn===a&&(s.id=n.reference.id.guid)}e.navigationEntities.push(s)}t.hasOwnProperty("businessprocessflowinstanceid")&&(e.businessProcessInstanceId=Object(A.c)(t.businessprocessflowinstanceid));t.hasOwnProperty("name")&&(e.businessProcessInstanceName=Object(A.c)(t.name));t.hasOwnProperty("statecode")&&(e.businessProcessState=Object(A.c)(t.statecode));t.hasOwnProperty("statuscode")&&(e.businessProcessStatus=Object(A.c)(t.statuscode));return t.hasOwnProperty("bpfDefinitionVersioNumber")&&(e.bpfDefinitionVersionNumber=Object(A.c)(t.bpfDefinitionVersioNumber)),e}_getNavigationEntityTypesFromWorkflowObjectModel(){const t={};if(!Object(dt.a)(this.getProcess()))for(let e=0;e<this.getProcess().get_Steps().get_Count();e++){const a=this.getProcess().get_Steps().get_item(e);if(!(a instanceof Microsoft.Crm.Workflow.ObjectModel.EntityStep))continue;const s=a.get_Description();t[s]||(t[s]=s)}return Object.keys(t)}reflow(t,e,a,s="Unknown"){const n=this._getTelemetryParamsForReflow(e,a,s);Object(yt.c)(Ot.n+".Start",n,this._applicationContext);const i=this._stageMetadata.getDefaultPathManager();if(!e&&!a)return void this._reflowInternal(s);if(!e)return;e=new f.a(e).guid;const r=this.getTraversedPath(),o=this.getActiveStageId();r&&o&&((o===e||r.indexOf(e)<0)&&(i.updateDefaultPath(e,a,this._applicationContext),this._updateProcessInstanceModifiedTime()),Object(yt.c)(Ot.n+".End",n,this._applicationContext))}_reflowInternal(t,e,a="Unknown"){const s=this._getTelemetryParamsForReflow(t,e,a);Object(yt.c)(Ot.o+".Start",s,this._applicationContext);const n=this._stageMetadata.getDefaultPathManager();t||e||(e=this.getActiveStageId(),t=this._stageMetadata.getPreviousStageId(e)),t&&(n.updateDefaultPath(t,e,this._applicationContext),this._updateProcessInstanceModifiedTime(),Object(yt.c)(Ot.o+".End",s,this._applicationContext))}callPblToEvaluateBranching(t){const e=this.getTelemetryParams();Object(yt.c)(Ot.c+".Start",e,this._applicationContext);const a=this._getState();if(!this._currentPageId)throw new Error("The current page Id should not be null when callPblToEvaluateBranching has been called. Because the reflow logic should be triggered for a particular page.");const s=Object(W.a)(a,this._currentPageId),n=this.getScriptContainer();n?(s<z.a.EditReady&&(n.getEventManager()?n.getEventManager().addOnLoadEvent(this.getContextToken(),()=>{n.execute(t,[])}):Object(yt.b)(Ot.c,new Error("Container getEventManager cannot be null"),"",e,this._applicationContext,this._currentFormEntity,this._getState())),s>=z.a.OnLoadReady&&n.execute(t,[]),Object(yt.c)(Ot.c+".End",e,this._applicationContext)):Object(yt.b)(Ot.c,new Error("Script container should not be null."),"",e,this._applicationContext,this._currentFormEntity,this._getState())}update(t){!Object(dt.a)(this._currentBpfInstance)&&this._isSelectedStageControl(t.Id)&&this._updateProcessInstanceModifiedTime()}waitForOngoingWork(){return Wt.a.getInstance().checkForOutstandingWork(this._getState())}_getEventManager(){const t=this.getScriptContainer();return t?t.getEventManager():null}getScriptContainer(){if(!this._applicationContext||!this._applicationContext.ScriptManager)return null;let t=null;try{t=this._applicationContext.ScriptManager.getContainer(this._currentPageId)}catch(t){this._logTraceFailureForScriptContainer()}return t}getScriptContainerPromise(){return this._applicationContext&&this._applicationContext.ScriptManager?this._applicationContext.ScriptManager.initializeContainer(this._currentPageId):Promise.reject("The current container should be created before invoking handlers.")}_executePostEvent(t,e,a=null,s=null){if(Object(kt.m)(this._getState(),this._currentPageId)||!this._getEventManager())this._logTraceFailureForProcessEvent(e,t,t);else switch(t){case"runOnProcessChange":this._dispatch(this._getEventManager().runOnProcessChange(this.getContextToken(),this));break;case"runOnProcessStatusChange":this._dispatch(this._getEventManager().runOnProcessStatusChange(this.getContextToken(),s,this));break;case"runOnStageChange":this._dispatch(this._getEventManager().runOnStageChange(this.getContextToken(),this,a));break;case"runOnStageSelected":this._dispatch(this._getEventManager().runOnStageSelected(this.getContextToken(),this))}}executePreEvent(t,e,a=null,s=null,n=null){let i=!1;if(!Object(kt.m)(this._getState(),this._currentPageId)&&this._getEventManager()){switch(t){case"runOnPreProcessStatusChange":i=this._dispatch(this._getEventManager().runOnPreProcessStatusChange(this.getContextToken(),s,this));break;case"runOnPreStageChange":i=this._dispatch(this._getEventManager().runOnPreStageChange(this.getContextToken(),this,a,n))}return this._logTraceInfoForProcessPreEvent(i,t,n,e,e),i}return this._logTraceFailureForProcessEvent(e,t,t),i}_saveFormDataAndActiveStage(t,e,a,s){const n=he.startStopwatch({processId:f.a.toString(this.getProcessId()),processInstanceId:f.a.toString(this.getProcessInstanceId())}),i=this.executePreEvent("runOnPreStageChange",a,e,null,null==t?void 0:t.guid),r=Object(st.c)(this._getState(),this.getCurrentFormEntity(!0));if(i)return this.reportStageNavigationBlockedToBpfChecker(`Stage navigation was prevented because of a call of executionContext.getEventArgs().preventDefault() by custom script. Please look into monitor event of Operation "${gt.z}.${c.b.onPreStageChange}" for custom script details.`),Promise.resolve({status:0,preventDefault:!0});const o=new Promise((e,n)=>{let i;if(!t)return i="Attemping to save invalid stage id: "+t,this.reportStageNavigationBlockedToBpfChecker(i),n(new q.d(i));const o=["traversedpath","activestageid","activestagestartedon","completedon"],c=this.getNavigationEntities(),l=Object(_.b)(this._getState(),this._currentBpfInstance);for(const t of c)for(const e in l)if(e.includes(t.entityLogicalName)){o.push(e);break}let d,h;if(Object(Nt.f)(this._getState(),Yt.c)){h=this._createActiveStageSnapshot(t);const n={refreshColumnsByEntity:{[this._currentBpfInstance.etn]:o},preSaveValidator:this._validateRequiredFieldsForNavigationOrStateChange.bind(this,a),ignorableResultCreator:this._ignorableResultCreator,preventDefaultErrorCreator:this._createPreventDefaultError};d=this._dispatch(Object(u.e)(this._currentPageId,1,s,[n],"This save event is invoked by Business Process Flow.")).catch(t=>{throw h&&this._dispatch(Object(oe.b)(h)),t}),e(d)}else{if(this._shouldPerformFormSave()){const e=this._getState();d=this._validateSnapshot(r,e).then(()=>this._validateRequiredFieldsForNavigationOrStateChangeAndThrowOnFailures(a)).then(()=>(h=this._createActiveStageSnapshot(t),this._saveFormEntityAndBPFEntitySnapshots(h,r,!1))).then(()=>{const t=this.getCurrentFormEntity();this._dispatch(Object(Xt.a)(this._currentPageId,e,this.getContextToken(),t.etn,t.id))}).catch(t=>{const e=Object(p.c)(t);return this._handleDuplicateDetection(e,h)})}else this._validateRequiredFieldsForNavigationOrStateChangeAndThrowOnFailures(a),h=this._createActiveStageSnapshot(t),d=this._dispatch(Object(Z.a)(h,!0,o,this._getRetrieveProcessControlDataRequest(),null,0)).then(()=>{this._dispatch(Object(Q.a)(this._currentPageId,this.getCurrentFormEntity(),this._getColumnsToRefresh(),this._getRetrieveProcessControlDataRequest())),this._dispatch(Object(I.b)(!0,this._currentFormEntity))});e(d)}}).then(()=>{var s;const n=this.getTraversedPath(),i=this.getActiveStageId();if(this._updateGlobalActiveStage(n,i),this.setSelectedStage(i),this._executePostEvent("runOnStageChange",a,e),!f.a.equals(t,f.a.tryParse(i))){const e=this._getStage(null==t?void 0:t.guid),a=this._getStage(i);this.reportStageNavigationBlockedToBpfChecker(`The client side intended to set active stage to ${null==e?void 0:e.get_stageName()} (id: ${null==t?void 0:t.guid}), but the server side returned active stage ${null==a?void 0:a.get_stageName()} (id: ${i}). Most likely some server side plugin or workflow has modified the current Business Process Flow entity ${this.getProcessInstanceName()} (id: ${null===(s=this.getProcessInstanceId())||void 0===s?void 0:s.guid}).`)}},t=>{throw this._unlockPrimaryEntityActiveChangesIfMainFormSaveFailure(t),t}).then(()=>({status:0}));return o.then(l,l),o;function l(){n()}}_handleDuplicateDetection(t,e){if(Object(Gt.e)(t)){return this._dispatch(Object(zt.a)(this._currentPageId,t,this.getCurrentFormEntity(!0))).then(t=>0===t.status?this._dispatch(Object(Ht.a)(t.pageId)).then(t=>t.value.param_lastButtonClicked===u.a?"success":"aborted"):"noop").then(t=>{if("success"===t){const t=Object(st.c)(this._getState(),this.getCurrentFormEntity(!0));return this._saveFormEntityAndBPFEntitySnapshots(e,t,!0)}})}throw t}_saveFormEntityAndBPFEntitySnapshots(t,e,a){const s={};s[e.identifier.etn]=this._getColumnsToRefresh();let n=null;return n=this.isImmersiveBPF()?[e.snapshotId]:[e.snapshotId,t],this._dispatch(Object(Z.b)(n,a,s,this._getRetrieveProcessControlDataRequest(),null,0))}_logTraceInfoForProcessPreEvent(t,e,a,s,n){const i=this._applicationContext.TraceManager.getTracer(n),r=this.getTelemetryParams(),o={name:"BpfOperationName",value:s};r.push(o);const c={name:"eventName",value:e};r.push(c);const l={name:"preventDefaultInvokedByWebResource",value:t};r.push(l);const u={name:"targetStageId",value:a};r.push(u),i.info("BPF ProcessManager executed scripts registered to event "+e,r)}_logTraceFailureForProcessEvent(t,e,a){const s=this._applicationContext.TraceManager.getTracer(a),n=this.getTelemetryParams(),i={name:"BpfOperationName",value:t};n.push(i);n.push({name:"preventDefaultInvokedByWebResource",value:null});const r={name:"eventName",value:e};n.push(r);const o={name:"isPageDead",value:Object(kt.m)(this._getState(),this._currentPageId)};n.push(o);const c={name:"currentPageId",value:this._currentPageId};n.push(c),s.error(`BPF ProcessManager not able to to execute scripts registered on event ${e} does not exist`,n)}_logTraceFailureForScriptContainer(){const t=this._applicationContext.TraceManager.getTracer("GET_SCRIPT_CONTAINER"),e=this.getTelemetryParams();e.push({name:"BpfOperationName",value:"GetScriptContainer"});const a={name:"IsPageDead",value:Object(kt.m)(this._getState(),this._currentPageId)};e.push(a);e.push({name:"IsSciptContainerAvailable",value:!1}),t.error("BPF ProcessManager not able to to execute scripts as the script container does not exist",e)}_getStage(t){let e=null;if(t){const a=this.getEntityStages();a&&a.some(a=>{for(let s=0;s<a.get_Steps().get_Count();s++){const n=a.get_Steps().get_item(s);if(this._equalsIgnoreCase(t,n.get_Id()))return e=n,!0}})}return e}getContextToken(){return Object(at.j)(this._getState(),this._currentPageId)}_updateProcessInstanceModifiedTime(){this._dispatch(Object(Y.b)(this.getCurrentFormEntity()))}_isSelectedStageControl(t){if(!Object(dt.a)(this.getSelectedStage())){const e=this.getSelectedStage().get_Steps();for(let a=0;a<e.get_Count();a++)if(this._equalsIgnoreCase(e.get_item(a).get_Id(),t))return!0}return!1}_equalsIgnoreCase(t,e){return!!t&&!!e&&t.toUpperCase()===e.toUpperCase()}_getTelemetryParamsForReflow(t,e,a="Unknown"){const s=this.getTelemetryParams(a),n={name:"ParentStageId",value:t},i={name:"NextStageId",value:e};return s.push(n),s.push(i),s}_getBPFSnasphotAndPrimaryEntitySnapshotParams(t,e){const a=this._getSnapshotStateTelemetryParams(e);if(t&&t.identifier){const e={name:"BPFSnapshotIdentifierId",value:Object(dt.a)(t.identifier.id)?null:f.a.toString(t.identifier.id)};if(a.push(e),t.identifier.etn){const e=this._applicationContext.DataSource.get_MetadataCache().getEntityMetadata(t.identifier.etn);if(e){const s={name:"BPFSnapshotIdentifierEntityObjectTypeCode",value:e.get_objectTypeCode()},n={name:"BPFSnasphotActiveChanges",value:this._getIFieldValuesString(t.activeChanges,e.get_logicalName())};a.push(s),a.push(n)}}}const s={name:"ProcessInstanceId",value:f.a.toString(this.getProcessInstanceId())},n={name:"CurrentFormEntityType",value:this.getCurrentFormEntity()&&this.getCurrentFormEntity().etn?this.getCurrentFormEntity().etn:""},i={name:"CurrentFormEntityId",value:this.getCurrentFormEntity()&&this.getCurrentFormEntity().id?f.a.toString(this.getCurrentFormEntity().id):""};return a.push(s),a.push(n),a.push(i),a}_getSnapshotStateTelemetryParams(t){const e=[];if(Object(dt.a)(t))return e;const a={name:"mode",value:t.mode},s={name:"identifierId",value:Object(dt.a)(t.identifier)||Object(dt.a)(t.identifier.id)?null:f.a.toString(t.identifier.id)},n=this._applicationContext.DataSource.get_MetadataCache().getEntityMetadata(t.identifier.etn),i={name:"identifierEntityId",value:Object(dt.a)(n)?null:f.a.fromLegacyGuid(n.get_id()).guid},r={name:"identifierEntityObjectTypeCode",value:Object(dt.a)(n)?null:n.get_objectTypeCode()},o={name:"activeChanges",value:Object(dt.a)(n)?null:this._getIFieldValuesString(t.activeChanges,n.get_logicalName())},c={name:"lockedChanges",value:Object(dt.a)(n)?null:this._getIFieldValuesString(t.lockedChanges,n.get_logicalName())};return e.push(a),e.push(i),e.push(r),e.push(s),e.push(o),e.push(c),e}_getTelemetryParamsForActionStep(t,e,a){const s=this.getTelemetryParams(),n={name:"ActionStepType",value:t},i={name:"ControlId",value:e},r={name:"ActionStepId",value:a};return s.push(n),s.push(i),s.push(r),s}getTelemetryParams(t="Unknown",e=null){const a=[],s=(null==e?void 0:e.length)?new Set(e):null;try{const e=(null==s?void 0:s.has(ge))?null:{name:ge,value:f.a.toString(this.getProcessId())},n=(null==s?void 0:s.has(pe))?null:{name:pe,value:f.a.toString(this.getProcessInstanceId())},i=(null==s?void 0:s.has(fe))?null:{name:fe,value:this.getActiveStageId()},o=(null==s?void 0:s.has(_e))||(null==s?void 0:s.has(fe))?null:{name:_e,value:this.getSelectedStageId()},c=(null==s?void 0:s.has(me))?null:{name:me,value:this.getTraversedPath()},l=(null==s?void 0:s.has(be))?null:{name:be,value:this._getActivePathString()},u=(null==s?void 0:s.has(ve))?null:{name:ve,value:this.getCurrentFormEntity()&&this.getCurrentFormEntity().etn?this.getCurrentFormEntity().etn:""},d=(null==s?void 0:s.has(Pe))?null:{name:Pe,value:this.getCurrentFormEntity()&&this.getCurrentFormEntity().id?f.a.toString(this.getCurrentFormEntity().id):""},h=(null==s?void 0:s.has(Se))?null:{name:Se,value:this.getProcessState()},g={name:"PageId",value:this._currentPageId},p=(null==s?void 0:s.has(Ie))?null:{name:Ie,value:Object(r.p)(this._getState(),this._currentPageId)},_={name:"SavedPageId",value:this._savedPageId},m=(null==s?void 0:s.has(ye))?null:{name:ye,value:Object(r.p)(this._getState(),this._savedPageId)};if(Object(Nt.f)(this._getState(),re.Sb)){const t=(null==s?void 0:s.has(Oe))?null:{name:Oe,value:this.getCustomControlIndicator()},e=(null==s?void 0:s.has(we))?null:{name:we,value:this.getFormXmlRenderingIndicator()};a.push(t),a.push(e)}const b=(null==s?void 0:s.has(Ce))?null:{name:Ce,value:this.isImmersiveBPF()};null==a||a.push({name:"Caller",value:t}),e&&a.push(e),n&&a.push(n),i&&a.push(i),c&&a.push(c),l&&a.push(l),o&&a.push(o),u&&a.push(u),d&&a.push(d),h&&a.push(h),a.push(g),p&&a.push(p),a.push(_),m&&a.push(m),b&&a.push(b)}catch(t){this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ProcessManagerTelemetryGeneration").error("Exception while generating Process Manager telemetry parameters: "+t.message,a)}return a}_getIFieldValuesString(t,e){let a="";if(!Object(dt.a)(t))for(const s in t)if(Object(dt.a)(s))a+=String.format("[fieldName: {0}]",null);else{const n=this._applicationContext.DataSource.get_MetadataCache().getAttributeMetadata(e,s),i=t[s];if(Object(dt.a)(i)||Object(dt.a)(n))a+=String.format("[attributeId is null: {0}, attributeMetadata is null: {1}]",Object(dt.a)(i),Object(dt.a)(n));else{let t="";Object(dt.a)(i.timestamp)||(t=i.timestamp.toUTCString());let e="",s="",r=null,o=null;Object(dt.a)(i.validationResult)||(e=i.validationResult.errorId,s=i.validationResult.errorMessage,r=i.validationResult.isOfflineSyncError,o=i.validationResult.isValueValid);const c=n.get_id();a+=String.format("[attributeId: {0}, timeStamp: {1}, validationResultErrorId: {2}, validationResultErrorMessage: {3}, validationResultIsOfflineSyncError: {4}, validationResultIsValueValid: {5}]",c,t,e,s,r,o)}}return a}_getActivePathString(){const t=this.getActivePath();let e="";if(t&&t.length>0){for(let a=0;a<t.length-1;a++)e=e+t[a].guid+",";e+=t[t.length-1].guid}return e}isImmersiveBPF(){return this.getCurrentFormEntity()&&this._currentBpfInstance&&this.getCurrentFormEntity().etn===this._currentBpfInstance.etn}_getColumnsToRefresh(){const t=Object(Vt.b)(this._getState(),this._currentPageId),e=Object(r.j)(this._getState(),this._currentPageId);if(Object(dt.a)(e)){const t=Object(st.c)(this._getState(),this.getCurrentFormEntity(!0)),e=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.SaveAndRefresh"),a=this._getSnapshotStateTelemetryParams(t);return e.warn("Columns To Refresh is not set as PageInput is null. Primary entity not refreshed after save",a),[]}const a=Object(wt.H)(this._getState(),e.entityTypeName),s=Object(u.g)(this._getState(),t,new U.a(e.entityTypeName,e.id),a,null);return s&&s.hasOwnProperty(e.entityTypeName)?s[e.entityTypeName]:[]}_getRetrieveProcessControlDataRequest(){const t=this.getProcessId()&&!f.a.equals(this.getProcessId(),f.a.EMPTY)?U.a.toLegacyEntityReference(new U.a("businessprocessflowinstance",this.getProcessId())):null,e=this.getProcessInstanceId()&&!f.a.equals(this.getProcessInstanceId(),f.a.EMPTY)?U.a.toLegacyEntityReference(new U.a("businessprocessflowinstance",this.getProcessInstanceId())):null;return this.getCurrentFormEntity()&&t&&e?new At.a(U.a.toLegacyEntityReference(this.getCurrentFormEntity()),t,e):this.getCurrentFormEntity()?new At.a(U.a.toLegacyEntityReference(this.getCurrentFormEntity()),null,null):null}getCustomControlIndicator(){return this._customControlsPresent}setCustomControlIndicator(t){this._customControlsPresent=t}getFormXmlRenderingIndicator(){return this._renderedFromFormXml}setFormXmlRenderingIndicator(t){this._renderedFromFormXml=t}getInstanceModifiedTimestamp(){return this._instanceModifiedTimestamp}isBpfFormDescriptorValid(t,e,a,s){return null===this._isBpfFormValid&&(this._isBpfFormValid=Object(Ut.f)(t,e,a,s)),this._isBpfFormValid}reportStageNavigationBlockedToBpfChecker(t){Object(Jt.a)()&&this._dispatch(function(t){return{type:"bpfChecker.StageNavigationBlocked.async",execute({},e){var a;const s=null===(a=null==e?void 0:e.TraceManager)||void 0===a?void 0:a.getTracer(`${gt.b}${gt.h}`);if(!s)return Promise.resolve();s.warn(gt.d,[{name:ht.l,value:gt.h},{name:gt.h,value:t}])}}}(t))}_unlockPrimaryEntityActiveChangesIfMainFormSaveFailure(t,e){let a=e;if(Object(dt.a)(e)){const e=Object(p.c)(t);a=!Object(dt.a)(e)&&e.FaultedSnapshotId}!Object(dt.b)(a)&&Object(st.b)(this._getState(),a)&&this._dispatch(Object(K.b)(a,!1));const s=Object(st.c)(this._getState(),this.getCurrentFormEntity(!0));s&&!Object(dt.a)(s.snapshotId)&&s.snapshotId!==a&&this._dispatch(Object(K.b)(s.snapshotId,!1))}}},ccIw:function(t,e,a){"use strict";a.d(e,"a",(function(){return C}));var s=a("WRDA"),n=a("504W");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class i{get invocationSource(){return this._invocationSource}set invocationSource(t){this._invocationSource=t}get workflowStep(){return this._workflowStep}set workflowStep(t){this._workflowStep=t}get businessProcessFlowVisitor(){return this._businessProcessFlowVisitor}set businessProcessFlowVisitor(t){this._businessProcessFlowVisitor=t}get currentEntityName(){return this._currentEntityName}set currentEntityName(t){this._currentEntityName=t}get processManager(){return this._processManager}set processManager(t){this._processManager=t}getStageStep(t){if(Object(n.b)(t)||!this._businessProcessFlowVisitor)return null;const e=this._businessProcessFlowVisitor.get_stagesById()[Object(s.a)(t)];return e||null}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class r extends
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class{constructor(t){this.value=t,this._next=null}get value(){return this._value}set value(t){this._value=t}getNext(){return this._next}setNext(t){this._next=t}}{constructor(t){super(Object(s.a)(t))}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class o{constructor(){this._latestDefaultPathCalculated=!1,this._rootNodes=[],this._rootNodesValue=[],this._lastDefaultPathCalculatedTimeHash=this._generateDefaultPathCalculatedTimeHash()}find(t,e){if(t=Object(s.a)(t),e){for(const e in this._rootNodesValue)if(t===this._rootNodesValue[e])return this._rootNodes[e];return null}for(const e in this._rootNodes){let a=this._rootNodes[e];if(a.value===t)return a;for(;null!=a.getNext();)if(a=a.getNext(),a.value===t)return a}return null}getNode(t){return this._rootNodes[t]}setNode(t,e){this._latestDefaultPathCalculated=!1,this._rootNodes[t]=e,this._rootNodesValue[t]=e.value}getDefaultPath(){return this._ensureLatestDefaultPathIsCalculated(),this._defaultPathArray}addAfter(t,e){this.find(e.value,!0)?this._addAfterInternal(t,new r(null)):this._addAfterInternal(t,e)}getDefaultPathHash(){return this._ensureLatestDefaultPathIsCalculated(),this._lastDefaultPathCalculatedTimeHash}_ensureLatestDefaultPathIsCalculated(){this._latestDefaultPathCalculated||(this._defaultPathArray=this._recaculateDefaultPath(),this._latestDefaultPathCalculated=!0,this._lastDefaultPathCalculatedTimeHash=this._generateDefaultPathCalculatedTimeHash())}_recaculateDefaultPath(){this._defaultPathArray=[];for(let t=0;t<this._rootNodes.length;t++){let e=this._rootNodes[t];for(this._defaultPathArray[this._defaultPathArray.length]=e.value;e.getNext();){const t=e.getNext();t.value&&(this._defaultPathArray[this._defaultPathArray.length]=t.value),e=t}}return this._defaultPathArray}_addAfterInternal(t,e){t.setNext(e),this._latestDefaultPathCalculated=!1}_generateDefaultPathCalculatedTimeHash(){let t=Math.floor(1e4*Math.random());try{t=crypto.getRandomValues(new Uint32Array(1))[0]}catch(t){}return Date.now().toString()+t}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class c{pathChanged(t){this._handler&&!Object(n.b)(t.parentStage)&&this._handler.handleChange(t.parentStage,t.nextStage)}getHandler(){return this._handler}setHandler(t){this._handler=t}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class l{constructor(t,e){this._nextStage=e,this._parentStage=t}get parentStage(){return this._parentStage}get nextStage(){return this._nextStage}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class u{constructor(t,e,a){this._context=t,this._defaultPath=e,this._staticPath=a}calculate(){let t=this._startingNodeInDefaultPath();for(let e=0;e<this._staticPath.length;e++){const a=this._staticPath[e];if(!this._context.businessProcessFlowVisitor.get_stagesById().hasOwnProperty(a))continue;const s=this._defaultPath.find(a,!0);s?t=s:(this._defaultPath.addAfter(t,new r(a)),t=t.getNext())}this._lastEvaluatedNode=t}getLastEvaluatedNodeInDefaultPath(){return this._lastEvaluatedNode}getDefaultPath(){return this._defaultPath}_startingNodeInDefaultPath(){return this._startNode||(this._startNode=this._defaultPath.getNode(0)),this._startNode}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class d{constructor(t,e){this._defaultPath=e,this._context=t}calculate(){this._staticPathToDefaultPathCalculator.calculate(),this._defaultPath=this._staticPathToDefaultPathCalculator.getDefaultPath()}getLastDefaultNode(){return this._staticPathToDefaultPathCalculator.getLastEvaluatedNodeInDefaultPath()}get traversedPath(){return this._traversedPath||(this._traversedPath=[]),this._traversedPath}set traversedPath(t){this._traversedPath=t}getDefaultPath(){return this._defaultPath}get _staticPathToDefaultPathCalculator(){return this.__staticPathToDefaultPathCalculator||(this.__staticPathToDefaultPathCalculator=new u(this._context,this._defaultPath,this._traversedPath)),this.__staticPathToDefaultPathCalculator}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class h{constructor(t,e){this._context=t,this._defaultPath=e}calculate(){this._context.businessProcessFlowVisitor.get_areConditionsPresent()&&this._calculateForTraveresedStages()}get traversedPath(){return this._traversedPath}set traversedPath(t){this._traversedPath=t}getLastCalculatedDefaultNode(){return this._traversedDefaultPathCalculator?this._traversedDefaultPathCalculator.getLastDefaultNode():null}getDefaultPath(){return this._defaultPath}_calculateForTraveresedStages(){this._traversedDefaultPathCalculator.traversedPath=this._traversedPath.split(","),this._traversedDefaultPathCalculator.calculate()}get _traversedDefaultPathCalculator(){return this.__traversedDefaultPathCalculator||(this.__traversedDefaultPathCalculator=new d(this._context,this._defaultPath)),this.__traversedDefaultPathCalculator}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class g{constructor(t){this.context=t}get stage(){return this._stageStep}set stage(t){this._stageStep=t}tryExecute(){const t=Object(s.a)(this.stage.get_stageId());return!!this.context.businessProcessFlowVisitor.get_conditionsByParentStageId()[t]&&(this.executeCondition(),!0)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class p extends g{executeCondition(){const t="bpf_"+this._sanitizeGuidForFunctionName(this.stage.get_stageId());this.context.processManager.callPblToEvaluateBranching(t)}_sanitizeGuidForFunctionName(t){if(Object(n.b)(t))return t;for(t=Object(s.a)(t);t.indexOf("-")>-1;)t=t.replace("-","");return t}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class f extends g{executeCondition(){const t=Object(s.a)(this.stage.get_stageId()),e=this.context.businessProcessFlowVisitor.get_conditionsByParentStageId()[t];if(!e)return;const a=e.findElseBranch();let n=null;if(a&&a.get_Steps().get_Count()>0){n=a.get_Steps().get_item(0).get_stageId()}this._invokeReflowFunction(t,n)}_invokeReflowFunction(t,e){this.context.processManager.reflow(!1,t,e)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class _{getStageCommand(t,e){const a=t.businessProcessFlowVisitor.get_parentEntityStepByStageId()[Object(s.a)(e.get_stageId())];return t.currentEntityName!==a.get_EntityLogicalName()?new f(t):new p(t)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class m{constructor(t,e,a){this._defaultPath=e,this._cascadeUpdate=a,this._context=t,this._businessRuleCommandFactory=new _}handleChange(t,e){const a=this._defaultPath.find(t,!1);if(null!=a){const t=Object(n.b)(e)?null:e,s=new r(t);this._defaultPath.addAfter(a,s),t&&this.triggerSubsequentDefaultPathCalculation(s)}}triggerSubsequentDefaultPathCalculation(t){if(!t)return;const e=t.value;if(e&&!this._tryExecuteConditionForStage(t)){const a=this._context.getStageStep(e).get_nextStageId();if(!a)return;const s=this._defaultPath.find(a,!0);if(s)return void(this._cascadeUpdate&&this.triggerSubsequentDefaultPathCalculation(s));this._defaultPath.addAfter(t,new r(a)),this.triggerSubsequentDefaultPathCalculation(t.getNext())}}_tryExecuteConditionForStage(t){const e=this._context.invocationSource;try{this._context.invocationSource="internal";const a=this._context.getStageStep(t.value),s=this._businessRuleCommandFactory.getStageCommand(this._context,a);if(s.stage=a,!s.tryExecute())return!1;if(t.getNext())return!0}finally{this._context.invocationSource=e}return!1}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class b{constructor(t,e,a){this._context=t,this._listener=e,this._defaultPath=a}calculate(){const t=this._pathChangeHandler;this._listener.setHandler(t),t.triggerSubsequentDefaultPathCalculation(this._startNode)}get startingNodeInDefaultPath(){return this._startNode}set startingNodeInDefaultPath(t){this._startNode=t}getDefaultPath(){return this._defaultPath}get _pathChangeHandler(){return this.__pathChangeHandler||(this.__pathChangeHandler=new m(this._context,this._defaultPath,!0)),this.__pathChangeHandler}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class v{constructor(t,e,a){this._context=t,this._listener=e,this._initialDefaultPath=a}calculate(){this._context.businessProcessFlowVisitor.get_areConditionsPresent()||(this._defaultPath=this._initialDefaultPath),this._calculateForTraversedStages(),this._calculateForNonTraversedStages()}get startingNodeInDefaultPath(){return this._startingNodeInDefaultPath}set startingNodeInDefaultPath(t){this._startingNodeInDefaultPath=t}getDefaultPath(){return this._defaultPath}_calculateForTraversedStages(){this._defaultPath=this._initialDefaultPath}_calculateForNonTraversedStages(){this._nonTraversedDefaultPathCalculator.startingNodeInDefaultPath=this.startingNodeInDefaultPath,this._nonTraversedDefaultPathCalculator.calculate()}get _nonTraversedDefaultPathCalculator(){return this.__nonTraversedDefaultPathCalculator||(this.__nonTraversedDefaultPathCalculator=new b(this._context,this._listener,this._defaultPath)),this.__nonTraversedDefaultPathCalculator}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class P{constructor(t,e,a){this._context=t,this._changeListener=e,this._defaultPath=a}calculate(){const t=this._pathChangeHandler;this._changeListener.setHandler(t)}getDefaultPath(){return this._defaultPath}get _pathChangeHandler(){return this.__pathChangeHandler||(this.__pathChangeHandler=new m(this._context,this._defaultPath,!1)),this.__pathChangeHandler}}var S=a("SAYH"),I=a("D4Jo"),y=a("JF0K");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class O{constructor(t,e){this._context=e,this._traversedPathProvider=t,this._changeListener=new c,this._initializeDefaultPathFromRootStages()}initializeComplete(){const t=this.defaultPathHash();this._initializeTraversedPath(),this._initializeNonTraversedPath();const e=this._context.processManager.getSelectedStageId(),a=this._context.processManager.getActivePath(),s=!Object(n.a)(e)&&!Object(n.a)(a),i=s&&a.findIndex(t=>t.guid.toString()===e)<0,r=s&&this.getDefaultPath().indexOf(e)>=0;this.getDefaultPath()&&(t!==this.defaultPathHash()||i&&r)&&this._context.processManager.setActivePath(this.getDefaultPath())}updateDefaultPath(t,e,a){const s=this._getTelemetryParamsForUpdateDefaultPath(t,e);if(Object(I.c)(y.u+".Start",s,a),!t)return;let n=null;if("internal"!==this._context.invocationSource&&(n=this.defaultPathHash()),this._changeListener.pathChanged(new l(t,e)),"internal"!==this._context.invocationSource){if(n!==this.defaultPathHash()){const t=this.getDefaultPath();this._context.processManager.setActivePath(t);const e={name:"ActivePath",value:t.toString()};s.push(e),Object(I.c)(y.u,s,a)}}Object(I.c)(y.u+".End",s,a)}triggerSubsequentDefaultPathCalculation(t){if(!(!!S.a.tryParseOrNull(t)&&!!this.getDefaultPath().find(e=>e.toLowerCase()===t.toLowerCase())))return;let e=null;if("internal"!==this._context.invocationSource&&(e=this.defaultPathHash()),this._changeListener.getHandler().triggerSubsequentDefaultPathCalculation(new r(t)),"internal"!==this._context.invocationSource){if(e!==this.defaultPathHash()){const t=this.getDefaultPath();this._context.processManager.setActivePath(t)}}}getDefaultPath(){return this._defaultPath.getDefaultPath()}defaultPathHash(){return this._defaultPath.getDefaultPathHash()}getNextStage(t){const e=this.getDefaultPath(),a=e.indexOf(Object(s.a)(t));return-1!==a&&a<e.length-1?e[a+1]:null}getPreviousStage(t){const e=this.getDefaultPath(),a=e.indexOf(Object(s.a)(t));return a<=0?null:e[a-1]}_initializeDefaultPathFromRootStages(){this._defaultPath=new o;const t=this._context.businessProcessFlowVisitor.get_firstLevelStages();let e=0;for(const a in t)this._defaultPath.setNode(e,new r(a)),e++}_initializeTraversedPath(){this._loadTimeDefaultPathCalculator.traversedPath=this._traversedPathProvider.getTraversedPath(),this._loadTimeDefaultPathCalculator.calculate(),this._defaultPath=this._loadTimeDefaultPathCalculator.getDefaultPath()}_initializeNonTraversedPath(){this._afterLoadPathCalculator.startingNodeInDefaultPath=this._loadTimeDefaultPathCalculator.getLastCalculatedDefaultNode(),this._afterLoadPathCalculator.calculate(),this._defaultPath=this._afterLoadPathCalculator.getDefaultPath(),this._runTimePathCalculator.calculate()}get _loadTimeDefaultPathCalculator(){return this._loadTimePathCalculator||(this._loadTimePathCalculator=new h(this._context,this._defaultPath)),this._loadTimePathCalculator}get _afterLoadPathCalculator(){return this.__afterLoadPathCalculator||(this.__afterLoadPathCalculator=new v(this._context,this._changeListener,this._defaultPath)),this.__afterLoadPathCalculator}get _runTimePathCalculator(){return this.__runTimePathCalculator||(this.__runTimePathCalculator=new P(this._context,this._changeListener,this._defaultPath)),this.__runTimePathCalculator}_getTelemetryParamsForUpdateDefaultPath(t,e){const a=[],s={name:"ParentStageId",value:t},n={name:"NextStageId",value:e};return a.push(n),a.push(s),a}}var w=a("i1f0");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class C{setPrimaryModel(t){this._primaryModelName=t}getDefaultPathManager(){return this._defaultPathManager}setObjectModel(t){const e=new Microsoft.Crm.Workflow.ObjectModel.WorkflowStep("",0),a={};t.businessProcessFlowEntities.forEach(t=>{if(this._isRelationshipStep(t)){const a=this._createRelationshipCollectionStep(e,t);a&&e.appendStep(a)}else{const s=this._createEntity(e,t);s&&(e.appendStep(s),a.hasOwnProperty(s.get_EntityLogicalName())||(a[s.get_EntityLogicalName()]=!0))}}),e.set_Name(t.businessProcessFlowName),e.set_Id(t.businessProcessFlowId?t.businessProcessFlowId.guid:""),this._processObjectModel=e,this._initializeVisitor()}initializeDefaultPathManager(t,e){const a=new i;a.processManager=e,a.businessProcessFlowVisitor=this._businessProcessFlowVisitor,a.workflowStep=this._processObjectModel,a.currentEntityName=this._primaryModelName,this._defaultPathManager=new O(t,a),this._defaultPathManager.initializeComplete()}get businessProcessFlowVisitor(){return this._businessProcessFlowVisitor}getEntityStages(){if(!this._processObjectModel)return null;const t=this._processObjectModel.get_Steps(),e=[];if(t){for(let a=0;a<t.get_Count();a++){const s=t.get_item(a);s&&s instanceof Microsoft.Crm.Workflow.ObjectModel.EntityStep&&(e[e.length]=t.get_item(a))}return e}return null}getRequiredFlowStepsForStage(t,e,a,s){const n=[],i=this.getStage(t);if(!i)throw new Error(t+" is not a valid stage id.");const r=i.get_Steps();if(!r)throw new Error(t+" does not include valid steps");for(let t=0;t<r.get_Count();t++)if(r.get_item(t)instanceof Microsoft.Crm.Workflow.ObjectModel.StepStep){const e=r.get_item(t);this._isFlowStep(e)&&e.get_isProcessRequired()&&n.push(e.get_Id())}return n}getRequiredDataStepsForStage(t,e,a,s){const n=new Set,i=this.getStage(t);if(!i)throw new Error(t+" is not a valid stage id.");const r=i.get_Steps();if(!r)throw new Error(t+" does not include valid steps");for(let t=0;t<r.get_Count();t++)if(r.get_item(t)instanceof Microsoft.Crm.Workflow.ObjectModel.StepStep){const i=r.get_item(t);if(!this._isActionStep(i)&&!this._isFlowStep(i))if(i.get_isProcessRequired())n.add(i);else{const t=this._getDataFieldNameFromStepStep(i);t&&this._isRequiredAttribute(t,e,a,s)&&n.add(i)}}return n}_getDataFieldNameFromStepStep(t){if(this._isActionStep(t)||this._isFlowStep(t))return null;if(this._isControlStep(t)){const e=t.get_Steps().get_item(0);return!e||e.get_isSystemControl()?null:e.get_dataFieldName()}return null}_isRequiredAttribute(t,e,a,s){if(null!=t){return 2===Object(w.xc)(s,e,a,t)}return!1}_isFlowStep(t){if(t&&t.get_Steps()&&t.get_Steps().get_Count()>0){if(t.get_Steps().get_item(0)instanceof Microsoft.Crm.Workflow.ObjectModel.FlowStep)return!0}return!1}_isActionStep(t){if(t&&t.get_Steps()&&t.get_Steps().get_Count()>0){if(t.get_Steps().get_item(0)instanceof Microsoft.Crm.Workflow.ObjectModel.ActionStep)return!0}return!1}_isControlStep(t){if(t&&t.get_Steps()&&t.get_Steps().get_Count()>0){if(t.get_Steps().get_item(0)instanceof Microsoft.Crm.Workflow.ObjectModel.ControlStep)return!0}return!1}_initializeVisitor(){this._businessProcessFlowVisitor=new ProcessObjectModel.Visitors.BusinessProcessFlowVisitor,this._businessProcessFlowVisitor.visit(this._processObjectModel)}_isRelationshipStep(t){return!(!t||!t.hasOwnProperty("relationships"))}_createEntity(t,e){const a=new Microsoft.Crm.Workflow.ObjectModel.EntityStep(t,e.entityLogicalName);a.set_Name(e.entityLogicalName),a.set_Description(e.entityDisplayName),a.set_relationshipName(e.relationshipName),a.set_attributeName(e.referencingAttributeName),a.set_parent(t);const s=this._createStage(t,e.stage);a&&s&&a.appendStep(s);for(let a=0;a<e.stage.steps.length;a++){const n=this._createStep(t,e.stage.steps[a]);n&&s.appendStep(n)}const n=this._createConditionStep(t,s,e.stage);return n&&s.appendStep(n),a}_createRelationshipCollectionStep(t,e){const a=new Microsoft.Crm.Workflow.ObjectModel.RelationshipCollectionStep(t);if(a.set_workflow(t),e.relationships)for(let s=0;s<e.relationships.length;s++){const n=this._createRelationshipStep(t,e.relationships[s]);a.appendStep(n)}return a}_createRelationshipStep(t,e){const a=new Microsoft.Crm.Workflow.ObjectModel.RelationshipStep(t);return a.set_workflow(t),a.set_sourceStageId(e.sourceStageId.guid),a.set_targetStageId(e.targetStageId.guid),a.set_attributeName(e.attributeName),a.set_relationshipName(e.relationshipName),a}_createStage(t,e){const a=new Microsoft.Crm.Workflow.ObjectModel.StageStep(t,e.stageDisplayName||"dummy");return a.set_Id(e.stageId.guid),a.set_stageId(e.stageId.guid),a.set_nextStageId(e.nextStageId?e.nextStageId.guid:""),a.set_stageCategory(e.stageCategory),a}_createStep(t,e){const a="action"===e.stepType.toLowerCase()?e.label:e.name,s=new Microsoft.Crm.Workflow.ObjectModel.StepStep(t,a||"dummy");s.set_isProcessRequired(e.required),s.set_Name(e.label),s.set_Id(e.stepId?e.stepId.guid:""),s.set_workflow(t);const n=new Microsoft.Crm.Workflow.ObjectModel.ControlStep(t);if(n.set_dataFieldName(a),"action"===e.stepType.toLowerCase()){const e=new Microsoft.Crm.Workflow.ObjectModel.ActionStep(t);e.set_Name(a),e.set_actionControl(n),s.appendStep(e)}else if("modernflow"===e.stepType.toLowerCase()){const e=new Microsoft.Crm.Workflow.ObjectModel.FlowStep(t);e.set_Name(a),e.set_flowControl(n),s.appendStep(e)}else s.appendStep(n);return s}_createConditionStep(t,e,a){if(!a.conditionJson)return null;const s=new Microsoft.Crm.Workflow.ObjectModel.ConditionStep(t);return s.set_parent(e),s.initializeFromDynamic(JSON.parse(a.conditionJson)),s.fixLinks(),s}getProcessObjectModel(){return this._processObjectModel}getStage(t){return Object(n.a)(t)||!this._processObjectModel?null:this._businessProcessFlowVisitor.get_stagesById().hasOwnProperty(t)?this._businessProcessFlowVisitor.get_stagesById()[t]:null}getPreviousStageId(t){if(this._defaultPathManager&&this._businessProcessFlowVisitor){const e=this._defaultPathManager.getPreviousStage(t);if(this._businessProcessFlowVisitor.get_stagesById().hasOwnProperty(e))return e}return null}getNextStageId(t){if(this._defaultPathManager&&this._businessProcessFlowVisitor){const e=this._defaultPathManager.getNextStage(t);if(this._businessProcessFlowVisitor.get_stagesById().hasOwnProperty(e))return e}return null}}},dMZy:function(t,e,a){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function s(){return{tabId:"",navigationStack:[]}}a.d(e,"a",(function(){return s}))},jezt:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));var s=a("Znsu");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function n(t){return{type:"pollingService.pollActive",execute:(e,a)=>t(e,a)}}function i(t){return{type:"pollingService.pollInactive",execute:(e,a)=>t(e,a)}}function r(t){return{type:"pollingService.pollResume",execute:(e,a)=>t(e,a)}}class o{constructor(t,e,a,s,n,i,r){this._context=t,this._dispatch=e,this._serviceName=a,this._activeUserPollingDelay=s,this._inactiveUserPollingDelay=n,this._navigationContextEnabled=i,this._fetchRequest=r,this._checkPolling=this._checkPolling.bind(this),this._sendFocusEventTelemetry=this._sendFocusEventTelemetry.bind(this),this._sendBlurEventTelemetry=this._sendBlurEventTelemetry.bind(this),this._observeNavigationContextProvider=this._observeNavigationContextProvider.bind(this)}startPolling(){this._isFetchComplete=!0,this._lastPolledOn=0,this._lastNavigationOn=(new Date).valueOf(),this._activeIntervalCount=0,this._inactiveIntervalCount=0,this._navigationActiveIntervalCount=0,this._navigationInactiveIntervalCount=0,this._pollingInterval=this._activeUserPollingDelay/2,setInterval(this._checkPolling,this._pollingInterval),setTimeout(()=>{this._context.ActivityManager.addOnFocusHandler(this._sendFocusEventTelemetry),this._context.ActivityManager.addOnBlurHandler(this._sendBlurEventTelemetry)},this._pollingInterval/2),this._navigationContextEnabled&&this._observeNavigationContextProvider()}_checkPolling(){if(this._context.ActivityManager.getHasFocus()){const t=(new Date).valueOf();let e;if(t-this._context.ActivityManager.getLastActiveOn()<this._activeUserPollingDelay?(e=this._activeUserPollingDelay,this._activeIntervalCount++):(e=this._inactiveUserPollingDelay,this._inactiveIntervalCount++),this._navigationContextEnabled&&(t-this._lastNavigationOn<this._activeUserPollingDelay+this._pollingInterval?(e=this._activeUserPollingDelay,this._navigationActiveIntervalCount++):(e=Number.MAX_VALUE,this._navigationInactiveIntervalCount++)),t-this._lastPolledOn>e&&this._isFetchComplete){this._lastPolledOn=t,this._isFetchComplete=!1;const a=this._appResumption?r:e===Number.MAX_VALUE?i:n;this._dispatch(a(this._fetchRequest)).then(()=>{this._isFetchComplete=!0}).catch(t=>{this._isFetchComplete=!0})}this._appResumption=!1}}_sendFocusEventTelemetry(){const t=(new Date).valueOf(),e=[];e.push({name:"TotalBackgroundTimeSeconds",value:(t-this._context.ActivityManager.getLastBlurOn())/1e3}),this._context.EventManager.ReportComponentSuccess(this._serviceName+".AppResume",e),this._lastNavigationOn=(new Date).valueOf(),this._appResumption=!0}_sendBlurEventTelemetry(){const t=(new Date).valueOf(),e=[];e.push({name:"TotalForegroundTimeSeconds",value:(t-this._context.ActivityManager.getLastFocusOn())/1e3}),e.push({name:"ActiveForegroundTimeSeconds",value:this._pollingInterval*this._activeIntervalCount/1e3}),e.push({name:"IdleForegroundTimeSeconds",value:this._pollingInterval*this._inactiveIntervalCount/1e3}),e.push({name:"NavigationActiveForegroundTimeSeconds",value:this._pollingInterval*this._navigationActiveIntervalCount/1e3}),e.push({name:"NavigationIdleForegroundTimeSeconds",value:this._pollingInterval*this._navigationInactiveIntervalCount/1e3}),this._context.EventManager.ReportComponentSuccess(this._serviceName+".AppPause",e),this._activeIntervalCount=0,this._inactiveIntervalCount=0,this._navigationActiveIntervalCount=0,this._navigationInactiveIntervalCount=0}_observeNavigationContextProvider(){const t=new MutationObserver(()=>{this._lastNavigationOn=(new Date).valueOf()}),e=document.getElementById(s.A);e&&t.observe(e,{attributes:!0})}}},lEp6:function(t,e,a){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function s(t){let e=null;try{e=JSON.parse(t)}catch(t){}return e}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function n(t){let e="";try{e=JSON.stringify(t)}catch(t){}return e}a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return n}))},sxfa:function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var s=a("WRDA"),n=a("504W");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class i{constructor(t){this.path=t}get path(){return this._traversedPath}set path(t){for(this._traversedPath=Object(s.a)(t);this._traversedPath&&this._traversedPath.indexOf("}")>0;)this._traversedPath=Object(s.a)(this._traversedPath)}static getCandidateTraversedPathFromStagStep(t,e){e=Object(s.a)(e);let a=!1;if(!t||t.length)return null;for(let n=0;n<t.length;n++){const i=Object(s.a)(t[n].get_stageId());if("".concat(i,","),e===i){a=!0;break}}return a?"".substring(0,"".length-2):null}isInTraversedPath(t){return!Object(n.b)(t)&&this._traversedPath.indexOf(Object(s.a)(t))>-1}}},zrcT:function(t,e,a){"use strict";a.d(e,"b",(function(){return N})),a.d(e,"a",(function(){return A}));var s=a("mMyr"),n=a("223Y"),i=a("odYE"),r=a("SAYH"),o=a("eXjw"),c=a("kXuq"),l=a("u+q+"),u=a("5Oca"),d=a("+nNZ"),h=a("arV0"),g=a("4Us1"),p=a("8O0c"),f=a("INOZ"),_=a("1ZrY"),m=a("TBkx"),b=a("YxC/"),v=a("69Qu"),P=a("Nzmy"),S=a("EY5k"),I=a("si7p"),y=a("pgSX");var O=a("g03H"),w=a("Nb1E"),C=a("oLL6"),F=a("+QYJ");var j=a("AsoW"),E=a("9x9u");var N,T;!function(t){t[t.BreadCrumb=0]="BreadCrumb",t[t.Stage=1]="Stage"}(N||(N={})),function(t){t[t.Initializing=0]="Initializing",t[t.MetadataReady=1]="MetadataReady",t[t.ReadyToRender=2]="ReadyToRender"}(T||(T={}));const M={Id:"MscrmControls.Containers.ProcessBreadCrumb",Label:"",Name:"",ShowLabel:!1,Visible:!0,Disabled:!1},x={Id:"MscrmControls.Containers.ProcessStageControl",Label:"",Name:"",ShowLabel:!1,Visible:!0,Disabled:!1};class B extends s.Component{constructor(t){super(t),this._flowStepInitInProgress=!1,this.state={status:T.Initializing};const e=t.renderingMode===N.BreadCrumb?"MscrmControls.Containers.ProcessBreadCrumb":"MscrmControls.Containers.ProcessStageControl";this._CCF_config=Object(O.q)(e)}render(){return!this.props.workflowObjectModelLibraryLoaded||!this.props.processInstanceId||this.props.descriptor&&!this.props.descriptor.hasOwnProperty("businessProcessFlowId")?null:this.props.renderingMode===N.BreadCrumb&&this.props.processInstanceId&&this.state.status!==T.Initializing?s.createElement(c.a,{id:"bpfContainer",key:"bpfContainer",style:this.props.breadCrumbContainerStyle},s.createElement(n.c,{key:"businessProcessFlow",id:this.props.id,controlId:"MscrmControls.Containers.ProcessBreadCrumb",configuration:this._CCF_config,descriptor:M,parentContextToken:this.props.contextToken})):this.state.status===T.ReadyToRender?s.createElement(n.c,{key:"businessProcessFlowStage",id:this.props.id,controlId:"MscrmControls.Containers.ProcessStageControl",configuration:this._CCF_config,descriptor:x,parentContextToken:this.props.contextToken}):null}componentDidMount(){this._checkForStatusUpdate()}componentDidUpdate(t){this._checkForStatusUpdate(),r.a.equals(t.processInstanceId,r.a.EMPTY)&&!r.a.equals(this.props.processInstanceId,t.processInstanceId)&&this._resetNewBPFData()}_resetNewBPFData(){const t=new i.a("businessprocessflowinstance",r.a.EMPTY);this.props.updateBusinessProcessFlowData(null,t)}_checkForStatusUpdate(){switch(this.state.status){case T.Initializing:this._loadDescriptorsIfUnavailable(),this._updateSelectedStageFromParams(),this._isMetadataReady()&&this.setState({status:T.MetadataReady});break;case T.MetadataReady:this._isProcessControlLoadable()&&(this._loadActionLogs(),this._loadFlowStepFlowIdsIfUnavailable(),this.setState({status:T.ReadyToRender}));break;case T.ReadyToRender:this._isProcessControlLoadable()&&this._loadFlowStepFlowIdsIfUnavailable()}}_updateSelectedStageFromParams(){if(this.props.selectedStageId&&!r.a.equals(this.props.selectedStageId,r.a.EMPTY)){const t={selectedStageId:this.props.selectedStageId},e=new i.a("businessprocessflowinstance",this.props.processInstanceId);if(this.props.updateBusinessProcessFlowData(t,e),!this.props.displayState){const t="floating";this.props.updateDisplayState(t,e)}}}_loadDescriptorsIfUnavailable(){this.props.processDescriptorLoaded||this.props.processId||this.props.currentEntity||this.props.retrieveBusinessProcessFlowDescriptor(this.props.processId,this.props.currentEntity)}_loadFlowStepFlowIdsIfUnavailable(){if(this.props.descriptor&&this.props.descriptor.businessProcessFlowFlows&&!this._flowStepInitInProgress){const t=this.props.descriptor.businessProcessFlowFlows;for(const e in t){const a=t[e];if(a.workflowId&&!a.flowId){this._flowStepInitInProgress=!0;return void this.props.retrieveBusinessProcessFlowFlowStepFlowIds(this.props.processId).then(()=>{this._flowStepInitInProgress=!1},t=>{this._flowStepInitInProgress=!1})}}}}_loadActionLogs(){if(this.props.descriptor&&this.props.descriptor.businessProcessFlowEntities&&this.props.renderingMode===N.Stage)for(const t of this.props.descriptor.businessProcessFlowEntities)if(t.stage){const e=t.stage;for(const t of e.steps){const e=t.stepType.toLowerCase();if("action"===e||"modernflow"===e)return void this.props.retrieveBusinessProcessFlowActionLogs(this.props.processId,new i.a(this.props.descriptor.businessProcessFlowUniqueName,this.props.processInstanceId))}}}_isProcessControlLoadable(){return!!this.props.processInstanceId}_isMetadataReady(){return!!this.props.processControlEnabled&&(!!this.props.currentEntity&&(!(!this.props.processId||r.a.equals(this.props.processId,r.a.EMPTY))&&!!this.props.processDescriptorLoaded))}}B.displayName="BusinessProcessFlow";const A=Object(l.a)((function(){const t=(t,e)=>{if(void 0===e.id&&void 0===e.processId)return;if(!e.id)return r.a.EMPTY;const a=Object(h.a)(t,e),s=new i.a(a.entityTypeName,a.id);return Object(u.e)(t,s)},e=(t,e)=>{if(void 0===e.id&&void 0===e.processId)return;if(!e.id)return r.a.EMPTY;const a=Object(h.a)(t,e),s=new i.a(a.entityTypeName,a.id);return Object(u.f)(t,s)},a=(t,e)=>!!(t&&t.metadata&&t.metadata.controlManifests&&t.metadata.controlManifests.hasOwnProperty("MscrmControls.Containers.ProcessBreadCrumb")&&t.metadata.controlManifests.hasOwnProperty("MscrmControls.Containers.ProcessBreadCrumb")),s=function(){let t=!1;return(e,a)=>{const s=Object(h.a)(e,a),n=new i.a(s.entityTypeName,s.id),r=Object(u.e)(e,n),c=r?Object(d.a)(e,r):null,l=null!==c&&c.initialized===o.a.Initialized;return l!==t&&(t=l),t}}(),n=(t,e)=>{const a=Object(h.a)(t,e),s=new i.a(a.entityTypeName,a.id),n=Object(u.e)(t,s);return n?Object(d.a)(t,n):null},c=function(){let t=null;return(e,a)=>{const s=Object(h.a)(e,a),n=new i.a(s.entityTypeName,s.id);return t||(t=n),n.id===t.id&&n.etn===t.etn||(t=n),t}}(),l=function(){let t=null;return(e,a)=>{const s=Object(h.a)(e,a);return s.selectedStageId&&!r.a.equals(t,r.a.tryParse(s.selectedStageId))&&(t=r.a.parse(s.selectedStageId)),t}}(),g=function(){let t=null;return(e,a)=>{const s=Object(E.a)(e);return t!==s&&(t=s),t}}();return function(i,r){var o;const u=t(i,r),d=e(i,r),h=a(i,r),p=s(i,r),f=n(i,r),_=c(i,r),m=l(i,r),b=g(i,r),v=null===(o=Object(j.b)(i,r.id))||void 0===o?void 0:o.workflowObjectModelLibraryLoaded;return{processId:u,processControlEnabled:h,processInstanceId:d,processDescriptorLoaded:p,currentEntity:_,selectedStageId:m,displayState:b,descriptor:f,contextToken:r.contextToken,workflowObjectModelLibraryLoaded:v}}}),(function(t,e){return{retrieveBusinessProcessFlowDescriptor:(e,a)=>t(Object(g.a)(e,a)),updateBusinessProcessFlowData:(a,s)=>t(Object(f.a)(e.id,a,s)),updateDisplayState:(e,a)=>t(Object(_.a)(e)),retrieveBusinessProcessFlowActionLogs:(a,s)=>t(Object(p.a)(e.id,a,s)),retrieveBusinessProcessFlowFlowStepFlowIds:e=>t(function(t){return{type:"businessprocessflow.flowstep.flowids.retrieve",execute({dispatch:e,getState:a},s){const n=s.TraceManager.getTracer("businessProcessFlow.retrieveBusinessProcessFlowFlowStepFlowIds"),i=a().metadata.businessProcessFlows;if(Object(F.c)(i))return void n.warn("Skip retrieveBusinessProcessFlowFlowStepFlowIds: IsNullOrUndefined businessProcessFlowsById: "+i);const r=i[t.guid];if(Object(F.c)(r))return void n.warn(`Skip retrieveBusinessProcessFlowFlowStepFlowIds for processId: ${t.guid.toString()}. IsNullOrUndefined businessProcessFlowDescriptor: ${r}`);const o=r.businessProcessFlowFlows;if(Object(F.c)(o))return void n.warn(`Skip retrieveBusinessProcessFlowFlowStepFlowIds for processId: ${t.guid.toString()}. IsNullOrUndefined businessProcessFlowFlowDescriptorDictionary: ${o}`);const c=[];for(const e in o){const a=o[e];if(Object(F.c)(a)){n.warn(`failure in retrieveBusinessProcessFlowFlowStepFlowIds for processId: ${t.guid.toString()}. IsNullOrUndefined businessProcessFlowFlowDescriptor: ${a}`);continue}const s=a.workflowId;Object(F.c)(s)?n.warn(`failure in retrieveBusinessProcessFlowFlowStepFlowIds for processId: ${t.guid.toString()}. IsNullOrUndefined workflowId: ${s}`):c.indexOf(s)<0&&c.push(s)}let l="?$select=workflowidunique,workflowid&$filter=",u=!0;for(let t=0;t<c.length;t++){const e=String.format("(workflowid%20eq%20({0}))",c[t]);u?(l+=e,u=!1):(l+="%20or%20",l+=e)}return n.info("retrieveBusinessProcessFlowFlowStepFlowIds OData RetrieveMultiple querystring: "+l),e(Object(w.e)("workflow",l)).then(a=>{a.value&&a.value.length&&(a.value.forEach(e=>{for(const a in o){const s=o[a];Object(F.c)(s)?n.warn(`failure in retrieveBusinessProcessFlowFlowStepFlowIds for processId: ${t.guid.toString()}. IsNullOrUndefined businessProcessFlowFlowDescriptor: ${s}`):(n.info(`retrieveBusinessProcessFlowFlowStepFlowIds comparing workflowid: ${s.workflowId}. workflowidunique: ${s.flowId}`),s.workflowId===e.workflowid&&(s.flowId=e.workflowidunique,n.info(`set businessProcessFlowFlowDescriptor.flowId: ${s.flowId}. actionid: ${s.actionId}`)))}}),e(Object(C.b)(i)))})}}}(e)),offlineBPFMultipleInstancesAlert:a=>t(function(t,e){return{type:"offline.alert.dialog.async",execute({dispatch:a,getState:s},n){if(Object(v.d)(s()))return P.c.info("Offline: Server is available"),Promise.resolve();const i=["Dialog_Button_Ok",t];return a(Object(S.e)(i)).then(()=>{const n=Object(b.b)(s(),"Dialog_Button_Ok"),i=Object(b.b)(s(),t);return a(Object(y.a)(I.a,i,null,n,null,void 0,void 0,void 0,void 0,void 0,e)).then(t=>{if(0!==t.status)throw P.c.error("Offline: Error in Sync error dialog creation "+Object(m.f)(t.error)),t.error;P.c.info("Offline: Alert dialog is created successfully with message "+i)})}).catch(t=>{throw P.c.error("Offline: Error in alert dialog creation "+Object(m.f)(t)),t})}}}(a,e.id))}}))(B)}}]),window.bundleExecutionMarkers["scripts/16.js?v=1.4.3886-master"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();