<!DOCTYPE html>
<!-- saved from url=(0073)https://org869ae3c9.crm8.dynamics.com/uclient/blank.htm?v=1.4.3886-master -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script type="text/javascript">
		window.Mscrm  = {};
		ï»¿//----------------------------------------------------------
// Copyright (C) Microsoft Corporation. All rights reserved.
//----------------------------------------------------------
// MicrosoftAjax.js
Function.__typeName="Function";Function.__class=true;Function.createCallback=function(b,a){return function(){var e=arguments.length;if(e>0){var d=[];for(var c=0;c<e;c++)d[c]=arguments[c];d[e]=a;return b.apply(this,d)}return b.call(this,a)}};Function.createDelegate=function(a,b){return function(){return b.apply(a,arguments)}};Function.emptyFunction=Function.emptyMethod=function(){};Function.validateParameters=function(c,b,a){return Function._validateParams(c,b,a)};Function._validateParams=function(g,e,c){var a,d=e.length;c=c||typeof c==="undefined";a=Function._validateParameterCount(g,e,c);if(a){a.popStackFrame();return a}for(var b=0,i=g.length;b<i;b++){var f=e[Math.min(b,d-1)],h=f.name;if(f.parameterArray)h+="["+(b-d+1)+"]";else if(!c&&b>=d)break;a=Function._validateParameter(g[b],f,h);if(a){a.popStackFrame();return a}}return null};Function._validateParameterCount=function(j,d,i){var a,c,b=d.length,e=j.length;if(e<b){var f=b;for(a=0;a<b;a++){var g=d[a];if(g.optional||g.parameterArray)f--}if(e<f)c=true}else if(i&&e>b){c=true;for(a=0;a<b;a++)if(d[a].parameterArray){c=false;break}}if(c){var h=Error.parameterCount();h.popStackFrame();return h}return null};Function._validateParameter=function(c,a,h){var b,g=a.type,l=!!a.integer,k=!!a.domElement,m=!!a.mayBeNull;b=Function._validateParameterType(c,g,l,k,m,h);if(b){b.popStackFrame();return b}var e=a.elementType,f=!!a.elementMayBeNull;if(g===Array&&typeof c!=="undefined"&&c!==null&&(e||!f)){var j=!!a.elementInteger,i=!!a.elementDomElement;for(var d=0;d<c.length;d++){var n=c[d];b=Function._validateParameterType(n,e,j,i,f,h+"["+d+"]");if(b){b.popStackFrame();return b}}}return null};Function._validateParameterType=function(b,c,k,j,h,d){var a,g;if(typeof b==="undefined")if(h)return null;else{a=Error.argumentUndefined(d);a.popStackFrame();return a}if(b===null)if(h)return null;else{a=Error.argumentNull(d);a.popStackFrame();return a}if(c&&c.__enum){if(typeof b!=="number"){a=Error.argumentType(d,Object.getType(b),c);a.popStackFrame();return a}if(b%1===0){var e=c.prototype;if(!c.__flags||b===0){for(g in e)if(e[g]===b)return null}else{var i=b;for(g in e){var f=e[g];if(f===0)continue;if((f&b)===f)i-=f;if(i===0)return null}}}a=Error.argumentOutOfRange(d,b,String.format(Sys.Res.enumInvalidValue,b,c.getName()));a.popStackFrame();return a}if(j&&(!Sys._isDomElement(b)||b.nodeType===3)){a=Error.argument(d,Sys.Res.argumentDomElement);a.popStackFrame();return a}if(c&&!Sys._isInstanceOfType(c,b)){a=Error.argumentType(d,Object.getType(b),c);a.popStackFrame();return a}if(c===Number&&k)if(b%1!==0){a=Error.argumentOutOfRange(d,b,Sys.Res.argumentInteger);a.popStackFrame();return a}return null};Error.__typeName="Error";Error.__class=true;Error.create=function(d,b){var a=new Error(d);a.message=d;if(b)for(var c in b)a[c]=b[c];a.popStackFrame();return a};Error.argument=function(a,c){var b="Sys.ArgumentException: "+(c?c:Sys.Res.argument);if(a)b+="\n"+String.format(Sys.Res.paramName,a);var d=Error.create(b,{name:"Sys.ArgumentException",paramName:a});d.popStackFrame();return d};Error.argumentNull=function(a,c){var b="Sys.ArgumentNullException: "+(c?c:Sys.Res.argumentNull);if(a)b+="\n"+String.format(Sys.Res.paramName,a);var d=Error.create(b,{name:"Sys.ArgumentNullException",paramName:a});d.popStackFrame();return d};Error.argumentOutOfRange=function(c,a,d){var b="Sys.ArgumentOutOfRangeException: "+(d?d:Sys.Res.argumentOutOfRange);if(c)b+="\n"+String.format(Sys.Res.paramName,c);if(typeof a!=="undefined"&&a!==null)b+="\n"+String.format(Sys.Res.actualValue,a);var e=Error.create(b,{name:"Sys.ArgumentOutOfRangeException",paramName:c,actualValue:a});e.popStackFrame();return e};Error.argumentType=function(d,c,b,e){var a="Sys.ArgumentTypeException: ";if(e)a+=e;else if(c&&b)a+=String.format(Sys.Res.argumentTypeWithTypes,c.getName(),b.getName());else a+=Sys.Res.argumentType;if(d)a+="\n"+String.format(Sys.Res.paramName,d);var f=Error.create(a,{name:"Sys.ArgumentTypeException",paramName:d,actualType:c,expectedType:b});f.popStackFrame();return f};Error.argumentUndefined=function(a,c){var b="Sys.ArgumentUndefinedException: "+(c?c:Sys.Res.argumentUndefined);if(a)b+="\n"+String.format(Sys.Res.paramName,a);var d=Error.create(b,{name:"Sys.ArgumentUndefinedException",paramName:a});d.popStackFrame();return d};Error.format=function(a){var c="Sys.FormatException: "+(a?a:Sys.Res.format),b=Error.create(c,{name:"Sys.FormatException"});b.popStackFrame();return b};Error.invalidOperation=function(a){var c="Sys.InvalidOperationException: "+(a?a:Sys.Res.invalidOperation),b=Error.create(c,{name:"Sys.InvalidOperationException"});b.popStackFrame();return b};Error.notImplemented=function(a){var c="Sys.NotImplementedException: "+(a?a:Sys.Res.notImplemented),b=Error.create(c,{name:"Sys.NotImplementedException"});b.popStackFrame();return b};Error.parameterCount=function(a){var c="Sys.ParameterCountException: "+(a?a:Sys.Res.parameterCount),b=Error.create(c,{name:"Sys.ParameterCountException"});b.popStackFrame();return b};Error.prototype.popStackFrame=function(){if(typeof this.stack==="undefined"||this.stack===null||typeof this.fileName==="undefined"||this.fileName===null||typeof this.lineNumber==="undefined"||this.lineNumber===null)return;var a=this.stack.split("\n"),c=a[0],e=this.fileName+":"+this.lineNumber;while(typeof c!=="undefined"&&c!==null&&c.indexOf(e)===-1){a.shift();c=a[0]}var d=a[1];if(typeof d==="undefined"||d===null)return;var b=d.match(/@(.*):(\d+)$/);if(typeof b==="undefined"||b===null)return;this.fileName=b[1];this.lineNumber=parseInt(b[2]);a.shift();this.stack=a.join("\n")};Object.__typeName="Object";Object.__class=true;Object.getType=function(b){var a=b.constructor;if(!a||typeof a!=="function"||!a.__typeName||a.__typeName==="Object")return Object;return a};Object.getTypeName=function(a){return Object.getType(a).getName()};String.__typeName="String";String.__class=true;String.prototype.endsWith=function(a){return this.substr(this.length-a.length)===a};String.prototype.startsWith=function(a){return this.substr(0,a.length)===a};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.trimEnd=function(){return this.replace(/\s+$/,"")};String.prototype.trimStart=function(){return this.replace(/^\s+/,"")};String.format=function(){return String._toFormattedString(false,arguments)};String._toFormattedString=function(l,j){var c="",e=j[0];for(var a=0;true;){var f=e.indexOf("{",a),d=e.indexOf("}",a);if(f<0&&d<0){c+=e.slice(a);break}if(d>0&&(d<f||f<0)){c+=e.slice(a,d+1);a=d+2;continue}c+=e.slice(a,f);a=f+1;if(e.charAt(a)==="{"){c+="{";a++;continue}if(d<0)break;var h=e.substring(a,d),g=h.indexOf(":"),k=parseInt(g<0?h:h.substring(0,g),10)+1,i=g<0?"":h.substring(g+1),b=j[k];if(typeof b==="undefined"||b===null)b="";if(b.toFormattedString)c+=b.toFormattedString(i);else if(l&&b.localeFormat)c+=b.localeFormat(i);else if(b.format)c+=b.format(i);else c+=b.toString();a=d+1}return c};Boolean.__typeName="Boolean";Boolean.__class=true;Boolean.parse=function(b){var a=b.trim().toLowerCase();if(a==="false")return false;if(a==="true")return true};Date.__typeName="Date";Date.__class=true;Number.__typeName="Number";Number.__class=true;RegExp.__typeName="RegExp";RegExp.__class=true;if(!window)this.window=this;window.Type=Function;Type.prototype.callBaseMethod=function(a,d,b){var c=Sys._getBaseMethod(this,a,d);if(!b)return c.apply(a);else return c.apply(a,b)};Type.prototype.getBaseMethod=function(a,b){return Sys._getBaseMethod(this,a,b)};Type.prototype.getBaseType=function(){return typeof this.__baseType==="undefined"?null:this.__baseType};Type.prototype.getInterfaces=function(){var a=[],b=this;while(b){var c=b.__interfaces;if(c)for(var d=0,f=c.length;d<f;d++){var e=c[d];if(!Array.contains(a,e))a[a.length]=e}b=b.__baseType}return a};Type.prototype.getName=function(){return typeof this.__typeName==="undefined"?"":this.__typeName};Type.prototype.implementsInterface=function(d){this.resolveInheritance();var c=d.getName(),a=this.__interfaceCache;if(a){var e=a[c];if(typeof e!=="undefined")return e}else a=this.__interfaceCache={};var b=this;while(b){var f=b.__interfaces;if(f)if(Array.indexOf(f,d)!==-1)return a[c]=true;b=b.__baseType}return a[c]=false};Type.prototype.inheritsFrom=function(b){this.resolveInheritance();var a=this.__baseType;while(a){if(a===b)return true;a=a.__baseType}return false};Type.prototype.initializeBase=function(a,b){this.resolveInheritance();if(this.__baseType)if(!b)this.__baseType.apply(a);else this.__baseType.apply(a,b);return a};Type.prototype.isImplementedBy=function(a){if(typeof a==="undefined"||a===null)return false;var b=Object.getType(a);return !!(b.implementsInterface&&b.implementsInterface(this))};Type.prototype.isInstanceOfType=function(a){return Sys._isInstanceOfType(this,a)};Type.prototype.registerClass=function(c,b,d){this.prototype.constructor=this;this.__typeName=c;this.__class=true;if(b){this.__baseType=b;this.__basePrototypePending=true}Sys.__upperCaseTypes[c.toUpperCase()]=this;if(d){this.__interfaces=[];for(var a=2,f=arguments.length;a<f;a++){var e=arguments[a];this.__interfaces.push(e)}}return this};Type.prototype.registerInterface=function(a){Sys.__upperCaseTypes[a.toUpperCase()]=this;this.prototype.constructor=this;this.__typeName=a;this.__interface=true;return this};Type.prototype.resolveInheritance=function(){if(this.__basePrototypePending){var b=this.__baseType;b.resolveInheritance();for(var a in b.prototype){var c=b.prototype[a];if(!this.prototype[a])this.prototype[a]=c}delete this.__basePrototypePending}};Type.getRootNamespaces=function(){return Array.clone(Sys.__rootNamespaces)};Type.isClass=function(a){if(typeof a==="undefined"||a===null)return false;return !!a.__class};Type.isInterface=function(a){if(typeof a==="undefined"||a===null)return false;return !!a.__interface};Type.isNamespace=function(a){if(typeof a==="undefined"||a===null)return false;return !!a.__namespace};Type.parse=function(typeName,ns){var fn;if(ns){fn=Sys.__upperCaseTypes[ns.getName().toUpperCase()+"."+typeName.toUpperCase()];return fn||null}if(!typeName)return null;if(!Type.__htClasses)Type.__htClasses={};fn=Type.__htClasses[typeName];if(!fn){fn=eval(typeName);Type.__htClasses[typeName]=fn}return fn};Type.registerNamespace=function(e){var d=window,c=e.split(".");for(var b=0;b<c.length;b++){var f=c[b],a=d[f];if(!a)a=d[f]={};if(!a.__namespace){if(b===0&&e!=="Sys")Sys.__rootNamespaces[Sys.__rootNamespaces.length]=a;a.__namespace=true;a.__typeName=c.slice(0,b+1).join(".");a.getName=function(){return this.__typeName}}d=a}};Type._checkDependency=function(c,a){var d=Type._registerScript._scripts,b=d?!!d[c]:false;if(typeof a!=="undefined"&&!b)throw Error.invalidOperation(String.format(Sys.Res.requiredScriptReferenceNotIncluded,a,c));return b};Type._registerScript=function(a,c){var b=Type._registerScript._scripts;if(!b)Type._registerScript._scripts=b={};if(b[a])throw Error.invalidOperation(String.format(Sys.Res.scriptAlreadyLoaded,a));b[a]=true;if(c)for(var d=0,f=c.length;d<f;d++){var e=c[d];if(!Type._checkDependency(e))throw Error.invalidOperation(String.format(Sys.Res.scriptDependencyNotFound,a,e))}};Type.registerNamespace("Sys");Sys.__upperCaseTypes={};Sys.__rootNamespaces=[Sys];Sys._isInstanceOfType=function(c,b){if(typeof b==="undefined"||b===null)return false;if(b instanceof c)return true;var a=Object.getType(b);return !!(a===c)||a.inheritsFrom&&a.inheritsFrom(c)||a.implementsInterface&&a.implementsInterface(c)};Sys._getBaseMethod=function(d,e,c){var b=d.getBaseType();if(b){var a=b.prototype[c];return a instanceof Function?a:null}return null};Sys._isDomElement=function(a){var c=false;if(typeof a.nodeType!=="number"){var b=a.ownerDocument||a.document||a;if(b!=a){var d=b.defaultView||b.parentWindow;c=d!=a}else c=typeof b.body==="undefined"}return !c};Array.__typeName="Array";Array.__class=true;Array.add=Array.enqueue=function(a,b){a[a.length]=b};Array.addRange=function(a,b){a.push.apply(a,b)};Array.clear=function(a){a.length=0};Array.clone=function(a){if(a.length===1)return [a[0]];else return Array.apply(null,a)};Array.contains=function(a,b){return Sys._indexOf(a,b)>=0};Array.dequeue=function(a){return a.shift()};Array.forEach=function(b,e,d){for(var a=0,f=b.length;a<f;a++){var c=b[a];if(typeof c!=="undefined")e.call(d,c,a,b)}};Array.indexOf=function(a,c,b){return Sys._indexOf(a,c,b)};Array.insert=function(a,b,c){a.splice(b,0,c)};Array.parse=function(value){if(!value)return [];return eval(value)};Array.remove=function(b,c){var a=Sys._indexOf(b,c);if(a>=0)b.splice(a,1);return a>=0};Array.removeAt=function(a,b){a.splice(b,1)};Sys._indexOf=function(d,e,a){if(typeof e==="undefined")return -1;var c=d.length;if(c!==0){a=a-0;if(isNaN(a))a=0;else{if(isFinite(a))a=a-a%1;if(a<0)a=Math.max(0,c+a)}for(var b=a;b<c;b++)if(typeof d[b]!=="undefined"&&d[b]===e)return b}return -1};Type._registerScript._scripts={"MicrosoftAjaxCore.js":true,"MicrosoftAjaxGlobalization.js":true,"MicrosoftAjaxSerialization.js":true,"MicrosoftAjaxComponentModel.js":true,"MicrosoftAjaxHistory.js":true,"MicrosoftAjaxNetwork.js":true,"MicrosoftAjaxWebServices.js":true};Sys.IDisposable=function(){};Sys.IDisposable.prototype={};Sys.IDisposable.registerInterface("Sys.IDisposable");Sys.StringBuilder=function(a){this._parts=typeof a!=="undefined"&&a!==null&&a!==""?[a.toString()]:[];this._value={};this._len=0};Sys.StringBuilder.prototype={append:function(a){this._parts[this._parts.length]=a},appendLine:function(a){this._parts[this._parts.length]=typeof a==="undefined"||a===null||a===""?"\r\n":a+"\r\n"},clear:function(){this._parts=[];this._value={};this._len=0},isEmpty:function(){if(this._parts.length===0)return true;return this.toString()===""},toString:function(a){a=a||"";var b=this._parts;if(this._len!==b.length){this._value={};this._len=b.length}var d=this._value;if(typeof d[a]==="undefined"){if(a!=="")for(var c=0;c<b.length;)if(typeof b[c]==="undefined"||b[c]===""||b[c]===null)b.splice(c,1);else c++;d[a]=this._parts.join(a)}return d[a]}};Sys.StringBuilder.registerClass("Sys.StringBuilder");Sys.Browser={};Sys.Browser.InternetExplorer={};Sys.Browser.Firefox={};Sys.Browser.Safari={};Sys.Browser.Opera={};Sys.Browser.agent=null;Sys.Browser.hasDebuggerStatement=false;Sys.Browser.name=navigator.appName;Sys.Browser.version=parseFloat(navigator.appVersion);Sys.Browser.documentMode=0;if(navigator.userAgent.indexOf(" MSIE ")>-1){Sys.Browser.agent=Sys.Browser.InternetExplorer;Sys.Browser.version=parseFloat(navigator.userAgent.match(/MSIE (\d+\.\d+)/)[1]);if(Sys.Browser.version>=8)if(document.documentMode>=7)Sys.Browser.documentMode=document.documentMode;Sys.Browser.hasDebuggerStatement=true}else if(navigator.userAgent.indexOf(" Firefox/")>-1){Sys.Browser.agent=Sys.Browser.Firefox;Sys.Browser.version=parseFloat(navigator.userAgent.match(/Firefox\/(\d+\.\d+)/)[1]);Sys.Browser.name="Firefox";Sys.Browser.hasDebuggerStatement=true}else if(navigator.userAgent.indexOf(" AppleWebKit/")>-1){Sys.Browser.agent=Sys.Browser.Safari;Sys.Browser.version=parseFloat(navigator.userAgent.match(/AppleWebKit\/(\d+(\.\d+)?)/)[1]);Sys.Browser.name="Safari"}else if(navigator.userAgent.indexOf("Opera/")>-1)Sys.Browser.agent=Sys.Browser.Opera;Sys.EventArgs=function(){};Sys.EventArgs.registerClass("Sys.EventArgs");Sys.EventArgs.Empty=new Sys.EventArgs;Sys.CancelEventArgs=function(){Sys.CancelEventArgs.initializeBase(this);this._cancel=false};Sys.CancelEventArgs.prototype={get_cancel:function(){return this._cancel},set_cancel:function(a){this._cancel=a}};Sys.CancelEventArgs.registerClass("Sys.CancelEventArgs",Sys.EventArgs);Type.registerNamespace("Sys.UI");Sys._Debug=function(){};Sys._Debug.prototype={_appendConsole:function(a){if(typeof Debug!=="undefined"&&Debug.writeln)Debug.writeln(a);if(window.console&&window.console.log)window.console.log(a);if(window.opera)window.opera.postError(a);if(window.debugService)window.debugService.trace(a)},_appendTrace:function(b){var a=document.getElementById("TraceConsole");if(a&&a.tagName.toUpperCase()==="TEXTAREA")a.value+=b+"\n"},assert:function(c,a,b){if(!c){a=b&&this.assert.caller?String.format(Sys.Res.assertFailedCaller,a,this.assert.caller):String.format(Sys.Res.assertFailed,a);if(confirm(String.format(Sys.Res.breakIntoDebugger,a)))this.fail(a)}},clearTrace:function(){var a=document.getElementById("TraceConsole");if(a&&a.tagName.toUpperCase()==="TEXTAREA")a.value=""},fail:function(message){this._appendConsole(message);if(Sys.Browser.hasDebuggerStatement)eval("debugger")},trace:function(a){this._appendConsole(a);this._appendTrace(a)},traceDump:function(a,b){var c=this._traceDump(a,b,true)},_traceDump:function(a,c,f,b,d){c=c?c:"traceDump";b=b?b:"";if(a===null){this.trace(b+c+": null");return}switch(typeof a){case "undefined":this.trace(b+c+": Undefined");break;case "number":case "string":case "boolean":this.trace(b+c+": "+a);break;default:if(Date.isInstanceOfType(a)||RegExp.isInstanceOfType(a)){this.trace(b+c+": "+a.toString());break}if(!d)d=[];else if(Array.contains(d,a)){this.trace(b+c+": ...");return}Array.add(d,a);if(a==window||a===document||window.HTMLElement&&a instanceof HTMLElement||typeof a.nodeName==="string"){var k=a.tagName?a.tagName:"DomElement";if(a.id)k+=" - "+a.id;this.trace(b+c+" {"+k+"}")}else{var i=Object.getTypeName(a);this.trace(b+c+(typeof i==="string"?" {"+i+"}":""));if(b===""||f){b+="    ";var e,j,l,g,h;if(Array.isInstanceOfType(a)){j=a.length;for(e=0;e<j;e++)this._traceDump(a[e],"["+e+"]",f,b,d)}else for(g in a){h=a[g];if(!Function.isInstanceOfType(h))this._traceDump(h,g,f,b,d)}}}Array.remove(d,a)}}};Sys._Debug.registerClass("Sys._Debug");Sys.Debug=new Sys._Debug;Sys.Debug.isDebug=false;function Sys$Enum$parse(c,e){var a,b,i;if(e){a=this.__lowerCaseValues;if(!a){this.__lowerCaseValues=a={};var g=this.prototype;for(var f in g)a[f.toLowerCase()]=g[f]}}else a=this.prototype;if(!this.__flags){i=e?c.toLowerCase():c;b=a[i.trim()];if(typeof b!=="number")throw Error.argument("value",String.format(Sys.Res.enumInvalidValue,c,this.__typeName));return b}else{var h=(e?c.toLowerCase():c).split(","),j=0;for(var d=h.length-1;d>=0;d--){var k=h[d].trim();b=a[k];if(typeof b!=="number")throw Error.argument("value",String.format(Sys.Res.enumInvalidValue,c.split(",")[d].trim(),this.__typeName));j|=b}return j}}function Sys$Enum$toString(c){if(typeof c==="undefined"||c===null)return this.__string;var d=this.prototype,a;if(!this.__flags||c===0){for(a in d)if(d[a]===c)return a}else{var b=this.__sortedValues;if(!b){b=[];for(a in d)b[b.length]={key:a,value:d[a]};b.sort(function(a,b){return a.value-b.value});this.__sortedValues=b}var e=[],g=c;for(a=b.length-1;a>=0;a--){var h=b[a],f=h.value;if(f===0)continue;if((f&c)===f){e[e.length]=h.key;g-=f;if(g===0)break}}if(e.length&&g===0)return e.reverse().join(", ")}return ""}Type.prototype.registerEnum=function(b,c){Sys.__upperCaseTypes[b.toUpperCase()]=this;for(var a in this.prototype)this[a]=this.prototype[a];this.__typeName=b;this.parse=Sys$Enum$parse;this.__string=this.toString();this.toString=Sys$Enum$toString;this.__flags=c;this.__enum=true};Type.isEnum=function(a){if(typeof a==="undefined"||a===null)return false;return !!a.__enum};Type.isFlags=function(a){if(typeof a==="undefined"||a===null)return false;return !!a.__flags};Sys.CollectionChange=function(e,a,c,b,d){this.action=e;if(a)if(!(a instanceof Array))a=[a];this.newItems=a||null;if(typeof c!=="number")c=-1;this.newStartingIndex=c;if(b)if(!(b instanceof Array))b=[b];this.oldItems=b||null;if(typeof d!=="number")d=-1;this.oldStartingIndex=d};Sys.CollectionChange.registerClass("Sys.CollectionChange");Sys.NotifyCollectionChangedAction=function(){throw Error.notImplemented()};Sys.NotifyCollectionChangedAction.prototype={add:0,remove:1,reset:2};Sys.NotifyCollectionChangedAction.registerEnum("Sys.NotifyCollectionChangedAction");Sys.NotifyCollectionChangedEventArgs=function(a){this._changes=a;Sys.NotifyCollectionChangedEventArgs.initializeBase(this)};Sys.NotifyCollectionChangedEventArgs.prototype={get_changes:function(){return this._changes||[]}};Sys.NotifyCollectionChangedEventArgs.registerClass("Sys.NotifyCollectionChangedEventArgs",Sys.EventArgs);Sys.Observer=function(){};Sys.Observer.registerClass("Sys.Observer");Sys.Observer.makeObservable=function(a){var c=a instanceof Array,b=Sys.Observer;if(a.setValue===b._observeMethods.setValue)return a;b._addMethods(a,b._observeMethods);if(c)b._addMethods(a,b._arrayMethods);return a};Sys.Observer._addMethods=function(c,b){for(var a in b)c[a]=b[a]};Sys.Observer._addEventHandler=function(c,a,b){Sys.Observer._getContext(c,true).events._addHandler(a,b)};Sys.Observer.addEventHandler=function(c,a,b){Sys.Observer._addEventHandler(c,a,b)};Sys.Observer._removeEventHandler=function(c,a,b){Sys.Observer._getContext(c,true).events._removeHandler(a,b)};Sys.Observer.removeEventHandler=function(c,a,b){Sys.Observer._removeEventHandler(c,a,b)};Sys.Observer.raiseEvent=function(b,e,d){var c=Sys.Observer._getContext(b);if(!c)return;var a=c.events.getHandler(e);if(a)a(b,d)};Sys.Observer.addPropertyChanged=function(b,a){Sys.Observer._addEventHandler(b,"propertyChanged",a)};Sys.Observer.removePropertyChanged=function(b,a){Sys.Observer._removeEventHandler(b,"propertyChanged",a)};Sys.Observer.beginUpdate=function(a){Sys.Observer._getContext(a,true).updating=true};Sys.Observer.endUpdate=function(b){var a=Sys.Observer._getContext(b);if(!a||!a.updating)return;a.updating=false;var d=a.dirty;a.dirty=false;if(d){if(b instanceof Array){var c=a.changes;a.changes=null;Sys.Observer.raiseCollectionChanged(b,c)}Sys.Observer.raisePropertyChanged(b,"")}};Sys.Observer.isUpdating=function(b){var a=Sys.Observer._getContext(b);return a?a.updating:false};Sys.Observer._setValue=function(a,j,g){var b,f,k=a,d=j.split(".");for(var i=0,m=d.length-1;i<m;i++){var l=d[i];b=a["get_"+l];if(typeof b==="function")a=b.call(a);else a=a[l];var n=typeof a;if(a===null||n==="undefined")throw Error.invalidOperation(String.format(Sys.Res.nullReferenceInPath,j))}var e,c=d[m];b=a["get_"+c];f=a["set_"+c];if(typeof b==="function")e=b.call(a);else e=a[c];if(typeof f==="function")f.call(a,g);else a[c]=g;if(e!==g){var h=Sys.Observer._getContext(k);if(h&&h.updating){h.dirty=true;return}Sys.Observer.raisePropertyChanged(k,d[0])}};Sys.Observer.setValue=function(b,a,c){Sys.Observer._setValue(b,a,c)};Sys.Observer.raisePropertyChanged=function(b,a){Sys.Observer.raiseEvent(b,"propertyChanged",new Sys.PropertyChangedEventArgs(a))};Sys.Observer.addCollectionChanged=function(b,a){Sys.Observer._addEventHandler(b,"collectionChanged",a)};Sys.Observer.removeCollectionChanged=function(b,a){Sys.Observer._removeEventHandler(b,"collectionChanged",a)};Sys.Observer._collectionChange=function(d,c){var a=Sys.Observer._getContext(d);if(a&&a.updating){a.dirty=true;var b=a.changes;if(!b)a.changes=b=[c];else b.push(c)}else{Sys.Observer.raiseCollectionChanged(d,[c]);Sys.Observer.raisePropertyChanged(d,"length")}};Sys.Observer.add=function(a,b){var c=new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.add,[b],a.length);Array.add(a,b);Sys.Observer._collectionChange(a,c)};Sys.Observer.addRange=function(a,b){var c=new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.add,b,a.length);Array.addRange(a,b);Sys.Observer._collectionChange(a,c)};Sys.Observer.clear=function(a){var b=Array.clone(a);Array.clear(a);Sys.Observer._collectionChange(a,new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.reset,null,-1,b,0))};Sys.Observer.insert=function(a,b,c){Array.insert(a,b,c);Sys.Observer._collectionChange(a,new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.add,[c],b))};Sys.Observer.remove=function(a,b){var c=Array.indexOf(a,b);if(c!==-1){Array.remove(a,b);Sys.Observer._collectionChange(a,new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.remove,null,-1,[b],c));return true}return false};Sys.Observer.removeAt=function(b,a){if(a>-1&&a<b.length){var c=b[a];Array.removeAt(b,a);Sys.Observer._collectionChange(b,new Sys.CollectionChange(Sys.NotifyCollectionChangedAction.remove,null,-1,[c],a))}};Sys.Observer.raiseCollectionChanged=function(b,a){Sys.Observer.raiseEvent(b,"collectionChanged",new Sys.NotifyCollectionChangedEventArgs(a))};Sys.Observer._observeMethods={add_propertyChanged:function(a){Sys.Observer._addEventHandler(this,"propertyChanged",a)},remove_propertyChanged:function(a){Sys.Observer._removeEventHandler(this,"propertyChanged",a)},addEventHandler:function(a,b){Sys.Observer._addEventHandler(this,a,b)},removeEventHandler:function(a,b){Sys.Observer._removeEventHandler(this,a,b)},get_isUpdating:function(){return Sys.Observer.isUpdating(this)},beginUpdate:function(){Sys.Observer.beginUpdate(this)},endUpdate:function(){Sys.Observer.endUpdate(this)},setValue:function(b,a){Sys.Observer._setValue(this,b,a)},raiseEvent:function(b,a){Sys.Observer.raiseEvent(this,b,a)},raisePropertyChanged:function(a){Sys.Observer.raiseEvent(this,"propertyChanged",new Sys.PropertyChangedEventArgs(a))}};Sys.Observer._arrayMethods={add_collectionChanged:function(a){Sys.Observer._addEventHandler(this,"collectionChanged",a)},remove_collectionChanged:function(a){Sys.Observer._removeEventHandler(this,"collectionChanged",a)},add:function(a){Sys.Observer.add(this,a)},addRange:function(a){Sys.Observer.addRange(this,a)},clear:function(){Sys.Observer.clear(this)},insert:function(a,b){Sys.Observer.insert(this,a,b)},remove:function(a){return Sys.Observer.remove(this,a)},removeAt:function(a){Sys.Observer.removeAt(this,a)},raiseCollectionChanged:function(a){Sys.Observer.raiseEvent(this,"collectionChanged",new Sys.NotifyCollectionChangedEventArgs(a))}};Sys.Observer._getContext=function(b,c){var a=b._observerContext;if(a)return a();if(c)return (b._observerContext=Sys.Observer._createContext())();return null};Sys.Observer._createContext=function(){var a={events:new Sys.EventHandlerList};return function(){return a}};Date._appendPreOrPostMatch=function(e,b){var d=0,a=false;for(var c=0,g=e.length;c<g;c++){var f=e.charAt(c);switch(f){case "'":if(a)b.append("'");else d++;a=false;break;case "\\":if(a)b.append("\\");a=!a;break;default:b.append(f);a=false}}return d};Date._expandFormat=function(a,b){if(!b)b="F";var c=b.length;if(c===1)switch(b){case "d":return a.ShortDatePattern;case "D":return a.LongDatePattern;case "t":return a.ShortTimePattern;case "T":return a.LongTimePattern;case "f":return a.LongDatePattern+" "+a.ShortTimePattern;case "F":return a.FullDateTimePattern;case "M":case "m":return a.MonthDayPattern;case "s":return a.SortableDateTimePattern;case "Y":case "y":return a.YearMonthPattern;default:throw Error.format(Sys.Res.formatInvalidString)}else if(c===2&&b.charAt(0)==="%")b=b.charAt(1);return b};Date._expandYear=function(c,a){var d=new Date,e=Date._getEra(d);if(a<100){var b=Date._getEraYear(d,c,e);a+=b-b%100;if(a>c.Calendar.TwoDigitYearMax)a-=100}return a};Date._getEra=function(e,c){if(!c)return 0;var b,d=e.getTime();for(var a=0,f=c.length;a<f;a+=4){b=c[a+2];if(b===null||d>=b)return a}return 0};Date._getEraYear=function(d,b,e,c){var a=d.getFullYear();if(!c&&b.eras)a-=b.eras[e+3];return a};Date._getParseRegExp=function(b,e){if(!b._parseRegExp)b._parseRegExp={};else if(b._parseRegExp[e])return b._parseRegExp[e];var c=Date._expandFormat(b,e);c=c.replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1");var a=new Sys.StringBuilder("^"),j=[],f=0,i=0,h=Date._getTokenRegExp(),d;while((d=h.exec(c))!==null){var l=c.slice(f,d.index);f=h.lastIndex;i+=Date._appendPreOrPostMatch(l,a);if(i%2===1){a.append(d[0]);continue}switch(d[0]){case "dddd":case "ddd":case "MMMM":case "MMM":case "gg":case "g":a.append("(\\D+)");break;case "tt":case "t":a.append("(\\D*)");break;case "yyyy":a.append("(\\d{4})");break;case "fff":a.append("(\\d{3})");break;case "ff":a.append("(\\d{2})");break;case "f":a.append("(\\d)");break;case "dd":case "d":case "MM":case "M":case "yy":case "y":case "HH":case "H":case "hh":case "h":case "mm":case "m":case "ss":case "s":a.append("(\\d\\d?)");break;case "zzz":a.append("([+-]?\\d\\d?:\\d{2})");break;case "zz":case "z":a.append("([+-]?\\d\\d?)");break;case "/":a.append("(\\"+b.DateSeparator+")")}Array.add(j,d[0])}Date._appendPreOrPostMatch(c.slice(f),a);a.append("$");var k=a.toString().replace(/\s+/g,"\\s+"),g={"regExp":k,"groups":j};b._parseRegExp[e]=g;return g};Date._getTokenRegExp=function(){return /\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g};Date.parseLocale=function(a){return Date._parse(a,Sys.CultureInfo.CurrentCulture,arguments)};Date.parseInvariant=function(a){return Date._parse(a,Sys.CultureInfo.InvariantCulture,arguments)};Date._parse=function(h,d,i){var a,c,b,f,e,g=false;for(a=1,c=i.length;a<c;a++){f=i[a];if(f){g=true;b=Date._parseExact(h,f,d);if(b)return b}}if(!g){e=d._getDateTimeFormats();for(a=0,c=e.length;a<c;a++){b=Date._parseExact(h,e[a],d);if(b)return b}}return null};Date._parseExact=function(w,D,k){w=w.trim();var g=k.dateTimeFormat,A=Date._getParseRegExp(g,D),C=(new RegExp(A.regExp)).exec(w);if(C===null)return null;var B=A.groups,x=null,e=null,c=null,j=null,i=null,d=0,h,p=0,q=0,f=0,l=null,v=false;for(var s=0,E=B.length;s<E;s++){var a=C[s+1];if(a)switch(B[s]){case "dd":case "d":j=parseInt(a,10);if(j<1||j>31)return null;break;case "MMMM":c=k._getMonthIndex(a);if(c<0||c>11)return null;break;case "MMM":c=k._getAbbrMonthIndex(a);if(c<0||c>11)return null;break;case "M":case "MM":c=parseInt(a,10)-1;if(c<0||c>11)return null;break;case "y":case "yy":e=Date._expandYear(g,parseInt(a,10));if(e<0||e>9999)return null;break;case "yyyy":e=parseInt(a,10);if(e<0||e>9999)return null;break;case "h":case "hh":d=parseInt(a,10);if(d===12)d=0;if(d<0||d>11)return null;break;case "H":case "HH":d=parseInt(a,10);if(d<0||d>23)return null;break;case "m":case "mm":p=parseInt(a,10);if(p<0||p>59)return null;break;case "s":case "ss":q=parseInt(a,10);if(q<0||q>59)return null;break;case "tt":case "t":var z=a.toUpperCase();v=z===g.PMDesignator.toUpperCase();if(!v&&z!==g.AMDesignator.toUpperCase())return null;break;case "f":f=parseInt(a,10)*100;if(f<0||f>999)return null;break;case "ff":f=parseInt(a,10)*10;if(f<0||f>999)return null;break;case "fff":f=parseInt(a,10);if(f<0||f>999)return null;break;case "dddd":i=k._getDayIndex(a);if(i<0||i>6)return null;break;case "ddd":i=k._getAbbrDayIndex(a);if(i<0||i>6)return null;break;case "zzz":var u=a.split(/:/);if(u.length!==2)return null;h=parseInt(u[0],10);if(h<-12||h>13)return null;var m=parseInt(u[1],10);if(m<0||m>59)return null;l=h*60+(a.startsWith("-")?-m:m);break;case "z":case "zz":h=parseInt(a,10);if(h<-12||h>13)return null;l=h*60;break;case "g":case "gg":var o=a;if(!o||!g.eras)return null;o=o.toLowerCase().trim();for(var r=0,F=g.eras.length;r<F;r+=4)if(o===g.eras[r+1].toLowerCase()){x=r;break}if(x===null)return null}}var b=new Date,t,n=g.Calendar.convert;if(n)t=n.fromGregorian(b)[0];else t=b.getFullYear();if(e===null)e=t;else if(g.eras)e+=g.eras[(x||0)+3];if(c===null)c=0;if(j===null)j=1;if(n){b=n.toGregorian(e,c,j);if(b===null)return null}else{b.setFullYear(e,c,j);if(b.getDate()!==j)return null;if(i!==null&&b.getDay()!==i)return null}if(v&&d<12)d+=12;b.setHours(d,p,q,f);if(l!==null){var y=b.getMinutes()-(l+b.getTimezoneOffset());b.setHours(b.getHours()+parseInt(y/60,10),y%60)}return b};Date.prototype.format=function(a){return this._toFormattedString(a,Sys.CultureInfo.InvariantCulture)};Date.prototype.localeFormat=function(a){return this._toFormattedString(a,Sys.CultureInfo.CurrentCulture)};Date.prototype._toFormattedString=function(e,j){var b=j.dateTimeFormat,n=b.Calendar.convert;if(!e||!e.length||e==="i")if(j&&j.name.length)if(n)return this._toFormattedString(b.FullDateTimePattern,j);else{var r=new Date(this.getTime()),x=Date._getEra(this,b.eras);r.setFullYear(Date._getEraYear(this,b,x));return r.toLocaleString()}else return this.toString();var l=b.eras,k=e==="s";e=Date._expandFormat(b,e);var a=new Sys.StringBuilder,c;function d(a){if(a<10)return "0"+a;return a.toString()}function m(a){if(a<10)return "00"+a;if(a<100)return "0"+a;return a.toString()}function v(a){if(a<10)return "000"+a;else if(a<100)return "00"+a;else if(a<1000)return "0"+a;return a.toString()}var h,p,t=/([^d]|^)(d|dd)([^d]|$)/g;function s(){if(h||p)return h;h=t.test(e);p=true;return h}var q=0,o=Date._getTokenRegExp(),f;if(!k&&n)f=n.fromGregorian(this);for(;true;){var w=o.lastIndex,i=o.exec(e),u=e.slice(w,i?i.index:e.length);q+=Date._appendPreOrPostMatch(u,a);if(!i)break;if(q%2===1){a.append(i[0]);continue}function g(a,b){if(f)return f[b];switch(b){case 0:return a.getFullYear();case 1:return a.getMonth();case 2:return a.getDate()}}switch(i[0]){case "dddd":a.append(b.DayNames[this.getDay()]);break;case "ddd":a.append(b.AbbreviatedDayNames[this.getDay()]);break;case "dd":h=true;a.append(d(g(this,2)));break;case "d":h=true;a.append(g(this,2));break;case "MMMM":a.append(b.MonthGenitiveNames&&s()?b.MonthGenitiveNames[g(this,1)]:b.MonthNames[g(this,1)]);break;case "MMM":a.append(b.AbbreviatedMonthGenitiveNames&&s()?b.AbbreviatedMonthGenitiveNames[g(this,1)]:b.AbbreviatedMonthNames[g(this,1)]);break;case "MM":a.append(d(g(this,1)+1));break;case "M":a.append(g(this,1)+1);break;case "yyyy":a.append(v(f?f[0]:Date._getEraYear(this,b,Date._getEra(this,l),k)));break;case "yy":a.append(d((f?f[0]:Date._getEraYear(this,b,Date._getEra(this,l),k))%100));break;case "y":a.append((f?f[0]:Date._getEraYear(this,b,Date._getEra(this,l),k))%100);break;case "hh":c=this.getHours()%12;if(c===0)c=12;a.append(d(c));break;case "h":c=this.getHours()%12;if(c===0)c=12;a.append(c);break;case "HH":a.append(d(this.getHours()));break;case "H":a.append(this.getHours());break;case "mm":a.append(d(this.getMinutes()));break;case "m":a.append(this.getMinutes());break;case "ss":a.append(d(this.getSeconds()));break;case "s":a.append(this.getSeconds());break;case "tt":a.append(this.getHours()<12?b.AMDesignator:b.PMDesignator);break;case "t":a.append((this.getHours()<12?b.AMDesignator:b.PMDesignator).charAt(0));break;case "f":a.append(m(this.getMilliseconds()).charAt(0));break;case "ff":a.append(m(this.getMilliseconds()).substr(0,2));break;case "fff":a.append(m(this.getMilliseconds()));break;case "z":c=this.getTimezoneOffset()/60;a.append((c<=0?"+":"-")+Math.floor(Math.abs(c)));break;case "zz":c=this.getTimezoneOffset()/60;a.append((c<=0?"+":"-")+d(Math.floor(Math.abs(c))));break;case "zzz":c=this.getTimezoneOffset()/60;a.append((c<=0?"+":"-")+d(Math.floor(Math.abs(c)))+":"+d(Math.abs(this.getTimezoneOffset()%60)));break;case "g":case "gg":if(b.eras)a.append(b.eras[Date._getEra(this,l)+1]);break;case "/":a.append(b.DateSeparator)}}return a.toString()};String.localeFormat=function(){return String._toFormattedString(true,arguments)};Number.parseLocale=function(a){return Number._parse(a,Sys.CultureInfo.CurrentCulture)};Number.parseInvariant=function(a){return Number._parse(a,Sys.CultureInfo.InvariantCulture)};Number._parse=function(b,o){b=b.trim();if(b.match(/^[+-]?infinity$/i))return parseFloat(b);if(b.match(/^0x[a-f0-9]+$/i))return parseInt(b);var a=o.numberFormat,g=Number._parseNumberNegativePattern(b,a,a.NumberNegativePattern),h=g[0],e=g[1];if(h===""&&a.NumberNegativePattern!==1){g=Number._parseNumberNegativePattern(b,a,1);h=g[0];e=g[1]}if(h==="")h="+";var j,d,f=e.indexOf("e");if(f<0)f=e.indexOf("E");if(f<0){d=e;j=null}else{d=e.substr(0,f);j=e.substr(f+1)}var c,k,m=d.indexOf(a.NumberDecimalSeparator);if(m<0){c=d;k=null}else{c=d.substr(0,m);k=d.substr(m+a.NumberDecimalSeparator.length)}c=c.split(a.NumberGroupSeparator).join("");var n=a.NumberGroupSeparator.replace(/\u00A0/g," ");if(a.NumberGroupSeparator!==n)c=c.split(n).join("");var l=h+c;if(k!==null)l+="."+k;if(j!==null){var i=Number._parseNumberNegativePattern(j,a,1);if(i[0]==="")i[0]="+";l+="e"+i[0]+i[1]}if(l.match(/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/))return parseFloat(l);return Number.NaN};Number._parseNumberNegativePattern=function(a,d,e){var b=d.NegativeSign,c=d.PositiveSign;switch(e){case 4:b=" "+b;c=" "+c;case 3:if(a.endsWith(b))return ["-",a.substr(0,a.length-b.length)];else if(a.endsWith(c))return ["+",a.substr(0,a.length-c.length)];break;case 2:b+=" ";c+=" ";case 1:if(a.startsWith(b))return ["-",a.substr(b.length)];else if(a.startsWith(c))return ["+",a.substr(c.length)];break;case 0:if(a.startsWith("(")&&a.endsWith(")"))return ["-",a.substr(1,a.length-2)]}return ["",a]};Number.prototype.format=function(a){return this._toFormattedString(a,Sys.CultureInfo.InvariantCulture)};Number.prototype.localeFormat=function(a){return this._toFormattedString(a,Sys.CultureInfo.CurrentCulture)};Number.prototype._toFormattedString=function(e,j){if(!e||e.length===0||e==="i")if(j&&j.name.length>0)return this.toLocaleString();else return this.toString();var o=["n %","n%","%n"],n=["-n %","-n%","-%n"],p=["(n)","-n","- n","n-","n -"],m=["$n","n$","$ n","n $"],l=["($n)","-$n","$-n","$n-","(n$)","-n$","n-$","n$-","-n $","-$ n","n $-","$ n-","$ -n","n- $","($ n)","(n $)"];function g(a,c,d){for(var b=a.length;b<c;b++)a=d?"0"+a:a+"0";return a}function i(j,i,l,n,p){var h=l[0],k=1,o=Math.pow(10,i),m=Math.round(j*o)/o;if(!isFinite(m))m=j;j=m;var b=j.toString(),a="",c,e=b.split(/e/i);b=e[0];c=e.length>1?parseInt(e[1]):0;e=b.split(".");b=e[0];a=e.length>1?e[1]:"";var q;if(c>0){a=g(a,c,false);b+=a.slice(0,c);a=a.substr(c)}else if(c<0){c=-c;b=g(b,c+1,true);a=b.slice(-c,b.length)+a;b=b.slice(0,-c)}if(i>0){if(a.length>i)a=a.slice(0,i);else a=g(a,i,false);a=p+a}else a="";var d=b.length-1,f="";while(d>=0){if(h===0||h>d)if(f.length>0)return b.slice(0,d+1)+n+f+a;else return b.slice(0,d+1)+a;if(f.length>0)f=b.slice(d-h+1,d+1)+n+f;else f=b.slice(d-h+1,d+1);d-=h;if(k<l.length){h=l[k];k++}}return b.slice(0,d+1)+n+f+a}var a=j.numberFormat,d=Math.abs(this);if(!e)e="D";var b=-1;if(e.length>1)b=parseInt(e.slice(1),10);var c;switch(e.charAt(0)){case "d":case "D":c="n";if(b!==-1)d=g(""+d,b,true);if(this<0)d=-d;break;case "c":case "C":if(this<0)c=l[a.CurrencyNegativePattern];else c=m[a.CurrencyPositivePattern];if(b===-1)b=a.CurrencyDecimalDigits;d=i(Math.abs(this),b,a.CurrencyGroupSizes,a.CurrencyGroupSeparator,a.CurrencyDecimalSeparator);break;case "n":case "N":if(this<0)c=p[a.NumberNegativePattern];else c="n";if(b===-1)b=a.NumberDecimalDigits;d=i(Math.abs(this),b,a.NumberGroupSizes,a.NumberGroupSeparator,a.NumberDecimalSeparator);break;case "p":case "P":if(this<0)c=n[a.PercentNegativePattern];else c=o[a.PercentPositivePattern];if(b===-1)b=a.PercentDecimalDigits;d=i(Math.abs(this)*100,b,a.PercentGroupSizes,a.PercentGroupSeparator,a.PercentDecimalSeparator);break;default:throw Error.format(Sys.Res.formatBadFormatSpecifier)}var k=/n|\$|-|%/g,f="";for(;true;){var q=k.lastIndex,h=k.exec(c);f+=c.slice(q,h?h.index:c.length);if(!h)break;switch(h[0]){case "n":f+=d;break;case "$":f+=a.CurrencySymbol;break;case "-":if(/[1-9]/.test(d))f+=a.NegativeSign;break;case "%":f+=a.PercentSymbol}}return f};Sys.CultureInfo=function(c,b,a){this.name=c;this.numberFormat=b;this.dateTimeFormat=a};Sys.CultureInfo.prototype={_getDateTimeFormats:function(){if(!this._dateTimeFormats){var a=this.dateTimeFormat;this._dateTimeFormats=[a.MonthDayPattern,a.YearMonthPattern,a.ShortDatePattern,a.ShortTimePattern,a.LongDatePattern,a.LongTimePattern,a.FullDateTimePattern,a.RFC1123Pattern,a.SortableDateTimePattern,a.UniversalSortableDateTimePattern]}return this._dateTimeFormats},_getIndex:function(c,d,e){var b=this._toUpper(c),a=Array.indexOf(d,b);if(a===-1)a=Array.indexOf(e,b);return a},_getMonthIndex:function(a){if(!this._upperMonths){this._upperMonths=this._toUpperArray(this.dateTimeFormat.MonthNames);this._upperMonthsGenitive=this._toUpperArray(this.dateTimeFormat.MonthGenitiveNames)}return this._getIndex(a,this._upperMonths,this._upperMonthsGenitive)},_getAbbrMonthIndex:function(a){if(!this._upperAbbrMonths){this._upperAbbrMonths=this._toUpperArray(this.dateTimeFormat.AbbreviatedMonthNames);this._upperAbbrMonthsGenitive=this._toUpperArray(this.dateTimeFormat.AbbreviatedMonthGenitiveNames)}return this._getIndex(a,this._upperAbbrMonths,this._upperAbbrMonthsGenitive)},_getDayIndex:function(a){if(!this._upperDays)this._upperDays=this._toUpperArray(this.dateTimeFormat.DayNames);return Array.indexOf(this._upperDays,this._toUpper(a))},_getAbbrDayIndex:function(a){if(!this._upperAbbrDays)this._upperAbbrDays=this._toUpperArray(this.dateTimeFormat.AbbreviatedDayNames);return Array.indexOf(this._upperAbbrDays,this._toUpper(a))},_toUpperArray:function(c){var b=[];for(var a=0,d=c.length;a<d;a++)b[a]=this._toUpper(c[a]);return b},_toUpper:function(a){return a.split("\u00a0").join(" ").toUpperCase()}};Sys.CultureInfo.registerClass("Sys.CultureInfo");Sys.CultureInfo._parse=function(a){var b=a.dateTimeFormat;if(b&&!b.eras)b.eras=a.eras;return new Sys.CultureInfo(a.name,a.numberFormat,b)};Sys.CultureInfo.InvariantCulture=Sys.CultureInfo._parse({"name":"","numberFormat":{"CurrencyDecimalDigits":2,"CurrencyDecimalSeparator":".","IsReadOnly":true,"CurrencyGroupSizes":[3],"NumberGroupSizes":[3],"PercentGroupSizes":[3],"CurrencyGroupSeparator":",","CurrencySymbol":"\u00a4","NaNSymbol":"NaN","CurrencyNegativePattern":0,"NumberNegativePattern":1,"PercentPositivePattern":0,"PercentNegativePattern":0,"NegativeInfinitySymbol":"-Infinity","NegativeSign":"-","NumberDecimalDigits":2,"NumberDecimalSeparator":".","NumberGroupSeparator":",","CurrencyPositivePattern":0,"PositiveInfinitySymbol":"Infinity","PositiveSign":"+","PercentDecimalDigits":2,"PercentDecimalSeparator":".","PercentGroupSeparator":",","PercentSymbol":"%","PerMilleSymbol":"\u2030","NativeDigits":["0","1","2","3","4","5","6","7","8","9"],"DigitSubstitution":1},"dateTimeFormat":{"AMDesignator":"AM","Calendar":{"MinSupportedDateTime":"@-62135568000000@","MaxSupportedDateTime":"@253402300799999@","AlgorithmType":1,"CalendarType":1,"Eras":[1],"TwoDigitYearMax":2029,"IsReadOnly":true},"DateSeparator":"/","FirstDayOfWeek":0,"CalendarWeekRule":0,"FullDateTimePattern":"dddd, dd MMMM yyyy HH:mm:ss","LongDatePattern":"dddd, dd MMMM yyyy","LongTimePattern":"HH:mm:ss","MonthDayPattern":"MMMM dd","PMDesignator":"PM","RFC1123Pattern":"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'","ShortDatePattern":"MM/dd/yyyy","ShortTimePattern":"HH:mm","SortableDateTimePattern":"yyyy'-'MM'-'dd'T'HH':'mm':'ss","TimeSeparator":":","UniversalSortableDateTimePattern":"yyyy'-'MM'-'dd HH':'mm':'ss'Z'","YearMonthPattern":"yyyy MMMM","AbbreviatedDayNames":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"ShortestDayNames":["Su","Mo","Tu","We","Th","Fr","Sa"],"DayNames":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"AbbreviatedMonthNames":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],"MonthNames":["January","February","March","April","May","June","July","August","September","October","November","December",""],"IsReadOnly":true,"NativeCalendarName":"Gregorian Calendar","AbbreviatedMonthGenitiveNames":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],"MonthGenitiveNames":["January","February","March","April","May","June","July","August","September","October","November","December",""]},"eras":[1,"A.D.",null,0]});if(typeof __cultureInfo==="object"){Sys.CultureInfo.CurrentCulture=Sys.CultureInfo._parse(__cultureInfo);delete __cultureInfo}else Sys.CultureInfo.CurrentCulture=Sys.CultureInfo._parse({"name":"en-US","numberFormat":{"CurrencyDecimalDigits":2,"CurrencyDecimalSeparator":".","IsReadOnly":false,"CurrencyGroupSizes":[3],"NumberGroupSizes":[3],"PercentGroupSizes":[3],"CurrencyGroupSeparator":",","CurrencySymbol":"$","NaNSymbol":"NaN","CurrencyNegativePattern":0,"NumberNegativePattern":1,"PercentPositivePattern":0,"PercentNegativePattern":0,"NegativeInfinitySymbol":"-Infinity","NegativeSign":"-","NumberDecimalDigits":2,"NumberDecimalSeparator":".","NumberGroupSeparator":",","CurrencyPositivePattern":0,"PositiveInfinitySymbol":"Infinity","PositiveSign":"+","PercentDecimalDigits":2,"PercentDecimalSeparator":".","PercentGroupSeparator":",","PercentSymbol":"%","PerMilleSymbol":"\u2030","NativeDigits":["0","1","2","3","4","5","6","7","8","9"],"DigitSubstitution":1},"dateTimeFormat":{"AMDesignator":"AM","Calendar":{"MinSupportedDateTime":"@-62135568000000@","MaxSupportedDateTime":"@253402300799999@","AlgorithmType":1,"CalendarType":1,"Eras":[1],"TwoDigitYearMax":2029,"IsReadOnly":false},"DateSeparator":"/","FirstDayOfWeek":0,"CalendarWeekRule":0,"FullDateTimePattern":"dddd, MMMM dd, yyyy h:mm:ss tt","LongDatePattern":"dddd, MMMM dd, yyyy","LongTimePattern":"h:mm:ss tt","MonthDayPattern":"MMMM dd","PMDesignator":"PM","RFC1123Pattern":"ddd, dd MMM yyyy HH':'mm':'ss 'GMT'","ShortDatePattern":"M/d/yyyy","ShortTimePattern":"h:mm tt","SortableDateTimePattern":"yyyy'-'MM'-'dd'T'HH':'mm':'ss","TimeSeparator":":","UniversalSortableDateTimePattern":"yyyy'-'MM'-'dd HH':'mm':'ss'Z'","YearMonthPattern":"MMMM, yyyy","AbbreviatedDayNames":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"ShortestDayNames":["Su","Mo","Tu","We","Th","Fr","Sa"],"DayNames":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"AbbreviatedMonthNames":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],"MonthNames":["January","February","March","April","May","June","July","August","September","October","November","December",""],"IsReadOnly":false,"NativeCalendarName":"Gregorian Calendar","AbbreviatedMonthGenitiveNames":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],"MonthGenitiveNames":["January","February","March","April","May","June","July","August","September","October","November","December",""]},"eras":[1,"A.D.",null,0]});Type.registerNamespace("Sys.Serialization");Sys.Serialization.JavaScriptSerializer=function(){};Sys.Serialization.JavaScriptSerializer.registerClass("Sys.Serialization.JavaScriptSerializer");Sys.Serialization.JavaScriptSerializer._charsToEscapeRegExs=[];Sys.Serialization.JavaScriptSerializer._charsToEscape=[];Sys.Serialization.JavaScriptSerializer._dateRegEx=new RegExp('(^|[^\\\\])\\"\\\\/Date\\((-?[0-9]+)(?:[a-zA-Z]|(?:\\+|-)[0-9]{4})?\\)\\\\/\\"',"g");Sys.Serialization.JavaScriptSerializer._escapeChars={};Sys.Serialization.JavaScriptSerializer._escapeRegEx=new RegExp('["\\\\\\x00-\\x1F]',"i");Sys.Serialization.JavaScriptSerializer._escapeRegExGlobal=new RegExp('["\\\\\\x00-\\x1F]',"g");Sys.Serialization.JavaScriptSerializer._jsonRegEx=new RegExp("[^,:{}\\[\\]0-9.\\-+Eaeflnr-u \\n\\r\\t]","g");Sys.Serialization.JavaScriptSerializer._jsonStringRegEx=new RegExp('"(\\\\.|[^"\\\\])*"',"g");Sys.Serialization.JavaScriptSerializer._serverTypeFieldName="__type";Sys.Serialization.JavaScriptSerializer._init=function(){var c=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000b","\\f","\\r","\\u000e","\\u000f","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001a","\\u001b","\\u001c","\\u001d","\\u001e","\\u001f"];Sys.Serialization.JavaScriptSerializer._charsToEscape[0]="\\";Sys.Serialization.JavaScriptSerializer._charsToEscapeRegExs["\\"]=new RegExp("\\\\","g");Sys.Serialization.JavaScriptSerializer._escapeChars["\\"]="\\\\";Sys.Serialization.JavaScriptSerializer._charsToEscape[1]='"';Sys.Serialization.JavaScriptSerializer._charsToEscapeRegExs['"']=new RegExp('"',"g");Sys.Serialization.JavaScriptSerializer._escapeChars['"']='\\"';for(var a=0;a<32;a++){var b=String.fromCharCode(a);Sys.Serialization.JavaScriptSerializer._charsToEscape[a+2]=b;Sys.Serialization.JavaScriptSerializer._charsToEscapeRegExs[b]=new RegExp(b,"g");Sys.Serialization.JavaScriptSerializer._escapeChars[b]=c[a]}};Sys.Serialization.JavaScriptSerializer._serializeBooleanWithBuilder=function(b,a){a.append(b.toString())};Sys.Serialization.JavaScriptSerializer._serializeNumberWithBuilder=function(a,b){if(isFinite(a))b.append(String(a));else throw Error.invalidOperation(Sys.Res.cannotSerializeNonFiniteNumbers)};Sys.Serialization.JavaScriptSerializer._serializeStringWithBuilder=function(a,c){c.append('"');if(Sys.Serialization.JavaScriptSerializer._escapeRegEx.test(a)){if(Sys.Serialization.JavaScriptSerializer._charsToEscape.length===0)Sys.Serialization.JavaScriptSerializer._init();if(a.length<128)a=a.replace(Sys.Serialization.JavaScriptSerializer._escapeRegExGlobal,function(a){return Sys.Serialization.JavaScriptSerializer._escapeChars[a]});else for(var d=0;d<34;d++){var b=Sys.Serialization.JavaScriptSerializer._charsToEscape[d];if(a.indexOf(b)!==-1)if(Sys.Browser.agent===Sys.Browser.Opera||Sys.Browser.agent===Sys.Browser.FireFox)a=a.split(b).join(Sys.Serialization.JavaScriptSerializer._escapeChars[b]);else a=a.replace(Sys.Serialization.JavaScriptSerializer._charsToEscapeRegExs[b],Sys.Serialization.JavaScriptSerializer._escapeChars[b])}}c.append(a);c.append('"')};Sys.Serialization.JavaScriptSerializer._serializeWithBuilder=function(b,a,i,g){var c;switch(typeof b){case "object":if(b)if(Number.isInstanceOfType(b))Sys.Serialization.JavaScriptSerializer._serializeNumberWithBuilder(b,a);else if(Boolean.isInstanceOfType(b))Sys.Serialization.JavaScriptSerializer._serializeBooleanWithBuilder(b,a);else if(String.isInstanceOfType(b))Sys.Serialization.JavaScriptSerializer._serializeStringWithBuilder(b,a);else if(Array.isInstanceOfType(b)){a.append("[");for(c=0;c<b.length;++c){if(c>0)a.append(",");Sys.Serialization.JavaScriptSerializer._serializeWithBuilder(b[c],a,false,g)}a.append("]")}else{if(Date.isInstanceOfType(b)){a.append('"\\/Date(');a.append(b.getTime());a.append(')\\/"');break}var d=[],f=0;for(var e in b){if(e.startsWith("$"))continue;if(e===Sys.Serialization.JavaScriptSerializer._serverTypeFieldName&&f!==0){d[f++]=d[0];d[0]=e}else d[f++]=e}if(i)d.sort();a.append("{");var j=false;for(c=0;c<f;c++){var h=b[d[c]];if(typeof h!=="undefined"&&typeof h!=="function"){if(j)a.append(",");else j=true;Sys.Serialization.JavaScriptSerializer._serializeWithBuilder(d[c],a,i,g);a.append(":");Sys.Serialization.JavaScriptSerializer._serializeWithBuilder(h,a,i,g)}}a.append("}")}else a.append("null");break;case "number":Sys.Serialization.JavaScriptSerializer._serializeNumberWithBuilder(b,a);break;case "string":Sys.Serialization.JavaScriptSerializer._serializeStringWithBuilder(b,a);break;case "boolean":Sys.Serialization.JavaScriptSerializer._serializeBooleanWithBuilder(b,a);break;default:a.append("null")}};Sys.Serialization.JavaScriptSerializer.serialize=function(b){var a=new Sys.StringBuilder;Sys.Serialization.JavaScriptSerializer._serializeWithBuilder(b,a,false);return a.toString()};Sys.Serialization.JavaScriptSerializer.deserialize=function(data,secure){if(data.length===0)throw Error.argument("data",Sys.Res.cannotDeserializeEmptyString);try{var exp=data.replace(Sys.Serialization.JavaScriptSerializer._dateRegEx,"$1new Date($2)");if(secure&&Sys.Serialization.JavaScriptSerializer._jsonRegEx.test(exp.replace(Sys.Serialization.JavaScriptSerializer._jsonStringRegEx,"")))throw null;return eval("("+exp+")")}catch(a){throw Error.argument("data",Sys.Res.cannotDeserializeInvalidJson)}};Type.registerNamespace("Sys.UI");Sys.EventHandlerList=function(){this._list={}};Sys.EventHandlerList.prototype={_addHandler:function(b,a){Array.add(this._getEvent(b,true),a)},addHandler:function(b,a){this._addHandler(b,a)},_removeHandler:function(c,b){var a=this._getEvent(c);if(!a)return;Array.remove(a,b)},removeHandler:function(b,a){this._removeHandler(b,a)},getHandler:function(b){var a=this._getEvent(b);if(!a||a.length===0)return null;a=Array.clone(a);return function(c,d){for(var b=0,e=a.length;b<e;b++)a[b](c,d)}},_getEvent:function(a,b){if(!this._list[a]){if(!b)return null;this._list[a]=[]}return this._list[a]}};Sys.EventHandlerList.registerClass("Sys.EventHandlerList");Sys.CommandEventArgs=function(c,a,b){Sys.CommandEventArgs.initializeBase(this);this._commandName=c;this._commandArgument=a;this._commandSource=b};Sys.CommandEventArgs.prototype={_commandName:null,_commandArgument:null,_commandSource:null,get_commandName:function(){return this._commandName},get_commandArgument:function(){return this._commandArgument},get_commandSource:function(){return this._commandSource}};Sys.CommandEventArgs.registerClass("Sys.CommandEventArgs",Sys.CancelEventArgs);Sys.INotifyPropertyChange=function(){};Sys.INotifyPropertyChange.prototype={};Sys.INotifyPropertyChange.registerInterface("Sys.INotifyPropertyChange");Sys.PropertyChangedEventArgs=function(a){Sys.PropertyChangedEventArgs.initializeBase(this);this._propertyName=a};Sys.PropertyChangedEventArgs.prototype={get_propertyName:function(){return this._propertyName}};Sys.PropertyChangedEventArgs.registerClass("Sys.PropertyChangedEventArgs",Sys.EventArgs);Sys.INotifyDisposing=function(){};Sys.INotifyDisposing.prototype={};Sys.INotifyDisposing.registerInterface("Sys.INotifyDisposing");Sys.Component=function(){if(Sys.Application)Sys.Application.registerDisposableObject(this)};Sys.Component.prototype={_id:null,_initialized:false,_updating:false,get_events:function(){if(!this._events)this._events=new Sys.EventHandlerList;return this._events},get_id:function(){return this._id},set_id:function(a){this._id=a},get_isInitialized:function(){return this._initialized},get_isUpdating:function(){return this._updating},add_disposing:function(a){this.get_events().addHandler("disposing",a)},remove_disposing:function(a){this.get_events().removeHandler("disposing",a)},add_propertyChanged:function(a){this.get_events().addHandler("propertyChanged",a)},remove_propertyChanged:function(a){this.get_events().removeHandler("propertyChanged",a)},beginUpdate:function(){this._updating=true},dispose:function(){if(this._events){var a=this._events.getHandler("disposing");if(a)a(this,Sys.EventArgs.Empty)}delete this._events;Sys.Application.unregisterDisposableObject(this);Sys.Application.removeComponent(this)},endUpdate:function(){this._updating=false;if(!this._initialized)this.initialize();this.updated()},initialize:function(){this._initialized=true},raisePropertyChanged:function(b){if(!this._events)return;var a=this._events.getHandler("propertyChanged");if(a)a(this,new Sys.PropertyChangedEventArgs(b))},updated:function(){}};Sys.Component.registerClass("Sys.Component",null,Sys.IDisposable,Sys.INotifyPropertyChange,Sys.INotifyDisposing);function Sys$Component$_setProperties(a,i){var d,j=Object.getType(a),e=j===Object||j===Sys.UI.DomElement,h=Sys.Component.isInstanceOfType(a)&&!a.get_isUpdating();if(h)a.beginUpdate();for(var c in i){var b=i[c],f=e?null:a["get_"+c];if(e||typeof f!=="function"){var k=a[c];if(!b||typeof b!=="object"||e&&!k)a[c]=b;else Sys$Component$_setProperties(k,b)}else{var l=a["set_"+c];if(typeof l==="function")l.apply(a,[b]);else if(b instanceof Array){d=f.apply(a);for(var g=0,m=d.length,n=b.length;g<n;g++,m++)d[m]=b[g]}else if(typeof b==="object"&&Object.getType(b)===Object){d=f.apply(a);Sys$Component$_setProperties(d,b)}}}if(h)a.endUpdate()}function Sys$Component$_setReferences(c,b){for(var a in b){var e=c["set_"+a],d=$find(b[a]);e.apply(c,[d])}}var $create=Sys.Component.create=function(h,f,d,c,g){var a=g?new h(g):new h,b=Sys.Application,i=b.get_isCreatingComponents();a.beginUpdate();if(f)Sys$Component$_setProperties(a,f);if(d)for(var e in d)a["add_"+e](d[e]);if(a.get_id())b.addComponent(a);if(i){b._createdComponents[b._createdComponents.length]=a;if(c)b._addComponentToSecondPass(a,c);else a.endUpdate()}else{if(c)Sys$Component$_setReferences(a,c);a.endUpdate()}return a};Sys.UI.MouseButton=function(){throw Error.notImplemented()};Sys.UI.MouseButton.prototype={leftButton:0,middleButton:1,rightButton:2};Sys.UI.MouseButton.registerEnum("Sys.UI.MouseButton");Sys.UI.Key=function(){throw Error.notImplemented()};Sys.UI.Key.prototype={backspace:8,tab:9,enter:13,esc:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,del:127};Sys.UI.Key.registerEnum("Sys.UI.Key");Sys.UI.Point=function(a,b){this.x=a;this.y=b};Sys.UI.Point.registerClass("Sys.UI.Point");Sys.UI.Bounds=function(c,d,b,a){this.x=c;this.y=d;this.height=a;this.width=b};Sys.UI.Bounds.registerClass("Sys.UI.Bounds");Sys.UI.DomEvent=function(e){var a=e,b=this.type=a.type.toLowerCase();this.rawEvent=a;this.altKey=a.altKey;if(typeof a.button!=="undefined")this.button=typeof a.which!=="undefined"?a.button:a.button===4?Sys.UI.MouseButton.middleButton:a.button===2?Sys.UI.MouseButton.rightButton:Sys.UI.MouseButton.leftButton;if(b==="keypress")this.charCode=a.charCode||a.keyCode;else if(a.keyCode&&a.keyCode===46)this.keyCode=127;else this.keyCode=a.keyCode;this.clientX=a.clientX;this.clientY=a.clientY;this.ctrlKey=a.ctrlKey;this.target=a.target?a.target:a.srcElement;if(!b.startsWith("key"))if(typeof a.offsetX!=="undefined"&&typeof a.offsetY!=="undefined"){this.offsetX=a.offsetX;this.offsetY=a.offsetY}else if(this.target&&this.target.nodeType!==3&&typeof a.clientX==="number"){var c=Sys.UI.DomElement.getLocation(this.target),d=Sys.UI.DomElement._getWindow(this.target);this.offsetX=(d.pageXOffset||0)+a.clientX-c.x;this.offsetY=(d.pageYOffset||0)+a.clientY-c.y}this.screenX=a.screenX;this.screenY=a.screenY;this.shiftKey=a.shiftKey};Sys.UI.DomEvent.prototype={preventDefault:function(){if(this.rawEvent.preventDefault)this.rawEvent.preventDefault();else if(window.event)this.rawEvent.returnValue=false},stopPropagation:function(){if(this.rawEvent.stopPropagation)this.rawEvent.stopPropagation();else if(window.event)this.rawEvent.cancelBubble=true}};Sys.UI.DomEvent.registerClass("Sys.UI.DomEvent");var $addHandler=Sys.UI.DomEvent.addHandler=function(a,d,e,g){if(!a._events)a._events={};var c=a._events[d];if(!c)a._events[d]=c=[];var b;if(a.addEventListener){b=function(b){return e.call(a,new Sys.UI.DomEvent(b))};a.addEventListener(d,b,false)}else if(a.attachEvent){b=function(){var b={};try{b=Sys.UI.DomElement._getWindow(a).event}catch(c){}return e.call(a,new Sys.UI.DomEvent(b))};a.attachEvent("on"+d,b)}c[c.length]={handler:e,browserHandler:b,autoRemove:g};if(g){var f=a.dispose;if(f!==Sys.UI.DomEvent._disposeHandlers){a.dispose=Sys.UI.DomEvent._disposeHandlers;if(typeof f!=="undefined")a._chainDispose=f}}},$addHandlers=Sys.UI.DomEvent.addHandlers=function(f,d,c,e){for(var b in d){var a=d[b];if(c)a=Function.createDelegate(c,a);$addHandler(f,b,a,e||false)}},$clearHandlers=Sys.UI.DomEvent.clearHandlers=function(a){Sys.UI.DomEvent._clearHandlers(a,false)};Sys.UI.DomEvent._clearHandlers=function(a,g){if(a._events){var e=a._events;for(var b in e){var d=e[b];for(var c=d.length-1;c>=0;c--){var f=d[c];if(!g||f.autoRemove)$removeHandler(a,b,f.handler)}}a._events=null}};Sys.UI.DomEvent._disposeHandlers=function(){Sys.UI.DomEvent._clearHandlers(this,true);var b=this._chainDispose,a=typeof b;if(a!=="undefined"){this.dispose=b;this._chainDispose=null;if(a==="function")this.dispose()}};var $removeHandler=Sys.UI.DomEvent.removeHandler=function(b,a,c){Sys.UI.DomEvent._removeHandler(b,a,c)};Sys.UI.DomEvent._removeHandler=function(a,e,f){var d=null,c=a._events[e];for(var b=0,g=c.length;b<g;b++)if(c[b].handler===f){d=c[b].browserHandler;break}if(a.removeEventListener)a.removeEventListener(e,d,false);else if(a.detachEvent)a.detachEvent("on"+e,d);c.splice(b,1)};Sys.UI.DomElement=function(){};Sys.UI.DomElement.registerClass("Sys.UI.DomElement");Sys.UI.DomElement.addCssClass=function(a,b){if(!Sys.UI.DomElement.containsCssClass(a,b))if(a.className==="")a.className=b;else a.className+=" "+b};Sys.UI.DomElement.containsCssClass=function(b,a){return Array.contains(b.className.split(" "),a)};Sys.UI.DomElement.getBounds=function(a){var b=Sys.UI.DomElement.getLocation(a);return new Sys.UI.Bounds(b.x,b.y,a.offsetWidth||0,a.offsetHeight||0)};var $get=Sys.UI.DomElement.getElementById=function(f,e){if(!e)return document.getElementById(f);if(e.getElementById)return e.getElementById(f);var c=[],d=e.childNodes;for(var b=0;b<d.length;b++){var a=d[b];if(a.nodeType==1)c[c.length]=a}while(c.length){a=c.shift();if(a.id==f)return a;d=a.childNodes;for(b=0;b<d.length;b++){a=d[b];if(a.nodeType==1)c[c.length]=a}}return null};if(document.documentElement.getBoundingClientRect)Sys.UI.DomElement.getLocation=function(b){if(b.self||b.nodeType===9||b===document.documentElement||b.parentNode===b.ownerDocument.documentElement)return new Sys.UI.Point(0,0);var f=b.getBoundingClientRect();if(!f)return new Sys.UI.Point(0,0);var k,e=b.ownerDocument.documentElement,c=Math.round(f.left)+e.scrollLeft,d=Math.round(f.top)+e.scrollTop;if(Sys.Browser.agent===Sys.Browser.InternetExplorer){try{var g=b.ownerDocument.parentWindow.frameElement||null;if(g){var h=g.frameBorder==="0"||g.frameBorder==="no"?2:0;c+=h;d+=h}}catch(l){}if(Sys.Browser.version===7&&!document.documentMode){var i=document.body,j=i.getBoundingClientRect(),a=(j.right-j.left)/i.clientWidth;a=Math.round(a*100);a=(a-a%5)/100;if(!isNaN(a)&&a!==1){c=Math.round(c/a);d=Math.round(d/a)}}if((document.documentMode||0)<8){c-=e.clientLeft;d-=e.clientTop}}return new Sys.UI.Point(c,d)};else if(Sys.Browser.agent===Sys.Browser.Safari)Sys.UI.DomElement.getLocation=function(c){if(c.window&&c.window===c||c.nodeType===9)return new Sys.UI.Point(0,0);var d=0,e=0,a,j=null,g=null,b;for(a=c;a;j=a,(g=b,a=a.offsetParent)){b=Sys.UI.DomElement._getCurrentStyle(a);var f=a.tagName?a.tagName.toUpperCase():null;if((a.offsetLeft||a.offsetTop)&&(f!=="BODY"||(!g||g.position!=="absolute"))){d+=a.offsetLeft;e+=a.offsetTop}if(j&&Sys.Browser.version>=3){d+=parseInt(b.borderLeftWidth);e+=parseInt(b.borderTopWidth)}}b=Sys.UI.DomElement._getCurrentStyle(c);var h=b?b.position:null;if(!h||h!=="absolute")for(a=c.parentNode;a;a=a.parentNode){f=a.tagName?a.tagName.toUpperCase():null;if(f!=="BODY"&&f!=="HTML"&&(a.scrollLeft||a.scrollTop)){d-=a.scrollLeft||0;e-=a.scrollTop||0}b=Sys.UI.DomElement._getCurrentStyle(a);var i=b?b.position:null;if(i&&i==="absolute")break}return new Sys.UI.Point(d,e)};else Sys.UI.DomElement.getLocation=function(d){if(d.window&&d.window===d||d.nodeType===9)return new Sys.UI.Point(0,0);var e=0,f=0,a,i=null,g=null,b=null;for(a=d;a;i=a,(g=b,a=a.offsetParent)){var c=a.tagName?a.tagName.toUpperCase():null;b=Sys.UI.DomElement._getCurrentStyle(a);if((a.offsetLeft||a.offsetTop)&&!(c==="BODY"&&(!g||g.position!=="absolute"))){e+=a.offsetLeft;f+=a.offsetTop}if(i!==null&&b){if(c!=="TABLE"&&c!=="TD"&&c!=="HTML"){e+=parseInt(b.borderLeftWidth)||0;f+=parseInt(b.borderTopWidth)||0}if(c==="TABLE"&&(b.position==="relative"||b.position==="absolute")){e+=parseInt(b.marginLeft)||0;f+=parseInt(b.marginTop)||0}}}b=Sys.UI.DomElement._getCurrentStyle(d);var h=b?b.position:null;if(!h||h!=="absolute")for(a=d.parentNode;a;a=a.parentNode){c=a.tagName?a.tagName.toUpperCase():null;if(c!=="BODY"&&c!=="HTML"&&(a.scrollLeft||a.scrollTop)){e-=a.scrollLeft||0;f-=a.scrollTop||0;b=Sys.UI.DomElement._getCurrentStyle(a);if(b){e+=parseInt(b.borderLeftWidth)||0;f+=parseInt(b.borderTopWidth)||0}}}return new Sys.UI.Point(e,f)};Sys.UI.DomElement.isDomElement=function(a){return Sys._isDomElement(a)};Sys.UI.DomElement.removeCssClass=function(d,c){var a=" "+d.className+" ",b=a.indexOf(" "+c+" ");if(b>=0)d.className=(a.substr(0,b)+" "+a.substring(b+c.length+1,a.length)).trim()};Sys.UI.DomElement.resolveElement=function(b,c){var a=b;if(!a)return null;if(typeof a==="string")a=Sys.UI.DomElement.getElementById(a,c);return a};Sys.UI.DomElement.raiseBubbleEvent=function(c,d){var b=c;while(b){var a=b.control;if(a&&a.onBubbleEvent&&a.raiseBubbleEvent){Sys.UI.DomElement._raiseBubbleEventFromControl(a,c,d);return}b=b.parentNode}};Sys.UI.DomElement._raiseBubbleEventFromControl=function(a,b,c){if(!a.onBubbleEvent(b,c))a._raiseBubbleEvent(b,c)};Sys.UI.DomElement.setLocation=function(b,c,d){var a=b.style;a.position="absolute";a.left=c+"px";a.top=d+"px"};Sys.UI.DomElement.toggleCssClass=function(b,a){if(Sys.UI.DomElement.containsCssClass(b,a))Sys.UI.DomElement.removeCssClass(b,a);else Sys.UI.DomElement.addCssClass(b,a)};Sys.UI.DomElement.getVisibilityMode=function(a){return a._visibilityMode===Sys.UI.VisibilityMode.hide?Sys.UI.VisibilityMode.hide:Sys.UI.VisibilityMode.collapse};Sys.UI.DomElement.setVisibilityMode=function(a,b){Sys.UI.DomElement._ensureOldDisplayMode(a);if(a._visibilityMode!==b){a._visibilityMode=b;if(Sys.UI.DomElement.getVisible(a)===false)if(a._visibilityMode===Sys.UI.VisibilityMode.hide)a.style.display=a._oldDisplayMode;else a.style.display="none";a._visibilityMode=b}};Sys.UI.DomElement.getVisible=function(b){var a=b.currentStyle||Sys.UI.DomElement._getCurrentStyle(b);if(!a)return true;return a.visibility!=="hidden"&&a.display!=="none"};Sys.UI.DomElement.setVisible=function(a,b){if(b!==Sys.UI.DomElement.getVisible(a)){Sys.UI.DomElement._ensureOldDisplayMode(a);a.style.visibility=b?"visible":"hidden";if(b||a._visibilityMode===Sys.UI.VisibilityMode.hide)a.style.display=a._oldDisplayMode;else a.style.display="none"}};Sys.UI.DomElement._ensureOldDisplayMode=function(a){if(!a._oldDisplayMode){var b=a.currentStyle||Sys.UI.DomElement._getCurrentStyle(a);a._oldDisplayMode=b?b.display:null;if(!a._oldDisplayMode||a._oldDisplayMode==="none")switch(a.tagName.toUpperCase()){case "DIV":case "P":case "ADDRESS":case "BLOCKQUOTE":case "BODY":case "COL":case "COLGROUP":case "DD":case "DL":case "DT":case "FIELDSET":case "FORM":case "H1":case "H2":case "H3":case "H4":case "H5":case "H6":case "HR":case "IFRAME":case "LEGEND":case "OL":case "PRE":case "TABLE":case "TD":case "TH":case "TR":case "UL":a._oldDisplayMode="block";break;case "LI":a._oldDisplayMode="list-item";break;default:a._oldDisplayMode="inline"}}};Sys.UI.DomElement._getWindow=function(a){var b=a.ownerDocument||a.document||a;return b.defaultView||b.parentWindow};Sys.UI.DomElement._getCurrentStyle=function(a){if(a.nodeType===3)return null;var c=Sys.UI.DomElement._getWindow(a);if(a.documentElement)a=a.documentElement;var b=c&&a!==c&&c.getComputedStyle?c.getComputedStyle(a,null):a.currentStyle||a.style;if(!b&&Sys.Browser.agent===Sys.Browser.Safari&&a.style){var g=a.style.display,f=a.style.position;a.style.position="absolute";a.style.display="block";var e=c.getComputedStyle(a,null);a.style.display=g;a.style.position=f;b={};for(var d in e)b[d]=e[d];b.display="none"}return b};Sys.IContainer=function(){};Sys.IContainer.prototype={};Sys.IContainer.registerInterface("Sys.IContainer");Sys.ApplicationLoadEventArgs=function(b,a){Sys.ApplicationLoadEventArgs.initializeBase(this);this._components=b;this._isPartialLoad=a};Sys.ApplicationLoadEventArgs.prototype={get_components:function(){return this._components},get_isPartialLoad:function(){return this._isPartialLoad}};Sys.ApplicationLoadEventArgs.registerClass("Sys.ApplicationLoadEventArgs",Sys.EventArgs);Sys._Application=function(){Sys._Application.initializeBase(this);this._disposableObjects=[];this._components={};this._createdComponents=[];this._secondPassComponents=[];this._unloadHandlerDelegate=Function.createDelegate(this,this._unloadHandler);Sys.UI.DomEvent.addHandler(window,"unload",this._unloadHandlerDelegate);this._domReady()};Sys._Application.prototype={_creatingComponents:false,_disposing:false,_deleteCount:0,get_isCreatingComponents:function(){return this._creatingComponents},get_isDisposing:function(){return this._disposing},add_init:function(a){if(this._initialized)a(this,Sys.EventArgs.Empty);else this.get_events().addHandler("init",a)},remove_init:function(a){this.get_events().removeHandler("init",a)},add_load:function(a){this.get_events().addHandler("load",a)},remove_load:function(a){this.get_events().removeHandler("load",a)},add_unload:function(a){this.get_events().addHandler("unload",a)},remove_unload:function(a){this.get_events().removeHandler("unload",a)},addComponent:function(a){this._components[a.get_id()]=a},beginCreateComponents:function(){this._creatingComponents=true},dispose:function(){if(!this._disposing){this._disposing=true;if(this._timerCookie){window.clearTimeout(this._timerCookie);delete this._timerCookie}if(this._endRequestHandler){Sys.WebForms.PageRequestManager.getInstance().remove_endRequest(this._endRequestHandler);delete this._endRequestHandler}if(this._beginRequestHandler){Sys.WebForms.PageRequestManager.getInstance().remove_beginRequest(this._beginRequestHandler);delete this._beginRequestHandler}if(window.pageUnload)window.pageUnload(this,Sys.EventArgs.Empty);var c=this.get_events().getHandler("unload");if(c)c(this,Sys.EventArgs.Empty);var b=Array.clone(this._disposableObjects);for(var a=0,f=b.length;a<f;a++){var d=b[a];if(typeof d!=="undefined")d.dispose()}Array.clear(this._disposableObjects);Sys.UI.DomEvent.removeHandler(window,"unload",this._unloadHandlerDelegate);if(Sys._ScriptLoader){var e=Sys._ScriptLoader.getInstance();if(e)e.dispose()}Sys._Application.callBaseMethod(this,"dispose")}},disposeElement:function(c,j){if(c.nodeType===1){var b,h=c.getElementsByTagName("*"),g=h.length,i=new Array(g);for(b=0;b<g;b++)i[b]=h[b];for(b=g-1;b>=0;b--){var d=i[b],f=d.dispose;if(f&&typeof f==="function")d.dispose();else{var e=d.control;if(e&&typeof e.dispose==="function")e.dispose()}var a=d._behaviors;if(a)this._disposeComponents(a);a=d._components;if(a){this._disposeComponents(a);d._components=null}}if(!j){var f=c.dispose;if(f&&typeof f==="function")c.dispose();else{var e=c.control;if(e&&typeof e.dispose==="function")e.dispose()}var a=c._behaviors;if(a)this._disposeComponents(a);a=c._components;if(a){this._disposeComponents(a);c._components=null}}}},endCreateComponents:function(){var b=this._secondPassComponents;for(var a=0,d=b.length;a<d;a++){var c=b[a].component;Sys$Component$_setReferences(c,b[a].references);c.endUpdate()}this._secondPassComponents=[];this._creatingComponents=false},findComponent:function(b,a){return a?Sys.IContainer.isInstanceOfType(a)?a.findComponent(b):a[b]||null:Sys.Application._components[b]||null},getComponents:function(){var a=[],b=this._components;for(var c in b)a[a.length]=b[c];return a},initialize:function(){if(!this.get_isInitialized()&&!this._disposing){Sys._Application.callBaseMethod(this,"initialize");this._raiseInit();if(this.get_stateString){if(Sys.WebForms&&Sys.WebForms.PageRequestManager){this._beginRequestHandler=Function.createDelegate(this,this._onPageRequestManagerBeginRequest);Sys.WebForms.PageRequestManager.getInstance().add_beginRequest(this._beginRequestHandler);this._endRequestHandler=Function.createDelegate(this,this._onPageRequestManagerEndRequest);Sys.WebForms.PageRequestManager.getInstance().add_endRequest(this._endRequestHandler)}var a=this.get_stateString();if(a!==this._currentEntry)this._navigate(a);else this._ensureHistory()}this.raiseLoad()}},notifyScriptLoaded:function(){},registerDisposableObject:function(b){if(!this._disposing){var a=this._disposableObjects,c=a.length;a[c]=b;b.__msdisposeindex=c}},raiseLoad:function(){var b=this.get_events().getHandler("load"),a=new Sys.ApplicationLoadEventArgs(Array.clone(this._createdComponents),!!this._loaded);this._loaded=true;if(b)b(this,a);if(window.pageLoad)window.pageLoad(this,a);this._createdComponents=[]},removeComponent:function(b){var a=b.get_id();if(a)delete this._components[a]},unregisterDisposableObject:function(a){if(!this._disposing){var e=a.__msdisposeindex;if(typeof e==="number"){var b=this._disposableObjects;delete b[e];delete a.__msdisposeindex;if(++this._deleteCount>1000){var c=[];for(var d=0,f=b.length;d<f;d++){a=b[d];if(typeof a!=="undefined"){a.__msdisposeindex=c.length;c.push(a)}}this._disposableObjects=c;this._deleteCount=0}}}},_addComponentToSecondPass:function(b,a){this._secondPassComponents[this._secondPassComponents.length]={component:b,references:a}},_disposeComponents:function(a){if(a)for(var b=a.length-1;b>=0;b--){var c=a[b];if(typeof c.dispose==="function")c.dispose()}},_domReady:function(){var a,g,f=this;function b(){f.initialize()}var c=function(){Sys.UI.DomEvent.removeHandler(window,"load",c);b()};Sys.UI.DomEvent.addHandler(window,"load",c);if(document.addEventListener)try{document.addEventListener("DOMContentLoaded",a=function(){document.removeEventListener("DOMContentLoaded",a,false);b()},false)}catch(h){}else if(document.attachEvent)if(window==window.top&&document.documentElement.doScroll){var e,d=document.createElement("div");a=function(){try{d.doScroll("left")}catch(c){e=window.setTimeout(a,0);return}d=null;b()};a()}else document.attachEvent("onreadystatechange",a=function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",a);b()}})},_raiseInit:function(){var a=this.get_events().getHandler("init");if(a){this.beginCreateComponents();a(this,Sys.EventArgs.Empty);this.endCreateComponents()}},_unloadHandler:function(){this.dispose()}};Sys._Application.registerClass("Sys._Application",Sys.Component,Sys.IContainer);Sys.Application=new Sys._Application;var $find=Sys.Application.findComponent;Sys.UI.Behavior=function(b){Sys.UI.Behavior.initializeBase(this);this._element=b;var a=b._behaviors;if(!a)b._behaviors=[this];else a[a.length]=this};Sys.UI.Behavior.prototype={_name:null,get_element:function(){return this._element},get_id:function(){var a=Sys.UI.Behavior.callBaseMethod(this,"get_id");if(a)return a;if(!this._element||!this._element.id)return "";return this._element.id+"$"+this.get_name()},get_name:function(){if(this._name)return this._name;var a=Object.getTypeName(this),b=a.lastIndexOf(".");if(b!==-1)a=a.substr(b+1);if(!this.get_isInitialized())this._name=a;return a},set_name:function(a){this._name=a},initialize:function(){Sys.UI.Behavior.callBaseMethod(this,"initialize");var a=this.get_name();if(a)this._element[a]=this},dispose:function(){Sys.UI.Behavior.callBaseMethod(this,"dispose");var a=this._element;if(a){var c=this.get_name();if(c)a[c]=null;var b=a._behaviors;Array.remove(b,this);if(b.length===0)a._behaviors=null;delete this._element}}};Sys.UI.Behavior.registerClass("Sys.UI.Behavior",Sys.Component);Sys.UI.Behavior.getBehaviorByName=function(b,c){var a=b[c];return a&&Sys.UI.Behavior.isInstanceOfType(a)?a:null};Sys.UI.Behavior.getBehaviors=function(a){if(!a._behaviors)return [];return Array.clone(a._behaviors)};Sys.UI.Behavior.getBehaviorsByType=function(d,e){var a=d._behaviors,c=[];if(a)for(var b=0,f=a.length;b<f;b++)if(e.isInstanceOfType(a[b]))c[c.length]=a[b];return c};Sys.UI.VisibilityMode=function(){throw Error.notImplemented()};Sys.UI.VisibilityMode.prototype={hide:0,collapse:1};Sys.UI.VisibilityMode.registerEnum("Sys.UI.VisibilityMode");Sys.UI.Control=function(a){Sys.UI.Control.initializeBase(this);this._element=a;a.control=this;var b=this.get_role();if(b)a.setAttribute("role",b)};Sys.UI.Control.prototype={_parent:null,_visibilityMode:Sys.UI.VisibilityMode.hide,get_element:function(){return this._element},get_id:function(){if(!this._element)return "";return this._element.id},set_id:function(){throw Error.invalidOperation(Sys.Res.cantSetId)},get_parent:function(){if(this._parent)return this._parent;if(!this._element)return null;var a=this._element.parentNode;while(a){if(a.control)return a.control;a=a.parentNode}return null},set_parent:function(a){this._parent=a},get_role:function(){return null},get_visibilityMode:function(){return Sys.UI.DomElement.getVisibilityMode(this._element)},set_visibilityMode:function(a){Sys.UI.DomElement.setVisibilityMode(this._element,a)},get_visible:function(){return Sys.UI.DomElement.getVisible(this._element)},set_visible:function(a){Sys.UI.DomElement.setVisible(this._element,a)},addCssClass:function(a){Sys.UI.DomElement.addCssClass(this._element,a)},dispose:function(){Sys.UI.Control.callBaseMethod(this,"dispose");if(this._element){this._element.control=null;delete this._element}if(this._parent)delete this._parent},onBubbleEvent:function(){return false},raiseBubbleEvent:function(a,b){this._raiseBubbleEvent(a,b)},_raiseBubbleEvent:function(b,c){var a=this.get_parent();while(a){if(a.onBubbleEvent(b,c))return;a=a.get_parent()}},removeCssClass:function(a){Sys.UI.DomElement.removeCssClass(this._element,a)},toggleCssClass:function(a){Sys.UI.DomElement.toggleCssClass(this._element,a)}};Sys.UI.Control.registerClass("Sys.UI.Control",Sys.Component);Sys.HistoryEventArgs=function(a){Sys.HistoryEventArgs.initializeBase(this);this._state=a};Sys.HistoryEventArgs.prototype={get_state:function(){return this._state}};Sys.HistoryEventArgs.registerClass("Sys.HistoryEventArgs",Sys.EventArgs);Sys.Application._appLoadHandler=null;Sys.Application._beginRequestHandler=null;Sys.Application._clientId=null;Sys.Application._currentEntry="";Sys.Application._endRequestHandler=null;Sys.Application._history=null;Sys.Application._enableHistory=false;Sys.Application._historyFrame=null;Sys.Application._historyInitialized=false;Sys.Application._historyPointIsNew=false;Sys.Application._ignoreTimer=false;Sys.Application._initialState=null;Sys.Application._state={};Sys.Application._timerCookie=0;Sys.Application._timerHandler=null;Sys.Application._uniqueId=null;Sys._Application.prototype.get_stateString=function(){var a=null;if(Sys.Browser.agent===Sys.Browser.Firefox){var c=window.location.href,b=c.indexOf("#");if(b!==-1)a=c.substring(b+1);else a="";return a}else a=window.location.hash;if(a.length>0&&a.charAt(0)==="#")a=a.substring(1);return a};Sys._Application.prototype.get_enableHistory=function(){return this._enableHistory};Sys._Application.prototype.set_enableHistory=function(a){this._enableHistory=a};Sys._Application.prototype.add_navigate=function(a){this.get_events().addHandler("navigate",a)};Sys._Application.prototype.remove_navigate=function(a){this.get_events().removeHandler("navigate",a)};Sys._Application.prototype.addHistoryPoint=function(c,f){this._ensureHistory();var b=this._state;for(var a in c){var d=c[a];if(d===null){if(typeof b[a]!=="undefined")delete b[a]}else b[a]=d}var e=this._serializeState(b);this._historyPointIsNew=true;this._setState(e,f);this._raiseNavigate()};Sys._Application.prototype.setServerId=function(a,b){this._clientId=a;this._uniqueId=b};Sys._Application.prototype.setServerState=function(a){this._ensureHistory();this._state.__s=a;this._updateHiddenField(a)};Sys._Application.prototype._deserializeState=function(a){var e={};a=a||"";var b=a.indexOf("&&");if(b!==-1&&b+2<a.length){e.__s=a.substr(b+2);a=a.substr(0,b)}var g=a.split("&");for(var f=0,j=g.length;f<j;f++){var d=g[f],c=d.indexOf("=");if(c!==-1&&c+1<d.length){var i=d.substr(0,c),h=d.substr(c+1);e[i]=decodeURIComponent(h)}}return e};Sys._Application.prototype._enableHistoryInScriptManager=function(){this._enableHistory=true};Sys._Application.prototype._ensureHistory=function(){if(!this._historyInitialized&&this._enableHistory){if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&Sys.Browser.documentMode<8){this._historyFrame=document.getElementById("__historyFrame");this._ignoreIFrame=true}this._timerHandler=Function.createDelegate(this,this._onIdle);this._timerCookie=window.setTimeout(this._timerHandler,100);try{this._initialState=this._deserializeState(this.get_stateString())}catch(a){}this._historyInitialized=true}};Sys._Application.prototype._navigate=function(c){this._ensureHistory();var b=this._deserializeState(c);if(this._uniqueId){var d=this._state.__s||"",a=b.__s||"";if(a!==d){this._updateHiddenField(a);__doPostBack(this._uniqueId,a);this._state=b;return}}this._setState(c);this._state=b;this._raiseNavigate()};Sys._Application.prototype._onIdle=function(){delete this._timerCookie;var a=this.get_stateString();if(a!==this._currentEntry){if(!this._ignoreTimer){this._historyPointIsNew=false;this._navigate(a)}}else this._ignoreTimer=false;this._timerCookie=window.setTimeout(this._timerHandler,100)};Sys._Application.prototype._onIFrameLoad=function(a){this._ensureHistory();if(!this._ignoreIFrame){this._historyPointIsNew=false;this._navigate(a)}this._ignoreIFrame=false};Sys._Application.prototype._onPageRequestManagerBeginRequest=function(){this._ignoreTimer=true;this._originalTitle=document.title};Sys._Application.prototype._onPageRequestManagerEndRequest=function(g,f){var d=f.get_dataItems()[this._clientId],c=this._originalTitle;this._originalTitle=null;var b=document.getElementById("__EVENTTARGET");if(b&&b.value===this._uniqueId)b.value="";if(typeof d!=="undefined"){this.setServerState(d);this._historyPointIsNew=true}else this._ignoreTimer=false;var a=this._serializeState(this._state);if(a!==this._currentEntry){this._ignoreTimer=true;if(typeof c==="string"){if(Sys.Browser.agent!==Sys.Browser.InternetExplorer||Sys.Browser.version>7){var e=document.title;document.title=c;this._setState(a);document.title=e}else this._setState(a);this._raiseNavigate()}else{this._setState(a);this._raiseNavigate()}}};Sys._Application.prototype._raiseNavigate=function(){var d=this._historyPointIsNew,c=this.get_events().getHandler("navigate"),b={};for(var a in this._state)if(a!=="__s")b[a]=this._state[a];var e=new Sys.HistoryEventArgs(b);if(c)c(this,e);if(!d){var f;try{if(Sys.Browser.agent===Sys.Browser.Firefox&&window.location.hash&&(!window.frameElement||window.top.location.hash))Sys.Browser.version<3.5?window.history.go(0):(location.hash=this.get_stateString())}catch(g){}}};Sys._Application.prototype._serializeState=function(d){var b=[];for(var a in d){var e=d[a];if(a==="__s")var c=e;else b[b.length]=a+"="+encodeURIComponent(e)}return b.join("&")+(c?"&&"+c:"")};Sys._Application.prototype._setState=function(a,b){if(this._enableHistory){a=a||"";if(a!==this._currentEntry){if(window.theForm){var d=window.theForm.action,e=d.indexOf("#");window.theForm.action=(e!==-1?d.substring(0,e):d)+"#"+a}if(this._historyFrame&&this._historyPointIsNew){this._ignoreIFrame=true;var c=this._historyFrame.contentWindow.document;c.open("javascript:'<html></html>'");c.write("<html><head><title>"+(b||document.title)+"</title><scri"+'pt type="text/javascript">parent.Sys.Application._onIFrameLoad('+Sys.Serialization.JavaScriptSerializer.serialize(a)+");</scri"+"pt></head><body></bo"+"dy></html>");c.close()}this._ignoreTimer=false;this._currentEntry=a;if(this._historyFrame||this._historyPointIsNew){var f=this.get_stateString();if(a!==f){window.location.hash=a;this._currentEntry=this.get_stateString();if(typeof b!=="undefined"&&b!==null)document.title=b}}this._historyPointIsNew=false}}};Sys._Application.prototype._updateHiddenField=function(b){if(this._clientId){var a=document.getElementById(this._clientId);if(a)a.value=b}};if(!window.XMLHttpRequest)window.XMLHttpRequest=function(){var b=["Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP"];for(var a=0,c=b.length;a<c;a++)try{return new ActiveXObject(b[a])}catch(d){}return null};Type.registerNamespace("Sys.Net");Sys.Net.WebRequestExecutor=function(){this._webRequest=null;this._resultObject=null};Sys.Net.WebRequestExecutor.prototype={get_webRequest:function(){return this._webRequest},_set_webRequest:function(a){this._webRequest=a},get_started:function(){throw Error.notImplemented()},get_responseAvailable:function(){throw Error.notImplemented()},get_timedOut:function(){throw Error.notImplemented()},get_aborted:function(){throw Error.notImplemented()},get_responseData:function(){throw Error.notImplemented()},get_statusCode:function(){throw Error.notImplemented()},get_statusText:function(){throw Error.notImplemented()},get_xml:function(){throw Error.notImplemented()},get_object:function(){if(!this._resultObject)this._resultObject=Sys.Serialization.JavaScriptSerializer.deserialize(this.get_responseData());return this._resultObject},executeRequest:function(){throw Error.notImplemented()},abort:function(){throw Error.notImplemented()},getResponseHeader:function(){throw Error.notImplemented()},getAllResponseHeaders:function(){throw Error.notImplemented()}};Sys.Net.WebRequestExecutor.registerClass("Sys.Net.WebRequestExecutor");Sys.Net.XMLDOM=function(d){if(!window.DOMParser){var c=["Msxml2.DOMDocument.3.0","Msxml2.DOMDocument"];for(var b=0,f=c.length;b<f;b++)try{var a=new ActiveXObject(c[b]);a.async=false;a.loadXML(d);a.setProperty("SelectionLanguage","XPath");return a}catch(g){}}else try{var e=new window.DOMParser;return e.parseFromString(d,"text/xml")}catch(g){}return null};Sys.Net.XMLHttpExecutor=function(){Sys.Net.XMLHttpExecutor.initializeBase(this);var a=this;this._xmlHttpRequest=null;this._webRequest=null;this._responseAvailable=false;this._timedOut=false;this._timer=null;this._aborted=false;this._started=false;this._onReadyStateChange=function(){if(a._xmlHttpRequest.readyState===4){try{if(typeof a._xmlHttpRequest.status==="undefined")return}catch(b){return}a._clearTimer();a._responseAvailable=true;try{a._webRequest.completed(Sys.EventArgs.Empty)}finally{if(a._xmlHttpRequest!=null){a._xmlHttpRequest.onreadystatechange=Function.emptyMethod;a._xmlHttpRequest=null}}}};this._clearTimer=function(){if(a._timer!=null){window.clearTimeout(a._timer);a._timer=null}};this._onTimeout=function(){if(!a._responseAvailable){a._clearTimer();a._timedOut=true;a._xmlHttpRequest.onreadystatechange=Function.emptyMethod;a._xmlHttpRequest.abort();a._webRequest.completed(Sys.EventArgs.Empty);a._xmlHttpRequest=null}}};Sys.Net.XMLHttpExecutor.prototype={get_timedOut:function(){return this._timedOut},get_started:function(){return this._started},get_responseAvailable:function(){return this._responseAvailable},get_aborted:function(){return this._aborted},executeRequest:function(){this._webRequest=this.get_webRequest();var c=this._webRequest.get_body(),a=this._webRequest.get_headers();this._xmlHttpRequest=new XMLHttpRequest;this._xmlHttpRequest.onreadystatechange=this._onReadyStateChange;var e=this._webRequest.get_httpVerb();this._xmlHttpRequest.open(e,this._webRequest.getResolvedUrl(),true);this._xmlHttpRequest.setRequestHeader("X-Requested-With","XMLHttpRequest");if(a)for(var b in a){var f=a[b];if(typeof f!=="function")this._xmlHttpRequest.setRequestHeader(b,f)}if(e.toLowerCase()==="post"){if(a===null||!a["Content-Type"])this._xmlHttpRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");if(!c)c=""}var d=this._webRequest.get_timeout();if(d>0)this._timer=window.setTimeout(Function.createDelegate(this,this._onTimeout),d);this._xmlHttpRequest.send(c);this._started=true},getResponseHeader:function(b){var a;try{a=this._xmlHttpRequest.getResponseHeader(b)}catch(c){}if(!a)a="";return a},getAllResponseHeaders:function(){return this._xmlHttpRequest.getAllResponseHeaders()},get_responseData:function(){return this._xmlHttpRequest.responseText},get_statusCode:function(){var a=0;try{a=this._xmlHttpRequest.status}catch(b){}return a},get_statusText:function(){return this._xmlHttpRequest.statusText},get_xml:function(){var a=this._xmlHttpRequest.responseXML;if(!a||!a.documentElement){a=Sys.Net.XMLDOM(this._xmlHttpRequest.responseText);if(!a||!a.documentElement)return null}else if(navigator.userAgent.indexOf("MSIE")!==-1)a.setProperty("SelectionLanguage","XPath");if(a.documentElement.namespaceURI==="http://www.mozilla.org/newlayout/xml/parsererror.xml"&&a.documentElement.tagName==="parsererror")return null;if(a.documentElement.firstChild&&a.documentElement.firstChild.tagName==="parsererror")return null;return a},abort:function(){if(this._aborted||this._responseAvailable||this._timedOut)return;this._aborted=true;this._clearTimer();if(this._xmlHttpRequest&&!this._responseAvailable){this._xmlHttpRequest.onreadystatechange=Function.emptyMethod;this._xmlHttpRequest.abort();this._xmlHttpRequest=null;this._webRequest.completed(Sys.EventArgs.Empty)}}};Sys.Net.XMLHttpExecutor.registerClass("Sys.Net.XMLHttpExecutor",Sys.Net.WebRequestExecutor);Sys.Net._WebRequestManager=function(){this._defaultTimeout=0;this._defaultExecutorType="Sys.Net.XMLHttpExecutor"};Sys.Net._WebRequestManager.prototype={add_invokingRequest:function(a){this._get_eventHandlerList().addHandler("invokingRequest",a)},remove_invokingRequest:function(a){this._get_eventHandlerList().removeHandler("invokingRequest",a)},add_completedRequest:function(a){this._get_eventHandlerList().addHandler("completedRequest",a)},remove_completedRequest:function(a){this._get_eventHandlerList().removeHandler("completedRequest",a)},_get_eventHandlerList:function(){if(!this._events)this._events=new Sys.EventHandlerList;return this._events},get_defaultTimeout:function(){return this._defaultTimeout},set_defaultTimeout:function(a){this._defaultTimeout=a},get_defaultExecutorType:function(){return this._defaultExecutorType},set_defaultExecutorType:function(a){this._defaultExecutorType=a},executeRequest:function(webRequest){var executor=webRequest.get_executor();if(!executor){var failed=false;try{var executorType=eval(this._defaultExecutorType);executor=new executorType}catch(a){failed=true}webRequest.set_executor(executor)}if(executor.get_aborted())return;var evArgs=new Sys.Net.NetworkRequestEventArgs(webRequest),handler=this._get_eventHandlerList().getHandler("invokingRequest");if(handler)handler(this,evArgs);if(!evArgs.get_cancel())executor.executeRequest()}};Sys.Net._WebRequestManager.registerClass("Sys.Net._WebRequestManager");Sys.Net.WebRequestManager=new Sys.Net._WebRequestManager;Sys.Net.NetworkRequestEventArgs=function(a){Sys.Net.NetworkRequestEventArgs.initializeBase(this);this._webRequest=a};Sys.Net.NetworkRequestEventArgs.prototype={get_webRequest:function(){return this._webRequest}};Sys.Net.NetworkRequestEventArgs.registerClass("Sys.Net.NetworkRequestEventArgs",Sys.CancelEventArgs);Sys.Net.WebRequest=function(){this._url="";this._headers={};this._body=null;this._userContext=null;this._httpVerb=null;this._executor=null;this._invokeCalled=false;this._timeout=0};Sys.Net.WebRequest.prototype={add_completed:function(a){this._get_eventHandlerList().addHandler("completed",a)},remove_completed:function(a){this._get_eventHandlerList().removeHandler("completed",a)},completed:function(b){var a=Sys.Net.WebRequestManager._get_eventHandlerList().getHandler("completedRequest");if(a)a(this._executor,b);a=this._get_eventHandlerList().getHandler("completed");if(a)a(this._executor,b)},_get_eventHandlerList:function(){if(!this._events)this._events=new Sys.EventHandlerList;return this._events},get_url:function(){return this._url},set_url:function(a){this._url=a},get_headers:function(){return this._headers},get_httpVerb:function(){if(this._httpVerb===null){if(this._body===null)return "GET";return "POST"}return this._httpVerb},set_httpVerb:function(a){this._httpVerb=a},get_body:function(){return this._body},set_body:function(a){this._body=a},get_userContext:function(){return this._userContext},set_userContext:function(a){this._userContext=a},get_executor:function(){return this._executor},set_executor:function(a){this._executor=a;this._executor._set_webRequest(this)},get_timeout:function(){if(this._timeout===0)return Sys.Net.WebRequestManager.get_defaultTimeout();return this._timeout},set_timeout:function(a){this._timeout=a},getResolvedUrl:function(){return Sys.Net.WebRequest._resolveUrl(this._url)},invoke:function(){Sys.Net.WebRequestManager.executeRequest(this);this._invokeCalled=true}};Sys.Net.WebRequest._resolveUrl=function(b,a){if(b&&b.indexOf("://")!==-1)return b;if(!a||a.length===0){var d=document.getElementsByTagName("base")[0];if(d&&d.href&&d.href.length>0)a=d.href;else a=document.URL}var c=a.indexOf("?");if(c!==-1)a=a.substr(0,c);c=a.indexOf("#");if(c!==-1)a=a.substr(0,c);a=a.substr(0,a.lastIndexOf("/")+1);if(!b||b.length===0)return a;if(b.charAt(0)==="/"){var e=a.indexOf("://"),g=a.indexOf("/",e+3);return a.substr(0,g)+b}else{var f=a.lastIndexOf("/");return a.substr(0,f+1)+b}};Sys.Net.WebRequest._createQueryString=function(c,b,f){b=b||encodeURIComponent;var h=0,e,g,d,a=new Sys.StringBuilder;if(c)for(d in c){e=c[d];if(typeof e==="function")continue;g=Sys.Serialization.JavaScriptSerializer.serialize(e);if(h++)a.append("&");a.append(d);a.append("=");a.append(b(g))}if(f){if(h)a.append("&");a.append(f)}return a.toString()};Sys.Net.WebRequest._createUrl=function(a,b,c){if(!b&&!c)return a;var d=Sys.Net.WebRequest._createQueryString(b,null,c);return d.length?a+(a&&a.indexOf("?")>=0?"&":"?")+d:a};Sys.Net.WebRequest.registerClass("Sys.Net.WebRequest");Sys._ScriptLoaderTask=function(b,a){this._scriptElement=b;this._completedCallback=a};Sys._ScriptLoaderTask.prototype={get_scriptElement:function(){return this._scriptElement},dispose:function(){if(this._disposed)return;this._disposed=true;this._removeScriptElementHandlers();Sys._ScriptLoaderTask._clearScript(this._scriptElement);this._scriptElement=null},execute:function(){this._addScriptElementHandlers();document.getElementsByTagName("head")[0].appendChild(this._scriptElement)},_addScriptElementHandlers:function(){this._scriptLoadDelegate=Function.createDelegate(this,this._scriptLoadHandler);if(Sys.Browser.agent!==Sys.Browser.InternetExplorer){this._scriptElement.readyState="loaded";$addHandler(this._scriptElement,"load",this._scriptLoadDelegate)}else $addHandler(this._scriptElement,"readystatechange",this._scriptLoadDelegate);if(this._scriptElement.addEventListener){this._scriptErrorDelegate=Function.createDelegate(this,this._scriptErrorHandler);this._scriptElement.addEventListener("error",this._scriptErrorDelegate,false)}},_removeScriptElementHandlers:function(){if(this._scriptLoadDelegate){var a=this.get_scriptElement();if(Sys.Browser.agent!==Sys.Browser.InternetExplorer)$removeHandler(a,"load",this._scriptLoadDelegate);else $removeHandler(a,"readystatechange",this._scriptLoadDelegate);if(this._scriptErrorDelegate){this._scriptElement.removeEventListener("error",this._scriptErrorDelegate,false);this._scriptErrorDelegate=null}this._scriptLoadDelegate=null}},_scriptErrorHandler:function(){if(this._disposed)return;this._completedCallback(this.get_scriptElement(),false)},_scriptLoadHandler:function(){if(this._disposed)return;var a=this.get_scriptElement();if(a.readyState!=="loaded"&&a.readyState!=="complete")return;this._completedCallback(a,true)}};Sys._ScriptLoaderTask.registerClass("Sys._ScriptLoaderTask",null,Sys.IDisposable);Sys._ScriptLoaderTask._clearScript=function(a){if(!Sys.Debug.isDebug)a.parentNode.removeChild(a)};Type.registerNamespace("Sys.Net");Sys.Net.WebServiceProxy=function(){};Sys.Net.WebServiceProxy.prototype={get_timeout:function(){return this._timeout||0},set_timeout:function(a){if(a<0)throw Error.argumentOutOfRange("value",a,Sys.Res.invalidTimeout);this._timeout=a},get_defaultUserContext:function(){return typeof this._userContext==="undefined"?null:this._userContext},set_defaultUserContext:function(a){this._userContext=a},get_defaultSucceededCallback:function(){return this._succeeded||null},set_defaultSucceededCallback:function(a){this._succeeded=a},get_defaultFailedCallback:function(){return this._failed||null},set_defaultFailedCallback:function(a){this._failed=a},get_enableJsonp:function(){return !!this._jsonp},set_enableJsonp:function(a){this._jsonp=a},get_path:function(){return this._path||null},set_path:function(a){this._path=a},get_jsonpCallbackParameter:function(){return this._callbackParameter||"callback"},set_jsonpCallbackParameter:function(a){this._callbackParameter=a},_invoke:function(d,e,g,f,c,b,a){c=c||this.get_defaultSucceededCallback();b=b||this.get_defaultFailedCallback();if(a===null||typeof a==="undefined")a=this.get_defaultUserContext();return Sys.Net.WebServiceProxy.invoke(d,e,g,f,c,b,a,this.get_timeout(),this.get_enableJsonp(),this.get_jsonpCallbackParameter())}};Sys.Net.WebServiceProxy.registerClass("Sys.Net.WebServiceProxy");Sys.Net.WebServiceProxy.invoke=function(q,a,m,l,j,b,g,e,w,p){var i=w!==false?Sys.Net.WebServiceProxy._xdomain.exec(q):null,c,n=i&&i.length===3&&(i[1]!==location.protocol||i[2]!==location.host);m=n||m;if(n){p=p||"callback";c="_jsonp"+Sys._jsonp++}if(!l)l={};var r=l;if(!m||!r)r={};var s,h,f=null,k,o=null,u=Sys.Net.WebRequest._createUrl(a?q+"/"+encodeURIComponent(a):q,r,n?p+"=Sys."+c:null);if(n){s=document.createElement("script");s.src=u;k=new Sys._ScriptLoaderTask(s,function(d,b){if(!b||c)t({Message:String.format(Sys.Res.webServiceFailedNoMsg,a)},-1)});function v(){if(f===null)return;f=null;h=new Sys.Net.WebServiceError(true,String.format(Sys.Res.webServiceTimedOut,a));k.dispose();delete Sys[c];if(b)b(h,g,a)}function t(d,e){if(f!==null){window.clearTimeout(f);f=null}k.dispose();delete Sys[c];c=null;if(typeof e!=="undefined"&&e!==200){if(b){h=new Sys.Net.WebServiceError(false,d.Message||String.format(Sys.Res.webServiceFailedNoMsg,a),d.StackTrace||null,d.ExceptionType||null,d);h._statusCode=e;b(h,g,a)}}else if(j)j(d,g,a)}Sys[c]=t;e=e||Sys.Net.WebRequestManager.get_defaultTimeout();if(e>0)f=window.setTimeout(v,e);k.execute();return null}var d=new Sys.Net.WebRequest;d.set_url(u);d.get_headers()["Content-Type"]="application/json; charset=utf-8";if(!m){o=Sys.Serialization.JavaScriptSerializer.serialize(l);if(o==="{}")o=""}d.set_body(o);d.add_completed(x);if(e&&e>0)d.set_timeout(e);d.invoke();function x(d){if(d.get_responseAvailable()){var f=d.get_statusCode(),c=null;try{var e=d.getResponseHeader("Content-Type");if(e.startsWith("application/json"))c=d.get_object();else if(e.startsWith("text/xml"))c=d.get_xml();else c=d.get_responseData()}catch(m){}var k=d.getResponseHeader("jsonerror"),h=k==="true";if(h){if(c)c=new Sys.Net.WebServiceError(false,c.Message,c.StackTrace,c.ExceptionType,c)}else if(e.startsWith("application/json"))c=!c||typeof c.d==="undefined"?c:c.d;if(f<200||f>=300||h){if(b){if(!c||!h)c=new Sys.Net.WebServiceError(false,String.format(Sys.Res.webServiceFailedNoMsg,a));c._statusCode=f;b(c,g,a)}}else if(j)j(c,g,a)}else{var i;if(d.get_timedOut())i=String.format(Sys.Res.webServiceTimedOut,a);else i=String.format(Sys.Res.webServiceFailedNoMsg,a);if(b)b(new Sys.Net.WebServiceError(d.get_timedOut(),i,"",""),g,a)}}return d};Sys.Net.WebServiceProxy._generateTypedConstructor=function(a){return function(b){if(b)for(var c in b)this[c]=b[c];this.__type=a}};Sys._jsonp=0;Sys.Net.WebServiceProxy._xdomain=/^\s*([a-zA-Z0-9\+\-\.]+\:)\/\/([^?#\/]+)/;Sys.Net.WebServiceError=function(d,e,c,a,b){this._timedOut=d;this._message=e;this._stackTrace=c;this._exceptionType=a;this._errorObject=b;this._statusCode=-1};Sys.Net.WebServiceError.prototype={get_timedOut:function(){return this._timedOut},get_statusCode:function(){return this._statusCode},get_message:function(){return this._message},get_stackTrace:function(){return this._stackTrace||""},get_exceptionType:function(){return this._exceptionType||""},get_errorObject:function(){return this._errorObject||null}};Sys.Net.WebServiceError.registerClass("Sys.Net.WebServiceError");
Type.registerNamespace('Sys');Sys.Res={'argumentInteger':'Value must be an integer.','invokeCalledTwice':'Cannot call invoke more than once.','webServiceFailed':'The server method \'{0}\' failed with the following error: {1}','argumentType':'Object cannot be converted to the required type.','argumentNull':'Value cannot be null.','scriptAlreadyLoaded':'The script \'{0}\' has been referenced multiple times. If referencing Microsoft AJAX scripts explicitly, set the MicrosoftAjaxMode property of the ScriptManager to Explicit.','scriptDependencyNotFound':'The script \'{0}\' failed to load because it is dependent on script \'{1}\'.','formatBadFormatSpecifier':'Format specifier was invalid.','requiredScriptReferenceNotIncluded':'\'{0}\' requires that you have included a script reference to \'{1}\'.','webServiceFailedNoMsg':'The server method \'{0}\' failed.','argumentDomElement':'Value must be a DOM element.','invalidExecutorType':'Could not create a valid Sys.Net.WebRequestExecutor from: {0}.','cannotCallBeforeResponse':'Cannot call {0} when responseAvailable is false.','actualValue':'Actual value was {0}.','enumInvalidValue':'\'{0}\' is not a valid value for enum {1}.','scriptLoadFailed':'The script \'{0}\' could not be loaded.','parameterCount':'Parameter count mismatch.','cannotDeserializeEmptyString':'Cannot deserialize empty string.','formatInvalidString':'Input string was not in a correct format.','invalidTimeout':'Value must be greater than or equal to zero.','cannotAbortBeforeStart':'Cannot abort when executor has not started.','argument':'Value does not fall within the expected range.','cannotDeserializeInvalidJson':'Cannot deserialize. The data does not correspond to valid JSON.','invalidHttpVerb':'httpVerb cannot be set to an empty or null string.','nullWebRequest':'Cannot call executeRequest with a null webRequest.','eventHandlerInvalid':'Handler was not added through the Sys.UI.DomEvent.addHandler method.','cannotSerializeNonFiniteNumbers':'Cannot serialize non finite numbers.','argumentUndefined':'Value cannot be undefined.','webServiceInvalidReturnType':'The server method \'{0}\' returned an invalid type. Expected type: {1}','servicePathNotSet':'The path to the web service has not been set.','argumentTypeWithTypes':'Object of type \'{0}\' cannot be converted to type \'{1}\'.','cannotCallOnceStarted':'Cannot call {0} once started.','badBaseUrl1':'Base URL does not contain ://.','badBaseUrl2':'Base URL does not contain another /.','badBaseUrl3':'Cannot find last / in base URL.','setExecutorAfterActive':'Cannot set executor after it has become active.','paramName':'Parameter name: {0}','nullReferenceInPath':'Null reference while evaluating data path: \'{0}\'.','cannotCallOutsideHandler':'Cannot call {0} outside of a completed event handler.','cannotSerializeObjectWithCycle':'Cannot serialize object with cyclic reference within child properties.','format':'One of the identified items was in an invalid format.','assertFailedCaller':'Assertion Failed: {0}\r\nat {1}','argumentOutOfRange':'Specified argument was out of the range of valid values.','webServiceTimedOut':'The server method \'{0}\' timed out.','notImplemented':'The method or operation is not implemented.','assertFailed':'Assertion Failed: {0}','invalidOperation':'Operation is not valid due to the current state of the object.','breakIntoDebugger':'{0}\r\n\r\nBreak into debugger?'};

		Mscrm.BusinessRules = {};
		Mscrm.BusinessRules.IErrorHandler = function () {
		};

		Mscrm.BusinessRules.JsErrorCodes = function () {
		};
		Mscrm.BusinessRules.Utility = function () {
		};
		Mscrm.BusinessRules.Utility.assign = function (obja, objb) {
			Object.keys(objb).forEach(function (k) {
				obja[k] = objb[k];
			});
		};
		Mscrm.BusinessRules.ErrorHandler = function (exception) {
			this.set_exception(exception)
		};
		Mscrm.BusinessRules.ErrorHandler.prototype = {
			_exception$p$0: null, get_exception: function () {
				return this._exception$p$0
			}, set_exception: function (value) {
				this._exception$p$0 = value;
				return value
			}
		};
		Mscrm.BusinessRules.ReportToWatsonErrorHandler = function (exception, caller) {
			Mscrm.BusinessRules.ErrorHandler.call(this, exception);
			this._caller$p$1 = caller
		};
		Mscrm.BusinessRules.ReportToWatsonErrorHandler.prototype = {
			handleError: function () {
				if (this._isBusinessRuleInDraftState$p$1(this._caller$p$1))
					return;
				var exceptionMessage = this.get_exception().message;
				var exceptionCode = this.get_exception().number || 0;
				Xrm.Internal.reportToWatson(exceptionMessage, "BusinessRuleScriptPage", 0, true, this._caller$p$1, exceptionCode, true)
			}, _isBusinessRuleInDraftState$p$1: function (exceptionCaller) {
				return !Mscrm.BusinessRules.Utility.isNull(Mscrm.BusinessRulesScript) && Mscrm.BusinessRulesScript.DraftRuleMethods.indexOf(exceptionCaller) >= 0
			}, _caller$p$1: null
		};
		Mscrm.BusinessRules.Utility.assign(Mscrm.BusinessRules.ReportToWatsonErrorHandler.prototype, Mscrm.BusinessRules.ErrorHandler.prototype);

		Mscrm.BusinessRules.ArithmeticErrorHandler = function (exception) {
			Mscrm.BusinessRules.ErrorHandler.call(this, exception);
		};
		Mscrm.BusinessRules.ArithmeticErrorHandler.prototype = {
			handleError: function () {
			}
		};
		Mscrm.BusinessRules.Utility.assign(Mscrm.BusinessRules.ArithmeticErrorHandler.prototype, Mscrm.BusinessRules.ErrorHandler.prototype);
		Mscrm.BusinessRules.ErrorHandlerFactory = function () {
		};
		Mscrm.BusinessRules.ErrorHandlerFactory.getHandler = function (e, caller) {
			if (e.message.indexOf(String.format(Mscrm.BusinessRules.ErrorHandlerFactory.businessErrorFormat, Mscrm.BusinessRules.JsErrorCodes.arithmeticOperationNotValid)) !== -1)
				return new Mscrm.BusinessRules.ArithmeticErrorHandler(e);
			return new Mscrm.BusinessRules.ReportToWatsonErrorHandler(e, caller)
		};

		Mscrm.BusinessRules.Utility.sanitizeGuid = function (guid) {
			if (Mscrm.BusinessRules.Utility.isNull(guid))
				return guid;
			return guid.replace("{", "").replace("}", "").toUpperCase()
		};
		Mscrm.BusinessRules.Utility.filterInputArguments = function (inputArguments) {
			if (!Mscrm.BusinessRules.Utility.isNull(inputArguments) && Microsoft.Crm.Application.SharedObjects.ProcessUnificationConstants.mddLastButtonClickedId in inputArguments && inputArguments[Microsoft.Crm.Application.SharedObjects.ProcessUnificationConstants.mddLastButtonClickedId] === Microsoft.Crm.Application.SharedObjects.ProcessUnificationConstants.mddOkButtonId) {
				var processUnificationTag = Microsoft.Crm.Application.SharedObjects.ProcessUnificationConstants.processActionArgumentsPrefix,
					$$dict_5 = inputArguments;
				for (var $$key_6 in $$dict_5) {
					var argument = { key: $$key_6, value: $$dict_5[$$key_6] },
						parameterName = argument.key.toString();
					if (parameterName.startsWith(processUnificationTag)) {
						var formattedName = parameterName.substring(processUnificationTag.length, parameterName.length);
						inputArguments[formattedName] = argument.value
					}
					delete inputArguments[parameterName]
				}
				return true
			}
			return false
		};
		Mscrm.BusinessRules.Utility.getDialogOptions = function()
		{
			var dialogOptions = {};
			dialogOptions["width"] = Mscrm.BusinessRules.Utility._width$p;
			dialogOptions["height"] = Mscrm.BusinessRules.Utility._height$p;
			return dialogOptions
		};
		/* DO NOT OVERWRITE BLINDLY - Intentionally different than WEB Source */
		Mscrm.BusinessRules.Utility.executeWorkflow = function(entityId, workflowId, inputArguments) {
			var metadata = {
				boundParameter: "entity",
				operationName: "ExecuteWorkflow",
				operationType: 0 /* Action */,
				parameterTypes: {
					"entity": {
						"typeName": "Microsoft.Dynamics.CRM.workflow",
						"structuralProperty": 5 /* PrimitiveType */,
					},
					"EntityId": {
						"typeName": "Edm.Guid",
						"structuralProperty": 1 /* PrimitiveType */,
					},
					"InputArguments": {
						"typeName": "Microsoft.Dynamics.CRM.InputArgumentCollection",
						"structuralProperty": 2 /* ComplexType */,
					},
				},
			};
			var keys = Object.keys(inputArguments);
			var values = Object.values(inputArguments).map(function (value) { return new XrmCore.SdkContracts.Object("System.String", value) });
			var args = new XrmCore.SdkContracts.InputArgument(3, true, keys, values);
			var argCol = new XrmCore.SdkContracts.InputArgumentCollection(args);
			var request = {
				getMetadata: function() {return metadata;},
				entity: {id: workflowId, entityType: "workflow"},
				EntityId: {guid: Mscrm.BusinessRules.Utility.sanitizeGuid(entityId)},
				InputArguments: argCol,
			};
			return Xrm.WebApi.online.execute(request);
		};
		Mscrm.BusinessRules.Utility.generateMessageForAction = function (progress) {
			var message = "";
			var webResourceName = "cc_MscrmControls.Containers.ProcessBreadCrumb/strings/ProcessControlResources";
			var localizedExecutionTimeToolTip = Xrm.Utility.getResourceString(webResourceName, "ProcessControl_ActionExecuter_ExecutionTimeTooltip");
			var localizedErrorMessageToolTip = Xrm.Utility.getResourceString(webResourceName, "ProcessControl_ActionExecuter_ErrorMessageTooltip");
			var localizedGenericErrorMessageToolTip = Xrm.Utility.getResourceString(webResourceName, "Crm_GenericErrorMessage");
			switch (progress) {
				case 2://completed
					message = String.format(localizedExecutionTimeToolTip, (new Date).toLocaleString());
					break;
				case 3://failed
					message = String.format(localizedExecutionTimeToolTip, (new Date).toLocaleString()) + "\n" + String.format(localizedErrorMessageToolTip, localizedGenericErrorMessageToolTip);
					break
			}
			return message;
		};
		Mscrm.BusinessRules.Utility.addRelationshipOnChange = function (referencingAttributeName, relationshipName, controlName, OnChangeFunctionCallObjectName) {
			if (Mscrm.BusinessRules.Utility.isNull(Mscrm.BusinessRules.Utility.relatedAttributesOnChangeHandlers))
				Mscrm.BusinessRules.Utility.relatedAttributesOnChangeHandlers = {};
			if (Mscrm.BusinessRules.Utility.isNull(Mscrm.BusinessRules.Utility.recycledRelatedAttributesOnChangeHandlers))
				Mscrm.BusinessRules.Utility.recycledRelatedAttributesOnChangeHandlers = {};
			if (!Mscrm.BusinessRules.Utility.isNull(Xrm.Page.data.entity.relatedEntities.get(relationshipName))) {
				Xrm.Page.data.entity.relatedEntities.get(relationshipName).attributes.get(controlName).addOnChange(OnChangeFunctionCallObjectName);
				try {
					OnChangeFunctionCallObjectName(null)
				}
				catch ($$e_4) {
				}
				Mscrm.BusinessRules.Utility._addOnChangeToRecycledRelatedAttributesOnChangeHandlers$p(referencingAttributeName, relationshipName, controlName, OnChangeFunctionCallObjectName)
			}
			else
				Mscrm.BusinessRules.Utility._addOnChangeToRelatedAttributesOnChangeHandlers$p(referencingAttributeName, relationshipName, controlName, OnChangeFunctionCallObjectName);
				var referencingAttribute = Xrm.Page.data.entity.attributes.get(referencingAttributeName);
				!Mscrm.BusinessRules.Utility.isNull(referencingAttribute) && referencingAttribute.addOnChange(function(context) {
					if (Mscrm.BusinessRules.Utility.isNull(Xrm.Page.data.entity.relatedEntities.get(relationshipName))) {
						var recycledHandler = Mscrm.BusinessRules.Utility.recycledRelatedAttributesOnChangeHandlers[referencingAttributeName][relationshipName][controlName];
						Mscrm.BusinessRules.Utility._addOnChangeToRelatedAttributesOnChangeHandlers$p(referencingAttributeName, relationshipName, controlName, recycledHandler);
						delete Mscrm.BusinessRules.Utility.recycledRelatedAttributesOnChangeHandlers[referencingAttributeName][relationshipName][controlName];
						return
					}
					if (!Mscrm.BusinessRules.Utility.isNull(Mscrm.BusinessRules.Utility.relatedAttributesOnChangeHandlers) && referencingAttributeName in Mscrm.BusinessRules.Utility.relatedAttributesOnChangeHandlers) {
						var relatedAtributeDictionary = Mscrm.BusinessRules.Utility.relatedAttributesOnChangeHandlers[referencingAttributeName];
						if (!Mscrm.BusinessRules.Utility.isNull(relatedAtributeDictionary) && relationshipName in relatedAtributeDictionary) {
							var controlDictionary = relatedAtributeDictionary[relationshipName];
							if (!Mscrm.BusinessRules.Utility.isNull(controlDictionary) && controlName in controlDictionary) {
								try {
									OnChangeFunctionCallObjectName(null)
								}
								catch ($$e_9) {
								}
								Xrm.Page.data.entity.relatedEntities.get(relationshipName).attributes.get(controlName).addOnChange(OnChangeFunctionCallObjectName);
								Mscrm.BusinessRules.Utility._addOnChangeToRecycledRelatedAttributesOnChangeHandlers$p(referencingAttributeName, relationshipName, controlName, OnChangeFunctionCallObjectName);
								delete Mscrm.BusinessRules.Utility.relatedAttributesOnChangeHandlers[referencingAttributeName][relationshipName][controlName]
							}
						}
					}
				})
		};
		Mscrm.BusinessRules.Utility._addOnChangeToRecycledRelatedAttributesOnChangeHandlers$p = function (referencingAttributeName, relationshipName, controlName, OnChangeFunctionCallObjectName) {
			if (!(referencingAttributeName in Mscrm.BusinessRules.Utility.recycledRelatedAttributesOnChangeHandlers))
				Mscrm.BusinessRules.Utility.recycledRelatedAttributesOnChangeHandlers[referencingAttributeName] = {};
			var recycledRelationshipNameDictionary = Mscrm.BusinessRules.Utility.recycledRelatedAttributesOnChangeHandlers[referencingAttributeName];
			if (!(relationshipName in recycledRelationshipNameDictionary))
				recycledRelationshipNameDictionary[relationshipName] = {};
			Mscrm.BusinessRules.Utility.recycledRelatedAttributesOnChangeHandlers[referencingAttributeName][relationshipName][controlName] = OnChangeFunctionCallObjectName
		};
		Mscrm.BusinessRules.Utility._addOnChangeToRelatedAttributesOnChangeHandlers$p = function (referencingAttributeName, relationshipName, controlName, OnChangeFunctionCallObjectName) {
			if (!(referencingAttributeName in Mscrm.BusinessRules.Utility.relatedAttributesOnChangeHandlers))
				Mscrm.BusinessRules.Utility.relatedAttributesOnChangeHandlers[referencingAttributeName] = {};
			var relationshipNameDictionary = Mscrm.BusinessRules.Utility.relatedAttributesOnChangeHandlers[referencingAttributeName];
			if (!(relationshipName in relationshipNameDictionary))
				relationshipNameDictionary[relationshipName] = {};
			Mscrm.BusinessRules.Utility.relatedAttributesOnChangeHandlers[referencingAttributeName][relationshipName][controlName] = OnChangeFunctionCallObjectName
		};
		Mscrm.BusinessRules.Utility.isNull = function (value) {
			return typeof value === "undefined" || value == null;
		};
		IsNull = function (value) {
			return typeof value === 'undefined' || value == null;
		};
		Mscrm.BusinessRules.JsErrorCodes.arithmeticOperationNotValid = "1000";
		Mscrm.BusinessRules.ErrorHandlerFactory.businessErrorFormat = "BusinessRuleError:{0}";
		Mscrm.BusinessRules.Utility.relatedAttributesOnChangeHandlers = {};
		Mscrm.BusinessRules.Utility.recycledRelatedAttributesOnChangeHandlers = {};
		Mscrm.BusinessRules.Utility._width$p = 450;
		Mscrm.BusinessRules.Utility._height$p = 450;
	</script>
</head>
<body><script type="text/javascript">var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)},MscrmControls;(function(MscrmControls){var Containers;(function(Containers){"use strict";var MetricObject=function(){function MetricObject(){}return MetricObject}(),MicrosoftFlowsTelemetryReporter=function(){function MicrosoftFlowsTelemetryReporter(){this.TIP_ENV="crm10.dynamics.com"}MicrosoftFlowsTelemetryReporter.prototype.init=function(crmBaseUri,clientType){try{this.crmBaseUri=crmBaseUri;this.metricsReportingServiceUrl=this.crmBaseUri+"/AppWebServices/MetricsReportingService.asmx/Report";this.clientType=clientType}catch(exception){console.error(exception)}};MicrosoftFlowsTelemetryReporter.prototype.getBaseWindowUrl=function(){var protocol=location.protocol,hostName=location.hostname,port=location.port?":"+location.port:"";return protocol+"//"+hostName+port};MicrosoftFlowsTelemetryReporter.prototype.logFlowTelemetryEvent=function(eventName,properties){if(properties===void 0)properties=null;this.sendMetric("MsFlow"+eventName,properties)};MicrosoftFlowsTelemetryReporter.prototype.logFlowAuthenticationEvent=function(tenantId,result,timeTaken,isSilent){var metricProperties={TenantId:tenantId,Result:result,TimeTaken:timeTaken,IsSilent:isSilent};this.sendMetric("MsFlowUserAuthentication",metricProperties)};MicrosoftFlowsTelemetryReporter.prototype.logFlowTriggerEvent=function(tenantId,noOfEntityRecords,noOfProperties,entityLogicalName,flowId,flowRunResult,environmentId,flowTriggerWidgetInitTimeMs,authTokenRetrievalTimeMs,dataRetrievalTimeMs,userRunButtonClickTimeMs){var metricProperties={TenantId:tenantId,NoOfEntityRecords:noOfEntityRecords,NoOfProperties:noOfProperties,EntityLogicalName:entityLogicalName,FlowId:flowId,FlowRunResult:flowRunResult,FlowEnvironmentId:environmentId,FlowTriggerWidgetInitTimeMs:flowTriggerWidgetInitTimeMs,AuthTokenRetrievalTimeMs:authTokenRetrievalTimeMs,DataRetrievalTimeMs:dataRetrievalTimeMs,UserRunButtonClickTimeMs:userRunButtonClickTimeMs};this.sendMetric("MsFlowTriggered",metricProperties)};MicrosoftFlowsTelemetryReporter.prototype.logFlowErrorEvent=function(tenantId,env,errorSource,response,methodName,errMsg){if(methodName==="AttemptToSilentlyAuthenticate"&&(!this.crmBaseUri||this.crmBaseUri&&this.crmBaseUri.indexOf(this.TIP_ENV)===-1))response="";if(response&&response.stack)response=JSON.stringify(response.stack);if(errMsg&&errMsg.message)errMsg=JSON.stringify(errMsg.message);var metricProperties={TenantId:tenantId,FlowEnvironmentId:env,ErrorSource:errorSource,Response:response,MethodName:methodName,IsFailure:true,ErrorMessage:errMsg};this.sendMetric("MsFlowError",metricProperties)};MicrosoftFlowsTelemetryReporter.prototype.logWorkFlowErrorEvent=function(tenantId,workFlowId,env,errorSource,response,methodName,errMsg){if(methodName==="AttemptToSilentlyAuthenticate"&&(!this.crmBaseUri||this.crmBaseUri&&this.crmBaseUri.indexOf(this.TIP_ENV)===-1))response="";if(response&&response.stack)response=JSON.stringify(response.stack);if(errMsg&&errMsg.message)errMsg=JSON.stringify(errMsg.message);var metricProperties={TenantId:tenantId,WorkFlowId:workFlowId,FlowEnvironmentId:env,ErrorSource:errorSource,Response:response,MethodName:methodName,IsFailure:true,ErrorMessage:errMsg};this.sendMetric("MsFlowError",metricProperties)};MicrosoftFlowsTelemetryReporter.prototype.logFlowDefinitionsListEvent=function(tenantId,env,numDefinitionsLoaded,timeToLoadDefinitionsMs,timetoLoadDefFromService,entityLogicalName,eventMessage){var metricProperties={TenantId:tenantId,FlowEnvironmentId:env,NumDefinitionsLoaded:numDefinitionsLoaded,TimeToLoadDefinitionsMs:timeToLoadDefinitionsMs,TimetoLoadDefFromService:timetoLoadDefFromService,EntityLogicalName:entityLogicalName,EventMessage:eventMessage};this.sendMetric("MsFlowDefinitionsList",metricProperties)};MicrosoftFlowsTelemetryReporter.prototype.logFlowDefinitionsMenuGenerationEvent=function(tenantId,env,numDefinitionsLoaded,timeToLoadDefinitionsMs,timetoLoadDefFromService,entityLogicalName,eventMessage){var metricProperties={TenantId:tenantId,FlowEnvironmentId:env,NumDefinitionsLoaded:numDefinitionsLoaded,TimeToLoadDefinitionsMs:timeToLoadDefinitionsMs,TimetoLoadDefFromService:timetoLoadDefFromService,EntityLogicalName:entityLogicalName,EventMessage:eventMessage};this.sendMetric("MsFlowDefinitionsList",metricProperties)};MicrosoftFlowsTelemetryReporter.prototype.sendMetric=function(name,properties){var _this=this;try{var _window=window;if(_window.Xrm&&_window.Xrm.Internal&&_window.Xrm.Internal.addMetric){_window.Xrm.Internal.addMetric(name,properties);return Promise.resolve()}var outerRequest={request:{MetricsCollections:[{RequestId:this.newGuid(),Metrics:[{n:name,p:properties,t:Date.now()}]}]}};return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.open("POST",_this.metricsReportingServiceUrl,true);xhr.setRequestHeader("Content-type","application/json");_this.clientType&&xhr.setRequestHeader("ClientAppName",_this.clientType);xhr.onload=function(){var status=xhr.status;if(status===200||status===204)resolve(xhr.response);else reject(status)};xhr.send(JSON.stringify(outerRequest))})}catch(ex){}};MicrosoftFlowsTelemetryReporter.prototype.newGuid=function(){return "xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)})};return MicrosoftFlowsTelemetryReporter}();Containers.MicrosoftFlowsTelemetryReporter=MicrosoftFlowsTelemetryReporter})(Containers=MscrmControls.Containers||(MscrmControls.Containers={}))})(MscrmControls||(MscrmControls={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var ActivateLibraryLegacy=function(){function ActivateLibraryLegacy(){this.activateRecordsLegacy=function(gridControl,records,entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.activate(gridControl,records,entityTypeCode):backCompatHeader.Mscrm.GridCommandActions.activate(gridControl,records,entityTypeCode)};this.activateRecords=function(gridControl,records,entityName,callback){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false),entityTypeCode=Xrm.Internal.getEntityCode(entityName);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.activate(gridControl,records,entityTypeCode,callback):backCompatHeader.Mscrm.GridCommandActions.activate(gridControl,records,entityTypeCode)}}ActivateLibraryLegacy.prototype.activatePrimaryRecord=function(id,entityName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.activate(id,entityName):backCompatHeader.Mscrm.CommandBarActions.activate(id,entityName)};return ActivateLibraryLegacy}();Commands.ActivateLibraryLegacy=ActivateLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var ActivateLibrary=function(){function ActivateLibrary(){var _this=this;this.activateRecordsLegacy=function(gridControl,records,entityTypeCode){_this.activateRecords(gridControl,records,Xrm.Internal.getEntityName(entityTypeCode))}}ActivateLibrary.prototype.activatePrimaryRecord=function(id,entityName){Commands.Common.changeState(entityName,id,true)};ActivateLibrary.prototype.activateRecords=function(gridControl,records,entityName,callback){if(!records.length){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Action_NoItemSelected")});return}if(records.length>1&&(entityName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.KnowledgeSearchModel||entityName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.TopicModel)){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Grid_Action_Too_Many_Custom_Messages_Selected_Alert")});return}var dialogParams={};dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records]=records;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.action]=XrmCore.InternalUtilities.DialogUtilities.DialogConstants.activate;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]="";dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StateId]=-1;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StatusId]=-1;var dialogCallbackParams={},options=null,client=Xrm.Utility.getGlobalContext().client.getClient();if(client===Xrm.Constants.ClientNames.web||client==Xrm.Constants.ClientNames.outlook||client==Xrm.Constants.ClientNames.unifiedServiceDesk)options={height:250,width:600,position:1};Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.SetStateDialog,options,dialogParams).then(function(successParameter){Commands.Common.closeSetStateDialogFromGridCallback(successParameter.parameters,dialogCallbackParams,gridControl,callback)})};return ActivateLibrary}();Commands.ActivateLibrary=ActivateLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Activate=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.ActivateLibrary:new Commands.ActivateLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AddLibraryLegacy=function(){function AddLibraryLegacy(){var _this=this;this.AddActivityFromGrid=function(activityTypeName,contentId,entityReference){_this.addActivityFromGrid(activityTypeName,contentId,entityReference)};this.addActivityFromGrid=function(activityTypeName,contentId,entityReference){if(typeof activityTypeName==="number")activityTypeName=Xrm.Internal.getEntityName(activityTypeName);_this.addActivityFromGridLegacy(Xrm.Internal.getEntityCode(activityTypeName),contentId,entityReference)};this.addActivityFromGridLegacy=function(activityTypeCode,contentId,entityReference){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);if(Mscrm&&Mscrm.GridRibbonActions&&Mscrm.GridRibbonActions.addActivityFromGrid)Mscrm.GridRibbonActions.addActivityFromGrid(activityTypeCode,contentId,entityReference);else backCompatHeader.Mscrm.GridRibbonActions.addActivityFromGrid(activityTypeCode,contentId,entityReference)};this.addActivityToFormFromsubgrid=function(activityType,parentId,parentType){var activityCode=Xrm.Internal.getEntityCode(activityType),parentCode=Xrm.Internal.getEntityCode(parentType);_this.addActivityToFormFromsubgridLegacy(activityCode,parentId,parentCode)};this.addActivityToFormFromsubgridLegacy=function(activityType,parentId,parentType){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);if(Mscrm&&Mscrm.AddActivity&&Mscrm.AddActivity.addActivityToFormFromsubgrid)Mscrm.AddActivity.addActivityToFormFromsubgrid(activityType,parentId,parentType);else backCompatHeader.Mscrm.AddActivity.addActivityToFormFromsubgrid(activityType,parentId,parentType)};this.AddActivityOnForm=function(activityTypeName,contentId){_this.addActivityToForm(activityTypeName,contentId)};this.AddActivityToForm=function(activityTypeName,contentId){_this.addActivityToForm(activityTypeName,contentId)};this.addActivityOnForm=function(activityTypeName,contentId){_this.addActivityToForm(activityTypeName,contentId)};this.addActivityToForm=function(activityTypeName,contentId){if(typeof activityTypeName==="number")activityTypeName=Xrm.Internal.getEntityName(activityTypeName);var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);if(Mscrm&&Mscrm.RibbonActions&&Mscrm.RibbonActions.addActivityOnForm)Mscrm.RibbonActions.addActivityOnForm(Xrm.Internal.getEntityCode(activityTypeName),contentId);else backCompatHeader.Mscrm.RibbonActions.addActivityOnForm(Xrm.Internal.getEntityCode(activityTypeName),contentId)};this.AddActivityToFormLegacy=function(activityType,contentId){_this.addActivityToFormLegacy(activityType,contentId)};this.addActivityToFormLegacy=function(activityType,contentId){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);if(Mscrm&&Mscrm.RibbonActions&&Mscrm.RibbonActions.addActivityOnForm)Mscrm.RibbonActions.addActivityOnForm(activityType,contentId);else backCompatHeader.Mscrm.RibbonActions.addActivityOnForm(activityType,contentId)};this.addConnectionFromForm=function(objectId,objectTypeCode,primaryControl,connectToMe,gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);if(Mscrm&&Mscrm.RibbonActions&&Mscrm.RibbonActions.addConnectionFromForm)Mscrm.RibbonActions.addConnectionFromForm(objectId,objectTypeCode,primaryControl,connectToMe,gridControl);else backCompatHeader.Mscrm.RibbonActions.addConnectionFromForm(objectId,objectTypeCode,primaryControl,connectToMe,gridControl)}}return AddLibraryLegacy}();Commands.AddLibraryLegacy=AddLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AddLibrary=function(){function AddLibrary(){var _this=this;this.AddActivityOnForm=function(activityTypeName,contentId){_this.addActivityToForm(activityTypeName,contentId)};this.AddActivityToForm=function(activityTypeName,contentId){_this.addActivityToForm(activityTypeName,contentId)};this.addActivityOnForm=function(activityTypeName,contentId){_this.addActivityToForm(activityTypeName,contentId)};this.addActivityToForm=function(activityTypeName,contentId){if(typeof activityTypeName==="number")activityTypeName=Xrm.Internal.getEntityName(activityTypeName);var entity=Xrm.Page.data.entity;entity&&entity.getId()&&entity.getEntityName()&&entity.getPrimaryAttributeValue()&&_this._genericAddActivityInternal(activityTypeName,contentId,entity.getId(),entity.getEntityName(),entity.getPrimaryAttributeValue())};this.AddActivityToFormLegacy=function(activityTypeCode,contentId){_this.addActivityToFormLegacy(activityTypeCode,contentId)};this.addActivityToFormLegacy=function(activityTypeCode,contentId){_this.AddActivityToForm(Xrm.Internal.getEntityName(activityTypeCode),contentId)};this.addActivityToFormFromsubgrid=function(activityType,parentId,parentType,gridControl){var parentName=Xrm.Page.data.entity.getPrimaryAttributeValue();parentType=Xrm.Page.data.entity.getEntityName();_this._genericAddActivityInternal(activityType,null,parentId,parentType,parentName,gridControl)};this.addActivityToFormFromsubgridLegacy=function(activityType,parentId,parentType){var activityTypeName=Xrm.Internal.getEntityName(activityType),parentTypeName=Xrm.Internal.getEntityName(parentType);_this.addActivityToFormFromsubgrid(activityTypeName,parentId,parentTypeName)};this.AddActivityFromGridLegacy=function(activityType,contentId,entityReference){_this.addActivityFromGridLegacy(activityType,contentId,entityReference)};this.addActivityFromGridLegacy=function(activityType,contentId,entityReference){if(typeof activityType!=="number")activityType=parseInt(activityType,10);var activityTypeName=Xrm.Internal.getEntityName(activityType);_this.AddActivityFromGrid(activityTypeName,contentId,entityReference)};this.AddActivityFromGrid=function(activityTypeName,contentId,entityReference){_this.addActivityFromGrid(activityTypeName,contentId,entityReference)};this.addActivityFromGrid=function(activityTypeName,contentId,entityReference){if(typeof activityTypeName==="number")activityTypeName=Xrm.Internal.getEntityName(activityTypeName);_this._addActivityToSelectedObject(activityTypeName,contentId,entityReference[0])};this.addConnectionFromForm=function(objectId,objectTypeCode,primaryControl,connectToMe,gridControl){var data={},parentEntityTypeName=Xrm.Page.data.entity.getEntityName(),parentEntityName=Xrm.Page.data.entity.getPrimaryAttributeValue(),fromEntity={id:objectId,name:parentEntityName,entityType:parentEntityTypeName};if(connectToMe){var formContext=Xrm.Page;data={record2id:{entityType:XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemUser,id:formContext.context.getUserId(),name:formContext.context.getUserName()},record1id:fromEntity}}else data={record1id:fromEntity};var openOptions={entityName:XrmCore.InternalUtilities.EntityUtilities.EntityNames.Connection};Xrm.Navigation.openForm(openOptions,data)};this._addActivityToSelectedObject=function(activityTypeName,contentId,entityReference){_this._genericAddActivityInternal(activityTypeName,contentId,entityReference.Id,entityReference.TypeName,entityReference.Name)};this._genericAddActivityInternal=function(activityTypeName,contentId,parentId,parentTypeName,parentName,gridControl){var partyId=null,partyType=null,partyName=null,partyLocation="",isCreateEmailForCustomEntity=false;if(activityTypeName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.PhoneCall){var phoneCallCustomerValue=_this._getPhoneCallCustomerForEntity(parentTypeName,parentName,parentId);if(phoneCallCustomerValue&&phoneCallCustomerValue.Id&&phoneCallCustomerValue.Name&&phoneCallCustomerValue.Typename){partyId=phoneCallCustomerValue.Id;partyName=phoneCallCustomerValue.Name;partyType=phoneCallCustomerValue.Typename}if(parentTypeName==XrmCore.InternalUtilities.EntityUtilities.EntityNames.Account||parentTypeName==XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contact||parentTypeName==XrmCore.InternalUtilities.EntityUtilities.EntityNames.Lead){var partyAttribute=Xrm.Page.getAttribute("telephone1");if(partyAttribute&&partyAttribute.getValue()!=null)partyLocation=partyAttribute.getValue().toString()}}else if(activityTypeName!=XrmCore.InternalUtilities.EntityUtilities.EntityNames.Task)switch(parentTypeName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Account:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contact:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Lead:partyId=parentId;partyType=parentTypeName;partyName=parentName;var partyAttribute=null;switch(activityTypeName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Fax:if(Xrm.Page.data){partyAttribute=Xrm.Page.getAttribute("fax");var partyAttribute1=Xrm.Page.getAttribute("address1_fax");if(partyAttribute&&partyAttribute.getValue()!=null)partyLocation=partyAttribute.getValue().toString();if(partyAttribute1){var partyLocation1=partyAttribute1.getValue();if(partyLocation1)if(partyLocation)partyLocation+=";"+partyLocation1;else partyLocation=partyLocation1}}break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Letter:if(Xrm.Page.data!=null){partyAttribute=Xrm.Page.getAttribute("address1_name");if(partyAttribute)partyLocation=partyAttribute.getValue()}break}break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Incident:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Opportunity:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Quote:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Invoice:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SalesOrder:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contract:var partyElement=_this._getPartyDetailsForRefreshForm(parentTypeName);if(partyElement){partyId=partyElement.Id;partyType=partyElement.Typename;partyName=partyElement.Name}break;default:if(activityTypeName==XrmCore.InternalUtilities.EntityUtilities.EntityNames.Email&&Xrm.Internal.getEntityCode(parentTypeName)>=Xrm.Internal.getEntityCode(XrmCore.InternalUtilities.EntityUtilities.EntityNames.BaseAddEntityObjectTypeCode)){partyType=parentTypeName;isCreateEmailForCustomEntity=true;Xrm.Utility.getEntityMetadata(partyType).then(function(entityMetadata){if(entityMetadata.IsActivityParty&&parentTypeName!==XrmCore.InternalUtilities.EntityUtilities.EntityNames.Campaign){partyId=parentId;partyType=parentTypeName;partyName=parentName}_this._addActivityTo(activityTypeName,parentId,parentTypeName,parentName,partyId,partyType,partyName,partyLocation,contentId,gridControl);return})}break}!isCreateEmailForCustomEntity&&_this._addActivityTo(activityTypeName,parentId,parentTypeName,parentName,partyId,partyType,partyName,partyLocation,contentId,gridControl)};this._getPartyDetailsForRefreshForm=function(entityTypeName){var partyElement=null;if(Xrm.Page.data&&Xrm.Page.data.entity){var entityUI=Xrm.Page.data.entity;switch(entityTypeName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Incident:partyElement=_this._getCustomerForIncident();break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Opportunity:partyElement=_this._getCustomerForOppurtunity();break;default:var attributes=entityUI.attributes;if(entityUI.attributes){var customerId=entityUI.attributes.get("customerid");if(customerId)partyElement=_this.getFirstLookupItem(customerId.getValue())}break}}return partyElement};this._getCustomerForOppurtunity=function(){for(var attributeNames=["parentcontactid","parentaccountid","parentaccountid"],_i=0,attributeNames_1=attributeNames;_i<attributeNames_1.length;_i++){var attributeName=attributeNames_1[_i],attribute=Xrm.Page.getAttribute(attributeName);if(attribute)return _this.getFirstLookupItem(attribute.getValue())}return null};this._getCustomerForIncident=function(){var customer=Xrm.Page.getAttribute("customerid"),contact=Xrm.Page.getAttribute("primarycontactid"),customerlookup=null,contactlookup=null;if(customer!=null)customerlookup=_this.getFirstLookupItem(customer.getValue());if(contact!=null)contactlookup=_this.getFirstLookupItem(contact.getValue());if(customerlookup!=null&&contactlookup==null)return customerlookup;else if(customerlookup&&contactlookup&&customerlookup.Typename==XrmCore.InternalUtilities.EntityUtilities.EntityNames.Account)return contactlookup;return customerlookup};this._getPhoneCallCustomerForEntity=function(parentTypeName,parentName,parentId){if(!parentName||parentName==="")parentName=Xrm.Page.data.entity.getPrimaryAttributeValue();var phoneCallCustomerValue=null;switch(parentTypeName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Incident:var customerIdAttribute=Xrm.Page.getAttribute("customerid");phoneCallCustomerValue=customerIdAttribute?_this.getFirstLookupItem(customerIdAttribute.getValue()):null;break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Account:var primaryContact=Xrm.Page.getAttribute("primarycontactid");if(primaryContact&&primaryContact.getValue())phoneCallCustomerValue=_this.getFirstLookupItem(primaryContact.getValue());else if(parentId&&parentName){var entityTypeName=XrmCore.InternalUtilities.EntityUtilities.EntityNames.Account;phoneCallCustomerValue={Id:parentId,Name:parentName,Type:Xrm.Internal.getEntityCode(entityTypeName).toString(),Typename:entityTypeName}}break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contact:if(parentId&&parentName){var entityTypeName=XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contact;phoneCallCustomerValue={Id:parentId,Name:parentName,Type:Xrm.Internal.getEntityCode(entityTypeName).toString(),Typename:entityTypeName}}break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Opportunity:var parentContactId=Xrm.Page.getAttribute("parentcontactid");if(parentContactId)phoneCallCustomerValue=_this.getFirstLookupItem(parentContactId.getValue());var parentAccount=Xrm.Page.getAttribute("parentaccountid");if(parentAccount&&!phoneCallCustomerValue)phoneCallCustomerValue=_this.getFirstLookupItem(parentAccount.getValue());break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Lead:var parentContact=Xrm.Page.getAttribute("parentcontactid");if(parentContact&&parentContact.getValue())phoneCallCustomerValue=_this.getFirstLookupItem(parentContact.getValue());else if(parentId&&parentName){var entityTypeName=XrmCore.InternalUtilities.EntityUtilities.EntityNames.Lead;phoneCallCustomerValue=phoneCallCustomerValue={Id:parentId,Name:parentName,Type:Xrm.Internal.getEntityCode(entityTypeName).toString(),Typename:entityTypeName}}break;default:break}return phoneCallCustomerValue};this.getFirstLookupItem=function(parameterCustomerValue){var parameterReturnType=null;if(Array.isArray(parameterCustomerValue)&&parameterCustomerValue.length>0&&parameterCustomerValue[0].id&&parameterCustomerValue[0].name&&parameterCustomerValue[0].entityType)parameterReturnType={Id:parameterCustomerValue[0].id,Name:parameterCustomerValue[0].name,Type:Xrm.Internal.getEntityCode(parameterCustomerValue[0].entityType).toString(),Typename:parameterCustomerValue[0].entityType};return parameterReturnType};this._addActivityTo=function(activityTypeName,id,type,name,partyId,partyType,partyName,location,contentId,gridControl){var parameters={},regardingObjectLookup={id:id,name:name,entityType:type},partyLookupList=[];if(contentId)parameters["contentId"]=contentId;var options={};options.entityName=activityTypeName;options.useQuickCreateForm=true;if(gridControl&&gridControl.getRelationship&&gridControl.getRelationship()!=null&&gridControl.getRelationship().relationshipType==0){options.relationship=gridControl.getRelationship();var parentControl=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page;if(parentControl&&parentControl.data&&parentControl.data.entity&&parentControl.data.entity.getEntityReference)options.createFromEntity=parentControl.data.entity.getEntityReference();var parentEntity=parentControl.data.entity.getEntityReference();if(parentEntity.id!=id&&parentEntity.entityType!=type){regardingObjectLookup={id:parentEntity.id,name:parentEntity.name,entityType:parentEntity.entityType};partyLookupList.push({id:parentEntity.id,name:parentEntity.name,entityType:parentEntity.entityType})}}if(id&&type&&activityTypeName!=XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignResponse)parameters["regardingobjectid"]=JSON.stringify(regardingObjectLookup);if(partyId){partyLookupList.length==0&&partyLookupList.push({id:partyId,name:partyName,entityType:partyType});var temp=JSON.stringify(partyLookupList);parameters["partyaddressused"]="";parameters["contactInfo"]=location;switch(activityTypeName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Email:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Fax:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Letter:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.PhoneCall:parameters["to"]=temp;break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Appointment:parameters["requiredattendees"]=temp;break;default:break}}Xrm.Navigation.openForm(options,parameters).then(function(){gridControl!=null&&gridControl!=undefined&&gridControl.refresh()})}}return AddLibrary}();Commands.AddLibrary=AddLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Add=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.AddLibrary:new Commands.AddLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AddEntityConstants;(function(AddEntityConstants){var MenuParams;(function(MenuParams){MenuParams.DynamicMenu_Subgrid_NewActivityMenu_ID="activitypointer|NoRelationship|SubGridAssociated|Mscrm.DynamicMenu.Subgrid.NewActivityMenu"})(MenuParams=AddEntityConstants.MenuParams||(AddEntityConstants.MenuParams={}));AddEntityConstants.imageDic={task:"NewTask",fax:"NewFax",phonecall:"NewPhoneCall",email:"NewEmail",letter:"NewLetter",appointment:"NewAppointment",campaignresponse:"CampaignResolution"}})(AddEntityConstants=Commands.AddEntityConstants||(Commands.AddEntityConstants={}))})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var Constants=Commands.AddEntityConstants,AddEntityAppList=function(){function AddEntityAppList(){}AddEntityAppList.buildEntityInCurrentAppModule=function(commandProperties){var entitiesActivityMetadata=[],entityToAttributes={},promise=new window.Promise(function(resolve){var currentAppComponents=Xrm.App.getCurrentAppComponents();if(currentAppComponents!==null){for(var _i=0,_a=currentAppComponents.entities;_i<_a.length;_i++){var currentAppComponent=_a[_i],logicalName=currentAppComponent.LogicalName;entityToAttributes[logicalName]=[]}Xrm.Utility.getEntitiesMetadata(entityToAttributes).then(function(entitiesMetadata){for(var _i=0,entitiesMetadata_1=entitiesMetadata;_i<entitiesMetadata_1.length;_i++){var entityMetadata=entitiesMetadata_1[_i];entityMetadata.IsActivity&&entitiesActivityMetadata.push(entityMetadata)}return resolve(AddEntityAppList.buildMenu(commandProperties,entitiesActivityMetadata))})}});commandProperties["PopulationXML"]=promise;return};AddEntityAppList.buildMenu=function(commandProperties,entityMetadataList){var menuId=commandProperties.SourceControlId,locationButtonsControl=AddEntityAppList.buildMenuControls(menuId,entityMetadataList),menuSection=AddEntityAppList.buildMenuSection(menuId,10,locationButtonsControl),menuSections=[];menuSection&&menuSections.push(menuSection);var menu=AddEntityAppList.buildMenuSections(menuId,menuSections);return menu};AddEntityAppList.buildMenuSections=function(menuId,menuSections){var menu={Id:menuId,MenuSection:menuSections};return menu};AddEntityAppList.buildMenuSection=function(menuId,sequenceNum,controls){var section={Id:menuId+".section1",Sequence:sequenceNum.toString(),Scrollable:false,DisplayMode:6,Item:controls};return section};AddEntityAppList.buildMenuControls=function(menuId,entityMetadataList){for(var buttons=[],controlsPrefix=""+menuId,commandPrefix=Constants.MenuParams.DynamicMenu_Subgrid_NewActivityMenu_ID,i=0;i<entityMetadataList.length;i++){var entityMetadata=entityMetadataList[i],logicalName=entityMetadata.LogicalName,displayName=entityMetadata.DisplayName,button={ControlType:"Button",Alt:""+displayName,Command:commandPrefix+"."+logicalName,CommandTypeSpecified:false,Id:controlsPrefix+"."+logicalName,LabelText:displayName,ModernCommandTypeSpecified:false,Sequence:(i*10+10).toString(),ToolTipTitle:""+displayName,ToolTipDescription:"$Resources("+displayName+"):Mscrm_Jewel_New_SubMenu_ToolTipDescription",ModernImage:entityMetadata.IsCustomEntity?"":Constants.imageDic[logicalName]==null?"CustomActivity":Constants.imageDic[logicalName]};buttons.push(button)}var controls={Id:menuId+".section1.Controls",Items:buttons};return controls};return AddEntityAppList}();Commands.AddEntityAppList=AddEntityAppList})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Common;(function(Common){var EntitySpecificOverrideBase=function(){function EntitySpecificOverrideBase(entityName){this.overrideMethods={};this.entityName=entityName}EntitySpecificOverrideBase.prototype.call=function(method){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];if(this.overrideMethods&&this.overrideMethods[method]&&this.overrideMethods[method][this.entityName]){var childArgs=[method];childArgs.push.apply(childArgs,args);return this[this.overrideMethods[method][this.entityName]].apply(this,childArgs)}else return this[method].apply(this,args)};return EntitySpecificOverrideBase}();Common.EntitySpecificOverrideBase=EntitySpecificOverrideBase})(Common=XrmCore.Common||(XrmCore.Common={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AddExistingFromSubGridBase=function(_super){__extends(AddExistingFromSubGridBase,_super);function AddExistingFromSubGridBase(){_super.apply(this,arguments)}AddExistingFromSubGridBase.prototype.addExistingFromSubGrid=function(gridTypeName,gridControl){var subGridControl=gridControl;if(subGridControl){var gridControlType=subGridControl.getGridType?subGridControl.getGridType():3;if(gridControlType===3||gridControlType===2)return this.call("openLookupRecord",gridTypeName,gridControl)}return false};AddExistingFromSubGridBase.prototype.openLookupRecord=function(gridTypeName,gridControl){var parentForm=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page,currentEntity={entityType:parentForm.data.entity.getEntityName(),name:parentForm.data.entity.getPrimaryAttributeValue(),id:parentForm.data.entity.getId().replace("{","").replace("}","")},currentPage=Xrm.Internal.getCurrentPageUrl?Xrm.Internal.getCurrentPageUrl(currentEntity):null;if(currentPage&&-1!==currentPage.indexOf("pagetype=dashboard"))return false;return this.call("lookupRecord",gridTypeName,gridControl)};AddExistingFromSubGridBase.prototype.lookupRecord=function(gridTypeName,gridControl){if(gridControl){var entityName=gridControl&&gridControl.getEntityName?gridControl.getEntityName():"",parentForm=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page,currentEntity=parentForm.data.entity?{id:parentForm.data.entity.getId().replace("{","").replace("}",""),name:parentForm.data.entity.getPrimaryAttributeValue(),entityType:parentForm.data.entity.getEntityName()}:null,lookup=Xrm.Utility.lookupObjects?Xrm.Utility.lookupObjects({allowMultiSelect:true,createFromEntity:currentEntity,defaultEntityType:entityName,entityTypes:[entityName],lookupType:"Lookup.Simple"}):null;if(lookup){var _this_1=this;lookup.then(function(lookupValues){return _this_1.call("associateRecords",lookupValues,gridTypeName,gridControl)})}return true}return false};AddExistingFromSubGridBase.prototype.associateRecords=function(lookupValues,gridTypeName,gridControl){var _this=this;if(!lookupValues||lookupValues.length===0)return;var subGridControl=gridControl,relationship=subGridControl&&subGridControl.getRelationship?subGridControl.getRelationship():null,relationshipAttributeName=relationship?relationship.attributeName:null,parentForm=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page,parentId=parentForm.data.entity.getId().replace("{","").replace("}",""),parentEntity=parentForm.data.entity.getEntityName();if(!XrmCore.InternalUtilities.DialogUtilities.isOffline()){var requests_1=[],requestsPromises=[],parentIssueCount_1=0,_loop_1=function(key){var lookupValue=lookupValues[key],newRequest=Xrm.WebApi.retrieveRecord(lookupValue.entityType,lookupValue.id.toString());newRequest.then(function(childEntity){if(relationship&&relationship.relationshipType===0){var relationshipState=_this.getRelationshipStateOneToMany(lookupValue,childEntity,parentId,relationshipAttributeName,parentEntity);switch(relationshipState){case 0:if(lookupValues.length>1)parentIssueCount_1++;else Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Parent_Record_AlreadyExists"),title:lookupValue.name});return;case 2:return}}var request;if(gridControl.getTeamTemplateId&&gridControl.getTeamTemplateId()!==null)request=_this.call("createAddUserToRecordTeamRequest",lookupValue,gridControl);else request=_this.call("createAssociateRequest",lookupValue,gridControl,relationship);request&&requests_1.push(request)});requestsPromises.push(newRequest)};for(var key in lookupValues)_loop_1(key);Promise.all(requestsPromises).then(function(){if(0<requests_1.length)if(requests_1.length==1)Xrm.WebApi.online.execute(requests_1[0]).then(function(success){gridControl&&gridControl.refresh();if(parentIssueCount_1>0){var message=XrmCore.InternalUtilities.GenericUtilities.stringFormat(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Multi_Associate_Parent_Record_AlreadyExists"),[1,lookupValues.length,parentIssueCount_1]);Xrm.Navigation.openAlertDialog({text:message})}},function(error){_this.onError(error,gridControl)});else Xrm.WebApi.online.executeMultiple(requests_1).then(function(success){if(parentIssueCount_1>0){var successCount_1=0;success.forEach(function(response){if(response.ok)successCount_1++});gridControl&&gridControl.refresh();var message=XrmCore.InternalUtilities.GenericUtilities.stringFormat(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Multi_Associate_Parent_Record_AlreadyExists"),[successCount_1,lookupValues.length,parentIssueCount_1]);Xrm.Navigation.openAlertDialog({text:message})}else XrmCore.InternalUtilities.DialogUtilities.onGridActionMultipleSuccess(gridControl,success)},function(error){_this.onError(error,gridControl)});else if(parentIssueCount_1>0){var message=XrmCore.InternalUtilities.GenericUtilities.stringFormat(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Multi_Associate_Parent_Record_AlreadyExists"),[0,lookupValues.length,parentIssueCount_1]);Xrm.Navigation.openAlertDialog({text:message})}},function(error){_this.onError(error,gridControl)})}else{if(relationship&&relationship.relationshipType===1){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Unsupported_Relationship_Offline")});return}var retrieveOptions="?$select="+relationshipAttributeName;Xrm.WebApi.retrieveRecord(lookupValues[0].entityType,lookupValues[0].id.toString(),retrieveOptions).then(function(childEntity){var relationshipState=_this.getRelationshipStateOneToMany(lookupValues[0],childEntity,parentId,relationshipAttributeName,parentEntity);if(relationshipState===2)return;if(relationshipState===0){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Parent_Record_AlreadyExists")});return}var regardingLookup={logicalname:parentEntity,id:parentId},updateEntityRecord={};updateEntityRecord[relationshipAttributeName]=regardingLookup;Xrm.WebApi.updateRecord(lookupValues[0].entityType,lookupValues[0].id.toString(),updateEntityRecord).then(function(entity){gridControl&&gridControl.refresh()},function(error){_this.onError(error,gridControl)})},function(error){_this.onError(error,gridControl)})}};AddExistingFromSubGridBase.prototype.createAssociateRequest=function(lookupValue,gridControl,relationship){var parentForm=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page,parentEntity=parentForm.data.entity.getEntityName(),parentId=parentForm.data.entity.getId().replace("{","").replace("}",""),childEntity=lookupValue.entityType||lookupValue.entityName,childId=lookupValue.id.replace("{","").replace("}",""),shouldSwapParentChild=relationship&&relationship.roleType===2&&relationship.relationshipType===1,request={getMetadata:function(){var ODataMetadata={boundParameter:null,parameterTypes:{},operationName:"Associate",operationType:2};return ODataMetadata},target:{id:shouldSwapParentChild?childId:parentId,entityType:shouldSwapParentChild?childEntity:parentEntity},relatedEntities:[{id:shouldSwapParentChild?parentId:childId,entityType:shouldSwapParentChild?parentEntity:childEntity}],relationship:relationship&&relationship.name};return request};AddExistingFromSubGridBase.prototype.createAddUserToRecordTeamRequest=function(lookupValue,gridControl){if(lookupValue&&lookupValue.id&&lookupValue.entityType){var userType=lookupValue.entityType,userId=lookupValue.id.replace("{","").replace("}",""),parentForm=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page;if(!parentForm||!parentForm.data||!parentForm.data.entity||!parentForm.data.entity.getEntityName||!parentForm.data.entity.getId)return null;var recordType=parentForm.data.entity.getEntityName(),recordId=parentForm.data.entity.getId().replace("{","").replace("}",""),user={id:userId,entityType:userType},record={id:recordId,entityType:recordType},teamTemplate={id:gridControl.getTeamTemplateId(),entityType:"teamtemplate"},request=new XrmCore.SdkContracts.AddUserToRecordTeamRequest(user,record,teamTemplate);return request}return null};AddExistingFromSubGridBase.prototype.onError=function(error,gridControl){gridControl.refresh();XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)};AddExistingFromSubGridBase.prototype.getRelationshipStateOneToMany=function(lookupValue,childEntity,parentId,relationshipAttributeName,parentEntity){var isModifiable=parentEntity===XrmCore.InternalUtilities.EntityUtilities.EntityNames.Territory&&lookupValue.entityType===XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemUser&&relationshipAttributeName==="territoryid",relatedEntityId=childEntity["_"+relationshipAttributeName+"_value"];return relatedEntityId&&!isModifiable?relatedEntityId.toLowerCase()===parentId.toLowerCase()?2:0:1};return AddExistingFromSubGridBase}(XrmCore.Common.EntitySpecificOverrideBase);Commands.AddExistingFromSubGridBase=AddExistingFromSubGridBase})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var GRID_TYPE_INLINE_SUB_GRID=3,GRID_TYPE_ASSOCIATED=2;Commands.ADD_EXISTING_FROM_SUB_GRID_OVERRIDES={addExistingFromSubGrid:{knowledgearticle:"translateArticle",connection:"openCaseResearchFlyout",contact:"checkInParentAndInvoke",account:"checkInParentAndInvoke",lead:"checkInParentAndInvoke",list:"checkInParentAndInvokeFromRelationship",campaign:"checkInParentAndInvokeFromRelationship",campaignactivity:"checkInParentAndInvokeFromRelationship"},openLookupRecord:{activitypointer:"openActivityMenu"},lookupRecord:{opportunityproduct:"openProductLookup",quotedetail:"openProductLookup",salesorderdetail:"openProductLookup",invoicedetail:"openProductLookup"},associateRecords:{list:"associateRecordsList",campaign:"associateRecordsCampaign",product:"associateRecordsProduct",systemuser:"associateRecordsSystemUser"},createAssociateRequest:{contact:"createAssociateRequestContact",list:"createAssociateRequestList",campaignactivity:"createAssociateRequestCampaignActivity",campaign:"createAssociateRequestCampaign",account:"createAssociateRequestAccount",systemuser:"createAssociateRequestSystemUser",lead:"createAssociateRequestLead",queue:"createAssociateRequestQueue",product:"createAssociateRequestProduct"}};var AddExistingFromSubGrid=function(_super){__extends(AddExistingFromSubGrid,_super);function AddExistingFromSubGrid(){_super.apply(this,arguments);this.overrideMethods=Commands.ADD_EXISTING_FROM_SUB_GRID_OVERRIDES}AddExistingFromSubGrid.prototype.translateArticle=function(base,gridTypeName,gridControl){return this[base](gridTypeName,gridControl)};AddExistingFromSubGrid.prototype.openCaseResearchFlyout=function(base,gridTypeName,gridControl){return this[base](gridTypeName,gridControl)};AddExistingFromSubGrid.prototype.checkInParentAndInvoke=function(base,gridTypeName,gridControl){return this[base](gridTypeName,gridControl)};AddExistingFromSubGrid.prototype.checkInParentAndInvokeFromRelationship=function(base,gridTypeName,gridControl){return this[base](gridTypeName,gridControl)};AddExistingFromSubGrid.prototype.openActivityMenu=function(base,gridTypeName,gridControl){return this[base](gridTypeName,gridControl)};AddExistingFromSubGrid.prototype.openProductLookup=function(base,gridTypeName,gridControl){return this[base](gridTypeName,gridControl)};AddExistingFromSubGrid.prototype.associateRecordsList=function(base,lookupValues,gridTypeName,gridControl){this[base](lookupValues,gridTypeName,gridControl)};AddExistingFromSubGrid.prototype.associateRecordsCampaign=function(base,lookupValues,gridTypeName,gridControl){this[base](lookupValues,gridTypeName,gridControl)};AddExistingFromSubGrid.prototype.associateRecordsProduct=function(base,lookupValues,gridTypeName,gridControl){this[base](lookupValues,gridTypeName,gridControl)};AddExistingFromSubGrid.prototype.associateRecordsSystemUser=function(base,lookupValues,gridTypeName,gridControl){this[base](lookupValues,gridTypeName,gridControl)};AddExistingFromSubGrid.prototype.createAssociateRequestContact=function(base,lookupValue,gridControl,relationship){return this[base](lookupValue,gridControl,relationship)};AddExistingFromSubGrid.prototype.createAssociateRequestList=function(base,lookupValue,gridControl,relationship){return this[base](lookupValue,gridControl,relationship)};AddExistingFromSubGrid.prototype.createAssociateRequestAccount=function(base,lookupValue,gridControl,relationship){return this[base](lookupValue,gridControl,relationship)};AddExistingFromSubGrid.prototype.createAssociateRequestCampaign=function(base,lookupValue,gridControl,relationship){return this[base](lookupValue,gridControl,relationship)};AddExistingFromSubGrid.prototype.createAssociateRequestCampaignActivity=function(base,lookupValue,gridControl,relationship){return this[base](lookupValue,gridControl,relationship)};AddExistingFromSubGrid.prototype.createAssociateRequestProduct=function(base,lookupValue,gridControl,relationship){return this[base](lookupValue,gridControl,relationship)};AddExistingFromSubGrid.prototype.createAssociateRequestQueue=function(base,lookupValue,gridControl,relationship){return this[base](lookupValue,gridControl,relationship)};AddExistingFromSubGrid.prototype.createAssociateRequestLead=function(base,lookupValue,gridControl,relationship){return this[base](lookupValue,gridControl,relationship)};AddExistingFromSubGrid.prototype.createAssociateRequestSystemUser=function(base,lookupValue,gridControl,relationship){return this[base](lookupValue,gridControl,relationship)};return AddExistingFromSubGrid}(Commands.AddExistingFromSubGridBase);Commands.AddExistingFromSubGrid=AddExistingFromSubGrid})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AddExistingFromSubGridStandardBase=function(_super){__extends(AddExistingFromSubGridStandardBase,_super);function AddExistingFromSubGridStandardBase(){_super.apply(this,arguments)}AddExistingFromSubGridStandardBase.prototype.addExistingFromSubGridStandard=function(gridTypeName,gridControl){var subGridControl=gridControl;!this.call("addExistingFromSubGrid",gridTypeName,gridControl)&&subGridControl&&this.call("locAssoc",gridTypeName,gridControl)};AddExistingFromSubGridStandardBase.prototype.locAssoc=function(gridTypeName,gridControl){var subGridControl=gridControl;if(subGridControl){var entityName=gridControl&&gridControl.getEntityName?gridControl.getEntityName():"",parentForm=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page,currentEntity=parentForm.data.entity?{id:parentForm.data.entity.getId().replace("{","").replace("}",""),name:parentForm.data.entity.getPrimaryAttributeValue(),entityType:parentForm.data.entity.getEntityName()}:null,lookup=Xrm.Utility.lookupObjects?Xrm.Utility.lookupObjects({allowMultiSelect:true,createFromEntity:currentEntity,defaultEntityType:entityName,entityTypes:[entityName],lookupType:"Lookup.PartyList"}):null;if(lookup){var _this_2=this;lookup.then(function(lookupValues){return _this_2.call("associateOneToManyRecords",lookupValues,gridControl,false)})}}};AddExistingFromSubGridStandardBase.prototype.associateOneToManyRecords=function(lookupValues,gridControl,overrideParent){if(!lookupValues||lookupValues.length===0)return;var subGridControl=gridControl,relationship=subGridControl&&subGridControl.getRelationship?subGridControl.getRelationship():null;if(relationship){var parentForm=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page,parentEntity=parentForm.data.entity.getEntityName(),parentId_1=parentForm.data.entity.getId().replace("{","").replace("}","");Xrm.Utility.getEntityMetadata(parentEntity).then(function(metadata){var recordCount=lookupValues.length,updatedRecords=0,updateRecord=function(lookupValue){var data={"@odata.type":"#Microsoft.Dynamics.CRM."+lookupValue.entityType};data[relationship.navigationPropertyName+"@odata.bind"]="/"+metadata.EntitySetName+"("+parentId_1+")";Xrm.WebApi.updateRecord(lookupValue.entityType,lookupValue.id,data).then(function(response){updatedRecords++;updatedRecords===recordCount&&gridControl&&gridControl.refresh&&gridControl.refresh()},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)},_loop_2=function(key){var lookupValue=lookupValues[key];if(overrideParent)updateRecord(lookupValue);else Xrm.WebApi.retrieveRecord(lookupValue.entityType,lookupValue.id).then(function(entity){!entity[relationship.attributeName]&&updateRecord(lookupValue)})};for(var key in lookupValues)_loop_2(key)})}};return AddExistingFromSubGridStandardBase}(Commands.AddExistingFromSubGrid);Commands.AddExistingFromSubGridStandardBase=AddExistingFromSubGridStandardBase})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AddExistingFromSubGridStandard=function(_super){__extends(AddExistingFromSubGridStandard,_super);function AddExistingFromSubGridStandard(){_super.apply(this,arguments);this.overrideMethods=AddExistingFromSubGridStandard.AddOverrideMethods(Commands.ADD_EXISTING_FROM_SUB_GRID_OVERRIDES)}AddExistingFromSubGridStandard.AddOverrideMethods=function(overrideMethods){overrideMethods["locAssoc"]={goal:"locAssocObjGoal"};overrideMethods["associateOneToManyRecords"]={territory:"associateOneToManyRecordsOverrideParent",mobileofflineprofile:"associateOneToManyRecordsOverrideParent"};return overrideMethods};AddExistingFromSubGridStandard.prototype.locAssocObjGoal=function(base,gridTypeName,gridControl){this[base](gridTypeName,gridControl)};AddExistingFromSubGridStandard.prototype.associateOneToManyRecordsOverrideParent=function(base,lookupValues,gridControl,overrideParent){this[base](lookupValues,gridControl,true)};return AddExistingFromSubGridStandard}(Commands.AddExistingFromSubGridStandardBase);Commands.AddExistingFromSubGridStandard=AddExistingFromSubGridStandard})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AddFromSubGridLibraryLegacy=function(){function AddFromSubGridLibraryLegacy(){}AddFromSubGridLibraryLegacy.prototype.addExistingFromSubGridAssociated=function(gridTypeName,gridControl){var gridTypeCode=Xrm.Internal.getEntityCode(gridTypeName),backCompatHeader=window.parent;Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.addExistingFromSubGridAssociated(gridTypeCode,gridControl):backCompatHeader.Mscrm.GridCommandActions.addExistingFromSubGridAssociated(gridTypeCode,gridControl)};AddFromSubGridLibraryLegacy.prototype.addExistingFromSubGridStandard=function(gridTypeName,gridControl){var gridTypeCode=Xrm.Internal.getEntityCode(gridTypeName),backCompatHeader=window.parent;Mscrm&&Mscrm.GridCommandActions&&Mscrm.GridControl?Mscrm.GridCommandActions.addExistingFromSubGridStandard(gridTypeCode,gridControl):backCompatHeader.Mscrm.GridCommandActions.addExistingFromSubGridStandard(gridTypeCode,gridControl)};return AddFromSubGridLibraryLegacy}();Commands.AddFromSubGridLibraryLegacy=AddFromSubGridLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AddFromSubGridLibrary=function(){function AddFromSubGridLibrary(){}AddFromSubGridLibrary.prototype.addExistingFromSubGridAssociated=function(gridTypeName,gridControl){var entityName=gridControl&&gridControl.getEntityName?gridControl.getEntityName():"",addExisting=new Commands.AddExistingFromSubGrid(entityName);addExisting.call("addExistingFromSubGrid",gridTypeName,gridControl)};AddFromSubGridLibrary.prototype.addExistingFromSubGridStandard=function(gridTypeName,gridControl){var entityName=gridControl&&gridControl.getEntityName?gridControl.getEntityName():"",addExisting=new Commands.AddExistingFromSubGridStandard(entityName);addExisting.addExistingFromSubGridStandard(gridTypeName,gridControl)};return AddFromSubGridLibrary}();Commands.AddFromSubGridLibrary=AddFromSubGridLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.AddFromSubGrid=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.AddFromSubGridLibrary:new Commands.AddFromSubGridLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AddToQueueLibraryLegacy=function(){function AddToQueueLibraryLegacy(){}AddToQueueLibraryLegacy.prototype.CommandBar=function(entityType){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);if(Mscrm&&Mscrm.CommandBarActions)Mscrm.CommandBarActions.addToQueue(Xrm.Internal.getEntityCode(entityType));else backCompatHeader.Mscrm.CommandBarActions.addToQueue(Xrm.Internal.getEntityCode(entityType))};AddToQueueLibraryLegacy.prototype.CommandBarLegacy=function(objectType){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);if(Mscrm&&Mscrm.CommandBarActions)Mscrm.CommandBarActions.addToQueue(objectType);else backCompatHeader.Mscrm.CommandBarActions.addToQueue(objectType)};AddToQueueLibraryLegacy.prototype.GridCommand=function(gridControl,records,entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);if(Mscrm&&Mscrm.CommandBarActions)Mscrm.GridCommandActions.addToQueue(gridControl,records,entityTypeCode);else backCompatHeader.Mscrm.GridCommandActions.addToQueue(gridControl,records,entityTypeCode)};return AddToQueueLibraryLegacy}();Commands.AddToQueueLibraryLegacy=AddToQueueLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AddToQueueLibrary=function(){function AddToQueueLibrary(){}AddToQueueLibrary.prototype.CommandBarLegacy=function(objectType){if(typeof objectType!=="number")objectType=parseInt(objectType,10);this.CommandBar(Xrm.Internal.getEntityName(objectType))};AddToQueueLibrary.prototype.CommandBar=function(entityType){var records=[],entityReference={Id:new Microsoft.Crm.Client.Core.Framework.Guid(Xrm.Page.data.entity.getId()),TypeName:entityType};records=[entityReference];var dialogParams={};dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records]=JSON.stringify(records);dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]=XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId;var options={},client=Xrm.Utility.getGlobalContext().client.getClient();if(client===Xrm.Constants.ClientNames.web||client==Xrm.Constants.ClientNames.outlook||client==Xrm.Constants.ClientNames.unifiedServiceDesk){options.height=235;options.width=450}Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.AddToQueueDialog,options,dialogParams).then(this.AddToQueueCommandBarDialogCloseCallback())};AddToQueueLibrary.prototype.GridCommand=function(gridControl,records,entityType){var selectedRecords=[];for(var i in records){var record=records[i],entityName=record.TypeName,entityReference={Id:new Microsoft.Crm.Client.Core.Framework.Guid(record.Id),TypeName:entityName};selectedRecords.push(entityReference)}var dialogParams={};dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records]=JSON.stringify(selectedRecords);dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]=XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.GridControl]=JSON.stringify(gridControl);var dialogOptions={},client=Xrm.Utility.getGlobalContext().client.getClient();if(client===Xrm.Constants.ClientNames.web||client==Xrm.Constants.ClientNames.outlook||client==Xrm.Constants.ClientNames.unifiedServiceDesk){dialogOptions.height=235;dialogOptions.width=450}Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.AddToQueueDialog,dialogOptions,dialogParams).then(Commands.Common.gridCommandDialogCloseCallback(gridControl))};AddToQueueLibrary.prototype.AddToQueueCommandBarDialogCloseCallback=function(){return function(callbackParams){var constants=XrmCore.InternalUtilities.DialogUtilities.DialogConstants,client=Xrm.Utility.getGlobalContext().client.getClient();(client===Xrm.Constants.ClientNames.web||callbackParams.parameters[constants.LastButtonClicked]==constants.DialogOkId)&&Xrm.Page.data.refresh(true)}};return AddToQueueLibrary}();Commands.AddToQueueLibrary=AddToQueueLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.AddToQueue=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.AddToQueueLibrary:new Commands.AddToQueueLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AssignLibraryLegacy=function(){function AssignLibraryLegacy(){this.assignObjectLegacy=function(objectType){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.assignObject(objectType):backCompatHeader.Mscrm.CommandBarActions.assignObject(objectType)};this.assignObject=function(entityTypeName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true),objectType=Xrm.Internal.getEntityCode(entityTypeName);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.assignObject(objectType):backCompatHeader.Mscrm.CommandBarActions.assignObject(objectType)};this.assignObjectOnLegacyForm=function(entityTypeName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true),objectType=Xrm.Internal.getEntityCode(entityTypeName);Mscrm&&Mscrm.FormAction?Mscrm.FormAction.assignObject(objectType):backCompatHeader.Mscrm.FormAction.assignObject(objectType)};this.assignObjectOnLegacyForms=function(objectType){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.FormAction?Mscrm.FormAction.assignObject(objectType):backCompatHeader.Mscrm.FormAction.assignObject(objectType)};this.assignQueueLegacy=function(entityId,objectType){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.assignQueue(entityId,objectType):backCompatHeader.Mscrm.CommandBarActions.assignQueue(entityId,objectType)};this.assignQueue=function(entityId,entityTypeName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true),objectType=Xrm.Internal.getEntityCode(entityTypeName);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.assignQueue(entityId,objectType):backCompatHeader.Mscrm.CommandBarActions.assignQueue(entityId,objectType)};this.assignSelectedRecordsLegacy=function(gridControl,selectedRecords,entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.CommandBarActions?Mscrm.GridCommandActions.assignSelectedRecords(gridControl,selectedRecords,entityTypeCode):backCompatHeader.Mscrm.GridCommandActions.assignSelectedRecords(gridControl,selectedRecords,entityTypeCode)};this.assignSelectedRecords=function(gridControl,selectedRecords,entityName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false),entityTypeCode=Xrm.Internal.getEntityCode(entityName);Mscrm&&Mscrm.CommandBarActions?Mscrm.GridCommandActions.assignSelectedRecords(gridControl,selectedRecords,entityTypeCode):backCompatHeader.Mscrm.GridCommandActions.assignSelectedRecords(gridControl,selectedRecords,entityTypeCode)};this.assignCloseDialog=function(){Commands.Common.closeDialogLegacy()};this.assignDialogAssignClick=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.assignDialogAssignClick():backCompatHeader.Mscrm.GridCommandActions.assignDialogAssignClick()};this.assignDialogAssignToChange=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.assignDialogAssignToChange():backCompatHeader.Mscrm.GridCommandActions.assignDialogAssignToChange()};this.assignDialogOnLoad=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.assignDialogOnLoad():backCompatHeader.Mscrm.GridCommandActions.assignDialogOnLoad()};this.assignDialogSystemUserChange=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.assignDialogSystemUserChange():backCompatHeader.Mscrm.CommandBarActions.assignDialogSystemUserChange()}}return AssignLibraryLegacy}();Commands.AssignLibraryLegacy=AssignLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var AssignLibrary=function(){function AssignLibrary(){var _this=this;this.assignObjectLegacy=function(objectType){if(typeof objectType!=="number")objectType=parseInt(objectType,10);_this.assignObject(Xrm.Internal.getEntityName(objectType))};this.assignObjectOnLegacyForm=function(entityTypeName){_this.assignObject(entityTypeName)};this.assignObjectOnLegacyForms=function(objectType){_this.assignObjectLegacy(objectType)};this.assignObject=function(entityTypeName){var id=Xrm.Page.data.entity.getId();if(entityTypeName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.Incident||Xrm.Utility.isActivityType(entityTypeName))_this.assignQueue(id,entityTypeName);else{var entityReference={Id:id,TypeName:entityTypeName,Name:Xrm.Page.data.entity.getEntityReference().name},records=[entityReference],dialogParams={};dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityId]=id;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityName]=entityTypeName;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityTypeCode]=Xrm.Internal.getEntityCode(entityTypeName).toString();dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records]=XrmCore.InternalUtilities.DialogUtilities.serializeSdkEntityReferences(records);dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.SelectedRecordsCount]=records.length;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]="";dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerId]="";dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerType]="";var dialogOptions=null;switch(entityTypeName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SLA:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ConvertRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RoutingRule:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Workflow:break;default:break}Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.Assign,dialogOptions,dialogParams).then(_this.assignDialogCloseCallback(dialogParams))}};this.assignQueueLegacy=function(entityId,objectType){if(typeof objectType!=="number")objectType=parseInt(objectType,10);_this.assignQueue(entityId,Xrm.Internal.getEntityName(objectType))};this.assignQueue=function(entityId,entityTypeName){if(!(entityTypeName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.Incident||Xrm.Utility.isActivityType(entityTypeName)))return;var entityReference={Id:entityId,TypeName:entityTypeName,Name:Xrm.Page.data.entity.getEntityReference().name},dialogParams={};dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityId]=entityId;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityTypeCode]=Xrm.Internal.getEntityCode(entityTypeName).toString();dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.SelectedRecordsCount]="1";dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityName]=entityTypeName;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]=XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerId]="";dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerType]="";dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.ShowAssignToMeOption]=true;var dialogOptions={height:undefined,width:undefined,position:null};Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.AssignQueue,dialogOptions,dialogParams).then(_this.assignQueueDialogCloseCallback(null,dialogParams,[entityReference]))};this.assignSelectedRecordsLegacy=function(gridControl,selectedRecords,entityTypeCode){_this.assignSelectedRecords(gridControl,selectedRecords,Xrm.Internal.getEntityName(entityTypeCode))};this.assignSelectedRecords=function(gridControl,selectedRecords,entityName){if(Xrm.Internal.isUci()&&entityName==Xrm.Constants.EntityNames.ActivityPointer){var thisObject=_this,promise=Xrm.Utility.getEntitiesMetadata(Commands.Common.GetEntityNamesFromActivityRecords(selectedRecords));selectedRecords.length>0&&promise.then(function(values){!Commands.Common.CheckIfIsReadOnlyInMobileClient(values)&&thisObject.assignSelectedRecordsCallBack(gridControl,selectedRecords,entityName)})}else _this.assignSelectedRecordsCallBack(gridControl,selectedRecords,entityName)};this.assignSelectedRecordsCallBack=function(gridControl,selectedRecords,entityName){if(selectedRecords.length<=0){var alert_1={text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Action_NoItemSelected")};Xrm.Navigation.openAlertDialog(alert_1);return}var dialogOptions=null,assignQueue=false,setSelectedSubTypes=false,height=285,width=456;if(Xrm.Utility.isActivityType(entityName))assignQueue=true;switch(entityName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.QueueItem:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.PhoneCall:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Appointment:setSelectedSubTypes=true;assignQueue=true;break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ActivityPointer:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Email:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Fax:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Letter:setSelectedSubTypes=true;assignQueue=true;break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Incident:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Task:assignQueue=true;break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignResponse:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignActivity:assignQueue=true;break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SLA:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ConvertRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RoutingRule:break}var dialogParams={};dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityName]=entityName;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]="";dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerId]="";dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerType]="";if(assignQueue){if(selectedRecords.length>0){dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.SelectedRecordsCount]=String(selectedRecords.length);dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records]=XrmCore.InternalUtilities.DialogUtilities.serializeSdkEntityReferences(selectedRecords);dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.ShowAssignToMeOption]=true;Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.AssignQueue,dialogOptions,dialogParams).then(_this.assignQueueDialogCloseCallback(gridControl,dialogParams,selectedRecords))}}else if(selectedRecords.length>0){var callback=_this.gridAssignDialogCloseCallback(gridControl,selectedRecords,dialogParams);dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.SelectedRecordsCount]=selectedRecords.length;Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.Assign,dialogOptions,dialogParams).then(callback)}};this.assignCloseDialog=function(eventContext){XrmCore.InternalUtilities.DialogUtilities.closeDialog(eventContext)};this.assignDialogAssignClick=function(eventContext){var formContext=eventContext.getFormContext();if(!formContext)if(Xrm.Page)formContext=Xrm.Page;else return;var ownerId="",ownerType="",assignTo=formContext.data.attributes.get("rdoMe_id"),assignToLookupControl=formContext.data.attributes.get("systemuserview_id"),disableAssignToLookupControl=assignTo.getValue();if(disableAssignToLookupControl){var selectedUser=assignToLookupControl.getValue();if(!selectedUser||selectedUser.length===0){var errorStrings=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web._grid.cmds.dlg_assignallrecords.aspx_60");Xrm.Navigation.openAlertDialog({text:errorStrings});return}else{ownerId=selectedUser[0].id;ownerType=selectedUser[0].entityType}}else{ownerId=formContext.context.getUserId();ownerType=XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemUser}formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerId).setValue(ownerId);formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerType).setValue(ownerType);formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked).setValue(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId);formContext.ui.close()};this.assignDialogAssignToChange=function(eventContext){var formContext=eventContext.getFormContext();if(!formContext)if(Xrm.Page)formContext=Xrm.Page;else return;var assignTo=formContext.data.attributes.get("rdoMe_id"),assignToLookupControl=formContext.getControl("systemuserview_id"),disableAssignToLookupControl=assignTo.getValue(),assignButton=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId);if(assignToLookupControl&&disableAssignToLookupControl){assignToLookupControl.setDisabled(false);var lookupValue=assignToLookupControl.getAttribute().getValue();assignButton&&(!lookupValue||lookupValue.length===0)&&assignButton.setDisabled(true)}else{assignToLookupControl.setDisabled(true);assignButton&&assignButton.setDisabled(false)}};this.assignDialogOnLoad=function(eventContext){var formContext=eventContext.getFormContext();if(!formContext)if(Xrm.Page)formContext=Xrm.Page;else return;var assignTo=formContext.data.attributes.get("rdoMe_id");assignTo&&assignTo.setValue(false);var entityName="",displayName="",entityDisplaySetName="",entityAttribute=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityName);if(entityAttribute){entityName=entityAttribute.getValue();var entityCallback=function(entityMap){var entityInfo=entityMap[entityName];displayName=entityInfo.DisplayName;entityDisplaySetName=entityInfo.DisplayCollectionName;var assignHeader=formContext.getControl("assignheader_id"),headerLabel=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Assign_Title");assignHeader.setLabel(XrmCore.InternalUtilities.GenericUtilities.stringFormat(headerLabel?headerLabel:"Assign",[displayName]));var headerDescription=formContext.getControl("label_headerdescription"),selectedRecordsCount=0,recordsCount=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.SelectedRecordsCount);if(recordsCount&&recordsCount.getValue())selectedRecordsCount=recordsCount.getValue();var titleDescription="";if(selectedRecordsCount===1){var singularDescription=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Assign_DescriptionSingular");titleDescription=XrmCore.InternalUtilities.GenericUtilities.stringFormat(singularDescription?singularDescription:" ",[selectedRecordsCount,displayName])}else if(selectedRecordsCount>1){var pluralDescription=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Assign_DescriptionPlural");titleDescription=XrmCore.InternalUtilities.GenericUtilities.stringFormat(pluralDescription?pluralDescription:" ",[selectedRecordsCount,entityDisplaySetName])}headerDescription.setLabel(titleDescription);_this.assignDialogAssignToChange(eventContext)};XrmCore.InternalUtilities.GenericUtilities.createChainedEntityMetadataMapWithCallback([entityName],0,{},entityCallback)}};this.assignDialogSystemUserChange=function(eventContext){var formContext=eventContext.getFormContext();if(!formContext)if(Xrm.Page)formContext=Xrm.Page;else return;var assignToLookupAttribute=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.SystemUserViewId);if(assignToLookupAttribute){var selectedItems=assignToLookupAttribute.getValue(),assignButton=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId);if(!assignButton)return;if(!selectedItems||selectedItems.length===0)assignButton.setDisabled(true);else assignButton.setDisabled(false)}};this.gridAssignDialogCloseCallback=function(gridControl,records,dialogParams){var assignMultiple=_this.assignMultipleRecords;return function(dialogResponse){if(dialogResponse&&dialogResponse.parameters&&dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId){var ownerId=dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerId].toString(),ownerType=dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerType].toString();if(XrmCore.InternalUtilities.DialogUtilities.isOffline()){XrmCore.InternalUtilities.DialogUtilities.showOfflineError();return}if(ownerId&&ownerType){XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();if(records.length===1){var assignRequest=new XrmCore.SdkContracts.AssignRequest;assignRequest.Target=XrmCore.InternalUtilities.GenericUtilities.ConvertEntityRefToLookUp(records[0]);assignRequest.Assignee={entityType:ownerType,id:ownerId};Xrm.WebApi.online.execute(assignRequest).then(function(response){Xrm.Utility.closeProgressIndicator();gridControl&&gridControl.refresh()},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)}else assignMultiple(ownerId,ownerType,gridControl,records)}}}};this.assignDialogCloseCallback=function(dialogParams){var shouldSaveBeforeAssigning=_this.shouldSaveBeforeAssigning;return function(dialogResponse){if(dialogResponse&&dialogResponse.parameters&&dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId){var ownerId_1=dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerId].toString(),ownerType_1=dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerType].toString(),entityName_1=dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityName].toString(),entityId_1=dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityId].toString();if(Xrm.Utility.getGlobalContext().client.getClientState()===Xrm.Constants.ClientStates.offline){XrmCore.InternalUtilities.DialogUtilities.showOfflineError();return}if(shouldSaveBeforeAssigning(entityName_1)){var saveOptions={useSchedulingEngine:false,saveMode:47};XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();Xrm.Page.data.save(saveOptions).then(function(success){var assignRequest=new XrmCore.SdkContracts.AssignRequest;assignRequest.Target={entityType:entityName_1,id:entityId_1};assignRequest.Assignee={entityType:ownerType_1,id:ownerId_1};Xrm.WebApi.online.execute(assignRequest).then(function(response){Xrm.Utility.closeProgressIndicator();Commands.Common.performPageDataAndRibbonRefresh()},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)}else{var assignRequest=new XrmCore.SdkContracts.AssignRequest;assignRequest.Target={entityType:entityName_1,id:entityId_1};assignRequest.Assignee={entityType:ownerType_1,id:ownerId_1};XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();Xrm.WebApi.online.execute(assignRequest).then(function(response){Xrm.Utility.closeProgressIndicator();Commands.Common.performPageDataAndRibbonRefresh()},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)}}}};this.shouldSaveBeforeAssigning=function(entityName){if(Xrm.Utility.getGlobalContext().client.getClient()!==Xrm.Constants.ClientNames.mobile||Xrm.Page.data.entity.getIsDirty())return true;return entityName!==XrmCore.InternalUtilities.EntityUtilities.EntityNames.Quote&&entityName!==XrmCore.InternalUtilities.EntityUtilities.EntityNames.QuoteDetail&&entityName!==XrmCore.InternalUtilities.EntityUtilities.EntityNames.SalesOrder&&entityName!==XrmCore.InternalUtilities.EntityUtilities.EntityNames.SalesOrderDetail&&entityName!==XrmCore.InternalUtilities.EntityUtilities.EntityNames.Invoice&&entityName!==XrmCore.InternalUtilities.EntityUtilities.EntityNames.InvoiceDetail}}AssignLibrary.prototype.assignQueueDialogCloseCallback=function(gridControl,dialogParams,records){var assignMultiple=this.assignMultipleRecords;return function(dialogResponse){if(dialogResponse&&dialogResponse.parameters&&(dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.AssignRequest]&&dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.AssignRequest]===true)&&(dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityName]&&dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityName]===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Task||XrmCore.InternalUtilities.DialogUtilities.DialogConstants.activityLogicalName)){Xrm.Page.data&&Xrm.Page.data.refresh();gridControl&&gridControl.refresh();return}if(dialogResponse&&dialogResponse.parameters&&dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]&&dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId){var ownerId_2=dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerId].toString(),ownerType_2=dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OwnerType].toString();if(ownerId_2&&ownerType_2){XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();var updatedGridControl=null;if(dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.GridControl])updatedGridControl=dialogResponse.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.GridControl];else updatedGridControl=gridControl;if(Xrm.Utility.getGlobalContext().client.getClientState()===Xrm.Constants.ClientStates.offline){XrmCore.InternalUtilities.DialogUtilities.showOfflineError();return}Xrm.Utility.getEntityMetadata(ownerType_2).then(function(metadata){if(records.length===1){var assignRequest=new XrmCore.SdkContracts.AssignRequest;assignRequest.Target=XrmCore.InternalUtilities.GenericUtilities.ConvertEntityRefToLookUp(records[0]);assignRequest.Assignee={entityType:ownerType_2,id:ownerId_2};Xrm.WebApi.online.execute(assignRequest).then(function(response){Xrm.Utility.closeProgressIndicator();gridControl&&gridControl.refresh();Xrm.Page.data&&Xrm.Page.data.refresh()},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)}else assignMultiple(ownerId_2,ownerType_2,gridControl,records)})}}}};AssignLibrary.prototype.assignMultipleRecords=function(ownerId,ownerType,gridControl,records){var assignBatch=records.map(function(record){var assignRequest=new XrmCore.SdkContracts.AssignRequest;assignRequest.Target=XrmCore.InternalUtilities.GenericUtilities.ConvertEntityRefToLookUp(record);assignRequest.Assignee={entityType:ownerType,id:ownerId};return assignRequest});Xrm.WebApi.online.executeMultiple(assignBatch).then(function(success){Xrm.Utility.closeProgressIndicator();XrmCore.InternalUtilities.DialogUtilities.onGridActionMultipleSuccess(gridControl,success)},function(error){gridControl.refresh();Xrm.Utility.closeProgressIndicator();XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)})};return AssignLibrary}();Commands.AssignLibrary=AssignLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Assign=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.AssignLibrary:new Commands.AssignLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var CloseLibraryLegacy=function(){function CloseLibraryLegacy(){this.closeActivityFromGrid=function(gridControl,records){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);if(Mscrm&&Mscrm.GridRibbonActions&&Mscrm.GridRibbonActions.addActivityFromGrid)Mscrm.GridCommandActions.closeActivityFromGrid(gridControl,records);else backCompatHeader.Mscrm.GridCommandActions.closeActivityFromGrid(gridControl,records)};this.closeActivityFromGridLegacy=function(gridControl,records){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);if(Mscrm&&Mscrm.GridRibbonActions&&Mscrm.GridRibbonActions.addActivityFromGrid)Mscrm.GridCommandActions.closeActivityFromGrid(gridControl,records);else backCompatHeader.Mscrm.GridCommandActions.closeActivityFromGrid(gridControl,records)}}return CloseLibraryLegacy}();Commands.CloseLibraryLegacy=CloseLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var CloseLibrary=function(){function CloseLibrary(){this.CloseActivity=function(entityId,entityName){Commands.Common.handleStateChangeAction(entityName,entityId,false)};this.closeActivityFromGrid=function(gridControl,records){for(var _i=0,records_1=records;_i<records_1.length;_i++){var entity=records_1[_i];Commands.Common.handleStateChangeAction(entity.TypeName,entity.Id,false,gridControl)}}}return CloseLibrary}();Commands.CloseLibrary=CloseLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Close=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.CloseLibrary:new Commands.CloseLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var ChangeStateLibraryLegacy=function(){function ChangeStateLibraryLegacy(){}ChangeStateLibraryLegacy.prototype.changeState=function(action,objectType,formEventId,objectSubtype){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.FormAction?Mscrm.FormAction.changeState(action,objectType,formEventId,objectSubtype):backCompatHeader.Mscrm.FormAction.changeState(action,objectType,formEventId,objectSubtype)};ChangeStateLibraryLegacy.prototype.deactivateClick=function(){Commands.Common.deactivateClickLegacy()};ChangeStateLibraryLegacy.prototype.onLoadSetState=function(){Commands.Common.onLoadSetStateLegacy()};ChangeStateLibraryLegacy.prototype.onStateChange=function(){Commands.Common.onStateChangeLegacy()};ChangeStateLibraryLegacy.prototype.changeStateCloseDialog=function(){Commands.Common.closeDialogLegacy()};return ChangeStateLibraryLegacy}();Commands.ChangeStateLibraryLegacy=ChangeStateLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var ChangeStateLibrary=function(){function ChangeStateLibrary(){}ChangeStateLibrary.prototype.changeState=function(action,objectType,formEventId,objectSubtype){var activate;switch(action){case "activate":activate=true;break;case "deactivate":activate=false;break;default:return}var id=Xrm.Page.data.entity.getId(),entityName=Xrm.Page.data.entity.getEntityName();Commands.Common.changeState(entityName,id,activate)};ChangeStateLibrary.prototype.changeStateCloseDialog=function(eventContext){XrmCore.InternalUtilities.DialogUtilities.closeDialog(eventContext)};ChangeStateLibrary.prototype.onLoadSetState=function(eventContext){Commands.Common.onLoadSetState(eventContext)};ChangeStateLibrary.prototype.onStateChange=function(eventContext){Commands.Common.onStateChange(eventContext)};ChangeStateLibrary.prototype.deactivateClick=function(eventContext){Commands.Common.deactivateClick(eventContext)};return ChangeStateLibrary}();Commands.ChangeStateLibrary=ChangeStateLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.ChangeState=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.ChangeStateLibrary:new Commands.ChangeStateLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.polyfillingCustomEvent=function(){if(typeof Event==="function")return false;function CustomEvent(event,params){if(params===void 0)params={bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}window.CustomEvent=CustomEvent};var Common=function(){function Common(){}Common.changeState=function(entityType,id,activate){Common.handleStateChangeAction(entityType,id,activate)};Common.handleStateChangeAction=function(entityName,id,activate,gridControl){var options=null,client=Xrm.Utility.getGlobalContext().client.getClient();if(client===Xrm.Constants.ClientNames.web||client==Xrm.Constants.ClientNames.outlook||client==Xrm.Constants.ClientNames.unifiedServiceDesk)options={height:250,width:600,position:1};var dialogArguments={};dialogArguments[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.action]=activate?XrmCore.InternalUtilities.DialogUtilities.DialogConstants.activate:XrmCore.InternalUtilities.DialogUtilities.DialogConstants.deactivate;dialogArguments[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]="";dialogArguments[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StateId]=-1;dialogArguments[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StatusId]=-1;var records=[{TypeName:entityName,Id:id}];dialogArguments[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records]=records;Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.SetStateDialog,options,dialogArguments).then(function(successParameter){if(successParameter&&successParameter.parameters&&successParameter.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId){var state_3=successParameter.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StateId],status_1=successParameter.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StatusId];XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();if(gridControl)Common.SetEntityState(entityName,id,Number(state_3),Number(status_1)).then(function(successParameter){Xrm.Utility.closeProgressIndicator();gridControl.refresh();gridControl.refreshRibbon()},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog);else{var statecodeAttribute=Xrm.Page.data.entity.attributes&&Xrm.Page.data.entity.attributes.get("statecode"),statuscodeAttribute=Xrm.Page.data.entity.attributes&&Xrm.Page.data.entity.attributes.get("statuscode");statecodeAttribute&&statecodeAttribute.getIsDirty()&&statecodeAttribute.setValue(statecodeAttribute.getInitialValue());statuscodeAttribute&&statuscodeAttribute.getIsDirty()&&statuscodeAttribute.setValue(statuscodeAttribute.getInitialValue());Xrm.Page.data.save({saveMode:activate?6:5}).then(function(successParameter){Common.SetEntityState(entityName,id,Number(state_3),Number(status_1)).then(function(successParameter){Xrm.Utility.closeProgressIndicator();Common.performPageRefresh(entityName,false)},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)}}})};Common.SetEntityState=function(entityType,id,state,status){var entity={};entity["statecode"]=state;if(status||status===0)entity["statuscode"]=status;else entity["statuscode"]=-1;return Xrm.WebApi.updateRecord(entityType,id,entity)};Common.setEntityIsDisabled=function(entityType,id,isDisabled){var entity={};entity["isdisabled"]=isDisabled;return Xrm.WebApi.updateRecord(entityType,id,entity)};Common.gridCommandDialogCloseCallback=function(_gridControl){return function(callbackParams){var constants=XrmCore.InternalUtilities.DialogUtilities.DialogConstants,gridControl=callbackParams.parameters[constants.GridControl]?callbackParams.parameters[constants.GridControl]:_gridControl;gridControl&&gridControl.refresh&&callbackParams.parameters[constants.LastButtonClicked]&&callbackParams.parameters[constants.LastButtonClicked]===constants.DialogOkId&&gridControl.refresh()}};Common.closeSetStateDialogFromGridCallback=function(dialogParams,callbackParams,gridControl,callback){if(dialogParams&&dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId){var records=dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records];if(!records||!records[0])return;var entityName=records[0].TypeName,isSystemUser=entityName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemUser,selectedState_1=dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StateId],selectedStatus_1=dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StatusId],action_name=dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.action],isDisabled_1=action_name===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.deactivate;XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();if(records.length===1){var entityId=records[0].Id,updateEntityPromise=isSystemUser?Common.setEntityIsDisabled(entityName,entityId,isDisabled_1):Common.SetEntityState(entityName,entityId,selectedState_1,selectedStatus_1);updateEntityPromise.then(function(successParameter){Xrm.Utility.closeProgressIndicator();gridControl&&gridControl.refresh();callback&&callback()},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)}else{var updateEntityRequests=void 0;if(isSystemUser)updateEntityRequests=records.map(function(record){return new XrmCore.SdkContracts.SetIsDisabledRequest(record.Id,record.TypeName,isDisabled_1)});else updateEntityRequests=records.map(function(record){return new XrmCore.SdkContracts.SetStateRequest(record.Id,record.TypeName,selectedState_1,selectedStatus_1)});Xrm.WebApi.online.executeMultiple(updateEntityRequests).then(function(success){Xrm.Utility.closeProgressIndicator();if(success.every(function(response){return response.ok})){gridControl&&gridControl.refresh();callback&&callback()}else{Common.openAlertDialogForSetStateMultipleError(gridControl);gridControl&&gridControl.refresh()}},function(error){Xrm.Utility.closeProgressIndicator();Common.openAlertDialogForSetStateMultipleError(gridControl);gridControl&&gridControl.refresh()})}}};Common.openAlertDialogForSetStateMultipleError=function(gridControl){var alertDialogStrings={text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Action_MultipleErrorsFound")};Xrm.Navigation.openAlertDialog(alertDialogStrings).then(function(successParameter){gridControl.refresh()})};Common.setState=function(entityId,entityName,stateCode,statusCode,closeWindow,entityToOpen,entityIdToOpen,saveMode){if(Xrm.Page.data.entity.getId()===null||Xrm.Page.data.entity.getId()===undefined||!Xrm.Page.data.isValid())return;if(!statusCode&&statusCode!==0)statusCode=-1;else if(stateCode===-1){Xrm.Utility.getEntityMetadata(entityName,["statuscode"]).then(function(entityMetadata){var statusMetadata=entityMetadata.Attributes.get("statuscode"),stateCode=statusMetadata.getState(statusCode);Common.setStateInternal(entityId,entityName,stateCode,statusCode,closeWindow,entityToOpen,entityIdToOpen)},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog);return}Common.setStateInternal(entityId,entityName,stateCode,statusCode,closeWindow,entityToOpen,entityIdToOpen,saveMode)};Common.setStateInternal=function(entityId,entityName,stateCode,statusCode,closeWindow,entityToOpen,entityIdToOpen,saveMode){if(!Common.isBusy){Common.isBusy=true;var saveOptions={useSchedulingEngine:false};if(saveMode)saveOptions.saveMode=saveMode;Xrm.Page.data.save(saveOptions).then(function(successParameter){Common.setStateUpdate(entityId,entityName,stateCode,statusCode,closeWindow,entityToOpen,entityIdToOpen)},function(error){Common.isBusy=false;XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)})}};Common.setStateUpdate=function(entityId,entityName,stateCode,statusCode,closeWindow,entityToOpen,entityIdToOpen){if(!entityId||!entityId.length)entityId=Xrm.Page.data.entity.getId();Common.SetEntityState(entityName,entityId,stateCode,statusCode).then(function(setStateResponse){Common.postSetState(entityId,entityName,closeWindow,entityToOpen,entityIdToOpen)},function(error){Common.isBusy=false;XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)})};Common.postSetState=function(entityId,entityName,closeWindow,entityToOpen,entityIdToOpen){if(closeWindow){if(entityToOpen&&entityIdToOpen)Xrm.Utility.openEntityForm(entityToOpen,entityIdToOpen,null);else Xrm.Utility.getEntityMetadata(entityName).then(function(successParameter){var interactionCentric=successParameter.IsInteractionCentricEnabled,oneCount=false;if(!interactionCentric&&oneCount)Xrm.Page.data.refresh(true);else{Common.refreshParentGrid(entityId,entityName);Xrm.Page.ui.close()}},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog);Common.isBusy=false;return}if(entityToOpen&&entityIdToOpen)Xrm.Utility.openEntityForm(entityToOpen,entityIdToOpen,null);else{Xrm.Page.data.refresh(true);Common.refreshParentGrid(entityId,entityName);Common.performPageRefresh(entityName,true)}Common.isBusy=false};Common.refreshParentGrid=function(id,entityName){if(entityName);};Common.performPageRefresh=function(entityName,shouldSaveAndRefresh){Xrm.Utility.getEntityMetadata(entityName).then(function(successParameter){if(successParameter.IsInteractionCentricEnabled)if(shouldSaveAndRefresh)Xrm.Page.data.save().then(function(successParameter){Common.performPageDataAndRibbonRefresh()},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog);else Common.performPageDataAndRibbonRefresh();else Xrm.Page.data.refresh(true)},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)};Common.performPageDataAndRibbonRefresh=function(){Xrm.Page.data.refresh(true).then(function(successParameter){Xrm.Page.ui.refreshRibbon()},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)};Common.deactivateClick=function(eventContext){if(XrmCore.InternalUtilities.DialogUtilities.isOffline()){XrmCore.InternalUtilities.DialogUtilities.showOfflineError();return}var formContext=eventContext.getFormContext(),statusId=formContext&&formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StatusId)?formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StatusId).getAttribute().getValue():undefined,allowedEntity=false;if(formContext&&formContext.data&&formContext.data.attributes){var recordsAttribute=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records),records=recordsAttribute&&recordsAttribute.getValue(),entityName=records&&records[0]&&records[0].TypeName?records[0].TypeName:null;allowedEntity=entityName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemUser}if(statusId!==null&&statusId!==undefined||allowedEntity){XrmCore.InternalUtilities.DialogUtilities.setLastButtonClicked(eventContext,XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId);formContext.ui.close()}};Common.onLoadSetState=function(eventContext){var formContext=eventContext.getFormContext();if(!formContext)if(Xrm.Page)formContext=Xrm.Page;else throw new Error("No Client API frame can be found");if(XrmCore.InternalUtilities.DialogUtilities.isOffline()){XrmCore.InternalUtilities.DialogUtilities.showOfflineError();formContext.ui.close();return}var actionName=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.action).getValue(),records=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records).getValue();if(!records||records.length===0)return;var entityName=records[0].TypeName,entityDisplayName="",entityDisplaySetName="",entityCallback=function(entityMap){var entityInfo=entityMap[entityName];entityDisplayName=entityInfo.DisplayName;entityDisplaySetName=entityInfo.DisplayCollectionName;Common.setLabelsForDeactivateDialog(formContext,entityName,entityDisplayName,entityDisplaySetName,records.length,actionName);if(!entityInfo.EnforceStateTransitions){Common.loadStates(formContext,entityName,actionName);return}var _failedCallback=function(recordId,entityName,functionName,errorResponse){throw new Error("Function: onLoadSetState: Retrieve record "+recordId+" from "+entityName+" failed from the Client API "+functionName)};Xrm.WebApi.online.retrieveRecord(entityName,records[0].Id).then(function(recordData){var statusCode=recordData["statuscode"];Xrm.Utility.getAllowedStatusTransitions(entityName,statusCode).then(function(allowedTransitions){if(!allowedTransitions||allowedTransitions.length===0)Common.setNoTransitionsWarning(formContext);else{formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.allowedTransitions).setValue(allowedTransitions);Common.setLabelsForDeactivateDialog(formContext,entityName,entityDisplayName,entityDisplaySetName,records.length,actionName);Common.loadStates(formContext,entityName,actionName)}},function(errorResponse){_failedCallback(records[0].Id,entityName,"Xrm.Utility.getAllowedStatusTransitions",errorResponse)})},function(errorResponse){_failedCallback(records[0].Id,entityName,"Xrm.WebApi.online.retrieveRecord",errorResponse)})};XrmCore.InternalUtilities.GenericUtilities.createChainedEntityMetadataMapWithCallback([entityName],0,{},entityCallback)};Common.setNoTransitionsWarning=function(formContext){var headerControl=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.HeaderTitleId),descriptionControl=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DescriptionId),okButtonControl=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId),cancelButtonControl=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogCancelId);headerControl!==undefined&&headerControl!==null&&headerControl.setLabel(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web._grid.cmds.dlg_deactivate.aspx_200_Activate_warning_Title"));descriptionControl.setLabel("");okButtonControl.setLabel(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_OK")?"OK":"OK");okButtonControl.setVisible(false);cancelButtonControl.setLabel(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_OK")?XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_OK"):"OK");cancelButtonControl.setVisible(true);var action=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.action).getValue(),messageToDisplay=action===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.activate?"Web._grid.cmds.dlg_deactivate.aspx_200_Activate_warning":"Web._grid.cmds.dlg_deactivate.aspx_200_Deactivate_warning";formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.MessageId).setLabel(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString(messageToDisplay))};Common.onActionMenuClickLegacy=function(action,entityTypeCode,objectSubtype,callbackArgumentRef){return Common.onActionMenuClick(action,Xrm.Internal.getEntityName(entityTypeCode),objectSubtype,callbackArgumentRef)};Common.onActionMenuClick=function(action,entityName,objectSubtype,callbackArgumentRef){if(Xrm.Internal.isUci&&Xrm.Internal.isUci()){var clickContext={};clickContext["action"]=action;clickContext["objectType"]=Xrm.Internal.getEntityCode(entityName);clickContext["objectSubtype"]=objectSubtype;clickContext["callbackArgumentRef"]=callbackArgumentRef;return Common.handleActionMenuClick(clickContext)}else{var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false),entityTypeCode=Xrm.Internal.getEntityCode(entityName);return Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.onActionMenuClick(action,entityTypeCode,objectSubtype,callbackArgumentRef):backCompatHeader.Mscrm.CommandBarActions.onActionMenuClick(action,entityTypeCode,objectSubtype,callbackArgumentRef)}};Common.handleActionMenuClick=function(clickContext){var action=null,objectType=null,objectTypeName=null,objectSubtype=null,callbackArgumentRef=null,recordId=null;if("action" in clickContext)action=clickContext["action"];if("objectType" in clickContext){objectTypeName=Xrm.Internal.getEntityName(clickContext["objectType"]);objectType=clickContext["objectType"]}if("objectSubtype" in clickContext)objectSubtype=clickContext["objectSubtype"];if("callbackArgumentRef" in clickContext)callbackArgumentRef=clickContext["callbackArgumentRef"];if("recordId" in clickContext)recordId=clickContext["recordId"];if(typeof objectType!=="number")objectType=parseInt(objectType,10);var x=400,y=200,close=false,reload=false,result=null,firstResult=null,callbackRef=null,isDialogInline=false,id=null;if(recordId)id=recordId;else id=Xrm.Page.data.entity.getId();var ids=[id],url=Xrm.Utility.getGlobalContext().prependOrgName("/_grid/cmds/dlg_");url=url.concat(encodeURIComponent(action.toString()),".aspx?dType=1");url=url.concat("&iObjType=",encodeURIComponent(objectType.toString()));url=url.concat("&iTotal=",encodeURIComponent("1"));url=url.concat("&sIds=",encodeURIComponent(id.toString()));if(objectSubtype!=null)url=url.concat("&iObjSubType=",encodeURIComponent(objectSubtype));switch(action){case "share":x=800;y=480;isDialogInline=true;break;case "grant":x=925;y=560;isDialogInline=true;break}if(action!=="delete"){if(action==="share"){var UCIDialogEnabled=Xrm.Internal.isFeatureEnabled("UCIShareDialog")&&Xrm.Internal.isFeatureEnabled("October2021Update");if(UCIDialogEnabled)return Common.openUCIShareDialog(objectTypeName,ids,950,500)}if(!callbackRef)firstResult=Common.handleCallbackFunction(result,url,action,objectType,ids,x,y,close,reload,id,callbackArgumentRef,isDialogInline)}return firstResult};Common.openUCIShareDialog=function(entityName,ids,dialogWidth,dialogHeight){var options={width:dialogWidth,height:dialogHeight,position:2},parameters={entity_name:entityName,object_id:ids};Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.ShareDialog,options,parameters)};Common.handleCallbackFunction=function(result,url,action,objectType,ids,width,height,close,reload,id,callbackArgumentRef,isDialogInline){var parameters=null;parameters=[action,objectType,close,reload,id,callbackArgumentRef];var option={position:1,width:width,height:height},callbackFunction=Common.createCallbackFunctionFactory(Common.performActionAfterSwitch,parameters);Common.appendAppIdAndOpenLegacyWebDialog(url.toString(),option,ids,callbackFunction);return result};Common.performActionAfterSwitch=function(result,action,objectType,close,reload,id,callbackArgumentRef){callbackArgumentRef!=null&&Common.executeFunction(callbackArgumentRef,result);return result};Common.executeFunction=function(callbackReference,value){if(callbackReference==null)return null};Common.setLabelsForDeactivateDialog=function(formContext,entityName,entitySingularDisplayName,entityPluralDisplayName,total,action){var entityDisplayName="";if(total===1)entityDisplayName=entitySingularDisplayName;else entityDisplayName=entityPluralDisplayName;var titleControlName=XrmCore.InternalUtilities.DialogUtilities.DialogConstants.TitleId,descriptionLabelName=XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DescriptionId,messageLabelName=XrmCore.InternalUtilities.DialogUtilities.DialogConstants.MessageId,dialogOkControlName=XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId,deactivateTitle=null,deactivateDescription=null,deactivateMessageLabel=null,deactivateOkLabel=null;if(action===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.deactivate)switch(entityName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Account:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contact:deactivateTitle=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Grid_Deactivate_Title");deactivateDescription=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Deactivate_Description");deactivateMessageLabel=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web._grid.cmds.dlg_deactivate.aspx_102_Title");deactivateOkLabel=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Deactivate");formContext.getControl(titleControlName).setLabel(deactivateTitle?deactivateTitle:"Deactivate");formContext.getControl(descriptionLabelName).setLabel(deactivateDescription?XrmCore.InternalUtilities.GenericUtilities.stringFormat(deactivateDescription,[total,entityDisplayName]):"Dialog_Deactivate_Description "+total+" "+entityDisplayName+"?");formContext.getControl(messageLabelName).setLabel(messageLabelName?XrmCore.InternalUtilities.GenericUtilities.stringFormat(deactivateMessageLabel,[entityDisplayName]):"Web._grid.cmds.dlg_deactivate.aspx_102_Title");formContext.getControl(dialogOkControlName).setLabel(deactivateOkLabel?XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Deactivate"):"Deactivate");break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ExternalParty:if(total==1);break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ExternalPartyItem:if(total==1);break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.TopicModel:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SyncError:deactivateTitle=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Grid_Deactivate_Title");deactivateDescription=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Deactivate_Description");deactivateMessageLabel=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("SyncError.Dialog.Deactivate.Messsage.Text");deactivateOkLabel=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Deactivate");formContext.getControl(titleControlName).setLabel(deactivateTitle?deactivateTitle:"Deactivate");formContext.getControl(descriptionLabelName).setLabel(deactivateDescription?XrmCore.InternalUtilities.GenericUtilities.stringFormat(deactivateDescription,[total,entityDisplayName]):"Dialog_Deactivate_Description "+total+" "+entityDisplayName+"?");formContext.getControl(messageLabelName).setLabel(messageLabelName?XrmCore.InternalUtilities.GenericUtilities.stringFormat(deactivateMessageLabel,[entityDisplayName]):"SyncError.Dialog.Deactivate.Messsage.Text");formContext.getControl(dialogOkControlName).setLabel(deactivateOkLabel?XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Deactivate"):"Deactivate");break;default:if(Xrm.Utility.isActivityType(entityName)){var closeActivityTitle=XrmCore.InternalUtilities.GenericUtilities.stringFormat(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Close_Activity_Title"),[entityDisplayName]),closeActivityDescription=XrmCore.InternalUtilities.GenericUtilities.stringFormat(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Close_Activity_Description"),[total,entityDisplayName]),closeActivityMessage=XrmCore.InternalUtilities.GenericUtilities.stringFormat(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web._grid.cmds.dlg_deactivate.aspx_85"),[entityDisplayName]),dialogTitle=XrmCore.InternalUtilities.GenericUtilities.stringFormat(closeActivityTitle,[entityDisplayName]);formContext.getControl(titleControlName).setLabel(dialogTitle?dialogTitle:"Dialog_Close_Activity_Title");formContext.getControl(descriptionLabelName).setLabel(closeActivityDescription?closeActivityDescription:"Dialog_Close_Activity_Description");formContext.getControl(messageLabelName).setLabel(closeActivityMessage?closeActivityMessage:"Web._grid.cmds.dlg_deactivate.aspx_85");formContext.getControl(dialogOkControlName).setLabel(closeActivityTitle?closeActivityTitle:"Dialog_Close_Activity_Title")}else{deactivateTitle=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Grid_Deactivate_Title");deactivateDescription=XrmCore.InternalUtilities.GenericUtilities.stringFormat(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Deactivate_Description"),[total,entityDisplayName]);deactivateMessageLabel=XrmCore.InternalUtilities.GenericUtilities.stringFormat(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web._grid.cmds.dlg_deactivate.aspx_55"),[entityDisplayName]);deactivateOkLabel=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Deactivate");formContext.getControl(titleControlName).setLabel(deactivateTitle?deactivateTitle:"Dialog_Grid_Deactivate_Title");formContext.getControl(descriptionLabelName).setLabel(deactivateDescription?deactivateDescription:"");formContext.getControl(messageLabelName).setLabel(deactivateMessageLabel?deactivateMessageLabel:"");formContext.getControl(dialogOkControlName).setLabel(deactivateOkLabel?deactivateOkLabel:"Button_Label_Deactivate")}break}else{var statusString=null,activateTitle=null,activateDescription=null,activateMessage=null,activateButtonText=null;switch(entityName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ExternalParty:if(total==1);break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ExternalPartyItem:if(total==1);break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ConvertRule:statusString=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Label_Active");activateTitle=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Activate_ConvertRule_Title");activateDescription=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Activate_Single_ConvertRule_Description");activateMessage=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web._grid.cmds.dlg_activate.aspx_55");activateButtonText=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Activate");formContext.getControl(titleControlName).setLabel(XrmCore.InternalUtilities.GenericUtilities.stringFormat(activateTitle,[entityDisplayName]));formContext.getControl(descriptionLabelName).setLabel(activateDescription);formContext.getControl(messageLabelName).setLabel(XrmCore.InternalUtilities.GenericUtilities.stringFormat(activateMessage,[entityDisplayName,statusString]));formContext.getControl(dialogOkControlName).setLabel(activateButtonText?activateButtonText:"Button_Label_Activate");break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ConvertRuleItem:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RecommendationModel:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RoutingRule:statusString=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Label_Active");activateTitle=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Activate_Title");activateDescription=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Activate_RoutingRule_Description");if(Xrm.Internal.isFeatureEnabled("HierarchicalRoutingRule"))activateDescription=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Activate_Description_Activate");activateMessage=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web._grid.cmds.dlg_activate.aspx_55");activateButtonText=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Activate");formContext.getControl(titleControlName).setLabel(XrmCore.InternalUtilities.GenericUtilities.stringFormat(activateTitle,[entityDisplayName]));formContext.getControl(descriptionLabelName).setLabel(XrmCore.InternalUtilities.GenericUtilities.stringFormat(activateDescription,[total,entityDisplayName]));formContext.getControl(messageLabelName).setLabel(XrmCore.InternalUtilities.GenericUtilities.stringFormat(activateMessage,[entityDisplayName,statusString]));formContext.getControl(dialogOkControlName).setLabel(activateButtonText?activateButtonText:"Button_Label_Activate");break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.TopicModel:break;default:statusString=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Label_Active");activateTitle=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Activate_Title");activateDescription=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_Activate_Description_Activate");activateMessage=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web._grid.cmds.dlg_activate.aspx_55");activateButtonText=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Activate");formContext.getControl(titleControlName).setLabel(XrmCore.InternalUtilities.GenericUtilities.stringFormat(activateTitle,[entityDisplayName]));formContext.getControl(descriptionLabelName).setLabel(XrmCore.InternalUtilities.GenericUtilities.stringFormat(activateDescription,[total,entityDisplayName]));formContext.getControl(messageLabelName).setLabel(XrmCore.InternalUtilities.GenericUtilities.stringFormat(activateMessage,[entityDisplayName,statusString]));formContext.getControl(dialogOkControlName).setLabel(activateButtonText?activateButtonText:"Button_Label_Activate");break}}formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId).setVisible(true);formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogCancelId).setVisible(true)};Common.loadStates=function(formContext,entityName,action){Xrm.Utility.getEntityMetadata(entityName,["statecode"]).then(function(entityMetadata){var stateMetadata=entityMetadata.Attributes.get("statecode"),stateCodeControl=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StateId);stateCodeControl.clearOptions();var defaultState;if(Xrm.Utility.isActivityType(entityName)&&action===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.deactivate){var valueList=Object.keys(stateMetadata.OptionSet);valueList.forEach(function(key){var stateCode=stateMetadata.OptionSet[key].value;(stateCode===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Completed||stateCode===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Canceled)&&stateCodeControl.addOption({text:stateMetadata.OptionSet[key].text,value:stateCode})});var defaultCloseState=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.defaultCloseState).getValue();defaultState=defaultCloseState?defaultCloseState:XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Completed;stateCodeControl.setVisible(true);stateCodeControl.getAttribute().setValue(defaultState)}else{stateCodeControl.setVisible(false);defaultState=XrmCore.InternalUtilities.EntityUtilities.isStateCodeReversed(entityName)?action===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.activate?XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Inactive:XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Active:action===XrmCore.InternalUtilities.DialogUtilities.DialogConstants.activate?XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Active:XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Inactive;var valueList=Object.keys(stateMetadata.OptionSet);valueList.forEach(function(key){var stateCode=stateMetadata.OptionSet[key].value;stateCode===defaultState&&stateCodeControl.addOption({text:stateMetadata.OptionSet[key].text,value:stateCode})});stateCodeControl.getAttribute().setValue(defaultState)}var defaultStatus=stateMetadata.getDefaultStatus(defaultState);Common.loadStatusOptions(formContext,entityName,defaultState,defaultStatus)},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)};Common.loadStatusOptions=function(formContext,entityName,selectedState,defaultStatusCode){if(XrmCore.InternalUtilities.DialogUtilities.isOffline()){XrmCore.InternalUtilities.DialogUtilities.showOfflineError();return}var statusCodeControl=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StatusId),statusCodeOptionSet=statusCodeControl.getAttribute();statusCodeControl.clearOptions();statusCodeControl.setVisible(false);Xrm.Utility.getEntityMetadata(entityName,["statuscode"]).then(function(entityMetadata){var statusMetadata=entityMetadata.Attributes.get("statuscode"),allowedTransitions=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.allowedTransitions).getValue(),total=0;if(statusMetadata){var valueList=statusMetadata.attributeDescriptor?statusMetadata.attributeDescriptor.OptionSet:statusMetadata.OptionSet?Object.keys(statusMetadata.OptionSet).map(function(key){return {Label:statusMetadata.OptionSet[key]?statusMetadata.OptionSet[key].text:undefined,Value:statusMetadata.OptionSet[key]?statusMetadata.OptionSet[key].value:undefined}}):null;valueList&&valueList.forEach(function(item){var statusCode=item.Value,rawState=statusMetadata.getState(statusCode);if(rawState===selectedState)if(!allowedTransitions||allowedTransitions.indexOf(statusCode)!==-1){statusCodeControl.addOption({text:item.Label,value:statusCode});total++}});if(allowedTransitions&&total>0&&allowedTransitions.indexOf(defaultStatusCode)===-1){var statusCodeOptions=statusCodeControl.getOptions();if(statusCodeOptions!==undefined&&statusCodeOptions!==null&&statusCodeOptions.length>0)for(var i=0;i<statusCodeOptions.length;i++)if(statusCodeOptions[i].value!==NaN&&statusCodeOptions[i].text!==""){defaultStatusCode=statusCodeOptions[i].value;break}}switch(total){case 0:Common.setNoTransitionsWarning(formContext);break;case 1:statusCodeOptionSet.setValue(defaultStatusCode);break;default:entityName!=="businessunit"&&statusCodeControl.setVisible(true);statusCodeOptionSet.setValue(defaultStatusCode);break}}},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)};Common.onStateChange=function(eventContext){var formContext=eventContext.getFormContext();if(!formContext)if(Xrm.Page)formContext=Xrm.Page;else throw new Error("No Client API frame can be found");if(XrmCore.InternalUtilities.DialogUtilities.isOffline()){XrmCore.InternalUtilities.DialogUtilities.showOfflineError();return}var recordsAttribute=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records),records=recordsAttribute.getValue(),entityName=records[0].TypeName,stateCodeControl=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StateId),selectedState=stateCodeControl.getAttribute().getValue();if(selectedState){formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.selectedState).setValue(selectedState);Xrm.Utility.getEntityMetadata(entityName,["statecode"]).then(function(entityMetadata){var stateMetadata=entityMetadata.Attributes.get("statecode"),defaultStatusCode=stateMetadata.getDefaultStatus(selectedState);Common.loadStatusOptions(formContext,entityName,selectedState,defaultStatusCode)},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)}};Common.deactivateClickLegacy=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.deactivateClick():backCompatHeader.Mscrm.CommandBarActions.deactivateClick()};Common.closeDialogLegacy=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.InternalUtilities?Mscrm.InternalUtilities.DialogUtility.closeDialog():backCompatHeader.Mscrm.InternalUtilities.DialogUtility.closeDialog()};Common.onLoadSetStateLegacy=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.onLoadSetState():backCompatHeader.Mscrm.CommandBarActions.onLoadSetState()};Common.onStateChangeLegacy=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.onStateChange():backCompatHeader.Mscrm.CommandBarActions.onStateChange()};Common.GetEntityNamesFromActivityRecords=function(records){for(var activityEntityNames={},i=0;i<records.length;i++)if(activityEntityNames[records[i].TypeName]==undefined)activityEntityNames[records[i].TypeName]=[];return activityEntityNames};Common.CheckIfIsReadOnlyInMobileClient=function(values){for(var returnValue=false,index=0;index<values.length;index++){var value=values[index];if(value["IsReadOnlyInMobileClient"]==true){returnValue=true;break}}if(returnValue){var errorStrings={text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("ReadOnlyEntity"),confirmButtonLabel:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_OK")};Xrm.Navigation.openAlertDialog(errorStrings)}return returnValue};Common.constructAndOpenLegacyWebDialog=function(entityName,gridControl,selectedRecords,dialogFileName,dialogWidth,dialogHeight,appendGridItemIdsToUri,dialogCallbackFunction,dialogCallbackParameters){if(!dialogFileName)return;if(!gridControl||!selectedRecords||!selectedRecords.length){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Action_NoItemSelected")});return}var entityTypeCode=Xrm.Internal.getEntityCode(entityName),actionUri=Xrm.Utility.getGlobalContext().prependOrgName("/_grid/cmds/");actionUri=actionUri.concat(encodeURIComponent(dialogFileName),"?dType=1");actionUri=actionUri.concat("&iObjType=",encodeURIComponent(entityTypeCode.toString()));actionUri=actionUri.concat("&iTotal=",encodeURIComponent(selectedRecords.length.toString()));if(appendGridItemIdsToUri){var parameterToEncode=(new String).concat("{",selectedRecords[0].Id.toString(),"}");actionUri=actionUri.concat("&sIds=",encodeURIComponent(parameterToEncode));for(var i_1=1;i_1<selectedRecords.length;i_1++){parameterToEncode=(new String).concat(";{",selectedRecords[i_1].Id.toString(),"}");actionUri=actionUri.concat(encodeURIComponent(parameterToEncode))}}for(var options={position:1,width:dialogWidth,height:dialogHeight},callbackRef=Common.createCallbackFunctionFactory(dialogCallbackFunction,dialogCallbackParameters),dialogArguments=new Array(selectedRecords.length),i=0;i<selectedRecords.length;i++)dialogArguments[i]=selectedRecords[i].Id;Common.appendAppIdAndOpenLegacyWebDialog(actionUri,options,dialogArguments,callbackRef)};Common.appendAppIdAndOpenLegacyWebDialog=function(actionUri,options,dialogArguments,callbackRef){if(dialogArguments===void 0)dialogArguments=null;if(callbackRef===void 0)callbackRef=null;if(actionUri.indexOf("appid=")<0){var globalContext=Xrm.Utility.getGlobalContext();globalContext.getCurrentAppProperties().then(function(appProperties){if(appProperties["appId"])actionUri=actionUri.concat("&appid=",encodeURIComponent(appProperties["appId"]));Xrm.Internal.openLegacyWebDialog(actionUri,options,dialogArguments,null,callbackRef)},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)}else Xrm.Internal.openLegacyWebDialog(actionUri,options,dialogArguments,null,callbackRef)};Common.refreshParentFromEmailPopup=function(){try{Commands.polyfillingCustomEvent();var containerFrameElement=window.parent.frameElement,containerPanelId=containerFrameElement&&containerFrameElement.getAttribute("email-popup-id");window.parent.parent.dispatchEvent(new CustomEvent("refreshParentFromEmailPopup",{detail:{containerPanelId:containerPanelId}}))}catch(e){}};Common.isBusy=false;Common.createCallbackFunctionFactory=function(func,parameters){return function(retValue){parameters.unshift(retValue);return func.apply(null,parameters)}};return Common}();Commands.Common=Common})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var DeactivateLibraryLegacy=function(){function DeactivateLibraryLegacy(){this.deactivateRecordsLegacy=function(gridControl,records,entityTypeCode,defaultCloseState){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.deactivate(gridControl,records,entityTypeCode,defaultCloseState):backCompatHeader.Mscrm.GridCommandActions.deactivate(gridControl,records,entityTypeCode,defaultCloseState)}}DeactivateLibraryLegacy.prototype.deactivatePrimaryRecord=function(id,entityName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.deactivate(id,entityName):backCompatHeader.Mscrm.CommandBarActions.deactivate(id,entityName)};DeactivateLibraryLegacy.prototype.deactivateRecords=function(gridControl,records,entityName,defaultCloseState,callback){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false),entityTypeCode=Xrm.Internal.getEntityCode(entityName);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.deactivate(gridControl,records,entityTypeCode,defaultCloseState,callback):backCompatHeader.Mscrm.GridCommandActions.deactivate(gridControl,records,entityTypeCode,defaultCloseState,callback)};return DeactivateLibraryLegacy}();Commands.DeactivateLibraryLegacy=DeactivateLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var DeactivateLibrary=function(){function DeactivateLibrary(){var _this=this;this.deactivateRecordsLegacy=function(gridControl,records,entityTypeCode,defaultCloseState){if(Xrm.Internal.isUci()&&entityTypeCode==4200){var thisObject=_this,promise=Xrm.Utility.getEntitiesMetadata(Commands.Common.GetEntityNamesFromActivityRecords(records));records.length>0&&promise.then(function(values){!Commands.Common.CheckIfIsReadOnlyInMobileClient(values)&&thisObject.deactivateRecords(gridControl,records,Xrm.Internal.getEntityName(entityTypeCode),defaultCloseState)})}else _this.deactivateRecords(gridControl,records,Xrm.Internal.getEntityName(entityTypeCode),defaultCloseState)}}DeactivateLibrary.prototype.deactivatePrimaryRecord=function(id,entityName){var stateCode=1;switch(entityName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DuplicateRule:stateCode=0;break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ConvertRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RoutingRule:Commands.Common.changeState(entityName,id,false);return}Xrm.Utility.getEntityMetadata(entityName,["statecode"]).then(function(entityMetadata){if(entityMetadata.EnforceStateTransitions){Commands.Common.changeState(entityName,id,false);return}var stateMetadata=entityMetadata.Attributes.get("statecode"),statusCodes=stateMetadata.getStatusValuesForState(stateCode);if(statusCodes&&statusCodes.length>0)Commands.Common.changeState(entityName,id,false);else{Xrm.Page.data.save({saveMode:5});Commands.Common.setState(id,entityName,stateCode)}},function(errorParameter){XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(errorParameter)})};DeactivateLibrary.prototype.deactivateRecords=function(gridControl,records,entityName,defaultCloseState,callback){if(!records.length){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Action_NoItemSelected")});return}Xrm.Utility.getEntityMetadata(entityName).then(function(entityMetadata){if(entityMetadata.IsInteractionCentricEnabled)for(var logicalName=records[0].TypeName,i=1;i<records.length;i++)if(records[i].TypeName===logicalName)continue;else{Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Grid_Apply_Rule_Heterogenous_Activity_Type_Records_Selected")});return}var options={position:1,width:600,height:250};switch(entityName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.BusinessUnit:options.width=650;options.height=280;break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DiscountType:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Account:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contact:options.height=200;break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignActivity:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignResponse:options.height=250;options.width=400;break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ActivityPointer:for(var record=records[0],i=1;i<records.length;i++)if(records[i].TypeName!==record.TypeName){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Grid_Apply_Rule_Heterogenous_Activity_Type_Records_Selected")});return}switch(record.TypeName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SocialActivity:Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Grid_Apply_Rule_Social_Activity_Type_Records_Selected_For_Invalid_Action")});return;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Email:Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Grid_Apply_Rule_Selected_Emails")});return;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignResponse:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignActivity:if(defaultCloseState===1){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Grid_Apply_Rule_Selected_Records")});return}break}entityName=record.TypeName;break}DeactivateLibrary.openDialog(gridControl,records,entityName,defaultCloseState,callback,options)},function(errorParameter){XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(errorParameter)})};DeactivateLibrary.openDialog=function(gridControl,records,entityName,defaultCloseState,callback,options){for(var i=0;i<records.length;i++){var resourceString=null;switch(records[i].TypeName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SocialActivity:resourceString="Grid_Apply_Rule_Social_Activity_Type_Records_Selected_For_Invalid_Action";break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Email:resourceString="Grid_Apply_Rule_Selected_Emails";break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignResponse:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignActivity:if(defaultCloseState===1)resourceString="Grid_Apply_Rule_Selected_Records";break}if(resourceString!=null){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString(resourceString)});return}}var dialogArguments={};dialogArguments[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records]=records;dialogArguments[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.action]=XrmCore.InternalUtilities.DialogUtilities.DialogConstants.deactivate;dialogArguments[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked]="";dialogArguments[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StateId]=-1;dialogArguments[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.StatusId]=-1;if((defaultCloseState||defaultCloseState===0)&&defaultCloseState!==-1)dialogArguments[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.defaultCloseState]=defaultCloseState;var client=Xrm.Utility.getGlobalContext().client.getClient();if(client===Xrm.Constants.ClientNames.web||client==Xrm.Constants.ClientNames.outlook||client==Xrm.Constants.ClientNames.unifiedServiceDesk)options={position:1,width:600,height:250};Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.SetStateDialog,options,dialogArguments).then(function(successParameter){var dialogCallbackParams={};Commands.Common.closeSetStateDialogFromGridCallback(successParameter.parameters,dialogCallbackParams,gridControl,callback)})};return DeactivateLibrary}();Commands.DeactivateLibrary=DeactivateLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Deactivate=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.DeactivateLibrary:new Commands.DeactivateLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var DeleteLibrary=function(){function DeleteLibrary(){var _this=this;this.deletePrimaryRecord=function(id,entityName){var dialogstrings={title:"",subtitle:"",text:"",confirmButtonLabel:"",cancelButtonLabel:""},url={},dialogOptions=null;Xrm.Utility.getEntityMetadata(entityName).then(function(metadata){switch(entityName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RecurringAppointmentMaster:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Appointment:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Account:dialogOptions=_this.GetDialogOptions(450,275,1);break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.TopicModel:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contact:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DynamicProperty:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.OpportunityProduct:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.QuoteDetail:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SalesOrderDetail:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.InvoiceDetail:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Queue:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SharePointSite:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Workflow:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Product:break;default:break}XrmCore.InternalUtilities.DialogUtilities.tryGetDialogStringsForEnabledMetadataDialogs(XrmCore.InternalUtilities.DialogUtilities.DialogName.DeleteDialog,dialogstrings,entityName,1,url,metadata.DisplayName,metadata.DisplayCollectionName,metadata.IsDocumentManagementEnabled,true);Xrm.Navigation.openConfirmDialog(dialogstrings,dialogOptions).then(function(result){if(result.confirmed){XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();Xrm.WebApi.deleteRecord(entityName,id).then(function(success){Xrm.Utility.closeProgressIndicator();if(success&&success.entityType&&success.id&&success.name)if(Xrm.Page.data.attributes["IsInteractionWallQuickAction"]&&Xrm.Page.data.attributes["IsInteractionWallQuickAction"].fireOnChange)Xrm.Page.data.attributes["IsInteractionWallQuickAction"].fireOnChange;else Xrm.Page.ui.close();else Xrm.Page.ui.close();success&&success.entityType=="email"&&Commands.Common.refreshParentFromEmailPopup()},function(error){Xrm.Utility.closeProgressIndicator();XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)})}})})};this.deleteRecordsLegacy=function(gridControl,records,entityTypeCode){_this.deleteRecords(gridControl,records,Xrm.Internal.getEntityName(entityTypeCode))};this.deleteRecords=function(gridControl,records,entityTypeName){var actionUri={};if(records.length<=0){var alert={text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Action_NoItemSelected")};Xrm.Navigation.openAlertDialog(alert);return}var dialogstrings={title:"",subtitle:"",text:"",confirmButtonLabel:"",cancelButtonLabel:""};if(XrmCore.InternalUtilities.DialogUtilities.isOffline()&&records&&records.length===1&&entityTypeName===Xrm.Constants.EntityNames.ActivityPointer)entityTypeName=records[0].TypeName;Xrm.Utility.getEntityMetadata(entityTypeName).then(function(metadata){XrmCore.InternalUtilities.DialogUtilities.tryGetDialogStringsForEnabledMetadataDialogs(XrmCore.InternalUtilities.DialogUtilities.DialogName.DeleteDialog,dialogstrings,entityTypeName,records.length,actionUri,metadata.DisplayName,metadata.DisplayCollectionName,metadata.IsDocumentManagementEnabled);var dialogOptions=null;if(Xrm.Utility.isActivityType(entityTypeName));if(entityTypeName!==XrmCore.InternalUtilities.EntityUtilities.EntityNames.Workflow)switch(entityTypeName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.BulkOperation:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Queue:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ImportMap:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RecurringAppointmentMaster:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Appointment:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ActivityPointer:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Equipment:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contract:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.QueueItem:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Solution:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemForm:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Audit:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SharePointSite:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Calendar:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Account:dialogOptions=_this.GetDialogOptions(450,275,1);break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contact:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.OpportunityProduct:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.QuoteDetail:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SalesOrderDetail:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.InvoiceDetail:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CalendarRule:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Product:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DynamicProperty:break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Connection:var subGridControl=gridControl;if(subGridControl.getGridType&&(subGridControl.getGridType()===3||subGridControl.getGridType()===2)){var gridLabel=void 0;if(subGridControl.getLabel&&subGridControl.getLabel())gridLabel=subGridControl.getLabel();else gridLabel=metadata.DisplayName;if(records.length===1)dialogstrings.text=XrmCore.InternalUtilities.GenericUtilities.stringFormat(dialogstrings.text,[records[0].Name,gridLabel]);else dialogstrings.text=XrmCore.InternalUtilities.GenericUtilities.stringFormat(dialogstrings.text,[gridLabel])}default:break}Xrm.Navigation.openConfirmDialog(dialogstrings,dialogOptions).then(function(result){if(result.confirmed){if(XrmCore.InternalUtilities.DialogUtilities.isOffline()){if(Xrm.Mobile.offline.isOfflineEnabled(entityTypeName)){if(records.length>1){var alert_2={text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Delete_Multiple_Offline")};Xrm.Navigation.openAlertDialog(alert_2);return}XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();Xrm.WebApi.offline.deleteRecord(entityTypeName,records[0].Id).then(function(success){gridControl&&gridControl.refresh();Xrm.Utility.closeProgressIndicator()},function(error){gridControl&&gridControl.refresh();Xrm.Utility.closeProgressIndicator();XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)})}else XrmCore.InternalUtilities.DialogUtilities.showOfflineError();return}XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();if(records.length===1)Xrm.WebApi.online.deleteRecord(records[0].TypeName,records[0].Id).then(function(success){gridControl&&gridControl.refresh();Xrm.Utility.closeProgressIndicator()},function(error){gridControl&&gridControl.refresh();Xrm.Utility.closeProgressIndicator();XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)});else{var deleteBatch=records.map(function(record){var entityReference={entityType:record.TypeName,id:record.Id};return new XrmCore.SdkContracts.DeleteRequest(entityReference)});Xrm.WebApi.online.executeMultiple(deleteBatch).then(function(success){Xrm.Utility.closeProgressIndicator();XrmCore.InternalUtilities.DialogUtilities.onGridActionMultipleSuccess(gridControl,success);var postDeleteActionBatch=_this.postDeleteActions(records,gridControl,entityTypeName);postDeleteActionBatch&&postDeleteActionBatch.length>0&&Xrm.WebApi.online.executeMultiple(postDeleteActionBatch).then(function(success){},function(error){gridControl&&gridControl.refresh();XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)})},function(error){gridControl&&gridControl.refresh();Xrm.Utility.closeProgressIndicator();XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)})}}})})};this.postDeleteActions=function(records,gridControl,entityType){var postDeleteActionBatch;switch(entityType){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Connection:var SALES_TEAM_VIEW_ID="FE4BC089-8901-466C-A41B-1C1090F204D4",currentViewId=gridControl&&gridControl.getViewSelector().getCurrentView().id,viewId=currentViewId&&currentViewId.replace("{","").replace("}","").toUpperCase();if(viewId&&viewId==SALES_TEAM_VIEW_ID){var ACCESS_TEAM_TEMPLATE_ID_1="B3228218-B8F6-4A1B-A18D-552C6F980831",parentControl=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page,parentEntity_1=parentControl.data.entity;postDeleteActionBatch=records.map(function(record){return _this.removeUserFromRecordTeam(record.Id,parentEntity_1,ACCESS_TEAM_TEMPLATE_ID_1)})}break}return postDeleteActionBatch}}DeleteLibrary.prototype.GetDialogOptions=function(height,width,position){var dialogOptions={height:height,width:width,position:position};return dialogOptions};DeleteLibrary.prototype.removeUserFromRecordTeam=function(userId,parentEntity,teamTemplateId){var removeUserFromTeamRequest=new XrmCore.SdkContracts.RemoveUserFromRecordTeamRequest({id:userId,entityType:XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemUser},{id:parentEntity.getId(),entityType:parentEntity.getEntityName()},{id:teamTemplateId,entityType:XrmCore.InternalUtilities.EntityUtilities.EntityNames.TeamTemplate});return removeUserFromTeamRequest};return DeleteLibrary}();Commands.DeleteLibrary=DeleteLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var DeleteLibraryLegacy=function(){function DeleteLibraryLegacy(){}DeleteLibraryLegacy.prototype.deletePrimaryRecord=function(id,entityName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.deletePrimaryRecord(id,entityName):backCompatHeader.Mscrm.CommandBarActions.deletePrimaryRecord(id,entityName)};DeleteLibraryLegacy.prototype.deleteRecordsLegacy=function(gridControl,records,entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.deleteRecords(gridControl,records,entityTypeCode):backCompatHeader.Mscrm.GridCommandActions.deleteRecords(gridControl,records,entityTypeCode)};DeleteLibraryLegacy.prototype.deleteRecords=function(gridControl,records,entityTypeName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false),entityTypeCode=Xrm.Internal.getEntityCode(entityTypeName);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.deleteRecords(gridControl,records,entityTypeCode):backCompatHeader.Mscrm.GridCommandActions.deleteRecords(gridControl,records,entityTypeCode)};return DeleteLibraryLegacy}();Commands.DeleteLibraryLegacy=DeleteLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var EmailCopyLinkLibraryLegacy=function(){function EmailCopyLinkLibraryLegacy(){this.sendCurrentViewUrl=function(useEmail,gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.sendCurrentViewUrl(useEmail,gridControl):backCompatHeader.Mscrm.Utilities.sendSelectedRecordsUrl(useEmail,gridControl)}}EmailCopyLinkLibraryLegacy.prototype.emailCopyLinkPrimaryRecord=function(usingEmail,form){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.sendFormShortcut(usingEmail,form):backCompatHeader.Mscrm.RibbonActions.sendFormShortcut(usingEmail,form)};EmailCopyLinkLibraryLegacy.prototype.emailCopyLinkRecordsLegacy=function(usingEmail,records,entityTypeCode,writeUrlOnly){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.Utilities?Mscrm.Utilities.sendSelectedRecordsUrl(usingEmail,records,entityTypeCode,writeUrlOnly):backCompatHeader.Mscrm.Utilities.sendSelectedRecordsUrl(usingEmail,records,entityTypeCode,writeUrlOnly)};EmailCopyLinkLibraryLegacy.prototype.emailCopyLinkRecords=function(usingEmail,records,entityName,writeUrlOnly){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false),entityTypeCode=Xrm.Internal.getEntityCode(entityName);Mscrm&&Mscrm.Utilities?Mscrm.Utilities.sendSelectedRecordsUrl(usingEmail,records,entityTypeCode,writeUrlOnly):backCompatHeader.Mscrm.Utilities.sendSelectedRecordsUrl(usingEmail,records,entityTypeCode,writeUrlOnly)};return EmailCopyLinkLibraryLegacy}();Commands.EmailCopyLinkLibraryLegacy=EmailCopyLinkLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var EmailCopyLinkLibrary=function(){function EmailCopyLinkLibrary(){this.sendCurrentViewUrl=function(useEmail,gridControl){var clientTypeValue=Xrm.Utility.getGlobalContext().client.getClient(),clientType=clientTypeValue===Xrm.Constants.ClientNames.mobile?1:0,currentWebViewUrl=gridControl.getUrl(),currentBrowserViewUrl=gridControl.getUrl(clientType),webLinkResourceString=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web Link")||"Web Link",title=gridControl.getViewSelector().getCurrentView().name,encodedNewLine=encodeURIComponent("<br>"),body=encodeURIComponent(currentBrowserViewUrl);if(clientType===1){var formattedWebLink=EmailCopyLinkLibrary.isAndroid()?XrmCore.InternalUtilities.GenericUtilities.stringFormat(EmailCopyLinkLibrary.generalEmailLinkForAndroidIntoBrackets,[webLinkResourceString,currentWebViewUrl]):XrmCore.InternalUtilities.GenericUtilities.stringFormat(EmailCopyLinkLibrary.generalEmailLinkIntoBrackets,[currentWebViewUrl,webLinkResourceString]);body+=encodeURIComponent(formattedWebLink)+encodedNewLine}useEmail&&EmailCopyLinkLibrary.openEmailForm("",title,body,null)}}EmailCopyLinkLibrary.prototype.emailCopyLinkPrimaryRecord=function(usingEmail,form){var entity=Xrm.Page.data.entity,entityTitle=entity.getPrimaryAttributeValue(),recordId=entity.getId(),entityLogicalName=entity.getEntityName(),ccFieldValue="",records=[];records.push({Id:recordId,Name:entityTitle,TypeName:entityLogicalName});EmailCopyLinkLibrary.emailCopyLinks(usingEmail,records,entityLogicalName,false,ccFieldValue)};EmailCopyLinkLibrary.prototype.emailCopyLinkRecordsLegacy=function(usingEmail,records,entityTypeCode,writeUrlOnly){EmailCopyLinkLibrary.emailCopyLinks(usingEmail,records,Xrm.Internal.getEntityName(entityTypeCode),writeUrlOnly)};EmailCopyLinkLibrary.prototype.emailCopyLinkRecords=function(usingEmail,records,entityName,writeUrlOnly){EmailCopyLinkLibrary.emailCopyLinks(usingEmail,records,entityName,writeUrlOnly)};EmailCopyLinkLibrary.emailCopyLinks=function(usingEmail,records,entityName,writeUrlOnly,ccFieldValue){if(!records||!records.length){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Action_NoItemSelected")});return}if(records.length>10){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Max_Shortcut_Record_Reached")});return}if(!writeUrlOnly)writeUrlOnly=!usingEmail&&records.length===1;for(var subject=" ",body="",clientTypeValue=Xrm.Utility.getGlobalContext().client.getClient(),clientType=clientTypeValue===Xrm.Constants.ClientNames.mobile?1:0,i=0;i<records.length;i++){var record=records[i],value={entityType:record.TypeName,id:record.Id,name:record.Name},pageUrl=Xrm.Internal.getCurrentPageUrl(value,clientType),browserUrl=Xrm.Internal.getEmailLink(value),entityTitle=record.Name,url=clientType==1||XrmCore.InternalUtilities.DialogUtilities.isMailApp()||record.TypeName==="report"?browserUrl:pageUrl,encodedNewLine=encodeURIComponent("<br>"),linkBracket=EmailCopyLinkLibrary.isAndroid()?EmailCopyLinkLibrary.newLineReplaceWithBreak(EmailCopyLinkLibrary.generalEmailLinkForIntoBrackets)+"<br>":EmailCopyLinkLibrary.generalEmailLinkForIntoBrackets,formattedWebLink=XrmCore.InternalUtilities.GenericUtilities.stringFormat(linkBracket,[writeUrlOnly?url:entityTitle,url]);if(clientType===1&&EmailCopyLinkLibrary.isiOSdevice()){body+=encodeURIComponent(entityTitle);var webLinkResourceString=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("EmailLink_WebLinkText")||"Web Link",formattediOSLink=XrmCore.InternalUtilities.GenericUtilities.stringFormat(EmailCopyLinkLibrary.generalEmailLinkIntoBrackets,[browserUrl,webLinkResourceString]);body+=encodeURIComponent(formattediOSLink)+encodedNewLine}else body+=encodeURIComponent(formattedWebLink);if(i===0&&records.length===1)subject=entityTitle}EmailCopyLinkLibrary.openEmailForm("",subject,body,ccFieldValue)};EmailCopyLinkLibrary.openEmailForm=function(to,subject,body,cc){var mailtoLink="mailto:";if(to){var index=to.lastIndexOf("@");if(index>=0&&index<to.length)mailtoLink+=encodeURIComponent(to.substr(0,index))+"@"+encodeURIComponent(to.substr(index+1));else mailtoLink+=encodeURIComponent(to)}var seporator="?";if(cc){mailtoLink+=seporator+"cc="+encodeURIComponent(cc);seporator="&"}if(subject){mailtoLink+=seporator+"subject="+encodeURIComponent(subject);seporator="&"}if(body)mailtoLink+=seporator+"body="+body;var maxAllowableLength=2020;if(mailtoLink.length>maxAllowableLength){var errorDialogOptions={message:"",errorCode:-2147204303};Xrm.Navigation.openErrorDialog(errorDialogOptions)}else Xrm.Navigation.openUrl(mailtoLink,{isExternal:true})};EmailCopyLinkLibrary.isAndroid=function(){return navigator.platform&&/Android|Linux/g.test(navigator.platform)};EmailCopyLinkLibrary.isiOSdevice=function(){return navigator.platform=="iPad"||navigator.platform=="iPhone"};EmailCopyLinkLibrary.newLineReplaceWithBreak=function(str){return str.replace("\n","<br/>")};EmailCopyLinkLibrary.generalEmailBodyFormat='<a href="{0}">{1}</a>';EmailCopyLinkLibrary.generalEmailLinkForAndroidIntoBrackets=" ({0}: {1})";EmailCopyLinkLibrary.generalEmailLinkForIntoBrackets="{0}\n({1})\n";EmailCopyLinkLibrary.generalEmailLinkIntoBrackets=" ("+EmailCopyLinkLibrary.generalEmailBodyFormat+")";return EmailCopyLinkLibrary}();Commands.EmailCopyLinkLibrary=EmailCopyLinkLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.EmailCopyLink=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.EmailCopyLinkLibrary:new Commands.EmailCopyLinkLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var EntityImageUpload=function(){function EntityImageUpload(){}EntityImageUpload.DialogLoad=function(eventContext){var formContext=eventContext.getFormContext(),dialogAttributes=formContext.data.attributes,entityImageUrl=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityImageUrlParameter).getValue(),entityPrimaryAttribute=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityPrimaryAttributeParameter).getValue(),entityImageData=JSON.stringify({mode:entityImageUrl?0:1,entityPrimaryField:entityPrimaryAttribute,imageSrc:entityImageUrl,dialogModeLabel:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_EntityImage_CurrentEntityImage")});dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityImagePreviewId).setValue(entityImageData);if(entityImageUrl===null)formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.UseDefaultId).setVisible(false);else formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.UseDefaultId).setVisible(true);var isNotMobile=Xrm.Utility.getGlobalContext().client.getClient()!=Xrm.Constants.ClientNames.mobile;if(isNotMobile)formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.TakePhotoId).setVisible(false);else formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.TakePhotoId).setVisible(true);formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.UploadImageId).setVisible(true);formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId).setVisible(false);formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogCancelId).setVisible(false)};EntityImageUpload.TakePhoto=function(eventContext){var formContext=eventContext.getFormContext(),dialogAttributes=eventContext.getFormContext().data.attributes,options={height:144,width:144,quality:50,allowEdit:true,preferFrontCamera:false};Xrm.Device.captureImage(options).then(function(file){EntityImageUpload._switchDialogMode(eventContext,true);EntityImageUpload._setEntityImagePreivewData(file,dialogAttributes)},function(error){var alert={text:error.message};Xrm.Navigation.openAlertDialog(alert)})};EntityImageUpload.UploadPhoto=function(eventContext){var formContext=eventContext.getFormContext(),dialogAttributes=eventContext.getFormContext().data.attributes,options={allowMultipleFiles:false,accept:"image/*"},imageFormats=/(\.jpg|\.png|\.JPG|\.PNG|\.gif|\.GIF|\.jpeg|\.JPEG|\.tif|\.TIF|\.tiff|\.TIFF|\.bmp|\.BMP)$/;Xrm.Utility.getGlobalContext().client.getClient()===Xrm.Constants.ClientNames.mobile&&XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();Xrm.Device.pickFile(options).then(function(files){if(files[0].fileName.match(imageFormats)){EntityImageUpload._switchDialogMode(eventContext,true);EntityImageUpload._setEntityImagePreivewData(files[0],dialogAttributes)}else{var alert_3={text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_UploadImage_ErrorMsg")};Xrm.Navigation.openAlertDialog(alert_3)}Xrm.Utility.getGlobalContext().client.getClient()===Xrm.Constants.ClientNames.mobile&&Xrm.Utility.closeProgressIndicator()},function(error){if(error.errorCode!=0){var alert_4={text:error.message};Xrm.Navigation.openAlertDialog(alert_4)}Xrm.Utility.getGlobalContext().client.getClient()===Xrm.Constants.ClientNames.mobile&&Xrm.Utility.closeProgressIndicator()})};EntityImageUpload.UseDefault=function(eventContext){EntityImageUpload._switchDialogMode(eventContext,true);var dialogAttributes=eventContext.getFormContext().data.attributes,entityPrimaryAttribute=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityPrimaryAttributeParameter).getValue(),entityImageData=JSON.stringify({mode:1,entityPrimaryField:entityPrimaryAttribute,imageSrc:"",dialogModeLabel:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_EntityImage_NewEntityImage")});dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityImagePreviewId).setValue(entityImageData);dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityImageDataParameter).setValue("")};EntityImageUpload.Update=function(eventContext){var dialogAttributes=eventContext.getFormContext().data.attributes,imageData=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityImageDataParameter).getValue(),primaryImageAttribute=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityPrimaryImageAttribute)?dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityPrimaryImageAttribute).getValue():"entityimage",entityImageData=(_a={},_a[primaryImageAttribute]=imageData,_a),entityLogicalName=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityLogicalNameParameter).getValue(),entityId=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityIdParameter).getValue();XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();Xrm.WebApi.updateRecord(entityLogicalName,entityId,entityImageData).then(function(){Xrm.Page.ui.close();Xrm.Utility.closeProgressIndicator()},function(error){var alert={text:error.message};Xrm.Navigation.openAlertDialog(alert);Xrm.Utility.closeProgressIndicator()});var _a};EntityImageUpload.Cancel=function(eventContext){EntityImageUpload._switchDialogMode(eventContext,false);var dialogAttributes=eventContext.getFormContext().data.attributes,entityImageUrl=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityImageUrlParameter).getValue(),entityPrimaryAttribute=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityPrimaryAttributeParameter).getValue(),entityImageData=JSON.stringify({mode:entityImageUrl?0:1,entityPrimaryField:entityPrimaryAttribute,imageSrc:entityImageUrl,dialogModeLabel:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_EntityImage_CurrentEntityImage")});dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityImagePreviewId).setValue(entityImageData)};EntityImageUpload._switchDialogMode=function(eventContext,isConfirmation){var formContext=eventContext.getFormContext(),dialogAttributes=formContext.data.attributes,editModeLabel=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_EntityImage_ChangeImage"),confirmationModeLabel=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_EntityImage_UpdateImage"),entityImageUrl=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityImageUrlParameter).getValue(),editModeDescriptionLabel=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_EntityImage_ChangeImage_Description"),confirmationModeDescriptionLabel=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_EntityImage_UpdateImage_Description");formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.TitleId).setLabel(isConfirmation?confirmationModeLabel:editModeLabel);formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DescriptionId).setLabel(isConfirmation?confirmationModeDescriptionLabel:editModeDescriptionLabel);var isMobile=Xrm.Utility.getGlobalContext().client.getClient()===Xrm.Constants.ClientNames.mobile;isMobile&&formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.TakePhotoId).setVisible(!isConfirmation);formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.UploadImageId).setVisible(!isConfirmation);entityImageUrl!==null&&formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.UseDefaultId).setVisible(!isConfirmation);formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId).setVisible(isConfirmation);formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogCancelId).setVisible(isConfirmation);if(isConfirmation)formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId).setFocus();else if(isMobile)formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.TakePhotoId).setFocus();else formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.UploadImageId).setFocus()};EntityImageUpload._setEntityImagePreivewData=function(file,dialogAttributes){var base64FileContent=file.fileContent,entityPrimaryAttribute=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityPrimaryAttributeParameter).getValue(),entityImageData=JSON.stringify({mode:0,entityPrimaryField:entityPrimaryAttribute,imageSrc:"data:image;base64,"+base64FileContent,dialogModeLabel:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_EntityImage_NewEntityImage")});dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityImagePreviewId).setValue(entityImageData);dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityImageDataParameter).setValue(base64FileContent)};return EntityImageUpload}();Commands.EntityImageUpload=EntityImageUpload})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var DeviceSettings=function(){function DeviceSettings(){}DeviceSettings.onLoadDeviceSettings=function(eventContext){var formContext=eventContext.getFormContext(),dialogAttributes=formContext.data.attributes;dialogAttributes.get("is_saved").setValue(false);var deviceSettings=dialogAttributes.get("device_settings").getValue(),isOfflineControlHidden=dialogAttributes.get("is_offline_control_hidden").getValue(),isOfflineSyncEnabled=dialogAttributes.get("is_offlinesync_enabled").getValue(),isOfflineInitializing=dialogAttributes.get("is_offline_initializing").getValue();DeviceSettings.setOfflineSync(formContext,isOfflineControlHidden,isOfflineSyncEnabled,isOfflineInitializing);DeviceSettings.setUserContentAndLocation(dialogAttributes,deviceSettings);DeviceSettings.setCamera(dialogAttributes,deviceSettings);DeviceSettings.isLoaded=true};DeviceSettings.saveButtonClick=function(eventContext){var formContext=eventContext.getFormContext(),dialogAttributes=formContext.data.attributes,deviceSettings=dialogAttributes.get("device_settings").getValue(),isOfflineSyncEnabled=dialogAttributes.get("is_offlinesync_enabled").getValue(),oldDeviceSettings=JSON.stringify(deviceSettings);DeviceSettings.saveGeneralParameters(dialogAttributes,deviceSettings);DeviceSettings.saveCamera(dialogAttributes,deviceSettings);DeviceSettings.saveVideo(dialogAttributes,deviceSettings);if(JSON.stringify(deviceSettings)===oldDeviceSettings&&isOfflineSyncEnabled===dialogAttributes.get("offlineSync").getValue())dialogAttributes.get("is_saved").setValue(false);else{dialogAttributes.get("device_settings").setValue(deviceSettings);dialogAttributes.get("is_offlinesync_enabled").setValue(dialogAttributes.get("offlineSync").getValue());dialogAttributes.get("is_saved").setValue(true)}Xrm.Page.ui.close()};DeviceSettings.closeButtonClick=function(eventContext){var formContext=eventContext.getFormContext(),dialogAttributes=formContext.data.attributes;dialogAttributes.get("is_saved").setValue(false);Xrm.Page.ui.close()};DeviceSettings.onUserContentAndLocationChanged=function(eventContext){var formContext=eventContext.getFormContext(),dialogAttributes=formContext.data.attributes,userContentAndLocation=dialogAttributes.get("userContentAndLocation");if(DeviceSettings.isLoaded&&userContentAndLocation.getValue()){userContentAndLocation.setValueInternal(false);Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.DeviceSettingsConsentDialog,null,null).then(function(response){response.parameters["is_confirmed"]&&userContentAndLocation.setValueInternal(true)})}};DeviceSettings.setOfflineSync=function(formContext,isOfflineControlHidden,isOfflineSyncEnabled,isOfflineInitializing){var dialogAttributes=formContext.data.attributes,offlineSync=dialogAttributes.get("offlineSync"),offlineSyncControl=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OfflineSync);if(isOfflineControlHidden){offlineSyncControl.setVisible(false);offlineSync.setValueInternal(false)}else if(isOfflineSyncEnabled){offlineSync.setValueInternal(isOfflineSyncEnabled);isOfflineInitializing&&offlineSyncControl.setDisabled(true)}else offlineSync.setValueInternal(false)};DeviceSettings.setUserContentAndLocation=function(dialogAttributes,deviceSettings){var userContentAndLocation=dialogAttributes.get("userContentAndLocation");userContentAndLocation.setValueInternal(deviceSettings["microphone"].isEnabled&&deviceSettings["geolocation"].isEnabled)};DeviceSettings.setCamera=function(dialogAttributes,deviceSettings){var cameraEnabled=dialogAttributes.get("cameraEnabled");cameraEnabled.setValueInternal(deviceSettings["camera"].isEnabled);var savePhotoToLibrary=dialogAttributes.get("savePhotoToLibrary");savePhotoToLibrary.setValueInternal(deviceSettings["camera"].savePhoto);dialogAttributes.get("photoResolution").setValue(deviceSettings["camera"].imageRes)};DeviceSettings.saveGeneralParameters=function(dialogAttributes,deviceSettings){var parameters=["geolocation","microphone"],attributeName;parameters.forEach(function(item){attributeName="userContentAndLocation";if(deviceSettings[item])deviceSettings[item].isEnabled=dialogAttributes.get(attributeName).getValue();else{var feature=(_a={},_a[item]={featureName:item,isEnabled:dialogAttributes.get(attributeName).getValue()},_a);Object.assign(deviceSettings,feature)}var _a})};DeviceSettings.saveCamera=function(dialogAttributes,deviceSettings){var attribute=dialogAttributes.get("photoResolution");if(deviceSettings["camera"]){deviceSettings["camera"].isEnabled=dialogAttributes.get("cameraEnabled").getValue();deviceSettings["camera"].savePhoto=dialogAttributes.get("savePhotoToLibrary").getValue();deviceSettings["camera"].imageRes=attribute.getSelectedOption().value}else{var camera={camera:{featureName:"camera",isEnabled:dialogAttributes.get("cameraEnabled").getValue(),savePhoto:dialogAttributes.get("savePhotoToLibrary").getValue(),imageRes:attribute.getSelectedOption().value}};Object.assign(deviceSettings,camera)}};DeviceSettings.saveVideo=function(dialogAttributes,deviceSettings){var videoValue=dialogAttributes.get("cameraEnabled").getValue()&&dialogAttributes.get("userContentAndLocation").getValue();if(deviceSettings["video"])deviceSettings["video"].isEnabled=videoValue;else{var video={video:{featureName:"video",isEnabled:videoValue}};Object.assign(deviceSettings,video)}};DeviceSettings.isLoaded=false;return DeviceSettings}();Commands.DeviceSettings=DeviceSettings})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var ExportLibraryLegacy=function(){function ExportLibraryLegacy(){this.exportToExcelLegacy=function(gridControl,entityTypeCode,exportType){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.exportToXlsx(gridControl,entityTypeCode,exportType):backCompatHeader.Mscrm.GridRibbonActions.exportToXlsx(gridControl,entityTypeCode,exportType)};this.exportToExcel=function(gridControl,entityTypeName,exportType){var entityTypeCode=Xrm.Internal.getEntityCode(entityTypeName),backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.exportToXlsx(gridControl,entityTypeCode,exportType):backCompatHeader.Mscrm.GridRibbonActions.exportToXlsx(gridControl,entityTypeCode,exportType)};this.generateWordTemplateFlyout=function(commandProperties,entityTypeName,isForm,gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.generateWordTemplateFlyout(commandProperties,entityTypeName,isForm,gridControl):backCompatHeader.Mscrm.CommandBarActions.generateWordTemplateFlyout(commandProperties,entityTypeName,isForm,gridControl)};this.generateExcelTemplateFlyout=function(commandProperties,entityTypeName,gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.generateDocumentTemplateFlyout(commandProperties,entityTypeName,gridControl):backCompatHeader.Mscrm.CommandBarActions.generateDocumentTemplateFlyout(commandProperties,entityTypeName,gridControl)};this.runExcelTemplate=function(commandProperties,gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.runDocumentTemplate(commandProperties,gridControl):backCompatHeader.Mscrm.GridRibbonActions.runDocumentTemplate(commandProperties,gridControl)};this.runWordTemplate=function(commandProperties,entityTypeName,gridControl,selectedRecords){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.runWordTemplate(commandProperties,entityTypeName,gridControl,selectedRecords):backCompatHeader.Mscrm.GridRibbonActions.runWordTemplate(commandProperties,entityTypeName,gridControl,selectedRecords)}}return ExportLibraryLegacy}();Commands.ExportLibraryLegacy=ExportLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var ExportToExcelType;(function(ExportToExcelType){ExportToExcelType[ExportToExcelType["DynamicXlsx"]=2]="DynamicXlsx";ExportToExcelType[ExportToExcelType["PivotXlsx"]=3]="PivotXlsx";ExportToExcelType[ExportToExcelType["StaticXlsx"]=4]="StaticXlsx";ExportToExcelType[ExportToExcelType["AllStaticXlsx"]=5]="AllStaticXlsx";ExportToExcelType[ExportToExcelType["OnlineExcel"]=6]="OnlineExcel"})(ExportToExcelType||(ExportToExcelType={}));var ExportLibrary=function(){function ExportLibrary(){var _this=this;this.getExportTypeName=function(exportType){var exportTypeName="";switch(exportType){case ExportToExcelType.AllStaticXlsx:exportTypeName="AllStaticXlsx";break;case ExportToExcelType.StaticXlsx:exportTypeName="StaticXlsx";break;case ExportToExcelType.DynamicXlsx:exportTypeName="DynamicXlsx";break;case ExportToExcelType.PivotXlsx:exportTypeName="PivotXlsx";break;case ExportToExcelType.OnlineExcel:exportTypeName="OnlineExcel";break}return exportTypeName};this.exportToExcelLegacy=function(gridControl,entityTypeCode,exportType){var entityTypeName=Xrm.Internal.getEntityName(entityTypeCode);_this.exportToExcel(gridControl,entityTypeName,exportType,null)};this.exportToExcel=function(gridControl,entityTypeName,exportType,selectedRecords){var exportTypeName=_this.getExportTypeName(exportType);Commands.ExportTelemetryHelper.logExportInitTelemetry("ExportToExcel.Init",entityTypeName,exportTypeName);if(exportType==ExportToExcelType.OnlineExcel)_this.exportToExcelOnline(gridControl,entityTypeName,exportType);else if(exportType==ExportToExcelType.DynamicXlsx||exportType==ExportToExcelType.PivotXlsx)_this.exportToDynamicExcel(gridControl,entityTypeName,exportType);else _this.exportToStandardExcel(gridControl.getViewSelector().getCurrentView(),gridControl.getFetchXml(),entityTypeName,exportType,selectedRecords,gridControl.getRollupType())};this.exportToStandardExcel=function(currentView,fetchXml,entityTypeName,exportType,selectedRecords,rollupType){var exportTypeName=_this.getExportTypeName(exportType),documentType=1,openMode=null;if(navigator.userAgent.search("MSIE")>0||navigator.userAgent.search("Trident")>0||navigator.userAgent.search("Edge")>0)openMode={openMode:1};else openMode={openMode:2};var dom_Fetch=XrmCore.InternalUtilities.ExportUtilities.getXmlDOMFromString(fetchXml);if(exportType==ExportToExcelType.AllStaticXlsx){dom_Fetch.getElementsByTagName("fetch")[0].removeAttribute("page");dom_Fetch.getElementsByTagName("fetch")[0].removeAttribute("count")}fetchXml=XrmCore.InternalUtilities.ExportUtilities.getXmlAsString(dom_Fetch);var keys=[],values=[],queryApi="";if(selectedRecords!=null){keys.push("selectedRecords");values.push({Type:"System.String",Value:selectedRecords.toString()})}if(rollupType!=null&&rollupType==1&&Xrm.Page.data!=null&&Xrm.Page.data.entity!=null){var primaryEntity=Xrm.Page.data.entity;keys.push("oId");values.push({Type:"System.String",Value:primaryEntity.getId().toString()});keys.push("oType");values.push({Type:"System.String",Value:Xrm.Internal.getEntityCode(primaryEntity.getEntityName()).toString()});queryApi="CRMActivity.RollupRelatedByParty"}var arg=new XrmCore.SdkContracts.InputArgument(selectedRecords!=null?1:0,true,keys,values),argCol=new XrmCore.SdkContracts.InputArgumentCollection(arg),r=new XrmCore.SdkContracts.ExportToExcelRequest(currentView,fetchXml,"",queryApi,argCol);Commands.ExportTelemetryHelper.logExportDetailsTelemetry("ExportToExcel.Details",entityTypeName,exportTypeName,currentView.entityType,currentView.id);Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString("Main_system_library","ExportToXlsx_ProgressDialog_Header"));var deferred=Xrm.WebApi.online.execute(r).then(function(res){return res.json()}).then(function(odataResponse){var file={fileContent:odataResponse.ExcelFile,fileName:XrmCore.InternalUtilities.ExportUtilities.generateExportFileName(currentView.name,documentType),mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};return Xrm.Navigation.openFile(file,openMode)}).then(function(res){console.log(res);Commands.ExportTelemetryHelper.logExportSuccessTelemetry("ExportToExcel.Completed",entityTypeName,exportTypeName);Xrm.Utility.closeProgressIndicator()}).then(undefined,function(err){console.error(err);Commands.ExportTelemetryHelper.logFailureTelemetry("ExportToExcel.Failure",err,entityTypeName,exportTypeName);var errorMessage="";if(err.innerror&&err.innerror.message){if(err.innerror.message!="")errorMessage=err.innerror.message}else errorMessage=err.message;var errorDialogOptions={message:errorMessage,errorCode:err.errorCode};Xrm.Navigation.openErrorDialog(errorDialogOptions);Xrm.Utility.closeProgressIndicator()})};this.exportToDynamicExcel=function(gridControl,entityTypeName,exportType){var documentType=1,openMode={openMode:2},currentView=gridControl.getViewSelector().getCurrentView(),fetchXml=gridControl.getFetchXml(),entityTypeCode=Xrm.Internal.getEntityCode(gridControl.getEntityName()),rollupType=gridControl.getRollupType(),dialogOption={height:600,width:800,position:1},dialogParams={};dialogParams["entity_typeName"]=gridControl.getEntityName();dialogParams["entity_typeCode"]=entityTypeCode;dialogParams["entity_fetchXml"]=fetchXml;dialogParams["entity_effectiveFetchXml"]=fetchXml;dialogParams["entity_exportType"]=exportType;dialogParams["entity_viewId"]=gridControl.getViewSelector().getCurrentView().id;dialogParams["entity_viewName"]=gridControl.getViewSelector().getCurrentView().name;dialogParams["entity_viewType"]=gridControl.getViewSelector().getCurrentView().entityType;dialogParams["entity_totalRecordCount"]=gridControl.getGrid().getTotalRecordCount();if(rollupType!=null&&rollupType==1&&Xrm.Page.data!=null&&Xrm.Page.data.entity!=null){var primaryEntity=Xrm.Page.data.entity;dialogParams["entity_oId"]=primaryEntity.getId().toString();dialogParams["entity_oType"]=Xrm.Internal.getEntityCode(primaryEntity.getEntityName()).toString();dialogParams["entity_rollupType"]=rollupType}var entityName=currentView.entityType,columns=["layoutxml"],exportTypeName=_this.getExportTypeName(exportType);Commands.ExportTelemetryHelper.logExportDetailsTelemetry("ExportToExcel.Details",entityTypeName,exportTypeName,gridControl.getViewSelector().getCurrentView().entityType,gridControl.getViewSelector().getCurrentView().id);Xrm.WebApi.online.retrieveRecord(entityName,currentView.id,"?$select="+columns).then(function(oppResponse){if(oppResponse.layoutxml){if(entityTypeName=="activitypointer"){for(var dom_Fetch=XrmCore.InternalUtilities.ExportUtilities.getXmlDOMFromString(fetchXml),dom_Layout=XrmCore.InternalUtilities.ExportUtilities.getXmlDOMFromString(oppResponse.layoutxml),i=dom_Layout.getElementsByTagName("row")[0].childNodes.length-1;i>0;i--)if(dom_Layout.getElementsByTagName("row")[0].childNodes[i].hasAttribute("ishidden"))for(var attributeName=dom_Layout.getElementsByTagName("row")[0].childNodes[i].attributes.name.value,l=dom_Fetch.getElementsByTagName("attribute").length-1;l>0;l--)dom_Fetch.getElementsByTagName("attribute")[l].attributes.name.value==attributeName&&dom_Fetch.getElementsByTagName("attribute")[l].remove();fetchXml=XrmCore.InternalUtilities.ExportUtilities.getXmlAsString(dom_Fetch);dialogParams["entity_fetchXml"]=fetchXml;dialogParams["entity_effectiveFetchXml"]=fetchXml}dialogParams["entity_layoutXml"]=oppResponse.layoutxml;dialogParams["entity_effectiveLayoutXml"]=oppResponse.layoutxml;Commands.ExportTelemetryHelper.logExportSuccessTelemetry("ExportToExcel.DialogOpened",entityTypeName,exportTypeName);Xrm.Navigation.openDialog("ExportToExcel",dialogOption,dialogParams)}},function(err){Commands.ExportTelemetryHelper.logFailureTelemetry("ExportToExcel.Failure",err,entityTypeName,exportTypeName);Xrm.Navigation.openAlertDialog({text:"No LayoutXml found for this View",confirmButtonLabel:"Error Dialog"})});return};this.exportToExcelOnline=function(gridControl,entityTypeName,exportType){var params={},currentView=gridControl.getViewSelector().getCurrentView(),fetchXml=gridControl.getFetchXml(),dom_Fetch=XrmCore.InternalUtilities.ExportUtilities.getXmlDOMFromString(fetchXml);dom_Fetch.getElementsByTagName("fetch")[0].removeAttribute("page");dom_Fetch.getElementsByTagName("fetch")[0].removeAttribute("count");fetchXml=XrmCore.InternalUtilities.ExportUtilities.getXmlAsString(dom_Fetch);var screenDimensions=_this.getScreenDimensions(),exportTypeName=_this.getExportTypeName(exportType),rollupType=gridControl.getRollupType();Xrm.Utility.getEntityMetadata(entityTypeName).then(function(entityMetadata){params["current_view"]=currentView.entityType+"/"+currentView.id;params["fetch_xml"]=fetchXml;params["entityType_name"]=entityTypeName;params["layout_xml"]=" ";params["entity_is_importable"]=entityMetadata.IsImportable;if(rollupType!=null&&rollupType==1&&Xrm.Page.data!=null&&Xrm.Page.data.entity!=null){var primaryEntity=Xrm.Page.data.entity;params["entity_oId"]=primaryEntity.getId().toString();params["entity_oType"]=Xrm.Internal.getEntityCode(primaryEntity.getEntityName()).toString();params["entity_rollupType"]=rollupType}Commands.ExportTelemetryHelper.logExportDetailsTelemetry("ExportToExcel.Details",entityTypeName,exportTypeName,gridControl.getViewSelector().getCurrentView().entityType,gridControl.getViewSelector().getCurrentView().id);Xrm.Navigation.openDialog("ExportToExcelOnlineDialog",{width:screenDimensions.width,height:screenDimensions.height,position:1},params)},function(err){Commands.ExportTelemetryHelper.logFailureTelemetry("ExportToExcel.Failure",err,entityTypeName,exportTypeName);var errorDialogOptions={message:Xrm.Utility.getResourceString("Main_system_library","ExportToXlsx_Error_Entity_Metadata_Not_Found"),errorCode:err.errorCode};Xrm.Navigation.openErrorDialog(errorDialogOptions)})};this.getScreenDimensions=function(){var screenWidth=window.screen.width,screenHeight=window.screen.height,screenDimensions={width:screenWidth,height:screenHeight};return screenDimensions};this.generateWordTemplateFlyout=function(commandProperties,entityTypeName,isForm,gridControl){var documentType=2,ribbonRelationshipType=-1,contextType=0,currentEntityTypeName=entityTypeName;if(isForm)contextType=1;else{if(entityTypeName=="activitypointer"&&gridControl!=null&&gridControl.getGrid()!=null){var selectedRows=gridControl.getGrid().getSelectedRows();if(selectedRows!=null&&selectedRows.getLength()==1){var selectedEntity=selectedRows.get(0).data.entity;if(selectedEntity!=null)currentEntityTypeName=selectedEntity.getEntityName()}}if(typeof gridControl.getRelationship==="function"){contextType=2;var relationship=gridControl.getRelationship();if(relationship!==null&&relationship.relationshipType===0)ribbonRelationshipType=0;else if(relationship!==null&&relationship.relationshipType===1)ribbonRelationshipType=1}}var deferred1=XrmCore.InternalUtilities.ExportUtilities.retrieveSystemDocumentTemplates(currentEntityTypeName,documentType),deferred2=XrmCore.InternalUtilities.ExportUtilities.retrievePersonalDocumentTemplates(currentEntityTypeName,documentType),menu=Promise.all([deferred1,deferred2]).then(function(_a){var systemTemplates=_a[0],personalTemplates=_a[1];ExportLibrary._systemTemplates=systemTemplates;ExportLibrary._personalTemplates=personalTemplates;return _this.buildMenu(systemTemplates,personalTemplates,entityTypeName,isForm,contextType,ribbonRelationshipType,documentType)});commandProperties["PopulationXML"]=menu;return};this.generateExcelTemplateFlyout=function(commandProperties,entityTypeName,gridControl){var isForm=false,documentType=1,contextType=0,ribbonRelationshipType=-1,currentEntityTypeName=entityTypeName;if(entityTypeName=="activitypointer"&&gridControl!=null&&gridControl.getEntityName()!=null)currentEntityTypeName=gridControl.getEntityName();if(typeof gridControl.getRelationship==="function"){contextType=2;var relationship=gridControl.getRelationship();if(relationship!==null&&relationship.relationshipType===0)ribbonRelationshipType=0;else if(relationship!==null&&relationship.relationshipType===1)ribbonRelationshipType=1}var deferred1=XrmCore.InternalUtilities.ExportUtilities.retrieveSystemDocumentTemplates(currentEntityTypeName,documentType),deferred2=XrmCore.InternalUtilities.ExportUtilities.retrievePersonalDocumentTemplates(currentEntityTypeName,documentType),menu=Promise.all([deferred1,deferred2]).then(function(_a){var systemTemplates=_a[0],personalTemplates=_a[1];ExportLibrary._systemTemplates=systemTemplates;ExportLibrary._personalTemplates=personalTemplates;return _this.buildMenu(systemTemplates,personalTemplates,entityTypeName,isForm,contextType,ribbonRelationshipType,documentType)});commandProperties["PopulationXML"]=menu;return};this.runExcelTemplate=function(commandProperties,gridControl){var documentType=1,openMode={openMode:2},contextType=0;if(typeof gridControl.getRelationship==="function")contextType=2;var personalTemplateKeyword="DocumentTemplates.Menu.PersonalExcelTemplates.",sourceControlId=commandProperties["SourceControlId"];if(sourceControlId=="ViewAllMyTemplatesId"){_this.navigateToPersonalDocumentTemplates("recordlist","personaldocumenttemplate");return}var templateEntityName="documenttemplate",templateId=sourceControlId.split(/[. ]+/).pop();if(sourceControlId.indexOf(personalTemplateKeyword)!==-1)templateEntityName="personaldocumenttemplate";if(templateId==="UploadTemplate"||templateId==="DownloadTemplate"){_this.openDocTemplateDialog(templateId,documentType,gridControl);return}var onlineTemplateKeyword="DocumentOnlineTemplates.Menu.",personalTemplateOnlineValidatorKeyword="PersonalExcelTemplates.Controls.",onlineExcelValidatorKeyword="Controls.OpenExcelOnline.";if(sourceControlId.indexOf(onlineTemplateKeyword)!==-1){if(sourceControlId.indexOf(personalTemplateOnlineValidatorKeyword)!==-1)templateEntityName="personaldocumenttemplate";if(sourceControlId.indexOf(onlineExcelValidatorKeyword)!==-1){var params={},screenDimensions=_this.getScreenDimensions(),fetchXml=gridControl.getFetchXml();params["current_view"]=templateEntityName+"/"+templateId;params["fetch_xml"]=fetchXml;params["entityType_name"]=gridControl.getEntityName();params["layout_xml"]=" ";var entityTypeName=gridControl.getEntityName();Xrm.Utility.getEntityMetadata(entityTypeName).then(function(entityMetadata){params["entity_is_importable"]=entityMetadata.IsImportable;Xrm.Navigation.openDialog("ExportToExcelOnlineDialog",{width:screenDimensions.width,height:screenDimensions.height,position:1},params)},function(err){Xrm.Navigation.openDialog("ExportToExcelOnlineDialog",{width:screenDimensions.width,height:screenDimensions.height,position:1},params)});return}}var templateRef={id:"{"+templateId+"}",entityType:templateEntityName},r=null;if(contextType===0){var currentViewId=gridControl.getViewSelector().getCurrentView().id,currentView={id:currentViewId,entityType:"savedquery"};r=new XrmCore.SdkContracts.RenderTemplateFromViewRequest(templateRef,currentView)}else if(contextType===2){var fetchXml=gridControl.getFetchXml(),dom_Fetch=XrmCore.InternalUtilities.ExportUtilities.getXmlDOMFromString(fetchXml);dom_Fetch.getElementsByTagName("fetch")[0].removeAttribute("page");dom_Fetch.getElementsByTagName("fetch")[0].removeAttribute("count");fetchXml=XrmCore.InternalUtilities.ExportUtilities.getXmlAsString(dom_Fetch);var keys=[],values=[],arg=new XrmCore.SdkContracts.InputArgument(0,true,keys,values),argCol=new XrmCore.SdkContracts.InputArgumentCollection(arg);r=new XrmCore.SdkContracts.RenderTemplateRequest(templateRef,fetchXml,"",argCol)}Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString("Main_system_library","ExportToXlsx_ProgressDialog_Header"));var deferred=Xrm.WebApi.online.execute(r).then(function(res){return res.json()}).then(function(odataResponse){var template=undefined;if(templateEntityName==="documenttemplate")template=ExportLibrary._systemTemplates.filter(function(obj){return obj.Id===templateId})[0];else template=ExportLibrary._personalTemplates.filter(function(obj){return obj.Id===templateId})[0];var file={fileContent:odataResponse.ExcelFile,fileName:XrmCore.InternalUtilities.ExportUtilities.generateExportFileName(template.Name,documentType),mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};Xrm.UI.addGlobalNotification(1,1,Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Group_SucessfullyDownloaded"),null,null);return Xrm.Navigation.openFile(file,openMode)},function(errorResponse){Xrm.Utility.closeProgressIndicator();console.log(errorResponse);var errorMessage="";if(errorResponse.innerror&&errorResponse.innerror.message){if(errorResponse.innerror.message!="")errorMessage=errorResponse.innerror.message}else errorMessage=errorResponse.message;var errorDialogOptions={message:errorMessage,errorCode:errorResponse.errorCode};Xrm.Navigation.openErrorDialog(errorDialogOptions)}).then(function(res){console.log(res);Xrm.Utility.closeProgressIndicator()});return};this.exportToExcelEditColumns=function(documentType,gridControl,exportType){var params={},dialogOptions={width:800,height:600,position:1},docDialog="DownloadExcelTemplate",columns=["layoutxml"],exportTypeName=_this.getExportTypeName(exportType),viewId=gridControl.getViewSelector().getCurrentView().id.replace("{","").replace("}",""),entityTypeName=gridControl.getViewSelector().getCurrentView().entityType;params["entity_typeCode"]=Xrm.Internal.getEntityCode(gridControl.getEntityName());params["View_Id"]=viewId;params["Entity_Name"]=gridControl.getEntityName();params["current_view"]=gridControl.getViewSelector().getCurrentView().name;params["fetch_xmldata"]=gridControl.getFetchXml();params["file_data"]=gridControl.getFetchXml();params["DocTemplateFile_Type"]=documentType;Xrm.WebApi.online.retrieveRecord(entityTypeName,viewId,"?$select="+columns).then(function(oppResponse){if(oppResponse.layoutxml){params["entity_layoutXml"]=oppResponse.layoutxml;params["entity_effectiveLayoutXml"]=oppResponse.layoutxml;Commands.ExportTelemetryHelper.logExportSuccessTelemetry("DownloadExcelTemplate.DialogOpened",entityTypeName,exportTypeName);Xrm.Navigation.openDialog(docDialog,dialogOptions,params)}},function(err){Commands.ExportTelemetryHelper.logFailureTelemetry("DownloadExcelTemplate.Failure",err,entityTypeName,exportTypeName);Xrm.Navigation.openAlertDialog({text:"No LayoutXml found for this View",confirmButtonLabel:"Error Dialog"})});return};this.openDocTemplateDialog=function(dialogName,documentType,gridControl,isForm){var isCustomerEnabledForPreview=Xrm.Internal.isFeatureEnabled("October2020Update"),width=512,height=300,docDialog="DocumentTemplateUpload";if(documentType==2&&dialogName==="DownloadTemplate"){width=850;height=650}if(dialogName==="DownloadTemplate")if(isForm||documentType==2)docDialog="DocumentTemplateDownload";else if(isCustomerEnabledForPreview){_this.exportToExcelEditColumns(documentType,gridControl,2);return}else docDialog="DocumentTemplateDownload";var params={};if(isForm)params["Entity_Name"]=gridControl.entityReference.entityType;else{var viewId=gridControl.getViewSelector().getCurrentView().id.replace("{","").replace("}",""),currentView=gridControl.getViewSelector().getCurrentView().name,fetchXmlData=gridControl.getFetchXml();params["Entity_Name"]=gridControl.getEntityName();params["View_Id"]=viewId;params["current_view"]=currentView;params["fetch_xmldata"]=fetchXmlData}params["DocTemplateFile_Type"]=documentType;params["DocTemplate_ExpectedFileType"]=documentType==1?3:documentType;params["DocTemplate_Type"]=9941;Xrm.Navigation.openDialog(docDialog,{width:width,height:height,position:1},params).then(function(result){if(result.parameters&&result.parameters["Is_DocumentTemplate_Uploaded"]!=undefined&&result.parameters["DocumentTemplate_index"]!=undefined)if(result.parameters["Is_DocumentTemplate_Uploaded"]==1){var entityFormOptions={};entityFormOptions["entityName"]="personaldocumenttemplate";entityFormOptions["entityId"]=result.parameters["DocumentTemplate_index"];var actionDescriptor={actionLabel:Xrm.Utility.getResourceString("Main_system_library","View_Personal_Document_Template"),eventHandler:function(){Xrm.Navigation.openForm(entityFormOptions)}};Xrm.UI.addGlobalNotification(1,1,Xrm.Utility.getResourceString("Main_system_library","DocTemplate_Successfully_Uploaded"),null,actionDescriptor)}Xrm.Utility.closeProgressIndicator()});return};this.runWordTemplate=function(commandProperties,entityTypeCode,gridControl,selectedRecords){var isForm=false,records=[];if(typeof selectedRecords==="string"){records=[selectedRecords];isForm=true}else records=[selectedRecords[0].Id];var documentType=2,openMode={openMode:2},personalTemplateKeyword="WordTemplates.Menu.PersonalWordTemplates.",sourceControlId=commandProperties["SourceControlId"];if(sourceControlId=="ViewAllMyTemplatesId"){_this.navigateToPersonalDocumentTemplates("recordlist","personaldocumenttemplate");return}var templateEntityName="documenttemplate";if(sourceControlId.indexOf(personalTemplateKeyword)!==-1)templateEntityName="personaldocumenttemplate";var templateId=sourceControlId.split(/[. ]+/).pop();if(templateId==="UploadTemplate"||templateId==="DownloadTemplate"){_this.openDocTemplateDialog(templateId,documentType,gridControl,isForm);return}var templateRef={id:"{"+templateId+"}",entityType:templateEntityName},actualEntityTypeCode=isForm?entityTypeCode:Xrm.Internal.getEntityCode(selectedRecords[0].TypeName),recordsString=JSON.stringify(records),exportWordDocumentRequest=new XrmCore.SdkContracts.ExportWordDocumentRequest(actualEntityTypeCode,templateRef,recordsString);Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString("Main_system_library","ExportToDocx_ProgressDialog_Header"));var deferred=Xrm.WebApi.online.execute(exportWordDocumentRequest).then(function(res){return res.json()}).then(function(odataResponse){var template=undefined;if(templateEntityName==="documenttemplate")template=ExportLibrary._systemTemplates.filter(function(obj){return obj.Id===templateId})[0];else template=ExportLibrary._personalTemplates.filter(function(obj){return obj.Id===templateId})[0];var file={fileContent:odataResponse.WordFile,fileName:XrmCore.InternalUtilities.ExportUtilities.generateExportFileName(template.Name,documentType),mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};Xrm.UI.addGlobalNotification(1,1,Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Group_Word_SucessfullyDownloaded"),null,null);return Xrm.Navigation.openFile(file,openMode)},function(errorResponse){Xrm.Utility.closeProgressIndicator();console.log(errorResponse);var errorMessage="";if(errorResponse.innerror&&errorResponse.innerror.message){if(errorResponse.innerror.message!="")errorMessage=errorResponse.innerror.message}else errorMessage=errorResponse.message;var errorDialogOptions={message:errorMessage,errorCode:errorResponse.errorCode};Xrm.Navigation.openErrorDialog(errorDialogOptions)}).then(function(res){console.log(res);Xrm.Utility.closeProgressIndicator()});return};this.navigateToPersonalDocumentTemplates=function(pageType,entityName){var personalDocTemplatePageInput={pageType:pageType,entityName:entityName};Xrm.Navigation.navigateTo(personalDocTemplatePageInput)};this.buildMenu=function(systemTemplates,personalTemplates,entityTypeName,isForm,contextType,ribbonRelationshipType,documentType){var menuId=XrmCore.InternalUtilities.ExportUtilities.determineRibbonMenuId(entityTypeName,isForm,contextType,ribbonRelationshipType,documentType,false),onlineMenuId=XrmCore.InternalUtilities.ExportUtilities.determineRibbonMenuId(entityTypeName,isForm,contextType,ribbonRelationshipType,documentType,true),commandId=XrmCore.InternalUtilities.ExportUtilities.determinRibbonCommandId(entityTypeName,isForm,contextType,ribbonRelationshipType,documentType,false),systemButtonsControl=systemTemplates!=null?XrmCore.InternalUtilities.ExportUtilities.buildControlsFromTemplates(menuId,onlineMenuId,commandId,systemTemplates,true,documentType):null,personalButtonsControl=personalTemplates!=null?XrmCore.InternalUtilities.ExportUtilities.buildControlsFromTemplates(menuId,onlineMenuId,commandId,personalTemplates,false,documentType):null,createcommandId=XrmCore.InternalUtilities.ExportUtilities.determinCreateRibbonCommandId(entityTypeName,isForm,contextType,documentType,true),createTemplates=XrmCore.InternalUtilities.ExportUtilities.retrieveCreateTemplates(),createuploadDownloadButtonsControl=XrmCore.InternalUtilities.ExportUtilities.buildControlsForCreate(menuId,createcommandId,createTemplates,false,documentType),menuSection1=XrmCore.InternalUtilities.ExportUtilities.buildMenuSection(menuId,false,documentType,true,10,createuploadDownloadButtonsControl),menuSection2=systemButtonsControl!=null?XrmCore.InternalUtilities.ExportUtilities.buildMenuSection(menuId,true,documentType,false,20,systemButtonsControl):null,menuSection3=personalButtonsControl!=null?XrmCore.InternalUtilities.ExportUtilities.buildMenuSection(menuId,false,documentType,false,30,personalButtonsControl):null,menuSections=[];menuSections.push(menuSection1);menuSection2!=null&&menuSections.push(menuSection2);menuSection3!=null&&menuSections.push(menuSection3);var menu=XrmCore.InternalUtilities.ExportUtilities.buildMenu(menuId,menuSections);return menu}}ExportLibrary._systemTemplates=[];ExportLibrary._personalTemplates=[];return ExportLibrary}();Commands.ExportLibrary=ExportLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Export=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.ExportLibrary:new Commands.ExportLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var ExportTelemetryHelper=function(){function ExportTelemetryHelper(){}ExportTelemetryHelper.getEventParams=function(entityTypeName,exportTypeName){var eventParams=[],entityTypeParam={name:"entityTypeName",value:entityTypeName},exportTypeParam={name:"exportTypeName",value:exportTypeName};eventParams.push(entityTypeParam);eventParams.push(exportTypeParam);return eventParams};ExportTelemetryHelper.logExportInitTelemetry=function(componentName,entityTypeName,exportTypeName){var eventParams=ExportTelemetryHelper.getEventParams(entityTypeName,exportTypeName);Xrm!=null&&Xrm.Reporting!=null&&Xrm.Reporting.reportSuccess(componentName,eventParams)};ExportTelemetryHelper.logExportDetailsTelemetry=function(componentName,entityTypeName,exportTypeName,viewEntityType,viewId){var viewEntityTypeParam={name:"viewEntityType",value:viewEntityType},viewIdParam={name:"viewId",value:viewId},eventParams=ExportTelemetryHelper.getEventParams(entityTypeName,exportTypeName);eventParams.push(viewEntityTypeParam);eventParams.push(viewIdParam);Xrm!=null&&Xrm.Reporting!=null&&Xrm.Reporting.reportSuccess(componentName,eventParams)};ExportTelemetryHelper.logExportSuccessTelemetry=function(componentName,entityTypeName,exportTypeName){var eventParams=ExportTelemetryHelper.getEventParams(entityTypeName,exportTypeName);Xrm!=null&&Xrm.Reporting!=null&&Xrm.Reporting.reportSuccess(componentName,eventParams)};ExportTelemetryHelper.logFailureTelemetry=function(componentName,err,entityTypeName,exportTypeName){var errorMessage;if(err.message&&err.message!=null&&err.message!="")errorMessage=err.message;else if(err.innerror&&err.innerror.message&&err.innerror.message!=null&&err.innerror.message!="")errorMessage=err.innerror.message;else errorMessage="Export to Excel Failed with unknown error";if(Xrm!=null&&Xrm.Reporting!=null){var errorParam={name:"ErrorResponse",message:errorMessage},eventParams=ExportTelemetryHelper.getEventParams(entityTypeName,exportTypeName);Xrm.Reporting.reportFailure(componentName,errorParam,"",eventParams)}};return ExportTelemetryHelper}();Commands.ExportTelemetryHelper=ExportTelemetryHelper})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var FlowsConstants=function(){function FlowsConstants(){}FlowsConstants.FlowFpiResponseIdsProcessed="FlowFpiResponseIdsProcessed";FlowsConstants.Flow_SessionStorage_CreateURL="flowCreateUrl";FlowsConstants.Flow_SessionStorage_ManageURL="flowManageUrl";FlowsConstants.Flow_SessionStorage_DefinitionList="flowDefinitionList";FlowsConstants.Flow_SessionStorage_UserLoginRequired="flowUserLoginRequired";FlowsConstants.Flow_SessionStorage_EntityLogicalName="dynamics365EntityLogicalName";FlowsConstants.Flow_SessionStorage_Dynamics365AccessToken="dynamics365AccessToken";FlowsConstants.Flow_LocalStorage_EnvironmentId="flowEnvironmentId";FlowsConstants.Flow_GlobalVar_EntityCollectionName="EntityLogicalCollectionName";FlowsConstants.Flow_GlobalVar_EntityLogicalName="EntityLogicalName";FlowsConstants.Flow_GlobalVar_IntegratedEnvironment="MICROSOFT_FLOW_INTEGRATED_ENVIRONMENT";FlowsConstants.Flow_GlobalVar_DestinationURL="MICROSOFT_FLOW_DESTINATIONURL";FlowsConstants.Flow_GlobalVar_FirstPartyURL="MICROSOFT_FLOW_FIRSTPARTYINTEGRATION_SITE_URL";FlowsConstants.Flow_GlobalVar_CrmOrgUniqueName="ORG_UNIQUE_NAME";FlowsConstants.Flow_GlobalVar_CrmOrgId="ORG_ID";FlowsConstants.Flow_Localization_CreateFlow="Flows_CreateFlow";FlowsConstants.Flow_Localization_ManageFlow="Flows_ManageFlows";FlowsConstants.Flow_Localization_LoginFlow="Flows_LoginFlow";FlowsConstants.Flow_Localization_RunWorkflow="Menu_Label_Run_Workflow";FlowsConstants.Flow_Localization_ManageFlowMenuSection="Flows_ManageFlowMenuSection";FlowsConstants.Flow_Localization_RunFlowMenuSection="Flows_RunFlowMenuSection";FlowsConstants.Flow_Localization_Authentication="SystemCustomization.SystemSettingsDialog.PreviewTab.IsMicrosoftFlowEnabled.AuthenticateButton.Text";FlowsConstants.Flow_Localization_AttemptAuthAgain="Flows_AttemptAuthAgain";FlowsConstants.Flow_Localization_FlowsNotSupportedWebclient="Flows_FlowsNotSupportedWebclient";FlowsConstants.Flow_Control_CreateFlow="Mscrm.Flows.TriggerFlow.CreateFlow";FlowsConstants.Flow_Control_ManageFlow="Mscrm.Flows.TriggerFlow.ManageFlows";FlowsConstants.Flow_Control_LoginFlow="Mscrm.Flows.TriggerFlow.LoginFlow";FlowsConstants.Flow_Control_AttemptAuthAgain="Mscrm.Flows.TriggerFlow.AttemptAuthAgain";FlowsConstants.Flow_Control_FlowsNotSupportedWebClient="Mscrm.Flows.TriggerFlow.FlowsNotSupportedWebclient";FlowsConstants.Flow_Settings_FlowSettings="ENABLE_MICROSOFT_FLOW_INTEGRATION";FlowsConstants.Flow_UciFpiUrl_ComponentId="FlowIntegrationUci";FlowsConstants.Flow_UciFpiUrl_ClientType="moca";FlowsConstants.Flow_UciFpiResources_FlowService="https://service.flow.microsoft.com/";FlowsConstants.Flow_UciFpiResources_GraphApi="https://graph.microsoft.com";FlowsConstants.ActivityPointerTypeCode=4200;FlowsConstants.Flow_ModernFlows="ModernFlows";FlowsConstants.Flow_OnDemandWorkFlow="On-Demand Workflow";FlowsConstants.Flow_Telemetry_FlowLibrary="FlowLibrary";FlowsConstants.Flow_Telemetry_WorkflowMenuBuilder="WorkflowDynamicMenuBuilder.buildMenuUCI";FlowsConstants.Flow_Telemetry_FlowMenuBuilder="FlowsDynamicMenuBuilder.buildMenuUCI";return FlowsConstants}();Commands.FlowsConstants=FlowsConstants})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var FlowsDynamicMenuBuilder=function(){function FlowsDynamicMenuBuilder(){}FlowsDynamicMenuBuilder.buildMenuUCI=function(flowsLibrary,entityLogicalName,selectedEntityTypeName,isForm){var mainPromise=new Promise(function(resolve,reject){var menuXml=FlowsDynamicMenuBuilder.generateMenuXml(flowsLibrary,entityLogicalName,selectedEntityTypeName,isForm,true);resolve(menuXml)});return mainPromise};FlowsDynamicMenuBuilder.buildStaticMenuUCI=function(flowsLibrary,selectedEntityTypeName,isForm){return FlowsDynamicMenuBuilder.generateFlowStaticMenuXml(flowsLibrary,selectedEntityTypeName,isForm,true)};FlowsDynamicMenuBuilder.buildFlowDefinitionMenuUCI=function(flowsLibrary,entityLogicalName,selectedEntityTypeName,isForm){return FlowsDynamicMenuBuilder.generateFlowDefinitionMenuXml(flowsLibrary,entityLogicalName,selectedEntityTypeName,isForm,true)};FlowsDynamicMenuBuilder.buildMenuWebClient=function(flowsLibrary,entityLogicalName,selectedEntityTypeName,isForm){var menuXml=FlowsDynamicMenuBuilder.generateMenuXml(flowsLibrary,entityLogicalName,selectedEntityTypeName,isForm,false);return menuXml};FlowsDynamicMenuBuilder.buildMenuWebClientWhenMenuNotSupported=function(flowsLibrary,isForm){var menuXml=FlowsDynamicMenuBuilder.generateMenuXmlForMenuNotSupportedForWebClient(flowsLibrary,isForm);return menuXml};FlowsDynamicMenuBuilder.generateMenuXml=function(flowsLibrary,entityName,selectedEntityLogicalName,isForm,isUCI){menuSectionCount=1;var menuSection1Title=Xrm.Encoding.xmlAttributeEncode(flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_ManageFlowMenuSection)),menuSection1='<MenuSection Id="Mscrm.DynamicMenu.Flows.MenuSection'+menuSectionCount+'" Title="'+menuSection1Title+'" Sequence="'+menuSectionCount*10+'"><Controls Id="Mscrm.DynamicMenu.Flows.Controls'+menuSectionCount+'">',controls="";menuSectionCount++;menuSequence=10;var label=flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_CreateFlow);controls+=FlowsDynamicMenuBuilder.generateControlXml(label,menuSequence,Commands.FlowsConstants.Flow_Control_CreateFlow,entityName,isForm,isUCI);menuSequence+=10;label=flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_ManageFlow);controls+=FlowsDynamicMenuBuilder.generateControlXml(label,menuSequence,Commands.FlowsConstants.Flow_Control_ManageFlow,entityName,isForm,isUCI);menuSequence+=10;var flowLoginRequired=sessionStorage.getItem(Commands.FlowsConstants.Flow_SessionStorage_UserLoginRequired);if((flowLoginRequired==null||flowLoginRequired=="true")&&!(isUCI&&Xrm.Internal.isFeatureEnabled("UseFlowServiceUrlInFlowsLibraryPCFVersion"))){label=flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_LoginFlow);controls+=FlowsDynamicMenuBuilder.generateControlXml(label,menuSequence,Commands.FlowsConstants.Flow_Control_LoginFlow,entityName,isForm,isUCI);menuSequence+=10}menuSection1+=controls+"</Controls></MenuSection>";var menuSection2Title=Xrm.Encoding.xmlAttributeEncode(flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_RunFlowMenuSection)),menuSection2='<MenuSection Id="Mscrm.DynamicMenu.Flows.MenuSection'+menuSectionCount+'" Title="'+menuSection2Title+'" Sequence="'+menuSectionCount*10+'"><Controls Id="Mscrm.DynamicMenu.Flows.Controls'+menuSectionCount+'">',flowDefinitions=sessionStorage.getItem(Commands.FlowsConstants.Flow_SessionStorage_DefinitionList+"_"+selectedEntityLogicalName);menuSequence=10;controls="";if((flowLoginRequired==null||flowLoginRequired=="true")&&isUCI&&Xrm.Internal.isFeatureEnabled("UseFlowServiceUrlInFlowsLibraryPCFVersion")){label=Commands.FlowsConstants.Flow_Localization_AttemptAuthAgain;controls+=FlowsDynamicMenuBuilder.generateControlXml(label,menuSequence,Commands.FlowsConstants.Flow_Control_AttemptAuthAgain,entityName,isForm,isUCI,false);menuSection2+=controls+"</Controls></MenuSection>"}else if(flowDefinitions!=null&&flowLoginRequired=="false"){var flowDefinitionList=[];flowDefinitionList=JSON.parse(flowDefinitions);if(flowDefinitionList.length>0){flowDefinitionList.forEach(function(flow){controls+=FlowsDynamicMenuBuilder.generateControlXml(flow.displayName,menuSequence,flow.name,entityName,isForm,isUCI);menuSequence+=10});menuSection2+=controls+"</Controls></MenuSection>";menuSectionCount++}else menuSection2=""}else menuSection2="";var flowMenuSection=menuSection1+menuSection2;return flowMenuSection};FlowsDynamicMenuBuilder.generateFlowStaticMenuXml=function(flowsLibrary,entityName,isForm,isUCI){var menuSectionCount=1,menuSequence=10,manageFlowMenuSectionTitle=Xrm.Encoding.xmlAttributeEncode(flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_ManageFlowMenuSection)),manageFlowMenuSection='<MenuSection Id="Mscrm.DynamicMenu.Flows.MenuSection'+menuSectionCount+'" Title="'+manageFlowMenuSectionTitle+'" Sequence="'+menuSectionCount*10+'"><Controls Id="Mscrm.DynamicMenu.Flows.Controls'+menuSectionCount+'">',controls="";menuSectionCount++;var label=flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_CreateFlow);controls+=FlowsDynamicMenuBuilder.generateControlXml(label,menuSequence,Commands.FlowsConstants.Flow_Control_CreateFlow,entityName,isForm,isUCI);menuSequence+=10;label=flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_ManageFlow);controls+=FlowsDynamicMenuBuilder.generateControlXml(label,menuSequence,Commands.FlowsConstants.Flow_Control_ManageFlow,entityName,isForm,isUCI);menuSequence+=10;var flowLoginRequired=sessionStorage.getItem(Commands.FlowsConstants.Flow_SessionStorage_UserLoginRequired);if(flowLoginRequired==null||flowLoginRequired=="true"){label=flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_LoginFlow);controls+=FlowsDynamicMenuBuilder.generateControlXml(label,menuSequence,Commands.FlowsConstants.Flow_Control_LoginFlow,entityName,isForm,isUCI);menuSequence+=10}manageFlowMenuSection=manageFlowMenuSection+controls+"</Controls></MenuSection>";return manageFlowMenuSection};FlowsDynamicMenuBuilder.generateFlowDefinitionMenuXml=function(flowsLibrary,entityName,selectedEntityLogicalName,isForm,isUCI){var menuSectionCount=1,menuSequence=10,runFlowMenuSectionTitle=Xrm.Encoding.xmlAttributeEncode(flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_RunFlowMenuSection)),runFlowMenuSection='<MenuSection Id="Mscrm.DynamicMenu.Flows.MenuSection'+menuSectionCount+'" Title="'+runFlowMenuSectionTitle+'" Sequence="'+menuSectionCount*10+'"><Controls Id="Mscrm.DynamicMenu.Flows.Controls'+menuSectionCount+'">',flowDefinitions=sessionStorage.getItem(Commands.FlowsConstants.Flow_SessionStorage_DefinitionList+"_"+selectedEntityLogicalName),controls="";if(flowDefinitions&&flowDefinitions!==null&&sessionStorage.getItem(Commands.FlowsConstants.Flow_SessionStorage_UserLoginRequired)=="false"){var flowDefinitionList=[];flowDefinitionList=JSON.parse(flowDefinitions);if(flowDefinitionList.length>0){flowDefinitionList.forEach(function(flow){controls+=FlowsDynamicMenuBuilder.generateControlXml(flow.displayName,menuSequence,flow.name,entityName,isForm,isUCI);menuSequence+=10});runFlowMenuSection+=controls+"</Controls></MenuSection>";menuSectionCount++}else runFlowMenuSection=""}else runFlowMenuSection="";return runFlowMenuSection};FlowsDynamicMenuBuilder.generateMenuXmlForMenuNotSupportedForWebClient=function(flowsLibrary,isForm){var menuSectionCount=1,menuSequence=10,manageFlowMenuSectionTitle=Xrm.Encoding.xmlAttributeEncode(flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_ManageFlowMenuSection)),manageFlowMenuSection='<MenuSection Id="Mscrm.DynamicMenu.Flows.MenuSection'+menuSectionCount+'" Title="'+manageFlowMenuSectionTitle+'" Sequence="'+menuSectionCount*10+'"><Controls Id="Mscrm.DynamicMenu.Flows.Controls'+menuSectionCount+'">',controls="",label=flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_FlowsNotSupportedWebclient);controls+=FlowsDynamicMenuBuilder.generateControlXml(label,menuSequence,Commands.FlowsConstants.Flow_Control_FlowsNotSupportedWebClient,"",isForm,false);manageFlowMenuSection=manageFlowMenuSection+controls+"</Controls></MenuSection>";return manageFlowMenuSection};FlowsDynamicMenuBuilder.generateControlXml=function(label,sequence,buttonId,entityName,isForm,isUCI,useIcon){if(useIcon===void 0)useIcon=true;var page="HomePageGrid";if(isForm)page="Form";var commandId=entityName+"|NoRelationship|"+page+"|Mscrm.Flows.TriggerFlow";if(!isUCI)commandId="Mscrm.Flows.TriggerFlow";var encodedFlowTitle=Xrm.Encoding.xmlAttributeEncode(label),button='<Button Id="'+buttonId+'" Command="'+commandId+'" Sequence="'+sequence+'" ToolTipTitle="'+encodedFlowTitle+'" LabelText="'+encodedFlowTitle+'" Alt="'+encodedFlowTitle+'" '+(useIcon?'Image16by16="/_imgs/Ribbon/OpenFlows_16.png" Image32by32="/_imgs/Ribbon/OpenFlows_32.png" ModernImage="Flows"':'Image16by16=" " Image32by32=" " ModernImage=" "')+" />";return button};return FlowsDynamicMenuBuilder}();Commands.FlowsDynamicMenuBuilder=FlowsDynamicMenuBuilder;var WorkflowDynamicMenuBuilder=function(){function WorkflowDynamicMenuBuilder(){}WorkflowDynamicMenuBuilder.buildMenuUCI=function(flowsLibrary,entityCollection,selectedEntityTypeName,isForm){var menuXml=WorkflowDynamicMenuBuilder.generateWorkflowMenuXml(flowsLibrary,entityCollection,selectedEntityTypeName,false,true);return menuXml};WorkflowDynamicMenuBuilder.generateWorkflowMenuXml=function(flowsLibrary,entityCollection,entityName,isForm,isUCI){var workflowMenuSection="",menuSectionCount=1,menuSequence=10,menuSectionTitle=Xrm.Encoding.xmlAttributeEncode(flowsLibrary.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_RunWorkflow)),menuSection='<MenuSection Id="Mscrm.DynamicMenu.Flows.MenuSection'+menuSectionCount+'" Title="'+menuSectionTitle+'" Sequence="'+menuSectionCount*10+'"><Controls Id="Mscrm.DynamicMenu.Flows.Controls'+menuSectionCount+'">',controls="";if(entityCollection.length>0){entityCollection.forEach(function(workflow){var label=workflow.name,buttonId=workflow.workflowid;controls+=WorkflowDynamicMenuBuilder.generateControlXml(label,menuSequence,buttonId,entityName,isForm,isUCI);menuSequence+=10});menuSection+=controls+"</Controls></MenuSection>"}else menuSection="";return workflowMenuSection=menuSection};WorkflowDynamicMenuBuilder.generateControlXml=function(label,sequence,buttonId,entityName,isForm,isUCI){var button="",page="HomePageGrid";if(isForm)page="Form";var commandId=entityName+"|NoRelationship|"+page+"|Mscrm.Flows.TriggerWorkflow";if(!isUCI)commandId="Mscrm.Flows.TriggerWorkflow";var encodedLabel=Xrm.Encoding.xmlAttributeEncode(label),button='<Button Id="'+buttonId+'" Command="'+commandId+'" Sequence="'+sequence+'" LabelText="'+encodedLabel+'" Alt="'+encodedLabel+'" Image16by16="/_imgs/Ribbon/OpenFlows_16.png" Image32by32="/_imgs/Ribbon/OpenFlows_32.png" ModernImage="Flows" />';return button};return WorkflowDynamicMenuBuilder}();Commands.WorkflowDynamicMenuBuilder=WorkflowDynamicMenuBuilder})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var MicrosoftFlowsTelemetryReporter=MscrmControls.Containers.MicrosoftFlowsTelemetryReporter,ExecuteOnDemandWorkflowRequest=function(){function ExecuteOnDemandWorkflowRequest(){}ExecuteOnDemandWorkflowRequest.prototype.getMetadata=function(){var metadata={boundParameter:"entity",parameterTypes:{entity:{typeName:"Microsoft.Dynamics.CRM.workflow",structuralProperty:5},EntityId:{typeName:"Edm.Guid",structuralProperty:1},InputArguments:{typeName:"Microsoft.Dynamics.CRM.InputArgumentCollection",structuralProperty:2}},operationName:"ExecuteWorkflow",operationType:0};return metadata};return ExecuteOnDemandWorkflowRequest}();Commands.ExecuteOnDemandWorkflowRequest=ExecuteOnDemandWorkflowRequest;var FlowsLibrary=function(){function FlowsLibrary(){var _this=this;this.populateMenu=function(commandProperties,entityLogicalName,isForm,records){var context=Xrm.Utility.getGlobalContext();if(context&&context.client&&context.client.getClient()==Xrm.Constants.ClientNames.outlook){commandProperties["PopulationXML"]="";return}if(!Xrm.Internal.isUci()&&Xrm.Internal.isFeatureEnabled("FCB.UseFlowServiceUrlInFlowsLibraryPCFVersion")){var flowMenuNotSupportedXml=Commands.FlowsDynamicMenuBuilder.buildMenuWebClientWhenMenuNotSupported(_this,isForm);commandProperties["PopulationXML"]='<Menu Id="Mscrm.DynamicMenu.Flows">'+flowMenuNotSupportedXml+"</Menu>";if(context){_this.microsoftFlowsTelemetryReporter=new MicrosoftFlowsTelemetryReporter;var clientType="";_this.microsoftFlowsTelemetryReporter.init(context.getClientUrl(),clientType);_this.microsoftFlowsTelemetryReporter.logFlowDefinitionsMenuGenerationEvent("","",0,0,0,entityLogicalName,"Flow Menu in WebClient when PCF enabled with EntityLogicalName: "+entityLogicalName)}return}var isQueueItemType=entityLogicalName==XrmCore.InternalUtilities.EntityUtilities.EntityNames.QueueItem;if(Xrm.Internal.isUci()&&isQueueItemType){_this.populateQueueItemMainMenu(commandProperties,entityLogicalName,isForm,records);return}_this.populateFlowMainMenu(commandProperties,entityLogicalName,isForm,records)};this.populateStaticFlowMenu=function(commandProperties,entityLogicalName,isForm){try{var context=Xrm.Utility.getGlobalContext();if(context&&context.client&&context.client.getClient()==Xrm.Constants.ClientNames.outlook){commandProperties["PopulationXML"]="";return}if(!entityLogicalName&&isForm&&Xrm.Page.data&&Xrm.Page.data.entity)entityLogicalName=Xrm.Page.data.entity.getEntityName();var flowEnvironmentID=_this.microsoftFlowEnvironmentId(),getFlowDefinitionListPromise_1=function(){return _this.getFlowDefinitionList(flowEnvironmentID,entityLogicalName,_this)};if(Xrm.Internal.isUci()){var flowPromise,flowMenuStartTag='<Menu Id="Mscrm.DynamicMenu.Flows">',flowMenuEndTag="</Menu>",staticMenu="",staticMenu=Commands.FlowsDynamicMenuBuilder.buildStaticMenuUCI(_this,entityLogicalName,isForm);flowPromise=getFlowDefinitionListPromise_1;if(_this.isInUciShim()){var fpiDomain=_this.getFirstPartyIntegrationDomain(),initShimTokensPromise=Xrm.Utility.beginSecureSessionForResource(Commands.FlowsConstants.Flow_UciFpiResources_FlowService,Commands.FlowsConstants.Flow_UciFpiUrl_ComponentId,fpiDomain);flowPromise=function(){return initShimTokensPromise.then(function(expDate){return getFlowDefinitionListPromise_1()},function(errorCode){console.error("Shim failed to init the Flow Token with error code: %d",errorCode)})}}commandProperties["PopulationXML"]=Promise.all([flowPromise()]).then(function(){staticMenu=Commands.FlowsDynamicMenuBuilder.buildStaticMenuUCI(_this,entityLogicalName,isForm);var finalMenu=flowMenuStartTag+staticMenu+flowMenuEndTag;return finalMenu})}}catch(exception){console.error(exception);_this.microsoftFlowsTelemetryReporter.logFlowErrorEvent(_this.tenantId,_this.microsoftFlowEnvironmentId(),Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,exception,"PopulateStaticFlowMenu",exception);commandProperties["PopulationXML"]="";var errorResponse={errorCode:2147811937,message:exception};XrmCore.InternalUtilities.GenericUtilities.HandleErrorMessage(errorResponse)}};this.populateFlowMenu=function(commandProperties,entityLogicalName,isForm,records){try{var context=Xrm.Utility.getGlobalContext();if(context&&context.client&&context.client.getClient()==Xrm.Constants.ClientNames.outlook){commandProperties["PopulationXML"]="";return}if(!entityLogicalName&&isForm&&Xrm.Page.data&&Xrm.Page.data.entity)entityLogicalName=Xrm.Page.data.entity.getEntityName();var entityTypeCode=Xrm.Internal.getEntityCode(entityLogicalName),selectedEntityLogicalName=entityLogicalName;if(Xrm.Internal.isUci()&&entityTypeCode==Commands.FlowsConstants.ActivityPointerTypeCode){if(records&&records.length>1&&!_this.checkIfAllRecordsAreSameTypes(records)){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Grid_Apply_Rule_Heterogenous_Activity_Type_Records_Selected")});return}if(records&&records.length>0){var entity=records[0];if(entity&&entity.TypeName){selectedEntityLogicalName=entity.TypeName;entityTypeCode=Xrm.Internal.getEntityCode(entity.TypeName)}}}var flowEnvironmentID=_this.microsoftFlowEnvironmentId(),getFlowDefinitionListPromise_2=function(){return _this.getFlowDefinitionList(flowEnvironmentID,entityLogicalName,_this)};if(Xrm.Internal.isUci()){var flowPromise,flowMenuStartTag='<Menu Id="Mscrm.DynamicMenu.Flows">',flowMenuEndTag="</Menu>",finalMenu="",flowDefinition=Commands.FlowsDynamicMenuBuilder.buildFlowDefinitionMenuUCI(_this,entityLogicalName,selectedEntityLogicalName,isForm);flowPromise=getFlowDefinitionListPromise_2;if(_this.isInUciShim()){var fpiDomain=_this.getFirstPartyIntegrationDomain(),initShimTokensPromise=Xrm.Utility.beginSecureSessionForResource(Commands.FlowsConstants.Flow_UciFpiResources_FlowService,Commands.FlowsConstants.Flow_UciFpiUrl_ComponentId,fpiDomain);flowPromise=function(){return initShimTokensPromise.then(function(expDate){return getFlowDefinitionListPromise_2()},function(errorCode){console.error("Shim failed to init the Flow Token with error code: %d",errorCode)})}}commandProperties["PopulationXML"]=Promise.all([flowPromise()]).then(function(){flowDefinition=Commands.FlowsDynamicMenuBuilder.buildFlowDefinitionMenuUCI(_this,entityLogicalName,selectedEntityLogicalName,isForm);var finalMenu=flowMenuStartTag+flowDefinition+flowMenuEndTag;return finalMenu})}else{getFlowDefinitionListPromise_2();var webMenuSection=Commands.FlowsDynamicMenuBuilder.buildMenuWebClient(_this,entityLogicalName,selectedEntityLogicalName,isForm);commandProperties["PopulationXML"]='<Menu Id="Mscrm.DynamicMenu.Flows">'+webMenuSection+"</Menu>"}}catch(exception){console.error(exception);_this.microsoftFlowsTelemetryReporter.logFlowErrorEvent(_this.tenantId,_this.microsoftFlowEnvironmentId(),Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,exception,"PopulateFlowMenu",exception);commandProperties["PopulationXML"]="";var errorResponse={errorCode:2147811937,message:exception};XrmCore.InternalUtilities.GenericUtilities.HandleErrorMessage(errorResponse)}};this.populateWorkFlowMenu=function(commandProperties,entityLogicalName,records,isForm){try{var context=Xrm.Utility.getGlobalContext();if(context&&context.client&&context.client.getClient()==Xrm.Constants.ClientNames.outlook){commandProperties["PopulationXML"]="";return}if(!entityLogicalName&&isForm&&Xrm.Page.data&&Xrm.Page.data.entity)entityLogicalName=Xrm.Page.data.entity.getEntityName();if(Xrm.Internal.isUci()&&_this.isMicrosoftFlowEnabled()&&Xrm.Internal.isFeatureEnabled("OnDemandWorkflowUCI")){var flowMenuStartTag='<Menu Id="Mscrm.DynamicMenu.Flows">',flowMenuEndTag="</Menu>",workflowDefinition="",finalMenu="",buildWorkFlowDefinitionPromise=function(){return _this.populateOnDemandWorkflowMenu(commandProperties,entityLogicalName,records,isForm)};commandProperties["PopulationXML"]=Promise.all([buildWorkFlowDefinitionPromise()]).then(function(response){workflowDefinition=response;var finalMenu=flowMenuStartTag+workflowDefinition+flowMenuEndTag;return finalMenu})}}catch(exception){console.error(exception);_this.microsoftFlowsTelemetryReporter.logFlowErrorEvent(null,null,Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,exception,"PopulateWorkFlowMenu",exception);commandProperties["PopulationXML"]="";var errorResponse={errorCode:2147811937,message:exception};XrmCore.InternalUtilities.GenericUtilities.HandleErrorMessage(errorResponse)}};this.populateFlowMainMenu=function(commandProperties,entityLogicalName,isForm,records){try{if(!entityLogicalName&&isForm&&Xrm.Page.data&&Xrm.Page.data.entity)entityLogicalName=Xrm.Page.data.entity.getEntityName();var entityTypeCode=Xrm.Internal.getEntityCode(entityLogicalName),selectedEntityLogicalName=entityLogicalName,isActivityType=entityTypeCode==Commands.FlowsConstants.ActivityPointerTypeCode,isQueueItemType=entityLogicalName==XrmCore.InternalUtilities.EntityUtilities.EntityNames.QueueItem;if(Xrm.Internal.isUci()&&(isActivityType||isQueueItemType)){if(records&&records.length>1&&!_this.checkIfAllRecordsAreSameTypes(records)){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Grid_Apply_Rule_Heterogenous_Activity_Type_Records_Selected")});return}if(records&&records.length>0){var entity=records[0];if(entity&&entity.TypeName){selectedEntityLogicalName=entity.TypeName;entityTypeCode=Xrm.Internal.getEntityCode(entity.TypeName)}}}var isOnPremise=false;_this.microsoftFlowsTelemetryReporter=new MicrosoftFlowsTelemetryReporter;var suppressPowerAutomateFlow=false;if(Xrm&&Xrm.Utility&&Xrm.Utility.getGlobalContext()){var clientType="";if(Xrm.Internal&&Xrm.Internal.isUci()){clientType="UCI";suppressPowerAutomateFlow=!!Xrm.Internal.isFeatureEnabled("SuppressPowerAutomateFlow")}_this.microsoftFlowsTelemetryReporter.init(Xrm.Utility.getGlobalContext().getClientUrl(),clientType);isOnPremise=Xrm.Utility.getGlobalContext().isOnPremises()}if(Xrm.Internal.isUci()){var overallPromise=function(){return Promise.resolve("")};if(!isOnPremise&&!suppressPowerAutomateFlow){var flowEnvironmentID=_this.microsoftFlowEnvironmentId(),getFlowDefinitionListPromise_3=function(){return _this.getFlowDefinitionList(flowEnvironmentID,selectedEntityLogicalName,_this)},buildMenuPromise=function(){return Commands.FlowsDynamicMenuBuilder.buildMenuUCI(_this,entityLogicalName,selectedEntityLogicalName,isForm)},menuXmlPromise=function(){return getFlowDefinitionListPromise_3().then(function(){return buildMenuPromise()},function(error){return buildMenuPromise()})};overallPromise=menuXmlPromise;if(_this.isInUciShim()&&!Xrm.Internal.isFeatureEnabled("UseFlowServiceUrlInFlowsLibraryPCFVersion")){var fpiDomain=_this.getFirstPartyIntegrationDomain(),initTokensPromise=Xrm.Utility.beginSecureSessionForResource(Commands.FlowsConstants.Flow_UciFpiResources_FlowService,Commands.FlowsConstants.Flow_UciFpiUrl_ComponentId,fpiDomain);overallPromise=function(){return initTokensPromise.then(function(expDate){return menuXmlPromise()},function(errorCode){console.error("Shim failed to init the Flow Token with error code: %d",errorCode);return buildMenuPromise()})}}}if(_this.isMicrosoftFlowEnabled()&&Xrm.Internal.isFeatureEnabled("OnDemandWorkflowUCI"))commandProperties["PopulationXML"]=overallPromise().then(function(flowMenuXml){var flowEventMessage="GenerateFlowMenu: Success, EntityLogicalName: "+entityLogicalName+" , Type: "+Commands.FlowsConstants.Flow_ModernFlows;_this.microsoftFlowsTelemetryReporter.logFlowDefinitionsMenuGenerationEvent(_this.tenantId,_this.microsoftFlowEnvironmentId(),0,0,0,entityLogicalName,flowEventMessage);var flowMenuPromise=(new Promise(function(resolve){resolve(_this.populateOnDemandWorkflowMenu(commandProperties,entityLogicalName,records,isForm))})).then(function(workflowMenuXml){var flowMenu='<Menu Id="Mscrm.DynamicMenu.Flows">'+flowMenuXml+workflowMenuXml+"</Menu>",ondemandWorkFlowEventMessage="GenerateOnDemanWorkFlowMenu: Success, EntityLogicalName: "+entityLogicalName+" , Type: "+Commands.FlowsConstants.Flow_OnDemandWorkFlow;_this.microsoftFlowsTelemetryReporter.logFlowDefinitionsMenuGenerationEvent(_this.tenantId,_this.microsoftFlowEnvironmentId(),0,0,0,entityLogicalName,ondemandWorkFlowEventMessage);return flowMenu},function(errorResponse){_this.microsoftFlowsTelemetryReporter.logFlowErrorEvent(_this.tenantId,_this.microsoftFlowEnvironmentId(),Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,null,Commands.FlowsConstants.Flow_Telemetry_WorkflowMenuBuilder,errorResponse.message)});return flowMenuPromise},function(errorResponse){_this.microsoftFlowsTelemetryReporter.logFlowErrorEvent(_this.tenantId,_this.microsoftFlowEnvironmentId(),Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,errorResponse,Commands.FlowsConstants.Flow_Telemetry_FlowMenuBuilder,errorResponse.message)});else commandProperties["PopulationXML"]=overallPromise()}else{var flowEnvironmentID=_this.microsoftFlowEnvironmentId(),getFlowDefinitionListPromise=function(){return _this.getFlowDefinitionList(flowEnvironmentID,selectedEntityLogicalName,_this)};getFlowDefinitionListPromise();var webMenuSection=Commands.FlowsDynamicMenuBuilder.buildMenuWebClient(_this,entityLogicalName,selectedEntityLogicalName,isForm);commandProperties["PopulationXML"]='<Menu Id="Mscrm.DynamicMenu.Flows">'+webMenuSection+"</Menu>"}}catch(exception){console.error(exception);_this.microsoftFlowsTelemetryReporter.logFlowErrorEvent(_this.tenantId,_this.microsoftFlowEnvironmentId(),Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,exception,"populateFlowMainMenu",exception.message);commandProperties["PopulationXML"]="";var errorResponse={errorCode:2147811937,message:exception};XrmCore.InternalUtilities.GenericUtilities.HandleErrorMessage(errorResponse)}};this.checkIfAllRecordsAreSameTypes=function(selectedRecords){var areHomogenous=true;if(selectedRecords&&selectedRecords.length>0)for(var entityName=selectedRecords[0].TypeName,_i=0,selectedRecords_1=selectedRecords;_i<selectedRecords_1.length;_i++){var record=selectedRecords_1[_i];if(record.TypeName!==entityName){areHomogenous=false;break}}return areHomogenous};this.populateQueueItemMainMenu=function(commandProperties,entityLogicalName,isForm,records){commandProperties["PopulationXML"]=_this.getQueueItemTargetEntities(entityLogicalName,records).then(function(targetEntityRecords){_this.populateFlowMainMenu(commandProperties,entityLogicalName,isForm,targetEntityRecords);return commandProperties["PopulationXML"]})};this.getQueueItemTargetEntities=function(entityLogicalName,selectedRowReferences){var selector="?$select=_objectid_value,objecttypecode",filter="&$filter=queueitemid eq '"+selectedRowReferences.map(function(x){return x.Id}).join("' or queueitemid eq '")+"'";return selectedRowReferences&&selectedRowReferences.length?Xrm.WebApi.retrieveMultipleRecords(entityLogicalName,""+selector+filter).then(function(response){var entities=response["entities"].map(function(entity){return {Id:entity["_objectid_value"],Name:entity["_objectid_value@OData.Community.Display.V1.FormattedValue"],TypeCode:entity["objecttypecode"],TypeName:entity["_objectid_value@Microsoft.Dynamics.CRM.lookuplogicalname"]}});return entities}):Promise.resolve([])};this.populateOnDemandWorkflowMenu=function(commandProperties,entityLogicalName,records,isForm){try{if(!entityLogicalName&&isForm&&Xrm.Page.data&&Xrm.Page.data.entity)entityLogicalName=Xrm.Page.data.entity.getEntityName();var entityTypeCode=Xrm.Internal.getEntityCode(entityLogicalName);if(Xrm.Internal.isUci()&&(entityTypeCode==Commands.FlowsConstants.ActivityPointerTypeCode||entityLogicalName==XrmCore.InternalUtilities.EntityUtilities.EntityNames.QueueItem))if(records&&records.length>0){var entity=records[0];if(entity&&entity.TypeName)entityTypeCode=Xrm.Internal.getEntityCode(entity.TypeName)}var queryFetchXml="<fetch mapping='logical' distinct='true'><entity name='workflow'><attribute name='workflowid'/><attribute name='name'/>",queryConditionEntityCodeXml="<condition attribute='primaryentity' operator='eq' value='"+entityTypeCode+"' />",queryConditionOnDemandXml="<condition attribute='ondemand' operator='eq' value='1' />",queryConditionCategoryXml="<condition attribute='category' operator='eq' value='0' />",queryConditionTypeXml="<condition attribute='type' operator='eq' value='1' />",queryConditionStateXml="<condition attribute='statecode' operator='eq' value='1' />",queryConditionStatusXml="<condition attribute='statuscode' operator='eq' value='2' />",queryConditionNonGeneratedWorkflowXml="<condition attribute='rendererobjecttypecode' operator='null' />",queryXml=queryFetchXml+"<filter type='and'>"+queryConditionEntityCodeXml+queryConditionOnDemandXml+queryConditionCategoryXml+queryConditionTypeXml+queryConditionStateXml+queryConditionStatusXml+queryConditionNonGeneratedWorkflowXml+"</filter></entity></fetch>",workflowMenuPromise=new Promise(function(resolve,reject){Xrm.WebApi.online.retrieveMultipleRecords("workflow","?fetchXml= "+queryXml).then(function(collection){var entityCollection=collection.entities;if(entityCollection.length>0)Xrm.Internal.isUci()&&resolve(Commands.WorkflowDynamicMenuBuilder.buildMenuUCI(_this,entityCollection,entityLogicalName,isForm));else resolve("")},function(errorResponse){console.error(errorResponse.message);_this.microsoftFlowsTelemetryReporter.logFlowErrorEvent(_this.tenantId,null,Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,null,"populateOnDemandWorkflowMenu",errorResponse.message);XrmCore.InternalUtilities.GenericUtilities.HandleErrorMessage(errorResponse);resolve("")})});return workflowMenuPromise}catch(exception){console.error(exception);_this.microsoftFlowsTelemetryReporter.logFlowErrorEvent(_this.tenantId,null,Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,exception,"populateOnDemandWorkflowMenu",exception);var errorResponse={errorCode:2147811937,message:exception};XrmCore.InternalUtilities.GenericUtilities.HandleErrorMessage(errorResponse);return ""}};this.getLocalizedLabel=function(lcid){if(Xrm.Internal.isUci())return Xrm.Utility.getResourceString("Main_system_library",lcid);else return Xrm.Internal.getResourceString(lcid)};this.getUrlVars=function(str){for(var vars=[],hash,hashes=str.slice(str.indexOf("?")+1).split("&"),i=0;i<hashes.length;i++){hash=hashes[i].split("=");vars.push(hash[0]);vars[hash[0]]=hash[1]}return vars};this.microsoftFlowDestinationUrl=function(){if(Xrm.Internal.isUci())return Xrm.Utility.getGlobalContext().getAdvancedConfigSetting("MicrosoftFlowDestinationUrl");else return window.parent[Commands.FlowsConstants.Flow_GlobalVar_DestinationURL]};this.getMicrosoftFlowFirstPartyIntegrationSiteUrl=function(){if(Xrm.Internal.isUci()){var url=Xrm.Utility.getGlobalContext().getAdvancedConfigSetting("MicrosoftFlowFirstPartyIntegrationSiteUrl");if(_this.isInUciShim()&&!Xrm.Internal.isFeatureEnabled("UseFlowServiceUrlInFlowsLibraryPCFVersion")){url+="&componentId="+Commands.FlowsConstants.Flow_UciFpiUrl_ComponentId;url+="&client="+Commands.FlowsConstants.Flow_UciFpiUrl_ClientType}if(Xrm.Internal.isFeatureEnabled("October2019Update"))url+="&flowsEnableWidgetV2=true";return url}else return window.parent[Commands.FlowsConstants.Flow_GlobalVar_FirstPartyURL]};this.isMicrosoftFlowEnableWidgetV2=function(){if(Xrm.Internal.isUci()&&Xrm.Internal.isFeatureEnabled("October2019Update"))return true;return false};this.triggerFlow=function(commandProperties,selectedRecords,entityLogicalName){var controlId=commandProperties["SourceControlId"];if(!entityLogicalName&&Xrm.Page.data&&Xrm.Page.data.entity)entityLogicalName=Xrm.Page.data.entity.getEntityName();switch(controlId){case Commands.FlowsConstants.Flow_Control_CreateFlow:_this.createFlow(entityLogicalName);break;case Commands.FlowsConstants.Flow_Control_ManageFlow:_this.manageFlows();break;case Commands.FlowsConstants.Flow_Control_AttemptAuthAgain:_this.showKBForFlows();break;case Commands.FlowsConstants.Flow_Control_FlowsNotSupportedWebClient:_this.showKBForFlowsNotSupportedWebclient();break;default:var orgUniqueName=FlowsLibrary.orgUniqueName();_this.getEntityCollectionNamePromise(entityLogicalName).then(function(entityLogicalCollectionName){_this.triggerFlowForDynamicDefinition(controlId,selectedRecords,orgUniqueName,entityLogicalName,entityLogicalCollectionName)});break}};this.triggerWorkflow=function(commandProperties,selectedRecords,entityLogicalName){var controlId=commandProperties["SourceControlId"];if(!entityLogicalName&&Xrm.Page.data&&Xrm.Page.data.entity)entityLogicalName=Xrm.Page.data.entity.getEntityName();if(selectedRecords!=null&&selectedRecords.length!==0&&entityLogicalName==XrmCore.InternalUtilities.EntityUtilities.EntityNames.QueueItem){_this.getQueueItemTargetEntities(entityLogicalName,selectedRecords).then(function(targetEntities){targetEntities&&targetEntities.length>0&&_this.triggerWorkflow(commandProperties,targetEntities,targetEntities[0].TypeName)});return}var entityIds=[];if(selectedRecords!=null){var records=selectedRecords.length;if(records===0)try{if(Xrm.Page.data.entity&&Xrm.Page.data.entity.getEntityName()){var entityIdFromPage=_this.removeCurlyBracesFromEntityRecordId(Xrm.Page.data.entity.getId());if(entityIdFromPage&&entityLogicalName===Xrm.Page.data.entity.getEntityName())entityIds.push(entityIdFromPage);else throw new Error}}catch(exception){var alert={text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Action_NoItemSelected")};Xrm.Navigation.openAlertDialog(alert);return}else for(var i=0;i<records;i++)entityIds.push(_this.removeCurlyBracesFromEntityRecordId(selectedRecords[i].Id))}var confirmSubtitle,confirmText,entityDisplayName,entityCollectionDisplayName;_this.getEntityDisplayNamePromiseUCI(entityLogicalName,true).then(function(collectionDisplayName){entityCollectionDisplayName=collectionDisplayName==null||collectionDisplayName.length==0?entityLogicalName:collectionDisplayName;_this.getEntityDisplayNamePromiseUCI(entityLogicalName,false).then(function(displayName){entityDisplayName=displayName==null||displayName.length==0?entityLogicalName:displayName;try{confirmSubtitle=Xrm.Utility.getResourceString("Main_system_library","Dialog_RunWorkflow_Description");confirmSubtitle=XrmCore.InternalUtilities.GenericUtilities.stringFormat(confirmSubtitle,[entityIds.length,entityIds.length>1?entityCollectionDisplayName:entityDisplayName]);confirmText=Xrm.Utility.getResourceString("Main_system_library","Dialog_RunWorkflow_Body")+" "+Xrm.Utility.getResourceString("Main_system_library","Dialog_RunWorkflow_Body_Confirm");confirmText=XrmCore.InternalUtilities.GenericUtilities.stringFormat(confirmText,[entityDisplayName]);var confirmOptions={title:_this.getLocalizedLabel("Dialog_Runworkflow_Title"),subtitle:confirmSubtitle,text:confirmText}}catch(exception){console.error(exception);_this.microsoftFlowsTelemetryReporter.logWorkFlowErrorEvent(_this.tenantId,controlId,_this.microsoftFlowEnvironmentId(),Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,exception,"TriggerWorkflow",exception);var errorResponse={errorCode:2147811937,message:exception};XrmCore.InternalUtilities.GenericUtilities.HandleErrorMessage(errorResponse);return}Xrm.Navigation.openConfirmDialog(confirmOptions).then(function(dialogResponse){if(dialogResponse.confirmed)if(entityIds.length==1){var request=new ExecuteOnDemandWorkflowRequest;request.InputArguments=null;request.entity={id:controlId,entityType:"workflow"};request.EntityId={guid:entityIds[0]};Xrm.WebApi.online.execute(request).then(function(sucessResponse){var successProperties={TenantId:_this.tenantId,FlowRunResult:"Success",NoOfEntityRecords:1,EntityLogicalName:entityLogicalName,FlowId:controlId,FlowEnvironmentId:null,EventMessage:Commands.FlowsConstants.Flow_OnDemandWorkFlow};_this.microsoftFlowsTelemetryReporter.logFlowTelemetryEvent("Triggered",successProperties);Xrm.Page.data&&Xrm.Page.data.refresh()},function(errorResponse){console.error(errorResponse.message);_this.microsoftFlowsTelemetryReporter.logWorkFlowErrorEvent(_this.tenantId,controlId,_this.microsoftFlowEnvironmentId(),Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,errorResponse,"TriggerWorkflow",errorResponse.message);XrmCore.InternalUtilities.GenericUtilities.HandleErrorMessage(errorResponse)})}else entityIds.length>1&&_this.triggerWorkflowInBatch(selectedRecords,entityLogicalName,controlId)})})})};this.createFlow=function(entityLogicalName){var flowCreateUrl=sessionStorage[Commands.FlowsConstants.Flow_SessionStorage_CreateURL+"_"+entityLogicalName];if(flowCreateUrl!=null)if(_this.isInUciShim())Xrm.Navigation.openUrl(flowCreateUrl);else window.parent.open(flowCreateUrl,"_blank")};this.manageFlows=function(){var flowManageUrl=sessionStorage[Commands.FlowsConstants.Flow_SessionStorage_ManageURL];if(flowManageUrl!=null)if(_this.isInUciShim())Xrm.Navigation.openUrl(flowManageUrl);else window.parent.open(flowManageUrl,"_blank")};this.showKBForFlows=function(){var flowKBUrl="https://docs.microsoft.com/en-us/power-automate/";if(_this.isInUciShim())Xrm.Navigation.openUrl(flowKBUrl);else window.parent.open(flowKBUrl,"_blank")};this.showKBForFlowsNotSupportedWebclient=function(){var flowKBUrl="https://go.microsoft.com/fwlink/?linkid=2168284";window.parent.open(flowKBUrl,"_blank")};this.triggerFlowForDynamicDefinition=function(definitionId,selectedRecords,orgUniqueName,entityLogicalName,entityLogicalCollectionName){var entityIds=[];if(selectedRecords!=null){var records=selectedRecords.length;if(records===0)try{if(Xrm.Page.data.entity&&Xrm.Page.data.entity.getEntityName()){var entityIdFromPage=_this.removeCurlyBracesFromEntityRecordId(Xrm.Page.data.entity.getId());entityIdFromPage&&entityLogicalName===Xrm.Page.data.entity.getEntityName()&&entityIds.push(entityIdFromPage)}}catch(exception){}else for(var i=0;i<records;i++)entityIds.push(_this.removeCurlyBracesFromEntityRecordId(selectedRecords[i].Id))}var flowLoginRequired=sessionStorage.getItem(Commands.FlowsConstants.Flow_SessionStorage_UserLoginRequired);if(entityIds.length===0&&flowLoginRequired&&flowLoginRequired==="false"){if(definitionId!==Commands.FlowsConstants.Flow_Control_LoginFlow){var errorResponse={errorCode:2147811938,message:""};XrmCore.InternalUtilities.GenericUtilities.HandleErrorMessage(errorResponse)}return}var entityIdCollection=JSON.stringify(entityIds),dynamics365AccessToken=sessionStorage.getItem(Commands.FlowsConstants.Flow_SessionStorage_Dynamics365AccessToken);if(_this.isInUciShim()&&!Xrm.Internal.isFeatureEnabled("UseFlowServiceUrlInFlowsLibraryPCFVersion")){var authenticationManager=Microsoft.Crm.Client.Core.Framework.AuthenticationManager;if(authenticationManager){var authManagerInstance=authenticationManager.get_defaultInstance();if(authManagerInstance){if(authManagerInstance.get_authToken())dynamics365AccessToken=authManagerInstance.get_authToken();!dynamics365AccessToken&&console.error("Failed to get the token from the Shim")}}}var dialogParams={};dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityIdCollection]=entityIdCollection;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.FlowId]=definitionId;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.FlowsEnvironmentId]=_this.microsoftFlowEnvironmentId();dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.OrgUniqueName]=orgUniqueName;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityLogicalCollectionName]=entityLogicalCollectionName;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityLogicalName]=entityLogicalName;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Dynamics365AccessToken]=dynamics365AccessToken;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.FlowsDestinationURL]=_this.microsoftFlowDestinationUrl();dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.FlowsFPISiteURL]=_this.getMicrosoftFlowFirstPartyIntegrationSiteUrl();dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.FlowsAuthenticationString]=_this.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_Authentication);dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.FlowsEnableWidgetV2]=_this.isMicrosoftFlowEnableWidgetV2();var dialogOptions={};dialogOptions.height=600;dialogOptions.width=600;Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.MicrosoftFlowsDialog,dialogOptions,dialogParams)};this.onFlowsDialogLoad=function(eventContext){var label="",flowLoginRequired=sessionStorage.getItem(Commands.FlowsConstants.Flow_SessionStorage_UserLoginRequired);if(flowLoginRequired==null||flowLoginRequired=="true")label=_this.getLocalizedLabel(Commands.FlowsConstants.Flow_Localization_LoginFlow);else if(eventContext!=null){var formContext=eventContext.getFormContext();if(formContext!=null&&formContext.data!=null&&formContext.data.attributes!=null){var dialogAttributes=formContext.data.attributes,definitionId=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.FlowId).getValue(),entityLogicalName=dialogAttributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityLogicalName).getValue();label=_this.getFlowDisplayName(eventContext,entityLogicalName,definitionId)}}if(!label)return;else Xrm.Page.ui.controls.get("lbl_flows").setLabel(label)};this.flowsDialogCloseCallback=function(eventContext){if(Xrm.Internal.isUci)XrmCore.InternalUtilities.DialogUtilities.closeDialog(eventContext);else Commands.Common.closeDialogLegacy();var flowEnvironmentId=_this.microsoftFlowEnvironmentId();_this.getFlowDefinitionList(flowEnvironmentId,window[Commands.FlowsConstants.Flow_GlobalVar_EntityLogicalName],_this)};this.getFlowDisplayName=function(eventContext,entityLogicalName,definitionId){var label="",flowDefinitions=sessionStorage.getItem(Commands.FlowsConstants.Flow_SessionStorage_DefinitionList+"_"+entityLogicalName);if(flowDefinitions!=null){var flowDefinitionList=[];flowDefinitionList=JSON.parse(flowDefinitions);flowDefinitionList!=null&&flowDefinitionList.length>0&&flowDefinitionList.forEach(function(flow){if(flow.name===definitionId)label=flow.displayName})}return label};this.removeCurlyBracesFromEntityRecordId=function(recordId){recordId=recordId.replace("{","");recordId=recordId.replace("}","");return recordId};this.isMicrosoftFlowEnabled=function(){try{var isFlowsEnabled=true;if(Xrm.Internal.isUci())isFlowsEnabled=!XrmCore.InternalUtilities.DialogUtilities.isOffline()&&Xrm.Utility.getGlobalContext().getAdvancedConfigSetting("IsMicrosoftFlowEnabled")&&Xrm.Internal.isFeatureEnabled("FlowIntegration");else{var isOnPremise=false;if(Xrm&&Xrm.Utility&&Xrm.Utility.getGlobalContext())isOnPremise=Xrm.Utility.getGlobalContext().isOnPremises();isFlowsEnabled=!isOnPremise&&window.top[Commands.FlowsConstants.Flow_Settings_FlowSettings]}return isFlowsEnabled}catch(ex){console.error(ex)}return false};this.displayFlowSingleMenu=function(){try{var isSingleMenu=true;if(Xrm.Internal.isUci())isSingleMenu=!XrmCore.InternalUtilities.DialogUtilities.isOffline()&&Xrm.Utility.getGlobalContext().getAdvancedConfigSetting("IsMicrosoftFlowEnabled")&&Xrm.Internal.isFeatureEnabled("FlowIntegration")&&!Xrm.Internal.isFeatureEnabled("EnableFlowSubMenuUCI");else isSingleMenu=true;return isSingleMenu}catch(ex){console.error(ex)}return false};this.localeCompareSupportsLocales=function(){try{"foo".localeCompare("bar","i")}catch(e){return e.name==="RangeError"}return false};if(Xrm.Internal.isUci()&&Xrm.Internal.isFeatureEnabled("UseFlowServiceUrlInFlowsLibraryPCFVersion")){if(!window.name)window.name="FlowsLibrary_iframe_"+Date.now().toString();window.addEventListener("message",function(event){var request=event&&event.data;if(!request||request.protocol!=="PAAF")return;var concatFrameIds=request.frameIds.concat([window.name]);window.parent.postMessage({action:request.action,frameIds:concatFrameIds,id:request.id,options:request.options,origin:request.origin,protocol:"PAAF"},"*")})}}FlowsLibrary.prototype.microsoftFlowEnvironmentId=function(){return localStorage.getItem(Commands.FlowsConstants.Flow_LocalStorage_EnvironmentId)};FlowsLibrary.prototype.updateEnvironmentIdCache=function(environmentId){environmentId&&localStorage.setItem(Commands.FlowsConstants.Flow_LocalStorage_EnvironmentId,environmentId)};FlowsLibrary.prototype.clearEnvironmentIdCache=function(){localStorage.removeItem(Commands.FlowsConstants.Flow_LocalStorage_EnvironmentId)};FlowsLibrary.prototype.getFirstPartyIntegrationDomain=function(){var a=document.createElement("a");a.href=this.microsoftFlowDestinationUrl();return a.hostname};FlowsLibrary.prototype.isInUciShim=function(){if(Xrm.Internal.isUci()){var context=Xrm.Utility.getGlobalContext();if(context&&context.client)return context.client.getClient()==Xrm.Constants.ClientNames.mobile}return false};FlowsLibrary.prototype.getOrganizationId=function(){var orgSettings=Xrm.Utility.getGlobalContext().organizationSettings;if(orgSettings)return orgSettings.organizationId;else{var crmOrganizationId=window[Commands.FlowsConstants.Flow_GlobalVar_CrmOrgId];if(!crmOrganizationId&&window.parent)crmOrganizationId=window.parent[Commands.FlowsConstants.Flow_GlobalVar_CrmOrgId];return crmOrganizationId}};FlowsLibrary.prototype.getEntityCollectionNamePromise=function(entityName){var entityCollectionNamePromise;if(Xrm.Internal.isUci()){var entityMetadataPromise=Xrm.Utility.getEntityMetadata(entityName);entityCollectionNamePromise=entityMetadataPromise.then(function(entityMetadata){return entityMetadata.EntitySetName},function(){console.error("Failed to get EntityCollectionName for '%s' entity",entityName)})}else{var entityColllectionName=window[Commands.FlowsConstants.Flow_GlobalVar_EntityCollectionName];if(!entityColllectionName)if(Xrm.Page.data&&Xrm.Page.data.entity&&Xrm.Page.data.entity.getEntitySetName)entityColllectionName=Xrm.Page.data.entity.getEntitySetName();else if(Xrm.Internal&&Xrm.Internal.getEntitySetName)entityColllectionName=Xrm.Internal.getEntitySetName(entityName);entityCollectionNamePromise=Promise.resolve(entityColllectionName)}return entityCollectionNamePromise};FlowsLibrary.prototype.getEntityDisplayNamePromiseUCI=function(entityName,getCollectionName){var _this=this,entityDisplayNamePromise,entityMetadataPromise=Xrm.Utility.getEntityMetadata(entityName);entityDisplayNamePromise=entityMetadataPromise.then(function(entityMetadata){return getCollectionName?entityMetadata.DisplayCollectionName:entityMetadata.DisplayName},function(errorResponse){console.error(errorResponse.message);_this.microsoftFlowsTelemetryReporter.logFlowErrorEvent(_this.tenantId,null,Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,null,"GetEntityDisplayNamePromiseUCI",errorResponse.message);return entityName});return entityDisplayNamePromise};FlowsLibrary.prototype.getFlowDefinitionList=function(environmentId,entityLogicalName,obj){var _this=this;try{this.microsoftFlowFirstPartyIntegrationSiteUrl=this.getMicrosoftFlowFirstPartyIntegrationSiteUrl();if(this.microsoftFlowFirstPartyIntegrationSiteUrl)this.tenantId=this.getUrlVars(this.microsoftFlowFirstPartyIntegrationSiteUrl)["tenantId"]}catch(exception){console.error(exception)}var entityCollectionNamePromise=this.getEntityCollectionNamePromise(entityLogicalName);return entityCollectionNamePromise.then(function(dynamics365EntityLogicalCollectionName){return _this.getFlowDefinitionListPromise(environmentId,entityLogicalName,dynamics365EntityLogicalCollectionName)})};FlowsLibrary.prototype.getFlowDefinitionListPromise=function(environmentId,entityLogicalName,dynamics365EntityLogicalCollectionName){var _this=this,mainPromise=new Promise(function(resolve,reject){var performanceTrackers={};performanceTrackers.startFlowDefinitionsLoadTime=performance.now();performanceTrackers.startAttemptToSilentlyAuthenticateTime=null;var destinationOrigin=_this.microsoftFlowDestinationUrl(),dynamics365OrganizationUniqueName=FlowsLibrary.orgUniqueName(),targetURL=_this.microsoftFlowFirstPartyIntegrationSiteUrl,organizationId=_this.getOrganizationId(),iframeWindow,cachedDefinitionsListStr=sessionStorage.getItem(Commands.FlowsConstants.Flow_SessionStorage_DefinitionList+"_"+entityLogicalName);if(cachedDefinitionsListStr){var cachedDefinitionsList=JSON.parse(cachedDefinitionsListStr);cachedDefinitionsList&&resolve(cachedDefinitionsList)}if(document.getElementById("flowIframe"))iframeWindow=document.getElementById("flowIframe");else{iframeWindow=document.createElement("iframe");iframeWindow.style.display="none";iframeWindow.className="flowClassIframe";iframeWindow.name=Xrm.Internal.isFeatureEnabled("UseFlowServiceUrlInFlowsLibraryPCFVersion")?"flowIframe"+Date.now().toString():"flowIframe";iframeWindow.id="flowIframe";document.body.appendChild(iframeWindow)}iframeWindow.src=targetURL;window[Commands.FlowsConstants.FlowFpiResponseIdsProcessed]={};_this.activeMessageEventListener&&window.removeEventListener("message",_this.activeMessageEventListener);_this.activeMessageEventListener=function(e){_this.fpiMessageHandler(e,iframeWindow,targetURL,dynamics365OrganizationUniqueName,entityLogicalName,dynamics365EntityLogicalCollectionName,environmentId,destinationOrigin,organizationId,performanceTrackers,resolve,reject)};window.addEventListener&&window.addEventListener("message",_this.activeMessageEventListener,false)});return mainPromise};FlowsLibrary.prototype.fpiMessageHandler=function(e,iframeWindow,targetURL,dynamics365OrganizationUniqueName,dynamics365EntityLogicalName,dynamics365EntityLogicalCollectionName,environmentId,destinationOrigin,organizationId,performanceTrackers,resolveCallback,rejectCallback){if(!e||!e.data||!e.data.isResponse||!e.data.requestId||!e.data.method)return;if(e.data.requestId){if(window[Commands.FlowsConstants.FlowFpiResponseIdsProcessed][e.data.requestId])return;window[Commands.FlowsConstants.FlowFpiResponseIdsProcessed][e.data.requestId]=true}var iFrameContentWindow=iframeWindow.contentWindow;if(e.data.method==="MicrosoftFlowAppLoaded"){iFrameContentWindow.postMessage({method:"GetFlowWebsiteUrls",params:{environment:environmentId,dynamics365OrganizationUniqueName:dynamics365OrganizationUniqueName,dynamics365EntityLogicalCollectionName:dynamics365EntityLogicalCollectionName,dynamics365EntityLogicalName:dynamics365EntityLogicalName,dynamics365OrganizationId:organizationId}},destinationOrigin);performanceTrackers.startAttemptToSilentlyAuthenticateTime=performance.now();iFrameContentWindow.postMessage({method:"AttemptToSilentlyAuthenticate"},destinationOrigin)}else if(e.data.method==="UserLoginCompleted"){var userAuthTime=performance.now()-performanceTrackers.startAttemptToSilentlyAuthenticateTime;userAuthTime>0&&this.microsoftFlowsTelemetryReporter.logFlowAuthenticationEvent(this.tenantId,"Success",userAuthTime,false);iframeWindow.src=targetURL}else if(e.data.method==="AttemptToSilentlyAuthenticate")if(e.data.response&&e.data.response.success){performanceTrackers.startFlowDefinitionsLoadTime=performance.now();sessionStorage.setItem(Commands.FlowsConstants.Flow_SessionStorage_UserLoginRequired,"false");var authTime=performance.now()-performanceTrackers.startAttemptToSilentlyAuthenticateTime;authTime>0&&this.microsoftFlowsTelemetryReporter.logFlowAuthenticationEvent(this.tenantId,"Success",authTime,true);iFrameContentWindow.postMessage({method:"GetDefinitionsList",params:{environment:environmentId,dynamics365OrganizationUniqueName:dynamics365OrganizationUniqueName,dynamics365EntityLogicalCollectionName:dynamics365EntityLogicalCollectionName,dynamics365EntityLogicalName:dynamics365EntityLogicalName,dynamics365OrganizationId:organizationId}},destinationOrigin)}else{Xrm.Internal.isUci()&&this.microsoftFlowsTelemetryReporter.logFlowAuthenticationEvent(this.tenantId,"Failure",null,true);sessionStorage.setItem(Commands.FlowsConstants.Flow_SessionStorage_UserLoginRequired,"true");rejectCallback(null)}else if(e.data.method==="GetDefinitionsList")if(!e.data.isFailure){var flowDefinitions=[],endFlowDefinitionsLoadTime=performance.now(),returnedEnvironmentId=e.data.response.environmentId;if(returnedEnvironmentId){this.updateEnvironmentIdCache(returnedEnvironmentId);environmentId=returnedEnvironmentId}var flows=e.data.response.flows,flowCount=0;try{flowDefinitions=flows.map(function(x){return {name:x.name,displayName:x.displayName}});flowCount=flowDefinitions.length;this.localeCompareSupportsLocales()&&flowDefinitions.sort(function(a,b){return a.displayName.localeCompare(b.displayName,undefined,{sensitivity:"base"})})}catch(exception){console.log(exception);flowDefinitions=[];flowCount=0;for(var n=0;n<flows.length;++n){flowDefinitions[n]={name:flows[n].name,displayName:flows[n].displayName};flowCount=flowCount+1}}sessionStorage.setItem(Commands.FlowsConstants.Flow_SessionStorage_DefinitionList+"_"+dynamics365EntityLogicalName,JSON.stringify(flowDefinitions));window.removeEventListener("message",this.activeMessageEventListener);var oLoadDefFromService=e.data.performanceInfo,timetoLoadDefFromService=0;if(oLoadDefFromService!=undefined)timetoLoadDefFromService=oLoadDefFromService.getDefinitionsListTimeMs;var timeTaken=Math.floor(endFlowDefinitionsLoadTime-performanceTrackers.startFlowDefinitionsLoadTime),flowEventMessage="GetDefinitionsList: Success, EntityLogicalName: "+dynamics365EntityLogicalName+" , Type: "+Commands.FlowsConstants.Flow_ModernFlows;this.microsoftFlowsTelemetryReporter.logFlowDefinitionsListEvent(this.tenantId,environmentId,flowCount,timeTaken,timetoLoadDefFromService,dynamics365EntityLogicalName,flowEventMessage);resolveCallback(flowDefinitions)}else{e.data.response&&e.data.response.status==403&&this.clearEnvironmentIdCache();rejectCallback(e.data.errorMessage)}else if(e.data.method==="GetFlowWebsiteUrls")if(e.data.response&&e.data.response.success){var returnedEnvironmentId=e.data.response.environmentId;if(returnedEnvironmentId){this.updateEnvironmentIdCache(returnedEnvironmentId);environmentId=returnedEnvironmentId}else console.warn("GetFlowWebsiteUrls did not get the environment Id in real time. Flow URLs are not going to be environment specific.");sessionStorage.setItem("flowCreateUrl_"+dynamics365EntityLogicalName,e.data.response.createFlowUrl);sessionStorage.setItem("flowManageUrl",e.data.response.manageFlowsUrl)}if(e.data.isFailure){var errMsg=e.data.errorMessage.replace(/'/g,"\\'"),methodName=e.data.method,errorSource=e.data.errorSource,response="";if(e.data.response)response=JSON.stringify(e.data.response);this.microsoftFlowsTelemetryReporter.logFlowErrorEvent(this.tenantId,environmentId,errorSource,response,methodName,errMsg)}};FlowsLibrary.prototype.triggerWorkflowInBatch=function(selectedRecords,entityLogicalName,workflowId){var _this=this;if(!selectedRecords||!entityLogicalName||!workflowId)return;XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();var triggerWorkflowInBatchRequest=selectedRecords.map(function(record){var request=new ExecuteOnDemandWorkflowRequest;request.InputArguments=null;request.entity={id:workflowId,entityType:"workflow"};request.EntityId={guid:record.Id};return request});Xrm.WebApi.online.executeMultiple(triggerWorkflowInBatchRequest).then(function(success){var successProperties={TenantId:_this.tenantId,FlowRunResult:"Success",NoOfEntityRecords:selectedRecords.length,EntityLogicalName:entityLogicalName,FlowId:workflowId,FlowEnvironmentId:null,EventMessage:Commands.FlowsConstants.Flow_OnDemandWorkFlow};Xrm.Utility.closeProgressIndicator();_this.microsoftFlowsTelemetryReporter.logFlowTelemetryEvent("Triggered",successProperties)},function(error){console.error(error.message);_this.microsoftFlowsTelemetryReporter.logWorkFlowErrorEvent(_this.tenantId,workflowId,_this.microsoftFlowEnvironmentId(),Commands.FlowsConstants.Flow_Telemetry_FlowLibrary,error,"TriggerWorkflow",error.message);Xrm.Utility.closeProgressIndicator();XrmCore.InternalUtilities.GenericUtilities.HandleErrorMessage(error)})};FlowsLibrary.orgUniqueName=function(){if(Xrm.Internal.isUci())return Xrm.Utility.getGlobalContext().getOrgUniqueName();else{var crmOrgUniqueName=window[Commands.FlowsConstants.Flow_GlobalVar_CrmOrgUniqueName];if(!crmOrgUniqueName&&window.parent)crmOrgUniqueName=window.parent[Commands.FlowsConstants.Flow_GlobalVar_CrmOrgUniqueName];return crmOrgUniqueName}};return FlowsLibrary}();Commands.FlowsLibrary=FlowsLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Flows=new Commands.FlowsLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Delete=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.DeleteLibrary:new Commands.DeleteLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var HierarchyLibraryLegacy=function(){function HierarchyLibraryLegacy(){}HierarchyLibraryLegacy.prototype.ViewHierarchy=function(entityTypeCode,form){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.viewHierarchy(entityTypeCode):backCompatHeader.Mscrm.CommandBarActions.viewHierarchy(entityTypeCode)};HierarchyLibraryLegacy.prototype.ViewHierarchyFromGrid=function(selectedRecords,entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.viewHierarchyFromGrid(selectedRecords,entityTypeCode):backCompatHeader.Mscrm.CommandBarActions.viewHierarchyFromGrid(selectedRecords,entityTypeCode)};return HierarchyLibraryLegacy}();Commands.HierarchyLibraryLegacy=HierarchyLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var HierarchyControlName="MscrmControls.HierarchyControl.HierarchyControl",CustomControlPageType="control",HierarchyLibrary=function(){function HierarchyLibrary(){}HierarchyLibrary.prototype.ViewHierarchy=function(entityTypeCode,form){var dataInput={};dataInput.etn=form.data.entity.getEntityName();dataInput.id=form.data.entity.getId().replace("{","").replace("}","");var controlInput={};controlInput.pageType=CustomControlPageType;controlInput.controlName=HierarchyControlName;controlInput.data=dataInput;Xrm.Navigation.navigateTo(controlInput)};HierarchyLibrary.prototype.ViewHierarchyFromGrid=function(selectedRecords,entityTypeCode){var dataInput={};dataInput.etn=selectedRecords[0].TypeName;dataInput.id=selectedRecords[0].Id;var controlInput={};controlInput.pageType=CustomControlPageType;controlInput.controlName=HierarchyControlName;controlInput.data=dataInput;Xrm.Navigation.navigateTo(controlInput)};return HierarchyLibrary}();Commands.HierarchyLibrary=HierarchyLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Hierarchy=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.HierarchyLibrary:new Commands.HierarchyLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var ImportLibrary=function(){function ImportLibrary(){this.importFromExcel=function(gridControl,entityTypeName){var params={};params["id_ImportFileType"]=3;params["id_EntityLogicalName"]=entityTypeName;if(entityTypeName=="activitypointer"&&gridControl.getEntityName()!=null)params["id_EntityLogicalName"]=gridControl.getEntityName();Xrm.Navigation.openDialog("ImportWizard",{width:512,height:600,position:2},params);Xrm.Reporting.reportSuccess("Import.SMBImportLaunchRequest",[{name:"Dialogname",value:"ImportWizard"},{name:"Source",value:"EntityGrid"},{name:"EntityLogicalName",value:entityTypeName},{name:"ImportFileType",value:3}])};this.importFromCSV=function(gridControl,entityTypeName){var params={};params["id_ImportFileType"]=0;params["id_EntityLogicalName"]=entityTypeName;if(entityTypeName=="activitypointer"&&gridControl.getEntityName()!=null)params["id_EntityLogicalName"]=gridControl.getEntityName();Xrm.Navigation.openDialog("ImportWizard",{width:512,height:600,position:2},params);Xrm.Reporting.reportSuccess("Import.SMBImportLaunchRequest",[{name:"Dialogname",value:"ImportWizard"},{name:"Source",value:"EntityGrid"},{name:"EntityLogicalName",value:entityTypeName},{name:"ImportFileType",value:0}])};this.importFromExchange=function(gridControl,entityTypeName){var params={};Xrm.Navigation.openDialog("ImportExchange",{width:400,height:600,position:2},params);Xrm.Reporting.reportSuccess("Import.SMBImportLaunchRequest",[{name:"Dialogname",value:"ImportExchange"},{name:"Source",value:"EntityGrid"},{name:"EntityLogicalName",value:entityTypeName},{name:"ImportFileType",value:2}])}}return ImportLibrary}();Commands.ImportLibrary=ImportLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Import=new Commands.ImportLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var BulkEditLibraryLegacy=function(){function BulkEditLibraryLegacy(){}BulkEditLibraryLegacy.prototype.bulkEditRecordsLegacy=function(gridControl,records,entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.bulkEdit(gridControl,records,entityTypeCode):backCompatHeader.Mscrm.GridRibbonActions.bulkEdit(gridControl,records,entityTypeCode)};BulkEditLibraryLegacy.prototype.bulkEditRecords=function(gridControl,records,entityName,defaultCloseState,callback){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false),entityTypeCode=Xrm.Internal.getEntityCode(entityName);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.bulkEdit(gridControl,records,entityTypeCode):backCompatHeader.Mscrm.GridRibbonActions.bulkEdit(gridControl,records,entityTypeCode)};BulkEditLibraryLegacy.prototype.isBulkEditEnabledForEntityLegacy=function(entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isBulkEditEnabledForEntity(entityTypeCode):backCompatHeader.Mscrm.RibbonActions.isBulkEditEnabledForEntity(entityTypeCode)};BulkEditLibraryLegacy.prototype.isBulkEditEnabledForEntity=function(entityName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false),entityTypeCode=Xrm.Internal.getEntityCode(entityName);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isBulkEditEnabledForEntity(entityTypeCode):backCompatHeader.Mscrm.RibbonActions.isBulkEditEnabledForEntity(entityTypeCode)};return BulkEditLibraryLegacy}();Commands.BulkEditLibraryLegacy=BulkEditLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var BulkEditLibrary=function(){function BulkEditLibrary(){var _this=this;this.bulkEditRecordsLegacy=function(gridControl,records,entityTypeCode){var entityName=Xrm.Internal.getEntityName(entityTypeCode);_this.bulkEditRecords(gridControl,records,entityName)};this.bulkEditRecords=function(gridControl,records,entityName){if(!gridControl||!records||records.length===0){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Action_NoItemSelected")});return}var entityTypeCode=Xrm.Internal.getEntityCode(entityName);if(records.length===1){var openOptions={entityName:records[0].TypeName,entityId:records[0].Id};Xrm.Navigation.openForm(openOptions);return}var actualEntityName=entityName,actionUri;if(entityName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.ActivityPointer){for(var record=records[0],i=1;i<records.length;i++)if(records[i].TypeName!==record.TypeName){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Grid_Apply_Rule_Heterogenous_Activity_Type_Records_Selected")});return}actualEntityName=record.TypeName}var uciDialogEnabled=Xrm.Internal.isFeatureEnabled("BulkEditNativeUCI")&&Xrm.Internal.isFeatureEnabled("October2021Update");if(uciDialogEnabled){var pageInput={pageType:"bulkedit",entityName:actualEntityName,entityIds:records.map(function(r){return r.Id})},navOptions={target:2,position:2,width:{value:40,unit:"%"},hideDialogHeader:true};Xrm.Navigation.navigateTo(pageInput,navOptions)}else{var forceRefresh=false,parameters=[forceRefresh,gridControl,"bulkedit",entityTypeCode,records];Commands.Common.constructAndOpenLegacyWebDialog(actualEntityName,gridControl,records,"dlg_bulkedit.aspx",1e3,700,false,_this._refreshGridAfterBulkEdit,parameters)}};this._refreshGridAfterBulkEdit=function(result,forceRefresh,gridControl,requestType,entityName,records){(result||forceRefresh)&&gridControl.refresh()};this.isBulkEditEnabledForEntityLegacy=function(entityTypeCode){return _this.isBulkEditEnabledForEntity(Xrm.Internal.getEntityName(entityTypeCode))};this.isBulkEditEnabledForEntity=function(entityName){if(XrmCore.InternalUtilities.ActivityUtilities.isActivityTypeCode(entityName))switch(entityName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RecurringAppointmentMaster:return false;default:return true}switch(entityName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.AccountAddress:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ActivityMimeAttachment:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ActivityParty:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ActivityScheduling:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.AdvancedSimilarityRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Annotation:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.AnnualFiscalCalendar:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ApplicationFile:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.AppLicense:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.AppOfflineFilter:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Appointment:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.AppSalesPerson:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.AppWorkflowInstance:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.AsyncOperation:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Attribute:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.AttributeMap:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.AttributePicklistValue:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Audit:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.BulkDeleteFailure:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.BulkDeleteOperation:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.BulkDeleteWizardDialog:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.BulkOperation:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.BulkOperationLog:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.BusinessUnit:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.BusinessUnitMap:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.BusinessUnitNewsArticle:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Calendar:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CalendarRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ClientUpdate:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ColumnMapping:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CompetitorAddress:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Connection:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ConnectionRole:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ConstraintBasedGroup:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ContactAddress:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contract:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ContractDetail:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ContractTemplate:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CustomerAddress:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CustomerOpportunityRole:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CustomerRelationship:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Discount:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DiscountType:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DisplayString:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DisplayStringMap:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DocumentIndex:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DocumentTemplate:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DuplicateDetectionDialog:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DuplicateRecord:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DuplicateRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.DuplicateRuleCondition:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Email:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.EmailHash:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Entity:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.EntityMap:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.EntityRelationship:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.EntityRelationshipRole:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Equipment:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Fax:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.FieldPermission:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.FieldSecurityProfile:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.FilterTemplate:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.FixedMonthlyFiscalCalendar:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.GoalRollupQuery:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.HolidayCalendarRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ImportData:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ImportEntity:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ImportFile:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ImportJob:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ImportLog:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ImportMap:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ImportWizardDialog:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.IncidentResolution:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.IntegrationStatus:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.InternalAddress:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.InterProcessLock:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Invoice:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.InvoiceDetail:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.IsvConfig:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.KbArticle:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.KbArticleComment:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.KbArticleTemplate:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.KnowledgeArticleTemplate:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.KnowledgeSearchModel:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.LeadAddress:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Letter:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.License:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ListMember:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.LocalizedLabel:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.LookUpMapping:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.MailMergeTemplate:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Metric:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.MonthlyFiscalCalendar:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.MobileOfflineProfileItemAssociation:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.NewKbArticle:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.None:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Notification:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.NotWorkingWorkShift:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.OccurrenceCalendarRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.OccurringWorkShift:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.OpportunityClose:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.OpportunityProduct:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.OptionSet:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.OrderClose:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Organization:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.OrganizationStatistic:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.OrganizationUI:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.OwnerMapping:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.PhoneCall:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.PickListMapping:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.PluginAssembly:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.PluginType:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.PluginTypeStatistic:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Privilege:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.PrivilegeObjectTypeCodes:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ProcessSession:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ProductPriceLevel:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Publisher:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.QuarterlyFiscalCalendar:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Queue:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.QueueItem:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.QuoteClose:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.QuoteDetail:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RecurrenceCalendarRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RecurringAppointmentMaster:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RecurringWorkShift:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Relationship:9803;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RelationshipRole:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RelationshipRoleMap:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Report:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ReportPropertyDialog:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ResourceGroupExpansion:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ResourceSpec:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RibbonCommand:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RibbonContextGroup:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RibbonCustomization:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RibbonDiff:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RibbonRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RibbonTabToCommandMap:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Role:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RolePrivileges:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RoleTemplate:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RoleTemplatePrivileges:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RollupField:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SalesLiterature:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SalesLiteratureItem:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SalesOrderDetail:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SavedQuery:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SavedQueryVisualization:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ScriptErrorDetailsDialog:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ScriptErrorDialog:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SdkMessage:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SdkMessageFilter:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SdkMessagePair:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SdkMessageProcessingStep:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SdkMessageProcessingStepImage:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SdkMessageProcessingStepSecureConfig:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SdkMessageRequest:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SdkMessageRequestField:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SdkMessageResponse:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SdkMessageResponseField:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SemiAnnualFiscalCalendar:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Service:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ServiceAppointment:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ServiceEndpoint:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ServiceRestrictionCalendarRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SharePointDocumentLocation:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SharePointSite:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Site:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SiteMap:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Solution:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SolutionComponent:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SolutionExportWizard:9207;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SolutionImportWizard:9208;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Subject:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Subscription:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SubscriptionClients:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SubscriptionManuallyTrackedObject:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SubscriptionSyncInfo:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemForm:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemUser:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemUserPrincipals:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Task:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Team:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Template:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Territory:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.TimeOffCalendarRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.TimeZoneDefinition:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.TimeZoneLocalizedName:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.TimeZoneRule:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.TopicModel:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.TransactionCurrency:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.TransformationMapping:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.TransformationParameterMapping:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.UnresolvedAddress:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.UnresolvedEmailParty:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.UoM:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.UserFiscalCalendar:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.UserForm:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.UserQuery:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.UserQueryVisualization:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.UserSettings:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ViewAttribute:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.WebResource:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.WebWizard:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.WizardAccessPrivilege:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.WizardPage:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Workflow:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.WorkflowDependency:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.WorkflowLog:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.WorkflowWaitSubscription:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.MailboxStatistics:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.EntityDashboard:return false;default:return true}}}return BulkEditLibrary}();Commands.BulkEditLibrary=BulkEditLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.BulkEdit=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.BulkEditLibrary:new Commands.BulkEditLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var MergeLibraryLegacy=function(){function MergeLibraryLegacy(){}MergeLibraryLegacy.prototype.mergeRecordsLegacy=function(gridControl,records,entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.mergeRecords(gridControl,records,entityTypeCode):backCompatHeader.Mscrm.GridCommandActions.mergeRecords(gridControl,records,entityTypeCode)};MergeLibraryLegacy.prototype.mergeRecords=function(gridControl,records,entityName,defaultCloseState,callback){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false),entityTypeCode=Xrm.Internal.getEntityCode(entityName);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.mergeRecords(gridControl,records,entityTypeCode):backCompatHeader.Mscrm.GridCommandActions.mergeRecords(gridControl,records,entityTypeCode)};return MergeLibraryLegacy}();Commands.MergeLibraryLegacy=MergeLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var MergeLibrary=function(){function MergeLibrary(){var _this=this;this.mergeRecordsLegacy=function(gridControl,records,entityTypeCode){var entityName=Xrm.Internal.getEntityName(entityTypeCode);_this.mergeRecords(gridControl,records,entityName)};this.mergeRecords=function(gridControl,records,entityName){var maxLimit=2;if(records&&records.length>maxLimit){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("LOCID_MERGE_TOOMANY_RECORDS")});return}var forceRefresh=false,parameters=[forceRefresh,gridControl,"merge",Xrm.Internal.getEntityCode(entityName),records];Commands.Common.constructAndOpenLegacyWebDialog(entityName,gridControl,records,"dlg_merge.aspx",800,570,true,_this.showMessageAfterMergeAssocAndRefreshGrid,parameters)};this.showMessageAfterMergeAssocAndRefreshGrid=function(result,forceRefresh,gridControl,requestType,entityName,records){(result||forceRefresh)&&gridControl.refresh()}}return MergeLibrary}();Commands.MergeLibrary=MergeLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Merge=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.MergeLibrary:new Commands.MergeLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var NavigateToGridLibrary=function(){function NavigateToGridLibrary(){}NavigateToGridLibrary.prototype.navigateToHomepageGrid=function(gridControl,entityTypeName){if(entityTypeName&&gridControl&&gridControl.getViewSelector()&&gridControl.getViewSelector().getCurrentView()){var currentView=gridControl.getViewSelector().getCurrentView(),currentViewId=currentView.id,viewId=currentViewId&&currentViewId.replace("{","").replace("}","").toUpperCase();Xrm.Navigation.navigateTo({pageType:"entitylist",entityName:entityTypeName,viewId:viewId,viewType:currentView.entityType})}};return NavigateToGridLibrary}();Commands.NavigateToGridLibrary=NavigateToGridLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.NavigateToGrid=new Commands.NavigateToGridLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var NewRecordForBPFEntityLibraryLegacy=function(){function NewRecordForBPFEntityLibraryLegacy(){this.openNewRecord=function(entityLogicalName,gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.openNewBpfEntityRecord(entityLogicalName,gridControl):backCompatHeader.Mscrm.CommandBarActions.openNewBpfEntityRecord(entityLogicalName,gridControl)}}return NewRecordForBPFEntityLibraryLegacy}();Commands.NewRecordForBPFEntityLibraryLegacy=NewRecordForBPFEntityLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var NewRecordForBPFEntityLibrary=function(){function NewRecordForBPFEntityLibrary(){this.openNewRecord=function(entityLogicalName,gridControl){NewRecordForBPFEntityLibrary.getProcessInfo(entityLogicalName).then(function(response){if(response.entities&&response.entities.length>0){var process=response.entities[0],primaryEntityLogicalName=process["primaryentity"],processId=process["workflowid"],openOptions={entityName:primaryEntityLogicalName,processId:processId};Xrm.Navigation.openForm(openOptions)}},function(e){console.error(e)})}}NewRecordForBPFEntityLibrary.getProcessInfo=function(entityLogicalName){var fetchXml="<fetch version='1.0' mapping='logical'><entity name='workflow'><attribute name='primaryentity' /><attribute name='workflowid' /><filter type='and'><condition attribute='uniquename' operator='eq' value='"+entityLogicalName+"' /></filter></entity></fetch>";return Xrm.WebApi.online.retrieveMultipleRecords("workflow","?fetchXml="+fetchXml)};return NewRecordForBPFEntityLibrary}();Commands.NewRecordForBPFEntityLibrary=NewRecordForBPFEntityLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.NewRecordForBPFEntity=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.NewRecordForBPFEntityLibrary:new Commands.NewRecordForBPFEntityLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var OpenObjLibraryLegacy=function(){function OpenObjLibraryLegacy(){var _this=this;this.NewCustomActivity=function(entityTypeName,gridControl,id,parameters,urlPrefix,mode,extraParams){_this.NewCustomActivityLegacy(Xrm.Internal.getEntityCode(entityTypeName),id,parameters,urlPrefix,mode,extraParams)};this.NewCustomActivityLegacy=function(entityTypeCode,id,parameters,urlPrefix,mode,extraParams){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);openObj?openObj(entityTypeCode,id,parameters,urlPrefix,mode,extraParams):backCompatHeader.openObj(entityTypeCode,id,parameters,urlPrefix,mode,extraParams)}}return OpenObjLibraryLegacy}();Commands.OpenObjLibraryLegacy=OpenObjLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var OpenObjLibrary=function(){function OpenObjLibrary(){var _this=this;this.NewCustomActivity=function(entityTypeName,gridControl,id,parameters,urlPrefix,mode,extraParams){var openOptions={entityName:entityTypeName};if(gridControl&&gridControl.getGridType&&(gridControl.getGridType()===3||gridControl.getGridType()===2))openOptions.useQuickCreateForm=true;Xrm.Navigation.openForm(openOptions)};this.NewCustomActivityLegacy=function(entityTypeCode,id,parameters,urlPrefix,mode,extraParams){var entityName=Xrm.Internal.getEntityName(entityTypeCode);_this.NewCustomActivity(entityName,undefined,id,parameters,urlPrefix,mode,extraParams)}}return OpenObjLibrary}();Commands.OpenObjLibrary=OpenObjLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.OpenObj=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.OpenObjLibrary:new Commands.OpenObjLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var OpenLibraryLegacy=function(){function OpenLibraryLegacy(){this.openNewRecord=function(entityLogicalName,gridControl){if(typeof entityLogicalName==="number")entityLogicalName=Xrm.Internal.getEntityName(entityLogicalName);var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.openNewRecord(entityLogicalName,gridControl):backCompatHeader.Mscrm.CommandBarActions.openNewRecord(entityLogicalName,gridControl)};this.addNewFromSubGridStandard=function(gridTypeName,parentEntityTypeName,parentEntityId,primaryControl,gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true),parentEntityTypeCode=Xrm.Internal.getEntityCode(parentEntityTypeName),gridTypeCode=Xrm.Internal.getEntityCode(gridTypeName);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.addNewFromSubGridStandard(gridTypeCode,parentEntityTypeCode,parentEntityId,primaryControl,gridControl):backCompatHeader.Mscrm.GridCommandActions.addNewFromSubGridStandard(gridTypeCode,parentEntityTypeCode,parentEntityId,primaryControl,gridControl)};this.addNewFromSubGridStandardLegacy=function(gridTypeCode,parentEntityTypeCode,parentEntityId,primaryControl,gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.addNewFromSubGridStandard(gridTypeCode,parentEntityTypeCode,parentEntityId,primaryControl,gridControl):backCompatHeader.Mscrm.GridCommandActions.addNewFromSubGridStandard(gridTypeCode,parentEntityTypeCode,parentEntityId,primaryControl,gridControl)}}return OpenLibraryLegacy}();Commands.OpenLibraryLegacy=OpenLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var OpenLibrary=function(){function OpenLibrary(){var _this=this;this.openNewRecord=function(entityLogicalName,gridControl){if(typeof entityLogicalName==="number")entityLogicalName=Xrm.Internal.getEntityName(entityLogicalName);if(!entityLogicalName)return;var parameters={};switch(entityLogicalName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Report:var runReportLib=void 0;runReportLib=new XrmCore.Commands.RunReportLibrary;runReportLib.NewReport(entityLogicalName,gridControl);break;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.Connection:var SALES_TEAM_VIEW_ID="FE4BC089-8901-466C-A41B-1C1090F204D4",STAKEHOLDER_VIEW_ID="4E3600FA-B9C8-49F4-B69A-51EBA06D9BDF",STAKEHOLDER_ROLE_ID="518D7AAA-3B4C-4041-AD33-A6FD40DF6C81",SALES_PROFESSIONAL_ROLE_ID_1="20079806-EB84-4093-99AD-BB46435DB028",currentViewId=gridControl&&gridControl.getViewSelector().getCurrentView().id,viewId=currentViewId&&currentViewId.replace("{","").replace("}","").toUpperCase(),isStakeholderOrSalesTeamGrid=viewId&&(viewId==STAKEHOLDER_VIEW_ID||viewId==SALES_TEAM_VIEW_ID);if(isStakeholderOrSalesTeamGrid){var targetEntityName=viewId==STAKEHOLDER_VIEW_ID?XrmCore.InternalUtilities.EntityUtilities.EntityNames.Contact:XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemUser,roleId_1=viewId==STAKEHOLDER_VIEW_ID?STAKEHOLDER_ROLE_ID:SALES_PROFESSIONAL_ROLE_ID_1,lookup=Xrm.Utility.lookupObjects?Xrm.Utility.lookupObjects({allowMultiSelect:false,defaultEntityType:targetEntityName,entityTypes:[targetEntityName],lookupType:"Lookup.Simple"}):null;lookup&&lookup.then(function(lookupValues){return _this.createConnection(lookupValues,roleId_1,gridControl,roleId_1==SALES_PROFESSIONAL_ROLE_ID_1)});break}else if(gridControl){var fetchXml=gridControl.getFetchXml(),domFetch=fetchXml&&XrmCore.InternalUtilities.ExportUtilities.getXmlDOMFromString(fetchXml),linkEntities=domFetch&&domFetch.getElementsByTagName("link-entity");if(linkEntities)for(var linkEntity=void 0,linkEntity=0;linkEntity<linkEntities.length;linkEntity++)if(linkEntities[linkEntity].getAttribute("name")=="connectionrole"){var filters=linkEntities[linkEntity].getElementsByTagName("filter");if(filters&&filters[0])for(var conditions=filters[0].getElementsByTagName("condition"),condition=void 0,condition=0;condition<conditions.length;condition++)if(conditions[condition].getAttribute("attribute")=="category")parameters["roleCategoryId"]=conditions[condition].getAttribute("value")}}default:var openOptions={entityName:entityLogicalName};if(gridControl){var subGridControl=gridControl;if(subGridControl.getGridType&&(subGridControl.getGridType()===3||subGridControl.getGridType()===2)){openOptions.useQuickCreateForm=true;if(subGridControl.getRelationship&&subGridControl.getRelationship()){var parentControl=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page;if(parentControl&&parentControl.data&&parentControl.data.entity){var lookupValue=parentControl.data.entity.getEntityReference();openOptions.createFromEntity=lookupValue}}}}Xrm.Navigation.openForm(openOptions,parameters)}};this.addNewFromSubGridStandard=function(gridEntityName,parentEntityName,parentEntityId,primaryControl,gridControl){if(typeof gridEntityName=="number")gridEntityName=Xrm.Internal.getEntityName(gridEntityName);var entityRelationship=gridControl.getRelationship(),parentControl=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page,fromEntity=parentControl.data.entity.getEntityReference(),openOptions={entityName:gridEntityName,createFromEntity:fromEntity,useQuickCreateForm:true,relationship:entityRelationship};Xrm.Navigation.openForm(openOptions)};this.addNewFromSubGridStandardLegacy=function(gridTypeCode,parentEntityTypeCode,parentEntityId,primaryControl,gridControl){_this.addNewFromSubGridStandard(Xrm.Internal.getEntityName(gridTypeCode),Xrm.Internal.getEntityName(parentEntityTypeCode),parentEntityId,primaryControl,gridControl)};this.createConnection=function(lookupValues,targetRoleId,gridControl,assignRecordToDefaultSalesTemplate){if(assignRecordToDefaultSalesTemplate===void 0)assignRecordToDefaultSalesTemplate=false;if(!lookupValues||lookupValues.length===0)return;var connectionFromEntitySetName,connectionToEntitySetName,parentControl=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page;Xrm.Utility.getEntityMetadata(parentControl.data.entity.getEntityName()).then(function(connectionFromMetadata){connectionFromEntitySetName=connectionFromMetadata["EntitySetName"];var fromEntityId=parentControl.data.entity.getId().replace("{","").replace("}",""),toEntityType=lookupValues[0].entityType,toEntityId=lookupValues[0].id.replace("{","").replace("}","");Xrm.Utility.getEntityMetadata(toEntityType).then(function(connectionToMetadata){connectionToEntitySetName=connectionToMetadata["EntitySetName"];var DummyConnectionRoleIdIfRecord2RoleIdDoesNotExist="26591187-1160-4D25-8723-2D9C92617D3A",record1RoleIdValue="",fetchXML="<fetch distinct='false' no-lock='false' mapping='logical' page='1' count='2'><entity name='connectionrole'><attribute name='connectionroleid' /><attribute name='name' /><link-entity name='connectionroleassociation' to='connectionroleid' from='connectionroleid' link-type='inner'><filter type='and'><condition attribute='associatedconnectionroleid' operator='eq' value='"+targetRoleId+"' /></filter></link-entity></entity></fetch>";Xrm.WebApi.online.retrieveMultipleRecords(XrmCore.InternalUtilities.EntityUtilities.EntityNames.ConnectionRole,"?fetchXml="+fetchXML).then(function(response){if(response!==null&&response!==undefined){var entityCollection=response.entities;if(entityCollection.length>0&&entityCollection.length==1)record1RoleIdValue=response.entities[0]["connectionroleid"];else record1RoleIdValue=DummyConnectionRoleIdIfRecord2RoleIdDoesNotExist}var connection={};connection["record1id_"+parentControl.data.entity.getEntityName()+"@odata.bind"]="/"+connectionFromEntitySetName+"("+fromEntityId+")";connection["record2id_"+toEntityType+"@odata.bind"]="/"+connectionToEntitySetName+"("+toEntityId+")";connection["record2roleid@odata.bind"]="/connectionroles("+targetRoleId+")";connection["record1roleid@odata.bind"]="/connectionroles("+record1RoleIdValue+")";Xrm.WebApi.createRecord(XrmCore.InternalUtilities.EntityUtilities.EntityNames.Connection,connection).then(function(success){if(assignRecordToDefaultSalesTemplate&&parentControl.data.entity.getEntityName()=="opportunity"){var ACCESS_TEAM_TEMPLATE_ID="B3228218-B8F6-4A1B-A18D-552C6F980831";_this.addUserToRecordTeam(lookupValues[0].id,ACCESS_TEAM_TEMPLATE_ID)}gridControl&&gridControl.refresh()},function(error){gridControl&&gridControl.refresh();XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)})})})})};this.addUserToRecordTeam=function(userId,templateId){var parentEntity=Xrm.Page.data.entity,addUserToTeamRequest=new XrmCore.SdkContracts.AddUserToRecordTeamRequest({id:userId,entityType:XrmCore.InternalUtilities.EntityUtilities.EntityNames.SystemUser},{id:parentEntity.getId(),entityType:parentEntity.getEntityName()},{id:templateId,entityType:XrmCore.InternalUtilities.EntityUtilities.EntityNames.TeamTemplate});Xrm.WebApi.online.execute(addUserToTeamRequest).then(null,function(error){XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)})}}OpenLibrary.prototype.openSearchResultInSidePane=function(records,commandParameters){var _this=this;if(!records||records.length===0||records[0]==null||records[0].TypeName==null||records[0].Id==null)return;var PANE_ID_FOR_SEARCH_RESULTS_PAGE="search-page-side-pane",CONTROL_TYPE_FOR_SEARCH_RESULTS_PAGE="searchresultsgrid",SIDE_PANE_WIDTH=592,paneIdToUse=commandParameters&&commandParameters["CustomControlType"]===CONTROL_TYPE_FOR_SEARCH_RESULTS_PAGE?PANE_ID_FOR_SEARCH_RESULTS_PAGE:null;if(Xrm.App.sidePanes.state===0)Xrm.App.sidePanes.state=1;var existingPane;if(paneIdToUse===PANE_ID_FOR_SEARCH_RESULTS_PAGE)existingPane=Xrm.App.sidePanes.getPane(paneIdToUse);Xrm.Utility.getEntityMetadata(records[0].TypeName).then(function(entityMetadata){var entityTypeImageName="";if(entityMetadata.IconVectorName)entityTypeImageName="/WebResources/"+entityMetadata.IconVectorName;else if(!entityMetadata.IsCustomEntity)entityTypeImageName="/_imgs/svg_"+entityMetadata.ObjectTypeCode+".svg";if(existingPane){existingPane.select();existingPane.imageSrc=entityTypeImageName;_this._navigateInSidePane(records[0],existingPane)}else{var sidePaneOptions={paneId:paneIdToUse,canClose:true,imageSrc:entityTypeImageName,title:undefined,hideHeader:true,isSelected:true,width:SIDE_PANE_WIDTH,hidden:false,alwaysRender:true,keepBadgeOnSelected:true};Xrm.App.sidePanes.createPane(sidePaneOptions).then(function(pane){_this._navigateInSidePane(records[0],pane)})}})};OpenLibrary.prototype._navigateInSidePane=function(record,pane){var PAGE_TYPE_ENTITY_RECORD="entityrecord",pageInput={pageType:PAGE_TYPE_ENTITY_RECORD,entityName:record.TypeName,entityId:record.Id},navigateOptions={replaceState:true,resetHistory:true};pane.navigate(pageInput,navigateOptions)};return OpenLibrary}();Commands.OpenLibrary=OpenLibrary;var LookupValueImplementation=function(){function LookupValueImplementation(id,name,entityType){this.name=name;this.id=id;this.entityType=entityType}return LookupValueImplementation}()})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Open=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.OpenLibrary:new Commands.OpenLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var PowerBI=function(){function PowerBI(){}PowerBI.openPowerBiQuickReport=function(gridControl){if(!Xrm.Internal.isUci)return;if(!gridControl)return;var fetchXml=gridControl.getFetchXml();if(!fetchXml)return;var viewName="",viewSelector=gridControl.getViewSelector?gridControl.getViewSelector():null;if(viewSelector&&viewSelector.getCurrentView)viewName=viewSelector.getCurrentView().name||"";var fetchXMLToSQL=new FetchXMLToSQL(fetchXml);Xrm.WebApi.online.execute(fetchXMLToSQL).then(function(response){if(response)try{response.json().then(function(jsonResponse){var parameters={fetch_xml_sql:jsonResponse.Response,view_name:viewName};Xrm.Navigation.openDialog("PowerBIQuickReport",{position:1,width:Math.ceil(window.screen.width*.8),height:Math.ceil(window.screen.height*.8)},parameters)})}catch(e){Xrm.Reporting.reportFailure("OpenPowerBiQuickReport",e,"",null)}else Xrm.Reporting.reportFailure("OpenPowerBiQuickReport",new Error("fetchXMLToSQL response is null"),"",null)},function(error){Xrm.Reporting.reportFailure("OpenPowerBiQuickReport",new Error(error.message),"",null);var errorDialogOptions={message:error.message,errorCode:error.errorCode};Xrm.Navigation.openErrorDialog(errorDialogOptions)})};PowerBI.enablePowerBiQuickReport=function(){var fcb=Xrm.Internal.isFeatureEnabled("PowerBIQuickReport"),context=Xrm.Utility.getGlobalContext(),powerBiSetting=context?context.getCurrentAppSetting("EnablePowerBIQuickReport"):null,tdsEnabled=true,orgDBOrgSettings=context&&context.organizationSettings&&context.organizationSettings.attributes&&context.organizationSettings.attributes.orgdborgsettings;if(orgDBOrgSettings){var domParser=new DOMParser,xmlDocument=domParser.parseFromString(orgDBOrgSettings,"text/xml"),nodes=xmlDocument&&xmlDocument.getElementsByTagName("EnableTDSEndpoint");if(nodes&&nodes.length>0&&nodes[0])tdsEnabled=nodes[0].textContent!=="false"}return fcb==true&&powerBiSetting==true&&tdsEnabled==true};return PowerBI}();Commands.PowerBI=PowerBI;var FetchXMLToSQL=function(){function FetchXMLToSQL(fetchXML){this.FetchXml=fetchXML;this.SubqueryCompatible=true}FetchXMLToSQL.prototype.getMetadata=function(){return {boundParameter:null,parameterTypes:{FetchXml:{typeName:"Edm.String",structuralProperty:1},SubqueryCompatible:{typeName:"Edm.Boolean",structuralProperty:1}},operationName:"FetchXMLToSQL",operationType:1}};return FetchXMLToSQL}()})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var OpenActiveStageLibraryLegacy=function(){function OpenActiveStageLibraryLegacy(){}OpenActiveStageLibraryLegacy.prototype.openActiveStageFromGrid=function(records){var record=records[0],bpfEntityReference={LogicalName:record.TypeName,Id:record.Id,Name:record.Name},backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.openActiveStage(bpfEntityReference):backCompatHeader.Mscrm.GridRibbonActions.openActiveStage(bpfEntityReference)};OpenActiveStageLibraryLegacy.prototype.openActiveStageFromForm=function(id,entityName){var bpfEntityReference={LogicalName:entityName,Id:id,Name:""},backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.openActiveStage(bpfEntityReference):backCompatHeader.Mscrm.GridRibbonActions.openActiveStage(bpfEntityReference)};return OpenActiveStageLibraryLegacy}();Commands.OpenActiveStageLibraryLegacy=OpenActiveStageLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var OpenActiveStageLibrary=function(){function OpenActiveStageLibrary(){}OpenActiveStageLibrary.prototype.openActiveStageFromGrid=function(records){if(records.length==1){var record_1=records[0],bpfEntityReference={entityType:record_1.TypeName,id:record_1.Id,name:record_1.Name},request=new XrmCore.SdkContracts.RetrieveActiveStageRecordRequest(bpfEntityReference),deferred=Xrm.WebApi.online.execute(request).then(function(response){return response.json()}).then(function(odataResponse){var entityName=odataResponse["@odata.type"].replace("#Microsoft.Dynamics.CRM.","");Xrm.Utility.getEntityMetadata(entityName).then(function(entityMetadata){var openOptions={entityName:entityName,entityId:odataResponse[entityMetadata.PrimaryIdAttribute],processId:odataResponse["processid"],processInstanceId:record_1.Id};Xrm.Navigation.openForm(openOptions,null)})},function(error){console.error(error)});return}};OpenActiveStageLibrary.prototype.openActiveStageFromForm=function(id,entityName){var bpfEntityReference={entityType:entityName,id:id},request=new XrmCore.SdkContracts.RetrieveActiveStageRecordRequest(bpfEntityReference),deferred=Xrm.WebApi.online.execute(request).then(function(response){return response.json()}).then(function(odataResponse){var entityName=odataResponse["@odata.type"].replace("#Microsoft.Dynamics.CRM.","");Xrm.Utility.getEntityMetadata(entityName).then(function(entityMetadata){var openOptions={entityName:entityName,entityId:odataResponse[entityMetadata.PrimaryIdAttribute],processId:odataResponse["processid"],processInstanceId:id};Xrm.Navigation.openForm(openOptions,null)})},function(error){console.error(error)})};return OpenActiveStageLibrary}();Commands.OpenActiveStageLibrary=OpenActiveStageLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.OpenActiveStage=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.OpenActiveStageLibrary:new Commands.OpenActiveStageLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var Refresh=function(){function Refresh(){}Refresh.refreshCommand=function(control){var gridControl=control;if(gridControl.refresh){var allEntities=Refresh._getAllEntitiesFromFetchXML(gridControl.getFetchXml());Xrm.Internal.initiateOfflineDataSync(allEntities).then(function(){return gridControl.refresh()})}else Xrm.Page.ui&&Xrm.Page.ui.refresh&&Xrm.Page.ui.refresh()};Refresh._getAllEntitiesFromFetchXML=function(fetchXml){var entities=[],fetchXmlParser=new DOMParser,parsedFetchXml=fetchXmlParser.parseFromString(fetchXml,"text/xml"),entityNodes=parsedFetchXml&&parsedFetchXml.documentElement?parsedFetchXml.documentElement.getElementsByTagName("entity"):null;if(entityNodes&&entityNodes.length){var entityNode=entityNodes[0],entityName=entityNode&&entityNode.attributes?entityNode.attributes.getNamedItem("name"):null;entityName&&entityName.value&&entities.push(entityName.value);var entityChildNodes=entityNode.childNodes;if(entityChildNodes&&entityChildNodes.length)for(var i=0;i<entityChildNodes.length;i++)entityChildNodes[i].nodeName==="link-entity"&&Refresh._parseLinkedEntities(entityChildNodes[i],entities)}return entities};Refresh._parseLinkedEntities=function(linkEntityNode,entities){var node=linkEntityNode,entityName=node&&node.attributes?node.attributes.getNamedItem("name"):null;entityName&&entityName.value&&entities.push(entityName.value);var childNodes=linkEntityNode.childNodes;if(childNodes&&childNodes.length)for(var i=0;i<childNodes.length;i++)childNodes[i].nodeName==="link-entity"&&Refresh._parseLinkedEntities(childNodes[i],entities);return entities};return Refresh}();Commands.Refresh=Refresh})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var DisassociateLibraryLegacy=function(){function DisassociateLibraryLegacy(){}DisassociateLibraryLegacy.prototype.gridDisassociate=function(typeName,gridControl,firstSelectedItemId){var typeCode=Xrm.Internal.getEntityCode(typeName),backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.gridDisassociate(typeCode,gridControl,firstSelectedItemId):backCompatHeader.Mscrm.GridRibbonActions.gridDisassociate(typeCode,gridControl,firstSelectedItemId)};DisassociateLibraryLegacy.prototype.gridDisassociateLegacy=function(typeCode,gridControl,firstSelectedItemId){if(typeCode!=null){var typeName=Xrm.Internal.getEntityName(typeCode);typeName!=null&&XrmCore.Commands.DisassociateLibraryLegacy.prototype.gridDisassociate(typeName,gridControl,firstSelectedItemId)}};return DisassociateLibraryLegacy}();Commands.DisassociateLibraryLegacy=DisassociateLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var GridDisassociateBase=function(_super){__extends(GridDisassociateBase,_super);function GridDisassociateBase(){_super.apply(this,arguments)}GridDisassociateBase.prototype.disassociate=function(gridControl,selectedRecords){var _this=this,parentControl=gridControl&&gridControl.getParentForm?gridControl.getParentForm():Xrm.Page,parentId=parentControl.data.entity.getId().replace("{","").replace("}",""),parentEntity=parentControl.data.entity.getEntityName(),subGridControl=gridControl,relationship=subGridControl&&subGridControl.getRelationship&&subGridControl.getRelationship(),relationshipName=relationship&&relationship.name,childEntity=gridControl&&gridControl.getEntityName?gridControl.getEntityName():"",shouldSwapParentChild=relationship&&relationship.roleType===2&&relationship.relationshipType===1;if(selectedRecords&&0<selectedRecords.getLength())Xrm.WebApi.online&&Xrm.Utility.getEntityMetadata(parentEntity).then(function(metadata){var batch=[];selectedRecords.forEach(function(selectedRecord){var childId=selectedRecord.getId().replace("{","").replace("}","");if(shouldSwapParentChild)batch.push(_this.createDisassociateODataContract(childId,childEntity,parentId,relationship));else batch.push(_this.createDisassociateODataContract(parentId,parentEntity,childId,relationship))});batch&&batch.length>0&&_this.performExecuteMultiple(gridControl,batch)});else{var rows_1=gridControl&&gridControl.getGrid&&gridControl.getGrid()&&gridControl.getGrid().getSelectedRows&&gridControl.getGrid().getSelectedRows();if(rows_1&&0<rows_1.getLength())Xrm.WebApi.online&&Xrm.Utility.getEntityMetadata(parentEntity).then(function(metadata){var batch=[];rows_1.forEach(function(row){var childId=row&&row.data&&row.data.entity&&row.data.entity.getId?row.data.entity.getId().replace("{","").replace("}",""):null;if(shouldSwapParentChild)batch.push(_this.createDisassociateODataContract(childId,childEntity,parentId,relationship));else batch.push(_this.createDisassociateODataContract(parentId,parentEntity,childId,relationship))});batch&&batch.length>0&&_this.performExecuteMultiple(gridControl,batch)})}};GridDisassociateBase.prototype.createDisassociateODataContract=function(entityId,entityType,relatedEntityId,relationship){var request={getMetadata:function(){var ODataMetadata={boundParameter:null,parameterTypes:{},operationName:"Disassociate",operationType:2};return ODataMetadata},target:{id:entityId,entityType:entityType},relatedEntityId:relatedEntityId,relationship:relationship&&relationship.name};return request};GridDisassociateBase.prototype.performExecuteMultiple=function(gridControl,batch){Xrm.WebApi.online.executeMultiple(batch).then(function(success){XrmCore.InternalUtilities.DialogUtilities.onGridActionMultipleSuccess(gridControl,success)},function(error){gridControl.refresh();XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error)})};return GridDisassociateBase}(XrmCore.Common.EntitySpecificOverrideBase);Commands.GridDisassociateBase=GridDisassociateBase})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var GridDisassociate=function(_super){__extends(GridDisassociate,_super);function GridDisassociate(){_super.apply(this,arguments);this.overrideMethods={disassociate:{category:"gridDisassociateForKnowledgeArticleCategory"}}}GridDisassociate.prototype.gridDisassociateForKnowledgeArticleCategory=function(base,gridControl,selectedRecords){this[base](gridControl,selectedRecords)};return GridDisassociate}(Commands.GridDisassociateBase);Commands.GridDisassociate=GridDisassociate})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var DisassociateLibrary=function(){function DisassociateLibrary(){}DisassociateLibrary.prototype.gridDisassociate=function(typeName,gridControl,firstSelectedItemId){var gridDisassociate=new Commands.GridDisassociate(typeName);gridDisassociate.call("disassociate",gridControl)};DisassociateLibrary.prototype.gridDisassociateLegacy=function(typeCode,gridControl,firstSelectedItemId){if(typeCode!=null){var typeName=Xrm.Internal.getEntityName(typeCode);typeName!=null&&XrmCore.Commands.DisassociateLibrary.prototype.gridDisassociate(typeName,gridControl,firstSelectedItemId)}};return DisassociateLibrary}();Commands.DisassociateLibrary=DisassociateLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Disassociate=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.DisassociateLibrary:new Commands.DisassociateLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var SaveLibraryLegacy=function(){function SaveLibraryLegacy(){this.saveForm=function(form){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.saveForm(form):backCompatHeader.Mscrm.RibbonActions.saveForm(form)};this.saveAndCloseForm=function(form){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.saveAndCloseForm(form):backCompatHeader.Mscrm.RibbonActions.saveAndCloseForm(form)};this.saveAsCompleted=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.saveAsCompleted():backCompatHeader.Mscrm.CommandBarActions.saveAsCompleted()}}return SaveLibraryLegacy}();Commands.SaveLibraryLegacy=SaveLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var SaveLibrary=function(){function SaveLibrary(){var _this=this;this.saveForm=function(form){var saveOptions={useSchedulingEngine:false,saveMode:1},successCallback=function(successParameter){successParameter&&successParameter.savedEntityReference&&successParameter.savedEntityReference.entityType=="email"&&Commands.Common.refreshParentFromEmailPopup()};form.data.save(saveOptions).then(successCallback,_this._failedCallback)};this.saveAndCloseForm=function(form){var saveOptions={useSchedulingEngine:false,saveMode:2},successCallback=function(successParameter){form.ui.close();successParameter&&successParameter.savedEntityReference&&successParameter.savedEntityReference.entityType=="email"&&Commands.Common.refreshParentFromEmailPopup()};form.data.save(saveOptions).then(successCallback,_this._failedCallback)};this._failedCallback=function(errorResponse){};this.saveAsCompleted=function(){if(Xrm.Page.data.isValid()){var entityId=Xrm.Page.data.entity.getId(),entityName=Xrm.Page.data.entity.getEntityName(),stateCode=1,statusCode=-1,closePage=true;XrmCore.Commands.Common.setState(entityId,entityName,stateCode,statusCode,closePage,null,null,58)}else Xrm.Page.data.save()}}return SaveLibrary}();Commands.SaveLibrary=SaveLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Save=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.SaveLibrary:new Commands.SaveLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var SetRegardingLibraryLegacy=function(){function SetRegardingLibraryLegacy(){}SetRegardingLibraryLegacy.prototype.setRegarding=function(gridControl,records,entityTypeName){var entityTypeCode=Xrm.Internal.getEntityCode(entityTypeName),backCompatHeader=window.top.frames[0];Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.setRegarding(gridControl,records,entityTypeCode):backCompatHeader.Mscrm.GridCommandActions.addExistingFromSubGridAssociated(gridControl,records,entityTypeCode)};SetRegardingLibraryLegacy.prototype.setRegardingOnLoad=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.setRegardingOnLoad():backCompatHeader.Mscrm.GridCommandActions.setRegardingOnLoad()};SetRegardingLibraryLegacy.prototype.setRegardingDialogRegardingChange=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.setRegardingDialogRegardingChange():backCompatHeader.Mscrm.GridCommandActions.setRegardingDialogRegardingChange()};SetRegardingLibraryLegacy.prototype.setRegardingDialogSetClick=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.setRegardingDialogSetClick():backCompatHeader.Mscrm.GridCommandActions.setRegardingDialogSetClick()};SetRegardingLibraryLegacy.prototype.setRegardingCloseDialog=function(){Commands.Common.closeDialogLegacy()};return SetRegardingLibraryLegacy}();Commands.SetRegardingLibraryLegacy=SetRegardingLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var SetRegardingLibrary=function(){function SetRegardingLibrary(){}SetRegardingLibrary.prototype.setRegarding=function(gridControl,records,entityTypeName){if(Xrm.Internal.isUci()&&entityTypeName==Xrm.Constants.EntityNames.ActivityPointer){var promise=Xrm.Utility.getEntitiesMetadata(Commands.Common.GetEntityNamesFromActivityRecords(records));records.length>0&&promise.then(function(values){!Commands.Common.CheckIfIsReadOnlyInMobileClient(values)&&SetRegardingLibrary.setRegardingCallback(gridControl,records,entityTypeName)})}else SetRegardingLibrary.setRegardingCallback(gridControl,records,entityTypeName)};SetRegardingLibrary.setRegardingCallback=function(gridControl,records,entityTypeName){var windowWidth=500,windowHeight=260,dialogParams={};dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityName]=entityTypeName;dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records]=records;var options={width:windowWidth,height:windowHeight};Xrm.Navigation.openDialog(XrmCore.InternalUtilities.DialogUtilities.DialogName.SetRegarding,options,dialogParams).then(Commands.Common.gridCommandDialogCloseCallback(gridControl))};SetRegardingLibrary.prototype.setRegardingOnLoad=function(eventContext){var formContext=eventContext.getFormContext(),setButton=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId);setButton.setDisabled(true);var headerDescriptionControl=formContext.getControl("label_DialogDescription"),selectedRecordsCount=0,records=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records).getValue();selectedRecordsCount=records.length;Xrm.Utility.getEntityMetadata(Xrm.Constants.EntityNames.ActivityPointer).then(function(entityInfo){var titleDescription="";if(selectedRecordsCount===1)titleDescription=XrmCore.InternalUtilities.GenericUtilities.stringFormat(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_SetRegarding_Description"),[selectedRecordsCount,entityInfo.DisplayName]);else titleDescription=XrmCore.InternalUtilities.GenericUtilities.stringFormat(XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Dialog_SetRegarding_Description"),[selectedRecordsCount,entityInfo.DisplayCollectionName]);headerDescriptionControl.setLabel(titleDescription)})};SetRegardingLibrary.prototype.setRegardingDialogRegardingChange=function(eventContext){var formContext=eventContext.getFormContext(),setButton=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId),setRegardingLookupControl=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.regardingControlName),regardingValue=setRegardingLookupControl.getAttribute().getValue();if(!regardingValue||regardingValue.length===0)setButton.setDisabled(true);else setButton.setDisabled(false)};SetRegardingLibrary.prototype.setRegardingDialogSetClick=function(eventContext){var formContext=eventContext.getFormContext();if(XrmCore.InternalUtilities.DialogUtilities.isOffline()){XrmCore.InternalUtilities.DialogUtilities.showOfflineError();return}var records=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.Records).getValue(),regardingLookupControl=formContext.getControl(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.regardingControlName),selectedRegardingEntities=regardingLookupControl.getAttribute().getValue(),regardingObjectId=selectedRegardingEntities[0].id,regardingObjectTypeName=selectedRegardingEntities[0].entityType;XrmCore.InternalUtilities.GenericUtilities.showGenericProgressIndicator();var uniqueRecordTypes=records.reduce(function(accumulator,record){accumulator.indexOf(record.TypeName)<0&&accumulator.push(record.TypeName);return accumulator},[]);XrmCore.InternalUtilities.GenericUtilities.createChainedEntityMetadataMapWithCallback(uniqueRecordTypes,0,{},function(entityInfo){if(records.length===1)SetRegardingLibrary.saveRegardingObject(eventContext,records[0].Id,records[0].TypeName,entityInfo[records[0].TypeName].EntitySetName,regardingObjectId,regardingObjectTypeName);else SetRegardingLibrary.saveRegardingMultiple(eventContext,records,entityInfo,regardingObjectId,regardingObjectTypeName)})};SetRegardingLibrary.prototype.setRegardingCloseDialog=function(eventContext){XrmCore.InternalUtilities.DialogUtilities.closeDialog(eventContext)};SetRegardingLibrary.saveRegardingObject=function(eventContext,id,entityName,entitySetName,regardingObjectId,regardingObjectEntityName){var formContext=eventContext.getFormContext(),payloadKey="regardingobjectid_"+regardingObjectEntityName+"_"+entityName+"@odata.bind",payload=(_a={},_a[payloadKey]="/"+entitySetName+"("+regardingObjectId.replace("{","").replace("}","")+")",_a);Xrm.WebApi.online.updateRecord(entityName,id,payload).then(function(){XrmCore.InternalUtilities.DialogUtilities.setLastButtonClicked(eventContext,XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId);Xrm.Utility.closeProgressIndicator();formContext.ui.close()},function(reason){XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(reason);formContext.ui.close()});var _a};SetRegardingLibrary.saveRegardingMultiple=function(eventContext,records,entityInfo,regardingObjectId,regardingObjectTypeName){var formContext=eventContext.getFormContext(),setRegardingBatch=records.map(function(record){var setRegardingRequest=new XrmCore.SdkContracts.SetRegardingRequest(record,regardingObjectTypeName,regardingObjectId,entityInfo[record.TypeName].EntitySetName);return setRegardingRequest});Xrm.WebApi.online.executeMultiple(setRegardingBatch).then(function(success){if(success.every(function(response){return response.ok})){XrmCore.InternalUtilities.DialogUtilities.setLastButtonClicked(eventContext,XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId);Xrm.Utility.closeProgressIndicator();formContext.ui.close()}else SetRegardingLibrary.openAlertDialogForSetRegardingMultipleError(eventContext)},function(error){Xrm.Utility.closeProgressIndicator();XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog(error);formContext.ui.close()})};SetRegardingLibrary.openAlertDialogForSetRegardingMultipleError=function(eventContext){var formContext=eventContext.getFormContext(),dialogText=XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Action_MultipleErrorsFound");Xrm.Navigation.openAlertDialog({text:dialogText});XrmCore.InternalUtilities.DialogUtilities.setLastButtonClicked(eventContext,XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId);Xrm.Utility.closeProgressIndicator();formContext.ui.close()};return SetRegardingLibrary}();Commands.SetRegardingLibrary=SetRegardingLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.SetRegarding=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.SetRegardingLibrary:new Commands.SetRegardingLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var ShareLibraryLegacy=function(){function ShareLibraryLegacy(){}ShareLibraryLegacy.prototype.shareSelectedRecordsLegacy=function(gridControl,selectedRecords,entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.shareSelectedRecords(gridControl,selectedRecords,entityTypeCode):backCompatHeader.Mscrm.GridRibbonActions.shareSelectedRecords(gridControl,selectedRecords,entityTypeCode)};ShareLibraryLegacy.prototype.shareSelectedRecords=function(gridControl,selectedRecords,entityName,defaultCloseState,callback){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false),entityTypeCode=Xrm.Internal.getEntityCode(entityName);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.shareSelectedRecords(gridControl,selectedRecords,entityTypeCode):backCompatHeader.Mscrm.GridRibbonActions.shareSelectedRecords(gridControl,selectedRecords,entityTypeCode)};ShareLibraryLegacy.prototype.isShareValidLegacy=function(selectedEntityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isShareValid(selectedEntityTypeCode):backCompatHeader.Mscrm.RibbonActions.isShareValid(selectedEntityTypeCode)};ShareLibraryLegacy.prototype.isShareValid=function(selectedEntityTypeName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false),selectedEntityTypeCode=Xrm.Internal.getEntityCode(selectedEntityTypeName);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isShareValid(selectedEntityTypeCode):backCompatHeader.Mscrm.RibbonActions.isShareValid(selectedEntityTypeCode)};return ShareLibraryLegacy}();Commands.ShareLibraryLegacy=ShareLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var SHARE_COMPONENT_NAME="Share",ShareLibrary=function(){function ShareLibrary(){var _this=this;this.isShareValidLegacy=function(selectedEntityTypeCode){return _this.isShareValid(Xrm.Internal.getEntityName(selectedEntityTypeCode))};this.isShareValid=function(selectedEntityName){switch(selectedEntityName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ActivityPointer:return false;default:return true}};this.shareSelectedRecordsLegacy=function(gridControl,selectedRecords,entityTypeCode){var entityName=Xrm.Internal.getEntityName(entityTypeCode);_this.shareSelectedRecords(gridControl,selectedRecords,entityName)};this.shareSelectedRecords=function(gridControl,selectedRecords,entityName){var UCIDialogEnabled=Xrm.Internal.isFeatureEnabled("UCIShareDialog")&&Xrm.Internal.isFeatureEnabled("October2021Update");if(UCIDialogEnabled){for(var ids=[],i=0;i<selectedRecords.length;i++)ids[i]=selectedRecords[i].Id;Commands.Common.openUCIShareDialog(entityName,ids,950,500)}else{var forceRefresh=false,callback=null,parameters=[forceRefresh,gridControl,callback];Commands.Common.constructAndOpenLegacyWebDialog(entityName,gridControl,selectedRecords,"dlg_share.aspx",885,500,false,_this.refreshGrid,parameters)}};this.refreshGrid=function(result,forceRefresh,gridControl,requestType,entityName,records){(result||forceRefresh)&&gridControl.refresh()};this.showLegacyShareAndEmailALink=function(entity){var showLegacyButtons=true;try{if(!entity)entity=Xrm.Page.data.entity.getEntityName();var entitiyNames=XrmCore.InternalUtilities.EntityUtilities.EntityNames,allowedEntities=[entitiyNames.Account,entitiyNames.Contact,entitiyNames.Opportunity,entitiyNames.Incident],collabExp=Xrm.Utility.getGlobalContext().organizationSettings["isCollaborationExperienceEnabled"],isNotMobileApp=Xrm.Utility.getGlobalContext().client.getClient()!=Xrm.Constants.ClientNames.mobile,isTabletOrPhoneBrowser=Xrm.Utility.getGlobalContext().client.getFormFactor()>1;if(isNotMobileApp&&!isTabletOrPhoneBrowser&&Xrm.Internal.isFeatureEnabled("CollaborationShare")&&(allowedEntities.indexOf(entity)!==-1||Xrm.Internal.isFeatureEnabled("CollaborationForAllEntity"))&&collabExp)showLegacyButtons=false}catch(e){Xrm.Reporting.reportFailure("ShowLegacyShareAndEmailALink",e,"",null);return showLegacyButtons}return showLegacyButtons}}return ShareLibrary}();Commands.ShareLibrary=ShareLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.Share=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.ShareLibrary:new Commands.ShareLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var AutoSaveLibraryLegacy=function(){function AutoSaveLibraryLegacy(){this.isAutoSaveEnabled=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isAutoSaveEnabled():backCompatHeader.Mscrm.RibbonActions.isAutoSaveEnabled()}}return AutoSaveLibraryLegacy}();Rules.AutoSaveLibraryLegacy=AutoSaveLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var AutoSaveLibrary=function(){function AutoSaveLibrary(){this.isAutoSaveEnabled=function(){return Xrm.Utility.getGlobalContext().organizationSettings.isAutoSaveEnabled}}return AutoSaveLibrary}();Rules.AutoSaveLibrary=AutoSaveLibrary})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.AutoSave=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Rules.AutoSaveLibrary:new Rules.AutoSaveLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var ChartsLibraryLegacy=function(){function ChartsLibraryLegacy(){this.disableButtonsWhenChartMaximized=function(gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.disableButtonsWhenChartMaximized(gridControl):backCompatHeader.Mscrm.GridCommandActions.disableButtonsWhenChartMaximized(gridControl)}}return ChartsLibraryLegacy}();Rules.ChartsLibraryLegacy=ChartsLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var ChartsLibrary=function(){function ChartsLibrary(){this.disableButtonsWhenChartMaximized=function(gridControl){return true}}return ChartsLibrary}();Rules.ChartsLibrary=ChartsLibrary})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.Charts=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Rules.ChartsLibrary:new Rules.ChartsLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var DashboardLibrary=function(){function DashboardLibrary(){this.isDashboardPage=function(){return Xrm.Utility.getGlobalContext().getQueryStringParameters().pageType==="dashboard"}}return DashboardLibrary}();Rules.DashboardLibrary=DashboardLibrary})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.Dashboard=new Rules.DashboardLibrary})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var Enabled=function(){function Enabled(){this.enableImportFromExchange=function(entityTypeName){if(entityTypeName=="contact")return true;else return false}}Enabled.alwaysEnabled=function(){return true};Enabled.neverEnabled=function(){return false};Enabled.enableImportForWeb=function(){if(Xrm.Internal.isUci&&Xrm.Internal.isUci()&&(Xrm.Utility.getGlobalContext().client.getClient()==Xrm.Constants.ClientNames.web||Xrm.Utility.getGlobalContext().client.getClient()==Xrm.Constants.ClientNames.unifiedServiceDesk))return true;else return false};Enabled.enableActivityForWeb=function(){if(Xrm.Internal.isUci&&Xrm.Internal.isUci())if(Xrm.Utility.getGlobalContext().client.getClient()==Xrm.Constants.ClientNames.web)return true;else return false;else return true};Enabled.enableActivityForUnifiedServiceDesk=function(){if(Xrm.Internal.isUci&&Xrm.Internal.isUci())if(Xrm.Utility.getGlobalContext().client.getClient()==Xrm.Constants.ClientNames.unifiedServiceDesk)return true;else return false;else return true};Enabled.enableExportToExcelOnlineForModern=function(){if(Xrm.Internal.isUci&&Xrm.Internal.isUci())return !Xrm.Utility.getGlobalContext().isOnPremises();else return true};Enabled.isReactNativeMobile=function(){var isMobile=Xrm.Utility.getGlobalContext().client.getClient()===Xrm.Constants.ClientNames.mobile,isNative=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i);return isMobile&&isNative!=null&&isNative!=undefined};Enabled.isReactNativeFormEditModeShowCommandBarEnabled=function(){return Xrm.Internal.isFeatureEnabled("ReactNativeFormEditModeShowCommandBar")&&Xrm.Internal.isFeatureEnabled("October2021Update")};Enabled.PrimaryIsNotActivityHomePageGrid=function(entityTypeName,gridControl){if(!Xrm.Utility.isActivityType(entityTypeName))return true;if(Enabled.isCustomActivityEntity(entityTypeName))return true;if(gridControl&&gridControl.getGridType()!=1)return true;return false};Enabled.isCustomActivityEntity=function(entityTypeName){if(Xrm.Internal.isUci&&Xrm.Internal.isUci())Xrm.Utility.getEntityMetadata(entityTypeName).then(function(metadata){return metadata.IsActivity&&metadata.IsCustomEntity});else return false};return Enabled}();Rules.Enabled=Enabled})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var ExportLibraryLegacy=function(){function ExportLibraryLegacy(){}ExportLibraryLegacy.prototype.EnableExportToExcel=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.enableExportToExcel():backCompatHeader.Mscrm.RibbonActions.enableExportToExcel()};ExportLibraryLegacy.prototype.EnabledForXlsxExport=function(gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);return Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.enabledForXlsxExport(gridControl):backCompatHeader.Mscrm.GridRibbonActions.enabledForXlsxExport(gridControl)};ExportLibraryLegacy.prototype.EnableOnlyInBrowsersForModern=function(){return true};return ExportLibraryLegacy}();Rules.ExportLibraryLegacy=ExportLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var ExportLibrary=function(){function ExportLibrary(){}ExportLibrary.prototype.EnableExportToExcel=function(){return true};ExportLibrary.prototype.EnabledForXlsxExport=function(gridControl){return true};ExportLibrary.prototype.EnableOnlyInBrowsersForModern=function(){if(Xrm.Internal.isUci&&Xrm.Internal.isUci())if(Xrm.Utility.getGlobalContext().client.getClient()==Xrm.Constants.ClientNames.web)return true;else return false;else return true};return ExportLibrary}();Rules.ExportLibrary=ExportLibrary})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.Export=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Rules.ExportLibrary:new Rules.ExportLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var HierarchyView=function(){function HierarchyView(){}HierarchyView.isValidForHierarchyView=function(){return true};HierarchyView.isValidForHierarchyPageInUC=function(){return true};return HierarchyView}();Rules.HierarchyView=HierarchyView})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var HierarchyLibraryLegacy=function(){function HierarchyLibraryLegacy(){this.IsRecordHierarchyEnabled=function(selectedControl,selectedControlSelectedItemReferences){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isRecordHierarchyEnabled(selectedControl,selectedControlSelectedItemReferences):backCompatHeader.Mscrm.RibbonActions.isRecordHierarchyEnabled(selectedControl,selectedControlSelectedItemReferences)}}HierarchyLibraryLegacy.prototype.IsFormHierarchyEnabled=function(form){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isFormHierarchyEnabled():backCompatHeader.Mscrm.RibbonActions.isFormHierarchyEnabled()};HierarchyLibraryLegacy.prototype.IsNotHierarchyView=function(selectedControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isNotHierarchyView():backCompatHeader.Mscrm.RibbonActions.isNotHierarchyView()};return HierarchyLibraryLegacy}();Rules.HierarchyLibraryLegacy=HierarchyLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var HierarchyLibrary=function(){function HierarchyLibrary(){}HierarchyLibrary.setHierarchyLibrary=function(success,entityId){HierarchyLibrary.currentEntityId=entityId;HierarchyLibrary.isHierarchial=success};HierarchyLibrary.prototype.IsFormHierarchyEnabled=function(form){return this.isHierarchyEnabled(form.data.entity.getEntityName(),form.data.entity.getId())};HierarchyLibrary.prototype.IsNotHierarchyView=function(selectedControl){if(selectedControl&&selectedControl._controlName)return selectedControl._controlName.indexOf("MscrmControls.HierarchyControl.HierarchyControl")<0;return false};HierarchyLibrary.prototype.IsRecordHierarchyEnabled=function(selectedControl,selectedItemReferences){return this.isHierarchyEnabled(selectedItemReferences[0].TypeName,selectedItemReferences[0].Id)};HierarchyLibrary.prototype.isHierarchyEnabled=function(entity,entityId){if(entityId===HierarchyLibrary.promiseEntityId&&HierarchyLibrary.metadataRequestPromise)return HierarchyLibrary.metadataRequestPromise;try{if(entityId==HierarchyLibrary.currentEntityId)return Promise.resolve(HierarchyLibrary.isHierarchial);else{HierarchyLibrary.promiseEntityId=entityId;return HierarchyLibrary.metadataRequestPromise=Xrm.Utility.getEntityMetadata(entity).then(function(metadata){var entitySetName=metadata.EntitySetName,hierarchicalRelationships=metadata.OneToManyRelationships.get(function(relationship){return relationship.IsHierarchical&&relationship.ReferencedEntity===entity});if(hierarchicalRelationships&&hierarchicalRelationships.length>0)return XrmCore.InternalUtilities.HierarchyUtilities.checkifRecordHierarchyEnabled(entity,entityId,entitySetName,hierarchicalRelationships[0]).then(function(success){HierarchyLibrary.setHierarchyLibrary(success,entityId);HierarchyLibrary.promiseEntityId=null;HierarchyLibrary.metadataRequestPromise=null;return HierarchyLibrary.isHierarchial});else return false})}}catch(ex){return Promise.resolve(false)}};HierarchyLibrary.isHierarchial=false;HierarchyLibrary.currentEntityId="";return HierarchyLibrary}();Rules.HierarchyLibrary=HierarchyLibrary})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.Hierarchy=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Rules.HierarchyLibrary:new Rules.HierarchyLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var OnlineLibraryLegacy=function(){function OnlineLibraryLegacy(){this.IsEntityAvailableForUserInMocaOffline=function(selectedEntityTypeName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);return Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.IsEntityAvailableForUserInMocaOffline(selectedEntityTypeName):backCompatHeader.Mscrm.CommandBarActions.IsEntityAvailableForUserInMocaOffline(selectedEntityTypeName)};this.IsCommandAvailableInMocaOffline=function(boolParam,selectedEntityTypeName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);return Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.IsCommandAvailableInMocaOffline(boolParam,selectedEntityTypeName):backCompatHeader.Mscrm.CommandBarActions.IsCommandAvailableInMocaOffline(boolParam,selectedEntityTypeName)}}return OnlineLibraryLegacy}();Rules.OnlineLibraryLegacy=OnlineLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var OnlineLibrary=function(){function OnlineLibrary(){this.IsCommandAvailableInMocaOffline=function(boolParam,selectedEntityTypeName){return true}}OnlineLibrary.prototype.IsEntityAvailableForUserInMocaOffline=function(selectedEntityTypeName){var isOffline=Xrm.Utility.getGlobalContext().getCurrentAppSettings()&&Xrm.Utility.getGlobalContext().getCurrentAppSettings()["ServerMode"]===false?!Xrm.Utility.getGlobalContext().client.isNetworkAvailable():Xrm.Utility.getGlobalContext().client.getClientState()===Xrm.Constants.ClientStates.offline;if(isOffline)return Xrm.Mobile.offline.isOfflineEnabled(selectedEntityTypeName);return true};OnlineLibrary.prototype.IsCustomActivityAvailableForUserInMocaOffline=function(commandProperties){var isOffline=Xrm.Utility.getGlobalContext().getCurrentAppSettings()&&Xrm.Utility.getGlobalContext().getCurrentAppSettings()["ServerMode"]===false?!Xrm.Utility.getGlobalContext().client.isNetworkAvailable():Xrm.Utility.getGlobalContext().client.getClientState()===Xrm.Constants.ClientStates.offline;if(isOffline){if(commandProperties!=null&&commandProperties["SourceControlId"]!=null){var buttonId=commandProperties["SourceControlId"];if(buttonId.toLowerCase().indexOf("mscrm.dynamicmenu.grid.newcustomactivity")>=0||buttonId.toLowerCase().indexOf("mscrm.dynamicmenu.form.addactivity")>=0||buttonId.toLowerCase().indexOf("mscrm.dynamicmenu.subgrid.newactivitymenu")>=0){var idParts=buttonId.split(".");return Xrm.Mobile.offline.isOfflineEnabled(idParts[idParts.length-1])}}return false}return true};OnlineLibrary.prototype.IsRelationshipEnabledInMocaOffline=function(gridControl){var subGridControl=gridControl;if(Xrm.Utility.getGlobalContext().client.getClientState()===Xrm.Constants.ClientStates.offline){var relationship=subGridControl&&subGridControl.getRelationship?subGridControl.getRelationship():null;if(relationship)return relationship.relationshipType===1?false:true}return true};return OnlineLibrary}();Rules.OnlineLibrary=OnlineLibrary})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.Online=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Rules.OnlineLibrary:new Rules.OnlineLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var OpenLibrary=function(){function OpenLibrary(){this.isQuickActionToOpenRecordInSidePaneEnabled=function(){return !!Xrm.Utility.getGlobalContext().organizationSettings.quickActionToOpenRecordsInSidePaneEnabled}}return OpenLibrary}();Rules.OpenLibrary=OpenLibrary})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.Open=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Rules.OpenLibrary:null})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var RefreshFormLibraryLegacy=function(){function RefreshFormLibraryLegacy(){this.isRefreshForm=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isRefreshForm():backCompatHeader.Mscrm.RibbonActions.isRefreshForm()}}return RefreshFormLibraryLegacy}();Rules.RefreshFormLibraryLegacy=RefreshFormLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var RefreshFormLibrary=function(){function RefreshFormLibrary(){this.isRefreshForm=function(){return true}}return RefreshFormLibrary}();Rules.RefreshFormLibrary=RefreshFormLibrary})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.RefreshForm=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Rules.RefreshFormLibrary:new Rules.RefreshFormLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var RunReportLibraryLegacy=function(){function RunReportLibraryLegacy(){}RunReportLibraryLegacy.prototype.generateReportMenuXml=function(commandProperties,entityLogicalName,isForm,ribbonSelectionControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.generateReportMenuXml(commandProperties,entityLogicalName,isForm,ribbonSelectionControl):backCompatHeader.Mscrm.CommandBarActions.generateReportMenuXml(commandProperties,entityLogicalName,isForm,ribbonSelectionControl)};RunReportLibraryLegacy.prototype.runReport=function(commandProperties,gridControl,recordIds){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.runReport(commandProperties,gridControl,recordIds):backCompatHeader.Mscrm.GridRibbonActions.runReport(commandProperties,gridControl,recordIds)};RunReportLibraryLegacy.prototype.runReportFromFormRibbon=function(commandProperties,formControl,entityLogicalName){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.runReportFromFormRibbon(commandProperties,formControl):backCompatHeader.Mscrm.RibbonActions.runReportFromFormRibbon(commandProperties,formControl)};RunReportLibraryLegacy.prototype.viewReport=function(gridControl,records){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.ReportActions?Mscrm.ReportActions.viewReport(gridControl,records):backCompatHeader.Mscrm.ReportActions.viewReport(gridControl,records)};RunReportLibraryLegacy.prototype.editReportFilter=function(gridControl,records){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.ReportActions?Mscrm.ReportActions.editReportFilter(gridControl,records):backCompatHeader.Mscrm.ReportActions.editReportFilter(gridControl,records)};RunReportLibraryLegacy.prototype.editReport=function(gridControl,records,entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(true);Mscrm&&Mscrm.ReportActions?Mscrm.ReportActions.editReport(gridControl,records,entityTypeCode):backCompatHeader.Mscrm.ReportActions.editReport(gridControl,records,entityTypeCode)};return RunReportLibraryLegacy}();Commands.RunReportLibraryLegacy=RunReportLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){var RunReportLibrary=function(){function RunReportLibrary(){var _this=this;this.generateReportMenuXml=function(commandProperties,entityLogicalName,isForm,ribbonSelectionControl){var contextType=0,ribbonRelationshipType=-1,reportVisibilityCode=3;if(isForm){contextType=1;reportVisibilityCode=2}else if(ribbonSelectionControl.getGridType()===3){contextType=2;reportVisibilityCode=3;var relationship=ribbonSelectionControl.getRelationship();if(relationship!==null&&relationship.relationshipType===0)ribbonRelationshipType=0;else if(relationship!==null&&relationship.relationshipType===1)ribbonRelationshipType=1}var deferred=XrmCore.InternalUtilities.ReportsUtilites.retrieveReportsForEntity(entityLogicalName,reportVisibilityCode),menu=Promise.all([deferred]).then(function(_a){var reports=_a[0];Commands.logRetrieveReportsSuccess(entityLogicalName,reportVisibilityCode,ribbonRelationshipType);RunReportLibrary._reports=reports;return _this._buildMenu(commandProperties,reports,entityLogicalName,isForm,contextType,ribbonRelationshipType)},function(error){Commands.logRetrieveReportsFailure(error,entityLogicalName,null,reportVisibilityCode,ribbonRelationshipType)});commandProperties["PopulationXML"]=menu};this._buildMenu=function(commandProperties,reports,entityLogicalName,isForm,ribbonContextType,ribbonRelationshipType){var sourceControlId=commandProperties["SourceControlId"],menuId=sourceControlId+".Menu",menuSections=[],reportsCommandId=XrmCore.InternalUtilities.ReportsUtilites.determineReportsCommandId(entityLogicalName,isForm,ribbonContextType,ribbonRelationshipType),sectionIndex=0;if(reports&&reports.length>0){var reportsSections=XrmCore.InternalUtilities.ReportsUtilites.divideReportsIntoFilterableAndNon(reports);if(reportsSections["filterableReports"].length>0){var filterableReportsSection=XrmCore.InternalUtilities.ReportsUtilites.createMenuSection(menuId,reportsSections["filterableReports"],reportsCommandId,sectionIndex,true);menuSections.push(filterableReportsSection);sectionIndex=sectionIndex+1}if(reportsSections["nonFilterableReports"].length>0){var nonFilterableReportsSection=XrmCore.InternalUtilities.ReportsUtilites.createMenuSection(menuId,reportsSections["nonFilterableReports"],reportsCommandId,sectionIndex,false);menuSections.push(nonFilterableReportsSection)}}else{var noReportsSection=XrmCore.InternalUtilities.ReportsUtilites.createMenuSection(menuId,null,reportsCommandId,sectionIndex,false);menuSections.push(noReportsSection)}var menu=XrmCore.InternalUtilities.ReportsUtilites.buildMenu(menuId,menuSections);return menu};this.NewReport=function(entityTypeName,gridControl){var page="/crmreports/reportproperty.aspx",actionUri=Xrm.Utility.getGlobalContext().prependOrgName(page);Commands.logReportEvent(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DefaultGuidString,Xrm.Internal.getEntityCode(entityTypeName),null,"newreport");_this.openLegacyReportPropertyPage(actionUri,gridControl,"_blank")}}RunReportLibrary.prototype.runReportFromFormRibbon=function(commandProperties,formControl,entityCode){var reportId=XrmCore.InternalUtilities.ReportsUtilites.getReportIdFromSourceControlId(commandProperties["SourceControlId"]),reportEntity=RunReportLibrary._getReport(reportId);this.runFormsReport(reportEntity.Isfilterable,reportId,reportEntity.ReportTypeCode,reportEntity.Name,reportEntity.Filename,formControl.entityReference,entityCode)};RunReportLibrary.prototype.runFormsReport=function(filterable,reportId,reportType,reportName,reportFilename,entityReference,entityTypeCode){Commands.logReportEvent(reportId,entityTypeCode,reportType,"run_reportonentityform");if(filterable){var uri=XrmCore.InternalUtilities.ReportsUtilites.getCrmUri(XrmCore.InternalUtilities.ReportsUtilites.reportViewerBaseUri)+"?id="+reportId+"&action=run&context=records&recordstype="+entityTypeCode+"&records="+Xrm.Page.data.entity.getId()+"&helpID="+reportFilename;window.parent.open(uri,"_blank")}else this._openReportBasedOnType(reportId,"run",reportName,reportFilename,reportType,null)};RunReportLibrary.prototype.viewReport=function(gridControl,records){this._openReport(gridControl,records,"run")};RunReportLibrary.prototype.editReportFilter=function(gridControl,records){XrmCore.InternalUtilities.DialogUtilities.isAllowLegacyDialogsEmbedding()&&this._openReport(gridControl,records,"editfilter")};RunReportLibrary.prototype.openRecordItem=function(gridControl,records){XrmCore.InternalUtilities.DialogUtilities.isAllowLegacyDialogsEmbedding()&&this._openReport(gridControl,records,"filter")};RunReportLibrary.prototype._openReport=function(gridControl,records,reportWindowType){var _this=this,record;if(records.length===1){var reportRecord_1=records[0],gridEntity=gridControl.getGrid().getRows().get(reportRecord_1.Id).data.entity,reportEntity=gridEntity,reportName=reportEntity.attributes.get("name"),reportFileName=reportEntity.attributes.get("filename"),reportTypecode=reportEntity.attributes.get("reporttypecode");if(reportName&&reportTypecode&&reportFileName){var reportTypecodeValue=reportTypecode.getValue(),reportFileNameValue=reportFileName.getValue(),reportNameValue=reportName.getValue();Commands.logReportEvent(reportRecord_1.Id,Xrm.Internal.getEntityCode(reportRecord_1.TypeName),reportTypecodeValue,reportWindowType+"_onreportgrid");this._openReportBasedOnType(reportRecord_1.Id,reportWindowType,reportNameValue,reportFileNameValue,reportTypecodeValue,reportEntity)}else Xrm.WebApi.retrieveRecord("report",reportRecord_1.Id,"?$select=name,filename,reporttypecode,bodyurl,bodybinary,filesize,mimetype").then(function(reportEntityRecord){if(reportEntityRecord!=null){var reportNameValue=reportEntityRecord["name"]!=null?reportEntityRecord["name"].toString():null,reportFileNameValue=reportEntityRecord["filename"]!=null?reportEntityRecord["filename"].toString():null,reportTypecodeValue=reportEntityRecord["reporttypecode"]!=null?reportEntityRecord["reporttypecode"]:null;Commands.logReportEvent(reportRecord_1.Id,Xrm.Internal.getEntityCode(reportRecord_1.TypeName),reportTypecodeValue,reportWindowType+"_onreportgrid");_this._openReportBasedOnType(reportRecord_1.Id,reportWindowType,reportNameValue,reportFileNameValue,reportTypecodeValue,reportEntityRecord)}},function(error){Commands.logRetrieveReportsFailure(error,"report",reportRecord_1.Id,null,null)})}};RunReportLibrary.prototype._openReportBasedOnType=function(reportRecordId,reportWindowType,reportNameValue,reportFileNameValue,reportTypecodeValue,reportEntityRecord){var reportURL=XrmCore.InternalUtilities.ReportsUtilites.getCrmUri("/crmreports/viewer/viewer.aspx?action="+encodeURIComponent(reportWindowType)+"&id="+encodeURIComponent(reportRecordId)+"&helpID="+encodeURIComponent(reportFileNameValue));switch(reportTypecodeValue){case 1:var globalContext=Xrm.Utility.getGlobalContext();globalContext.getCurrentAppProperties().then(function(appProperties){if(appProperties["appId"])reportURL=reportURL.concat("&appid=",encodeURIComponent(appProperties["appId"]));window.parent.open(reportURL,"_blank");var recent={entityTypeName:"report",objectId:reportRecordId,pinStatus:false,recordType:"Entity",title:reportNameValue};Xrm.Internal.addRecentItem(recent)},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog);break;case 2:if(reportWindowType==="editfilter")Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web.Reports.NonSRSReportFilterSchedule")});else this._DownloadReport(reportEntityRecord,reportRecordId);break;case 3:if(reportWindowType==="editfilter")Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web.Reports.NonSRSReportFilterSchedule")});else window.parent.open(reportURL,"_blank");break;case 4:Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Web.Reports.UnsupportedReportType")});break;default:break}};RunReportLibrary.prototype._DownloadReport=function(reportEntityRecord,reportRecordId){var _this=this;if(reportEntityRecord&&reportEntityRecord["bodybinary"]!=null&&reportEntityRecord["filename"]!=null&&reportEntityRecord["filesize"]!=null&&reportEntityRecord["mimetype"]!=null)this._DownloadReportHelper(reportEntityRecord);else Xrm.WebApi.retrieveRecord("report",reportRecordId,"?$select=filename,reporttypecode,bodyurl,bodybinary,filesize,mimetype").then(function(reportEntityRecord){reportEntityRecord!=null&&_this._DownloadReportHelper(reportEntityRecord)},function(error){Commands.logRetrieveReportsFailure(error,"report",reportRecordId,null,null)})};RunReportLibrary.prototype._DownloadReportHelper=function(reportEntityRecord){if(reportEntityRecord){var file={fileContent:reportEntityRecord["bodybinary"]!=null?reportEntityRecord["bodybinary"].toString():null,fileName:reportEntityRecord["filename"]!=null?reportEntityRecord["filename"].toString():null,fileSize:reportEntityRecord["filesize"]!=null?reportEntityRecord["filesize"]:null,mimeType:reportEntityRecord["mimetype"]!=null?reportEntityRecord["mimetype"].toString():null},openMode={openMode:2};Xrm.Navigation.openFile(file,openMode)}};RunReportLibrary.prototype.runReport=function(commandProperties,gridControl,recordIds,entityCode){if(recordIds==null)recordIds=[];var reportId=XrmCore.InternalUtilities.ReportsUtilites.getReportIdFromSourceControlId(commandProperties["SourceControlId"]),reportEntity=RunReportLibrary._getReport(reportId),parameters={GridControl:gridControl,ReportEntity:reportEntity,RecordIds:recordIds,EntityTypeCode:entityCode};if(reportEntity.Isfilterable){Commands.logReportEvent(reportId,entityCode,parameters.ReportEntity.ReportTypeCode,"RunReportCommandButtonOnEntityGridInitiated");var numRecordsSelected=recordIds.length,enableView=XrmCore.InternalUtilities.ReportsUtilites.isEffectiveFetchXmlFinal(gridControl),dialogUrl=XrmCore.InternalUtilities.ReportsUtilites.getRunReportDialogUrl(reportId,numRecordsSelected,enableView),options={position:1,width:450,height:400},dialogArguments={uciCallback:this.performActionAfterRunReport,callbackParameters:parameters};Commands.Common.appendAppIdAndOpenLegacyWebDialog(dialogUrl,options,dialogArguments,null)}else this.performActionAfterRunReport(2,parameters)};RunReportLibrary.prototype.performActionAfterRunReport=function(runMode,parameters){var uri=XrmCore.InternalUtilities.ReportsUtilites.getCrmUri(XrmCore.InternalUtilities.ReportsUtilites.reportViewerBaseUri),fetchXml=parameters.GridControl.getFetchXml(),form;if(parameters.ReportEntity.Isfilterable){if(runMode==null)runMode=-1;Commands.logRunReportOnEntityGrid(parameters,runMode);if(runMode==-1)return;switch(runMode){case 0:var sb=[],recordIds=parameters.RecordIds;if(recordIds)for(var i=0;i<recordIds.length;i++){i>0&&sb.push(";");sb.push(recordIds[i])}form=XrmCore.InternalUtilities.ReportsUtilites.CreateViewReportForm(uri,parameters.ReportEntity.ReportId,parameters.ReportEntity.Filename,"records","recordstype="+parameters.EntityTypeCode);XrmCore.InternalUtilities.ReportsUtilites.addFormParameter(form,"records",sb.join(""));Commands.logReportEvent(parameters.ReportEntity.ReportId,parameters.EntityTypeCode,null,"run_filterablereport_onentitygrid_forselectedrecords: "+sb.join(","));break;case 1:form=XrmCore.InternalUtilities.ReportsUtilites.CreateViewReportForm(uri,parameters.ReportEntity.ReportId,parameters.ReportEntity.Filename,"fetch");XrmCore.InternalUtilities.ReportsUtilites.addFormParameter(form,"fetchxml",fetchXml);Commands.logReportEvent(parameters.ReportEntity.ReportId,parameters.EntityTypeCode,null,"run_filterablereport_onentitygrid_forfetchxml: "+fetchXml);break;case 2:default:var reportURL_1=XrmCore.InternalUtilities.ReportsUtilites.getCrmUri("/crmreports/viewer/viewer.aspx?action=run&id="+parameters.ReportEntity.ReportId+"&helpID="+parameters.ReportEntity.Filename);Commands.logReportEvent(parameters.ReportEntity.ReportId,parameters.EntityTypeCode,null,"run_filterablereport_onentitygrid_forallrecords_BeforeOpen");var globalContext=Xrm.Utility.getGlobalContext();globalContext.getCurrentAppProperties().then(function(appProperties){if(appProperties["appId"])reportURL_1=reportURL_1.concat("&appid=",encodeURIComponent(appProperties["appId"]));window.parent.open(reportURL_1,"_blank");Commands.logReportEvent(parameters.ReportEntity.ReportId,parameters.EntityTypeCode,null,"run_filterablereport_onentitygrid_forallrecords_AfterOpen");var recent={entityTypeName:"report",objectId:parameters.ReportEntity.ReportId,pinStatus:false,recordType:"Entity",title:parameters.ReportEntity.Name};Xrm.Internal.addRecentItem(recent)},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog);break}}else{var reportViewType=parameters.ReportEntity.ReportTypeCode;Commands.logReportEvent(parameters.ReportEntity.ReportId,parameters.EntityTypeCode,reportViewType,"run_nonfilterablereport_onentitygrid");this._openReportBasedOnType(parameters.ReportEntity.ReportId,"run",parameters.ReportEntity.Name,parameters.ReportEntity.Filename,reportViewType,null)}if(form){var globalContext=Xrm.Utility.getGlobalContext();globalContext.getCurrentAppProperties().then(function(appProperties){var reportURL=form["action"];if(appProperties["appId"])reportURL=reportURL.concat("&appid=",encodeURIComponent(appProperties["appId"]));form.setAttribute("action",reportURL);form.setAttribute("target","_blank");form.submit()},XrmCore.InternalUtilities.DialogUtilities.createActionFailedErrorDialog)}};RunReportLibrary._getReport=function(reportID){for(var i=0;i<RunReportLibrary._reports.length;i++)if(RunReportLibrary._reports[i].ReportId===reportID)return RunReportLibrary._reports[i]};RunReportLibrary.prototype.editReport=function(gridControl,records,entityTypeCode){var record;if(records.length===1){var reportRecord=records[0],page="/crmreports/reportproperty.aspx",actionUri=Xrm.Utility.getGlobalContext().prependOrgName(page),parameterToEncode=(new String).concat("{",reportRecord.Id.toString(),"}");actionUri=actionUri.concat("?id=",encodeURIComponent(parameterToEncode));Commands.logReportEvent(reportRecord.Id.toString(),entityTypeCode,null,"editreport");this.openLegacyReportPropertyPage(actionUri,gridControl,reportRecord.Id.toString())}};RunReportLibrary.prototype.openLegacyReportPropertyPage=function(actionUri,gridControl,name){var options={position:1,width:window.parent.innerHeight,height:window.parent.innerWidth},reportwindow=window.open(actionUri,name,"width="+options.width+", height="+options.height+", resizable=1, align-item=center, justify-content=center");window.onmessage=function(e){gridControl.refresh()}};RunReportLibrary._reports=[];return RunReportLibrary}();Commands.RunReportLibrary=RunReportLibrary})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){Commands.RunReport=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Commands.RunReportLibrary:new Commands.RunReportLibraryLegacy})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var InternalUtilities;(function(InternalUtilities){var ReportsUtilites=function(){function ReportsUtilites(){}ReportsUtilites.buildControlsForRunReports=function(menuId,reports,commandId){var buttons=[],controlsPrefix=menuId+".Filtered.Controls",image="Report";if(reports&&reports.length>0)for(var i=0;i<reports.length;i++){var button={ControlType:"Button",Id:controlsPrefix+".{"+reports[i].ReportId+"}",Command:commandId,Sequence:String(i*10+10),ToolTipDescription:reports[i].Name,Alt:reports[i].Name,LabelText:reports[i].Name,ModernImage:image};buttons.push(button)}var controls={Id:controlsPrefix,Items:buttons};return controls};ReportsUtilites.GridViewReportId="gridViewReport";ReportsUtilites.reportViewerBaseUri="/crmreports/viewer/viewer.aspx";ReportsUtilites.retrieveReportsForEntity=function(entityTypeName,reportVisibilityCode){var entityTypeCode=Xrm.Internal.getEntityCode(entityTypeName),fetchXml='<fetch mapping="logical">\n\t\t\t<entity name="report">\n\t\t\t<attribute name="name" /><attribute name="reporttypecode" /><attribute name="reportid" /><attribute name="filename" />\n\t\t\t<attribute name="bodyurl" />\n\t\t\t<order attribute="name" descending="false" />\n\t\t\t<filter type="and"><condition attribute="languagecode" operator="eq-userlanguage" /></filter>\n\t\t\t<link-entity alias="reportreportidreportentityreportid" name="reportentity" from="reportid" to="reportid">\n\t\t\t<attribute name="isfilterable" />\n\t\t\t<filter type="and"><condition attribute="objecttypecode" operator="eq" value="'+entityTypeCode+'"/></filter>\n\t\t\t</link-entity>\n\t\t\t<link-entity alias="reportreportidreportvisibilityreportid" name="reportvisibility" from="reportid" to="reportid">\n\t\t\t<filter type="and"><condition attribute="visibilitycode" operator="eq" value="'+reportVisibilityCode+'"/>\n\t\t\t</filter>\n\t\t\t</link-entity>\n\t\t\t</entity>\n\t\t\t</fetch>',deferred=Xrm.WebApi.online.retrieveMultipleRecords(InternalUtilities.EntityUtilities.EntityNames.Report,"?fetchXml="+fetchXml).then(function(response){for(var reports=[],templates=response.entities,i=0;i<templates.length;i++){var curT={ReportId:templates[i].reportid,Name:templates[i].name,Filename:templates[i].filename,Bodyurl:templates[i].bodyurl,ReportTypeCode:templates[i].reporttypecode,Isfilterable:templates[i]["reportreportidreportentityreportid.isfilterable"]};reports.push(curT)}return reports},function(e){console.error(e)});return deferred};ReportsUtilites.createMenuSection=function(menuId,reports,reportsCommandId,sectionIndex,filterableSection){var filterableReportsControl=ReportsUtilites.buildControlsForRunReports(menuId,reports,reportsCommandId);return InternalUtilities.ReportsUtilites.buildMenuSection(menuId,filterableSection,sectionIndex*10+10,filterableReportsControl)};ReportsUtilites.buildMenuSection=function(menuId,filterable,sequenceNum,controls){var runOnCurrentRecordLabel=Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Group_ParameterizedReportsForm"),sectionStr="",titleStr="";if(controls&&controls.Items&&controls.Items.length>0)if(filterable){titleStr=Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Group_ParameterizedReports");sectionStr="filterable"}else{titleStr=Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Group_GlobalReports");sectionStr="nonFilterable"}else{titleStr=Xrm.Utility.getResourceString("Main_system_library","Ribbon.ReportMenu.NoReportsAvailable");sectionStr="noReports"}var section={Id:menuId+"."+sectionStr,Sequence:String(sequenceNum),DisplayMode:6,Title:titleStr,Item:controls};return section};ReportsUtilites.buildMenu=function(menuId,menuSections){var menu={Id:menuId,MenuSection:menuSections};return menu};ReportsUtilites.determineReportsCommandId=function(entityLogicalName,isForm,ribbonContextType,ribbonRelationshipType){var relType="NoRelationship";if(ribbonRelationshipType===0)relType="OneToMany";else if(ribbonRelationshipType===1)relType="ManyToMany";var ribbonContext="SubGridAssociated";if(isForm)ribbonContext="Form";else if(ribbonContextType==0)ribbonContext="HomePageGrid";var docStr="ReportsMenu",opStr="RunReport",contextStr=isForm?"Form":"Grid",cmdStr=entityLogicalName+"|"+relType+"|"+ribbonContext+"|Mscrm."+docStr+"."+opStr+"."+contextStr;return cmdStr};ReportsUtilites.getReportIdFromSourceControlId=function(sourceControlId){return sourceControlId.substring(sourceControlId.length-37).slice(0,-1)};ReportsUtilites.getCrmUri=function(path){if(Xrm.Utility.getGlobalContext().isOnPremises&&Xrm.Utility.getGlobalContext().getOrgUniqueName)return Xrm.Utility.getGlobalContext().prependOrgName(path)};ReportsUtilites.CreateViewReportForm=function(uri,reportId,fileName,context,contextQuery){var form=document.getElementsByName(ReportsUtilites.GridViewReportId)[0];if(form)form=ReportsUtilites._clearFormParameters(form);else{form=document.createElement("form");form.setAttribute("name",ReportsUtilites.GridViewReportId);form.setAttribute("method","post");form.setAttribute("style","display: none");form=document.body.appendChild(form)}uri=uri+("?action=run&id="+reportId+"&helpID="+fileName);if(context!=null)uri=uri+("&context="+context);if(contextQuery!=null)uri=uri+("&"+contextQuery);form.setAttribute("action",uri);return form};ReportsUtilites.addFormParameter=function(form,paramName,paramValue){var inputElement=document.createElement("input");inputElement.value=paramValue;inputElement.name=paramName;form.appendChild(inputElement);return form};ReportsUtilites.isEffectiveFetchXmlFinal=function(gridControl){return true};ReportsUtilites.getRunReportDialogUrl=function(reportId,numRecordsSelected,enableView){var view=enableView?1:0;return ReportsUtilites.getCrmUri("/_grid/cmds/dlg_runreport.aspx?id="+reportId+"&numselected="+numRecordsSelected+"&enableview="+view)};ReportsUtilites.divideReportsIntoFilterableAndNon=function(reports){for(var filterableReports=[],nonFilterableReports=[],i=0;i<reports.length;i++)if(reports[i].Isfilterable)filterableReports.push(reports[i]);else nonFilterableReports.push(reports[i]);return {filterableReports:filterableReports,nonFilterableReports:nonFilterableReports}};ReportsUtilites._clearFormParameters=function(form){if(form&&form.children)for(var i=form.children.length-1;i>=0;i--)form.removeChild(form.children[i]);return form};return ReportsUtilites}();InternalUtilities.ReportsUtilites=ReportsUtilites})(InternalUtilities=XrmCore.InternalUtilities||(XrmCore.InternalUtilities={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Commands;(function(Commands){function _getEventParam(eventName,eventValue){var eventParam={name:eventName,value:eventValue};return eventParam}function _reportingAvailable(){if(Xrm!=null&&Xrm.Reporting!=null)return true;return false}function logRetrieveReportsSuccess(entityLogicalName,reportVisibilityCode,ribbonRelationshipType){if(_reportingAvailable()){var eventParams=[];eventParams.push(_getEventParam("entityLogicalName",entityLogicalName));eventParams.push(_getEventParam("reportVisibilityCode",reportVisibilityCode.toString()));eventParams.push(_getEventParam("ribbonRelationshipType",ribbonRelationshipType.toString()));Xrm.Reporting.reportSuccess("RetrieveReports",eventParams)}}Commands.logRetrieveReportsSuccess=logRetrieveReportsSuccess;function logRetrieveReportsFailure(error,entityLogicalName,reportId,reportVisibilityCode,ribbonRelationshipType){var errorMessage;if(error.message&&error.message!=null&&error.message!="")errorMessage=error.message;else if(error.innerror&&error.innerror.message&&error.innerror.message!=null&&error.innerror.message!="")errorMessage=error.innerror.message;else errorMessage="Retrieve Reports Failed with unknown error";if(_reportingAvailable()){var errorParam={name:"ErrorResponse",message:errorMessage},eventParams=[];entityLogicalName?eventParams.push(_getEventParam("entityLogicalName",entityLogicalName)):null;reportVisibilityCode?eventParams.push(_getEventParam("reportVisibilityCode",reportVisibilityCode.toString())):null;ribbonRelationshipType?eventParams.push(_getEventParam("ribbonRelationshipType",ribbonRelationshipType.toString())):null;reportId?eventParams.push(_getEventParam("reportId",reportId)):null;Xrm.Reporting.reportFailure("RetrieveReports",errorParam,"",eventParams)}}Commands.logRetrieveReportsFailure=logRetrieveReportsFailure;function logRunReportOnEntityGrid(parameters,runMode){parameters&&parameters.ReportEntity&&_logReportEvent(parameters.ReportEntity.ReportId,parameters.EntityTypeCode,null,runMode,"run_reportonentitygrid")}Commands.logRunReportOnEntityGrid=logRunReportOnEntityGrid;function logReportEvent(reportId,entityTypeCode,reportTypecodeValue,eventDetail){_logReportEvent(reportId,entityTypeCode,reportTypecodeValue,null,eventDetail)}Commands.logReportEvent=logReportEvent;function _logReportEvent(reportId,entityTypeCode,reportTypecodeValue,runMode,eventDetail){if(_reportingAvailable()){var eventParams=[];entityTypeCode?eventParams.push(_getEventParam("EntityTypeCode",entityTypeCode.toString())):null;reportTypecodeValue?eventParams.push(_getEventParam("ReportTypecodeValue",reportTypecodeValue.toString())):null;runMode?eventParams.push(_getEventParam("RunMode",runMode.toString())):null;eventDetail?eventParams.push(_getEventParam("EventDetail",eventDetail)):null;var applicationEvent={eventName:"ucissrsreports",eventParameters:eventParams};if(reportId){eventParams.push(_getEventParam("ReportId",reportId));Xrm.Reporting.reportEvent(applicationEvent)}else{var errorParam={name:"ErrorResponse",message:"ReportId is null"};Xrm.Reporting.reportFailure("RetrieveReports",errorParam,"",eventParams)}}}})(Commands=XrmCore.Commands||(XrmCore.Commands={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var SaveAsLibraryLegacy=function(){function SaveAsLibraryLegacy(){var _this=this;this.isBulkSaveAsCancelledValid=function(entityTypeName){return _this.isBulkSaveAsCancelledValidLegacy(Xrm.Internal.getEntityCode(entityTypeName))};this.isBulkSaveAsCompletedValid=function(entityTypeName){return _this.isBulkSaveAsCompletedValidLegacy(Xrm.Internal.getEntityCode(entityTypeName))};this.canMarkComplete=function(records){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.canMarkComplete(records):backCompatHeader.Mscrm.GridRibbonActions.canMarkComplete(records)};this.isBulkSaveAsCancelledValidLegacy=function(entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.isBulkSaveAsCancelledValid(entityTypeCode):backCompatHeader.Mscrm.GridRibbonActions.isBulkSaveAsCancelledValid(entityTypeCode)};this.isBulkSaveAsCompletedValidLegacy=function(entityTypeCode){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.isBulkSaveAsCompletedValid(entityTypeCode):backCompatHeader.Mscrm.GridRibbonActions.isBulkSaveAsCompletedValid(entityTypeCode)}}return SaveAsLibraryLegacy}();Rules.SaveAsLibraryLegacy=SaveAsLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var SaveAsLibrary=function(){function SaveAsLibrary(){var _this=this;this.isBulkSaveAsCancelledValid=function(entityTypeName){if(XrmCore.InternalUtilities.DialogUtilities.isMobileCompanionApp())return true;if(Xrm.Utility.isActivityType(entityTypeName)||entityTypeName===Xrm.Constants.EntityNames.ActivityPointer)return !(entityTypeName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.RecurringAppointmentMaster||entityTypeName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.Email);else return false};this.isBulkSaveAsCompletedValid=function(entityTypeName){if(XrmCore.InternalUtilities.DialogUtilities.isMobileCompanionApp())return true;if(Xrm.Utility.isActivityType(entityTypeName)||entityTypeName===Xrm.Constants.EntityNames.ActivityPointer)return !(entityTypeName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.RecurringAppointmentMaster||entityTypeName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignActivity||entityTypeName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignResponse||entityTypeName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.Email);else return false};this.canMarkComplete=function(records){for(var i=0;i<records.length;i++){var typeName=records[i].TypeName;if(typeName!==XrmCore.InternalUtilities.EntityUtilities.EntityNames.Email&&typeName!==XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignActivity&&typeName!==XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignResponse)return true}return false};this.isBulkSaveAsCancelledValidLegacy=function(entityTypeCode){var entityName=Xrm.Internal.getEntityName(entityTypeCode);return _this.isBulkSaveAsCancelledValid(entityName)};this.isBulkSaveAsCompletedValidLegacy=function(entityTypeCode){var entityName=Xrm.Internal.getEntityName(entityTypeCode);return _this.isBulkSaveAsCompletedValid(entityName)}}return SaveAsLibrary}();Rules.SaveAsLibrary=SaveAsLibrary})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.SaveAs=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Rules.SaveAsLibrary:new Rules.SaveAsLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var SetRegardingLibraryLegacy=function(){function SetRegardingLibraryLegacy(){}SetRegardingLibraryLegacy.prototype.isBulkSetRegardingValid=function(entityTypeName,records){var entityTypeCode=Xrm.Internal.getEntityCode(entityTypeName),backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.GridCommandActions?Mscrm.GridCommandActions.isBulkSetRegardingValid(entityTypeCode,records):backCompatHeader.Mscrm.GridCommandActions.isBulkSetRegardingValid(entityTypeCode,records)};SetRegardingLibraryLegacy.prototype.disableForSocialActivityView=function(gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.GridRibbonActions?Mscrm.GridRibbonActions.disableForSocialActivityView(gridControl):backCompatHeader.Mscrm.GridRibbonActions.disableForSocialActivityView(gridControl)};return SetRegardingLibraryLegacy}();Rules.SetRegardingLibraryLegacy=SetRegardingLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var SetRegardingLibrary=function(){function SetRegardingLibrary(){}SetRegardingLibrary.prototype.isBulkSetRegardingValid=function(entityName,records){if(Xrm.Utility.isActivityType(entityName)||entityName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.ActivityPointer)switch(entityName){case XrmCore.InternalUtilities.EntityUtilities.EntityNames.ActivityPointer:for(var key in records){var record=records[key];if(record.logicalName===XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignActivity)return false}return true;case XrmCore.InternalUtilities.EntityUtilities.EntityNames.RecurringAppointmentMaster:case XrmCore.InternalUtilities.EntityUtilities.EntityNames.CampaignActivity:return false;default:return true}return false};SetRegardingLibrary.prototype.disableForSocialActivityView=function(gridControl){if(gridControl&&gridControl.getViewSelector&&gridControl.getViewSelector()&&gridControl.getViewSelector().getCurrentView&&gridControl.getViewSelector().getCurrentView())return ["{E3CA8AD6-C682-4383-B54E-82641EF83206}","{DB576E56-6591-402D-848B-D6F9D626DAA3}","{AE2B791C-8210-49D3-BA16-3110AF6864A4}","{3354F296-99AF-45EF-8223-88ED59A7F478}","{C26EF3A5-0D49-42D3-ABD9-0D75E5F849E3}","{9E28442C-413E-4E5B-B3ED-1DCFFE9F43A9}","{CE7337DF-90B4-4940-8751-0C7BF8CD50EB}","{436918CB-693E-43F1-AE90-48AE3FA21C61}","{DF8137B5-B580-4806-8A26-385B83CFB5BF}"].indexOf(gridControl.getViewSelector().getCurrentView().id)!==-1;return false};return SetRegardingLibrary}();Rules.SetRegardingLibrary=SetRegardingLibrary})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.SetRegarding=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Rules.SetRegardingLibrary:new Rules.SetRegardingLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.SharePointFCBLegacy="FCB.SharePointS2S";var SharePointDocumentLibraryLegacy=function(){function SharePointDocumentLibraryLegacy(){}SharePointDocumentLibraryLegacy.prototype.areSelectedLocationsSame=function(gridControl,records){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.areSelectedLocationsSame(gridControl,records):backCompatHeader.Mscrm.GridCommandActions.areSelectedLocationsSame(gridControl,records)};SharePointDocumentLibraryLegacy.prototype.isDocumentNotFromSharedLocation=function(gridControl,records){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isDocumentNotFromSharedLocation(gridControl,records):backCompatHeader.Mscrm.GridCommandActions.isDocumentNotFromSharedLocation(gridControl,records)};SharePointDocumentLibraryLegacy.prototype.isSharePointSiteConfigured=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isSharePointSiteConfigured():backCompatHeader.Mscrm.GridCommandActions.isSharePointSiteConfigured()};SharePointDocumentLibraryLegacy.prototype.isRecordHasActiveSharePointDocLocation=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isRecordHasActiveSharePointDocLocation():backCompatHeader.Mscrm.GridCommandActions.disableButtonsWhenChartMaximized()};SharePointDocumentLibraryLegacy.prototype.isRecordHasActiveOrRenamedSharePointDocLocation=function(){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isRecordHasActiveOrRenamedSharePointDocLocation():backCompatHeader.Mscrm.GridCommandActions.isRecordHasActiveOrRenamedSharePointDocLocation()};SharePointDocumentLibraryLegacy.prototype.isDocumentRecommendationsEnabledForEntity=function(gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.CommandBarActions?Mscrm.CommandBarActions.isDocumentRecommendationsEnabledForEntity(gridControl):backCompatHeader.Mscrm.CommandBarActions.isDocumentRecommendationsEnabledForEntity(gridControl)};SharePointDocumentLibraryLegacy.prototype.isFolderNotSelected=function(gridControl,records){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.CommandBarActions?Mscrm.RibbonActions.isFolderNotSelected(gridControl,records):backCompatHeader.Mscrm.CommandBarActions.isFolderNotSelected(gridControl,records)};SharePointDocumentLibraryLegacy.prototype.isDocumentAssociatedGridViewSelected=function(gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.CommandBarActions?Mscrm.RibbonActions.isDocumentAssociatedGridViewSelected(gridControl):backCompatHeader.Mscrm.CommandBarActions.isDocumentAssociatedGridViewSelected(gridControl)};SharePointDocumentLibraryLegacy.prototype.isSharePointDocLocationNotSharedOrAllFiles=function(gridControl){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.RibbonActions?Mscrm.RibbonActions.isSharePointDocLocationNotSharedOrAllFiles():backCompatHeader.Mscrm.GridCommandActions.isSharePointDocLocationNotSharedOrAllFiles()};SharePointDocumentLibraryLegacy.prototype.hideCommand=function(){return false};SharePointDocumentLibraryLegacy.prototype.hideCommandForServiceAppointmentEntity=function(){return Xrm.Page.data.entity.getEntityName()==="serviceappointment"?false:true};SharePointDocumentLibraryLegacy.prototype.isSharePointEnabled=function(){return Xrm.Internal.isFeatureEnabled(Rules.SharePointFCBLegacy)};return SharePointDocumentLibraryLegacy}();Rules.SharePointDocumentLibraryLegacy=SharePointDocumentLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.LOCATION_ID="locationid";Rules.SHARED_LOCATION_GUID="17DE0DBB-153C-4C1A-B98A-223B3EA10125";Rules.ALL_FILES_LOCATION_GUID="BEF666F6-2EAD-4B6A-BCD4-22D87DFFF51E";Rules.SharePointFCB="SharePointS2S";Rules.MSTeamsFCB="MSTeamsIntegration";Rules.IsMSTeamsIntegrationEnabled="IsMSTeamsIntegrationEnabled";Rules.IsDocumentManagementEnabled="IsDocumentManagementEnabled";Rules.OrgSettingMSTeamsIntegrationEnabled="ismsteamsenabled";Rules.OrgSettingsMSTeamsFilter="?$select=ismsteamsenabled";Rules.OrgEntityName="organization";var SharePointDocumentLibrary=function(){function SharePointDocumentLibrary(){}SharePointDocumentLibrary.prototype.areSelectedLocationsSame=function(gridControl,records){return true};SharePointDocumentLibrary.prototype.isDocumentNotFromSharedLocation=function(gridControl,records){var isDocNotFromSharedLoc=false,getLocationIdFromGridCtrl=GridControlUtil.GetParameterFromGridControl(gridControl,Rules.LOCATION_ID).toUpperCase();if(getLocationIdFromGridCtrl!=Rules.SHARED_LOCATION_GUID)return isDocNotFromSharedLoc=true;return isDocNotFromSharedLoc};SharePointDocumentLibrary.prototype.isSharePointSiteConfigured=function(){return true};SharePointDocumentLibrary.prototype.isRecordHasActiveSharePointDocLocation=function(){return true};SharePointDocumentLibrary.prototype.isRecordHasActiveOrRenamedSharePointDocLocation=function(){return true};SharePointDocumentLibrary.prototype.isDocumentRecommendationsEnabledForEntity=function(gridControl){return false};SharePointDocumentLibrary.prototype.isFolderNotSelected=function(gridControl,records){var returnValue=false;if(gridControl&&records){returnValue=true;var selectedRecords=gridControl.getGrid().getSelectedRows();selectedRecords&&selectedRecords.forEach(function(row){if(row&&row.data&&row.data.entity){var fileType=row.data.entity.attributes.get("filetype").getValue();if(fileType=="folder"||fileType=="onetoc2")returnValue=false}})}return returnValue};SharePointDocumentLibrary.prototype.isDocumentAssociatedGridViewSelected=function(gridControl){var isViewSelected=false,viewId="{0016f9f3-41cc-4276-9d11-04308d15858d}";if(gridControl){var viewSelector=gridControl.getViewSelector(),currentView=viewSelector.getCurrentView();isViewSelected=currentView!=null&&currentView.id!=null&&currentView.id.toString().toUpperCase()==viewId.toUpperCase()?true:false}return isViewSelected};SharePointDocumentLibrary.prototype.isSharePointDocLocationNotSharedOrAllFiles=function(gridControl){var isDocNotFromSharedLoc=false,getLocationIdFromGridCtrl=GridControlUtil.GetParameterFromGridControl(gridControl,Rules.LOCATION_ID).toUpperCase();if(getLocationIdFromGridCtrl!=Rules.SHARED_LOCATION_GUID&&getLocationIdFromGridCtrl!=Rules.ALL_FILES_LOCATION_GUID)return isDocNotFromSharedLoc=true;return isDocNotFromSharedLoc};SharePointDocumentLibrary.prototype.hideCommand=function(){return false};SharePointDocumentLibrary.prototype.hideCommandForServiceAppointmentEntity=function(){return Xrm.Page.data.entity.getEntityName()==="serviceappointment"?false:true};SharePointDocumentLibrary.prototype.isSharePointEnabled=function(){return Xrm.Internal.isFeatureEnabled(Rules.SharePointFCB)};SharePointDocumentLibrary.prototype.isMSTeamsIntegrationFCBEnabled=function(){return Xrm.Internal.isFeatureEnabled(Rules.MSTeamsFCB)};SharePointDocumentLibrary.prototype.retrieveOrgSettings=function(gridControl,orgSettingsFilter){var orgId=Xrm.Utility.getGlobalContext().organizationSettings.organizationId;Xrm.WebApi.retrieveRecord(Rules.OrgEntityName,orgId,orgSettingsFilter).then(function(orgData){SharePointDocumentLibrary.MSTeamsOrgSettingEnabled=orgData.ismsteamsenabled==0?false:true;gridControl.refreshRibbon()});SharePointDocumentLibrary.isOrgSettingRetrieveStarted=true};SharePointDocumentLibrary.prototype.loadEntityMetadata=function(gridControl){var parentform=gridControl.getParentForm(),entityName=parentform.data.entity.getEntityName();Xrm.Utility.getEntityMetadata(entityName,[Rules.IsMSTeamsIntegrationEnabled,Rules.IsDocumentManagementEnabled]).then(function(entityMetadata){SharePointDocumentLibrary.IsMSTeamsIntegrationEnabledOnEntity=entityMetadata.IsMSTeamsIntegrationEnabled;SharePointDocumentLibrary.IsDocumentManagementEnabledOnEntity=entityMetadata.IsDocumentManagementEnabled;gridControl.refreshRibbon()});SharePointDocumentLibrary.isEntityMetadataLoadingStarted=true};SharePointDocumentLibrary.prototype.isDocumentManagementEnabled=function(gridControl){!SharePointDocumentLibrary.isOrgSettingRetrieveStarted&&this.retrieveOrgSettings(gridControl,Rules.OrgSettingsMSTeamsFilter);!SharePointDocumentLibrary.isEntityMetadataLoadingStarted&&this.loadEntityMetadata(gridControl);return this.isSharePointEnabled()&&SharePointDocumentLibrary.IsDocumentManagementEnabledOnEntity||this.isMSTeamsIntegrationFCBEnabled()&&SharePointDocumentLibrary.MSTeamsOrgSettingEnabled&&SharePointDocumentLibrary.IsMSTeamsIntegrationEnabledOnEntity};SharePointDocumentLibrary.prototype.IsOnlyMSTeamsIntegrationNotEnabledOnEntity=function(gridControl){!SharePointDocumentLibrary.isEntityMetadataLoadingStarted&&this.loadEntityMetadata(gridControl);return this.isSharePointEnabled()&&SharePointDocumentLibrary.IsDocumentManagementEnabledOnEntity==true};SharePointDocumentLibrary.IsMSTeamsIntegrationEnabledOnEntity=false;SharePointDocumentLibrary.IsDocumentManagementEnabledOnEntity=false;SharePointDocumentLibrary.MSTeamsOrgSettingEnabled=false;SharePointDocumentLibrary.isOrgSettingRetrieveStarted=false;SharePointDocumentLibrary.isEntityMetadataLoadingStarted=false;return SharePointDocumentLibrary}();Rules.SharePointDocumentLibrary=SharePointDocumentLibrary;var GridControlUtil=function(){function GridControlUtil(){}GridControlUtil.GetParameterFromGridControl=function(gridControl,id){var customFilterXml=gridControl.getFilterXml();return customFilterXml?GridControlUtil.GetParameterFromFetchXml(customFilterXml,id.toLowerCase()):""};GridControlUtil.GetParameterFromFetchXml=function(fetchXml,parameterName){var domParser=new DOMParser,fetchXmlDocument=domParser.parseFromString(fetchXml,"text/xml");if(fetchXmlDocument){var filterElements=fetchXmlDocument.getElementsByTagName("filter");if(filterElements&&filterElements.length>0)for(var index=0;index<filterElements.length;index++)for(var filterElement=filterElements[index],filterElementIndex=0;filterElementIndex<filterElement.childNodes.length;filterElementIndex++){var currentElement=filterElement.childNodes.item(filterElementIndex);if(currentElement.nodeName==="condition"){var attributeName=GridControlUtil.getNodeAttributeValueFromName(currentElement,"attribute");if(attributeName===parameterName)return GridControlUtil.getNodeAttributeValueFromName(currentElement,"value")}}}return ""};GridControlUtil.getNodeAttributeValueFromName=function(inputNode,attribuetName){if(!inputNode)return null;var nodeAttributeMap=inputNode.attributes.getNamedItem(attribuetName);return nodeAttributeMap?nodeAttributeMap.value:null};return GridControlUtil}();Rules.GridControlUtil=GridControlUtil})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.SharePointDocument=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Rules.SharePointDocumentLibrary:new Rules.SharePointDocumentLibraryLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var SystemUserRules=function(){function SystemUserRules(){}SystemUserRules.prototype.isCurrentUser=function(userId){var globalContext=Xrm.Utility.getGlobalContext(),currentUserId=globalContext?globalContext.userSettings.userId.toLowerCase().replace("{","").replace("}",""):null;if(userId!==null&&userId!==undefined&&currentUserId){userId=userId.toLowerCase().replace("{","").replace("}","");return userId===currentUserId}return false};return SystemUserRules}();Rules.SystemUserRules=SystemUserRules})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){var SystemUserRulesLegacy=function(){function SystemUserRulesLegacy(){}SystemUserRulesLegacy.prototype.isCurrentUser=function(userId){var backCompatHeader=XrmCore.InternalUtilities.LegacyUtilities.getIFrameForWebClient(false);return Mscrm&&Mscrm.SystemUserActions?Mscrm.SystemUserActions.isCurrentUser(userId):backCompatHeader.Mscrm.SystemUserActions.isCurrentUser(userId)};return SystemUserRulesLegacy}();Rules.SystemUserRulesLegacy=SystemUserRulesLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var Rules;(function(Rules){Rules.SystemUser=Xrm.Internal.isUci&&Xrm.Internal.isUci()?new Rules.SystemUserRules:new Rules.SystemUserRulesLegacy})(Rules=XrmCore.Rules||(XrmCore.Rules={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var AssignRequest=function(){function AssignRequest(){}AssignRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,operationName:"Assign",operationType:0,parameterTypes:{Target:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},Assignee:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}}};return metadata};return AssignRequest}();SdkContracts.AssignRequest=AssignRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var DeleteRequest=function(){function DeleteRequest(entityReference){this.entityReference=entityReference}DeleteRequest.prototype.getMetadata=function(){var metadata={boundParameter:undefined,parameterTypes:{entityReference:{typeName:"mscrm.crmbaseentity",structuralProperty:5}},operationName:"Delete",operationType:2};return metadata};return DeleteRequest}();SdkContracts.DeleteRequest=DeleteRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var Object=function(){function Object(){}Object.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{},operationName:null,operationType:null};return metadata};return Object}();SdkContracts.Object=Object})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var InputArgumentCollection=function(){function InputArgumentCollection(args){this.Arguments=args}InputArgumentCollection.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Arguments:{typeName:"Microsoft.Dynamics.CRM.InputArgument",structuralProperty:2}},operationName:null,operationType:null};return metadata};return InputArgumentCollection}();SdkContracts.InputArgumentCollection=InputArgumentCollection})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var InputArgument=function(){function InputArgument(count,isReadOnly,keys,values){this.Count=count;this.IsReadOnly=isReadOnly;this.Keys=keys;this.Values=values}InputArgument.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Count:{typeName:"Edm.Int32",structuralProperty:1},IsReadOnly:{typeName:"Edm.Boolean",structuralProperty:1},Keys:{typeName:"Edm.String",structuralProperty:4},Values:{typeName:"mscrm.Object",structuralProperty:4}},operationName:null,operationType:null};return metadata};return InputArgument}();SdkContracts.InputArgument=InputArgument})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var ExportToExcelRequest=function(){function ExportToExcelRequest(view,fetchXml,layoutXml,queryApi,queryParameters){this.View=view;this.FetchXml=fetchXml;this.LayoutXml=layoutXml;this.QueryApi=queryApi;this.QueryParameters=queryParameters}ExportToExcelRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{View:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},FetchXml:{typeName:"Edm.String",structuralProperty:1},LayoutXml:{typeName:"Edm.String",structuralProperty:1},QueryApi:{typeName:"Edm.String",structuralProperty:1},QueryParameters:{typeName:"Microsoft.Dynamics.CRM.InputArgumentCollection",structuralProperty:2}},operationName:"ExportToExcel",operationType:0};return metadata};return ExportToExcelRequest}();SdkContracts.ExportToExcelRequest=ExportToExcelRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var ExportWordDocumentRequest=function(){function ExportWordDocumentRequest(entityTypeCode,selectedTemplate,selectedRecords){this.EntityTypeCode=entityTypeCode;this.SelectedTemplate=selectedTemplate;this.SelectedRecords=selectedRecords}ExportWordDocumentRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{EntityTypeCode:{typeName:"Edm.Int32",structuralProperty:1},SelectedTemplate:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},SelectedRecords:{typeName:"Edm.String",structuralProperty:1}},operationName:"ExportWordDocument",operationType:0};return metadata};return ExportWordDocumentRequest}();SdkContracts.ExportWordDocumentRequest=ExportWordDocumentRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var RenderTemplateRequest=function(){function RenderTemplateRequest(template,fetchXml,queryApi,queryParameters){this.Template=template;this.FetchXml=fetchXml;this.QueryApi=queryApi;this.QueryParameters=queryParameters}RenderTemplateRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Template:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},FetchXml:{typeName:"Edm.String",structuralProperty:1},QueryApi:{typeName:"Edm.String",structuralProperty:1},QueryParameters:{typeName:"Microsoft.Dynamics.CRM.InputArgumentCollection",structuralProperty:2}},operationName:"RenderTemplate",operationType:0};return metadata};return RenderTemplateRequest}();SdkContracts.RenderTemplateRequest=RenderTemplateRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var RenderTemplateFromViewRequest=function(){function RenderTemplateFromViewRequest(template,view){this.Template=template;this.View=view}RenderTemplateFromViewRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Template:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},View:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"RenderTemplateFromView",operationType:0};return metadata};return RenderTemplateFromViewRequest}();SdkContracts.RenderTemplateFromViewRequest=RenderTemplateFromViewRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var RetrieveActiveStageRecordRequest=function(){function RetrieveActiveStageRecordRequest(bpfEntityReference){this.BpfEntityReference=bpfEntityReference}RetrieveActiveStageRecordRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{BpfEntityReference:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"RetrieveActiveStageRecord",operationType:1};return metadata};return RetrieveActiveStageRecordRequest}();SdkContracts.RetrieveActiveStageRecordRequest=RetrieveActiveStageRecordRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var SetIsDisabledRequest=function(){function SetIsDisabledRequest(id,etn,isdisabled){this.id=id.replace("{","").replace("}","");this.etn=etn;this.payload={isdisabled:isdisabled}}SetIsDisabledRequest.prototype.getMetadata=function(){var metadata={boundParameter:undefined,parameterTypes:{},operationName:"Update",operationType:2};return metadata};return SetIsDisabledRequest}();SdkContracts.SetIsDisabledRequest=SetIsDisabledRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var SetRegardingRequest=function(){function SetRegardingRequest(record,regardingObjectTypeName,regardingObjectId,entitySetName){this.id=record.Id.replace("{","").replace("}","");this.etn=record.TypeName;var payloadKey="regardingobjectid_"+regardingObjectTypeName+"_"+record.TypeName+"@odata.bind";this.payload={};this.payload[payloadKey]="/"+entitySetName+"("+regardingObjectId.replace("{","").replace("}","")+")"}SetRegardingRequest.prototype.getMetadata=function(){var metadata={boundParameter:undefined,parameterTypes:{},operationName:"Update",operationType:2};return metadata};return SetRegardingRequest}();SdkContracts.SetRegardingRequest=SetRegardingRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var SetStateRequest=function(){function SetStateRequest(id,etn,statecode,statuscode){this.id=id.replace("{","").replace("}","");this.etn=etn;this.payload={statecode:statecode,statuscode:statuscode}}SetStateRequest.prototype.getMetadata=function(){var metadata={boundParameter:undefined,parameterTypes:{},operationName:"Update",operationType:2};return metadata};return SetStateRequest}();SdkContracts.SetStateRequest=SetStateRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var RemoveUserFromRecordTeamRequest=function(){function RemoveUserFromRecordTeamRequest(entity,record,teamTemplate){this.entity=entity;this.Record=record;this.TeamTemplate=teamTemplate}RemoveUserFromRecordTeamRequest.prototype.getMetadata=function(){var metadata={boundParameter:"entity",parameterTypes:{entity:{typeName:"Microsoft.Dynamics.CRM.systemuser",structuralProperty:5},Record:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},TeamTemplate:{typeName:"Microsoft.Dynamics.CRM.teamtemplate",structuralProperty:5}},operationName:"RemoveUserFromRecordTeam",operationType:0};return metadata};return RemoveUserFromRecordTeamRequest}();SdkContracts.RemoveUserFromRecordTeamRequest=RemoveUserFromRecordTeamRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var AddUserToRecordTeamRequest=function(){function AddUserToRecordTeamRequest(entity,record,teamTemplate){this.entity=entity;this.Record=record;this.TeamTemplate=teamTemplate}AddUserToRecordTeamRequest.prototype.getMetadata=function(){var metadata={boundParameter:"entity",parameterTypes:{entity:{typeName:"Microsoft.Dynamics.CRM.systemuser",structuralProperty:5},Record:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},TeamTemplate:{typeName:"Microsoft.Dynamics.CRM.teamtemplate",structuralProperty:5}},operationName:"AddUserToRecordTeam",operationType:0};return metadata};return AddUserToRecordTeamRequest}();SdkContracts.AddUserToRecordTeamRequest=AddUserToRecordTeamRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var InternalUtilities;(function(InternalUtilities){var ActivityUtilities=function(){function ActivityUtilities(){}ActivityUtilities.isActivityTypeCode=function(entityName){switch(entityName){case InternalUtilities.EntityUtilities.EntityNames.Task:case InternalUtilities.EntityUtilities.EntityNames.Letter:case InternalUtilities.EntityUtilities.EntityNames.PhoneCall:case InternalUtilities.EntityUtilities.EntityNames.ServiceAppointment:case InternalUtilities.EntityUtilities.EntityNames.UntrackedEmail:case InternalUtilities.EntityUtilities.EntityNames.Fax:case InternalUtilities.EntityUtilities.EntityNames.QuoteClose:case InternalUtilities.EntityUtilities.EntityNames.OrderClose:case InternalUtilities.EntityUtilities.EntityNames.IncidentResolution:case InternalUtilities.EntityUtilities.EntityNames.OpportunityClose:case InternalUtilities.EntityUtilities.EntityNames.SocialActivity:case InternalUtilities.EntityUtilities.EntityNames.CampaignActivity:case InternalUtilities.EntityUtilities.EntityNames.Appointment:case InternalUtilities.EntityUtilities.EntityNames.BulkOperation:case InternalUtilities.EntityUtilities.EntityNames.RecurringAppointmentMaster:case InternalUtilities.EntityUtilities.EntityNames.CampaignResponse:case InternalUtilities.EntityUtilities.EntityNames.Email:case InternalUtilities.EntityUtilities.EntityNames.ActivityPointer:return true;default:return false}};return ActivityUtilities}();InternalUtilities.ActivityUtilities=ActivityUtilities})(InternalUtilities=XrmCore.InternalUtilities||(XrmCore.InternalUtilities={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var InternalUtilities;(function(InternalUtilities){var DialogUtilities=function(){function DialogUtilities(){}DialogUtilities.closeDialog=function(eventContext){var formContext=eventContext.getFormContext();this.setLastButtonClicked(eventContext,DialogUtilities.DialogConstants.DialogCancelId);formContext.ui.close()};DialogUtilities.setLastButtonClicked=function(eventContext,buttonId){var formContext=eventContext.getFormContext(),lastButtonClicked=formContext.data.attributes.get("last_button_clicked");lastButtonClicked&&lastButtonClicked.setValue(buttonId)};DialogUtilities.isMobileCompanionApp=function(){return Xrm.Utility.getGlobalContext().client.getClient()===Xrm.Constants.ClientNames.mobile};DialogUtilities.isOutlook=function(){return Xrm.Utility.getGlobalContext().client.getClient()===Xrm.Constants.ClientNames.outlook};DialogUtilities.isMailApp=function(){var contexts=Xrm&&Xrm.ExternalContext?Xrm.ExternalContext.getAvailableExternalContexts():null;if(contexts&&contexts.get("MAIL_CONTEXT"))return true;return false};DialogUtilities.isOffline=function(){return DialogUtilities.isMobileCompanionApp()&&Xrm.Utility.getGlobalContext().client.getClientState()===Xrm.Constants.ClientStates.offline};DialogUtilities.showOfflineError=function(){var alert={text:InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Generic_Mobile_Client_Offline")};Xrm.Navigation.openAlertDialog(alert)};DialogUtilities.getSdkEntityReference=function(records){var referenceList=[];records.forEach(function(record){referenceList.push(record)});return referenceList};DialogUtilities.serializeSdkEntityReferences=function(records){return JSON.stringify(records)};DialogUtilities.deserializeSdkEntityReferences=function(stringifiedRecords){if(!stringifiedRecords)return [];return DialogUtilities.getSdkEntityReference(JSON.parse(stringifiedRecords))};DialogUtilities.createActionFailedErrorDialog=function(errorResponse){Xrm.Utility.closeProgressIndicator();var errorDialogOptions={message:errorResponse.message,errorCode:errorResponse.errorCode};Xrm.Navigation.openErrorDialog(errorDialogOptions)};DialogUtilities.onGridActionMultipleSuccess=function(gridControl,successResponses){if(successResponses.every(function(response){return response.ok}))gridControl&&gridControl.refresh();else InternalUtilities.DialogUtilities.openAlertDialogForMultipleErrors(gridControl)};DialogUtilities.isAllowLegacyDialogsEmbedding=function(){if(Xrm&&Xrm.Internal&&Xrm.Internal.isUci()&&Xrm.Internal.getAllowLegacyDialogsEmbedding)return !DialogUtilities.isMobileCompanionApp()&&!DialogUtilities.isOutlook()&&!DialogUtilities.isMailApp()&&Xrm.Internal.getAllowLegacyDialogsEmbedding();return true};DialogUtilities.tryGetDialogStringsForEnabledMetadataDialogs=function(dialogName,confirmDialogStrings,entityName,recordsToDelete,actionUri,entityDisplayName,entitySetName,isDocumentManagementEnabled,isPrimary){if(isPrimary===void 0)isPrimary=false;if(recordsToDelete===null||recordsToDelete===undefined)recordsToDelete=1;var displayName=entityDisplayName;if(recordsToDelete>1)displayName=entitySetName;var DialogStrings={},DialogKeys=null;switch(dialogName){case DialogUtilities.DialogName.DeleteDialog:switch(entityName){case InternalUtilities.EntityUtilities.EntityNames.Contact:DialogKeys=["Web._grid.cmds.dlg_delete_contact.aspx_54","Delete_Customer_Dialog_Account_Instruction","Delete_Customer_Dialog_Delete_Instruction","Button_Label_Delete","Button_Label_Cancel","Dialog_DeleteContactConfirm_Title","Dialog_DeleteContactConfirm_Description"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Web._grid.cmds.dlg_delete_contact.aspx_54"].toString(),[displayName]);confirmDialogStrings.text+="\n";confirmDialogStrings.text+=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Delete_Customer_Dialog_Account_Instruction"].toString(),[displayName]);confirmDialogStrings.text+="\n";confirmDialogStrings.text+=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Delete_Customer_Dialog_Delete_Instruction"].toString(),[displayName]);confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Delete"].toString(),[]);confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Cancel"].toString(),[]);confirmDialogStrings.title=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_DeleteContactConfirm_Title"].toString(),[displayName]);confirmDialogStrings.subtitle=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_DeleteContactConfirm_Description"].toString(),[recordsToDelete,displayName]);break;case InternalUtilities.EntityUtilities.EntityNames.Account:DialogKeys=["Web._grid.cmds.dlg_delete_account.aspx_54","Button_Label_Delete","Button_Label_Cancel","Dialog_DeleteAccountConfirm_Title","Dialog_DeleteAccountConfirm_Description"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Web._grid.cmds.dlg_delete_account.aspx_54"].toString(),[displayName]);confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Delete"].toString(),[]);confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Cancel"].toString(),[]);confirmDialogStrings.title=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_DeleteAccountConfirm_Title"].toString(),[displayName]);confirmDialogStrings.subtitle=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_DeleteAccountConfirm_Description"].toString(),[recordsToDelete,displayName]);if(isDocumentManagementEnabled){DialogKeys=["Delete_Account_Dialog_RelatedDocumentsWarning","Delete_Customer_Dialog_Account_Instruction","Delete_Customer_Dialog_Delete_Instruction"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text+="\n";confirmDialogStrings.text+=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Delete_Account_Dialog_RelatedDocumentsWarning"].toString(),[]);confirmDialogStrings.text+="\n";confirmDialogStrings.text+=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Delete_Customer_Dialog_Account_Instruction"].toString(),[displayName]);confirmDialogStrings.text+="\n";confirmDialogStrings.text+=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Delete_Customer_Dialog_Delete_Instruction"].toString(),[displayName])}break;case InternalUtilities.EntityUtilities.EntityNames.KnowledgeArticle:DialogKeys=["Delete_KnowledgeArticle_Dialog_RelatedInformationWarning","Button_Label_Delete","Button_Label_Cancel","Dialog_DeleteKnowledgeArticleConfirm_Title","Dialog_DeleteKnowledgeArticleConfirm_Description"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=DialogStrings["Delete_KnowledgeArticle_Dialog_RelatedInformationWarning"].toString();confirmDialogStrings.confirmButtonLabel=DialogStrings["Button_Label_Delete"].toString();confirmDialogStrings.cancelButtonLabel=DialogStrings["Button_Label_Cancel"].toString();confirmDialogStrings.title=DialogStrings["Dialog_DeleteKnowledgeArticleConfirm_Title"].toString();confirmDialogStrings.subtitle=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_DeleteKnowledgeArticleConfirm_Description"].toString(),[recordsToDelete]);break;case InternalUtilities.EntityUtilities.EntityNames.OpportunityProduct:case InternalUtilities.EntityUtilities.EntityNames.InvoiceDetail:DialogKeys=["Dialog_Delete_DeleteAll","Button_Label_Delete","Button_Label_Cancel","Web._grid.cmds.dlg_delete.aspx_26"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_Delete_DeleteAll"].toString(),[]);confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Delete"].toString(),[]);confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Cancel"].toString(),[]);confirmDialogStrings.title=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Web._grid.cmds.dlg_delete.aspx_26"].toString(),[]);confirmDialogStrings.subtitle="";break;case InternalUtilities.EntityUtilities.EntityNames.Lead:case InternalUtilities.EntityUtilities.EntityNames.Competitor:case InternalUtilities.EntityUtilities.EntityNames.Opportunity:case InternalUtilities.EntityUtilities.EntityNames.DynamicProperty:case InternalUtilities.EntityUtilities.EntityNames.Email:case InternalUtilities.EntityUtilities.EntityNames.Incident:case InternalUtilities.EntityUtilities.EntityNames.SyncError:case InternalUtilities.EntityUtilities.EntityNames.ServiceAppointment:DialogKeys=["Dialog_Delete_Description","Button_Label_Delete","Button_Label_Cancel","Web._grid.cmds.dlg_delete.aspx_26","Dialog_DeleteAccountConfirm_Description"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=recordsToDelete<=1?InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_Delete_Description"].toString(),[displayName]):InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_DeleteAccountConfirm_Description"].toString(),[recordsToDelete,displayName]);confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Delete"].toString(),[]);confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Cancel"].toString(),[]);confirmDialogStrings.title=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Web._grid.cmds.dlg_delete.aspx_26"].toString(),[]);confirmDialogStrings.subtitle="";break;case InternalUtilities.EntityUtilities.EntityNames.Queue:DialogKeys=["Dialog_DeleteQueue_Description","Button_Label_Delete","Button_Label_Cancel","Dialog_DeleteQueueEmpty_Title"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_DeleteQueue_Description"].toString(),[recordsToDelete,displayName]);confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Delete"].toString(),[]);confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Cancel"].toString(),[]);confirmDialogStrings.title=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_DeleteQueueEmpty_Title"].toString(),[displayName]);confirmDialogStrings.subtitle="";break;case InternalUtilities.EntityUtilities.EntityNames.TopicModel:DialogKeys=["Dialog_Delete_Topicmodel_Description","Button_Label_Delete","Button_Label_Cancel","Dialog_Delete_Topicmodel_Title"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_Delete_Topicmodel_Description"].toString(),[]);confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Delete"].toString(),[]);confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Cancel"].toString(),[]);confirmDialogStrings.title=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_Delete_Topicmodel_Title"].toString(),[]);confirmDialogStrings.subtitle="";break;case InternalUtilities.EntityUtilities.EntityNames.AzureServiceConnection:DialogKeys=["Dialog_Delete_AzureServiceConnection_Description","Button_Label_Delete","Button_Label_Cancel","Dialog_Delete_AzureServiceConnection_Title"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_Delete_AzureServiceConnection_Description"].toString(),[]);confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Delete"].toString(),[]);confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Cancel"].toString(),[]);confirmDialogStrings.title=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_Delete_AzureServiceConnection_Title"].toString(),[]);confirmDialogStrings.subtitle="";break;case InternalUtilities.EntityUtilities.EntityNames.Contract:case InternalUtilities.EntityUtilities.EntityNames.RecurringAppointmentMaster:case InternalUtilities.EntityUtilities.EntityNames.Role:case InternalUtilities.EntityUtilities.EntityNames.TeamTemplate:case InternalUtilities.EntityUtilities.EntityNames.CalendarRule:return false;case InternalUtilities.EntityUtilities.EntityNames.Product:DialogUtilities.GetDefaultStringsForDeleteDialog(confirmDialogStrings,displayName);break;case InternalUtilities.EntityUtilities.EntityNames.Connection:if(isPrimary)DialogUtilities.GetDefaultStringsForDeleteDialog(confirmDialogStrings,displayName);else{DialogKeys=["Dialog_Delete_Connection_Description","Dialog_Delete_Bulk_Connection_Description","Button_Label_Yes","Button_Label_No","Dialog_Delete_Connection_Title"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=Xrm.Utility.getResourceString("Main_system_library",key)||key});confirmDialogStrings.text=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_Delete_Connection_Description"].toString(),[]);confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Yes"].toString(),[]);confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_No"].toString(),[]);confirmDialogStrings.title=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_Delete_Connection_Title"].toString(),[]);if(recordsToDelete>1)confirmDialogStrings.text=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_Delete_Bulk_Connection_Description"].toString(),[]);confirmDialogStrings.subtitle=""}break;case InternalUtilities.EntityUtilities.EntityNames.Category:DialogKeys=["Dialog_Delete_Description_Category","Button_Label_Yes","Button_Label_No","Web._grid.cmds.dlg_delete.aspx_26"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_Delete_Description_Category"].toString(),[displayName]);confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Yes"].toString(),[]);confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_No"].toString(),[]);confirmDialogStrings.title=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Web._grid.cmds.dlg_delete.aspx_26"].toString(),[]);confirmDialogStrings.subtitle="";break;default:DialogUtilities.GetDefaultStringsForDeleteDialog(confirmDialogStrings,displayName);break}break;case InternalUtilities.DialogUtilities.DialogName.SaveAndRouteCase:confirmDialogStrings.text=InternalUtilities.GenericUtilities.getLocalResourceString("Dlg_RouteCase_AddRequiredConfirmForSingleCase_Body");confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Route");confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Cancel");confirmDialogStrings.title=InternalUtilities.GenericUtilities.getLocalResourceString("Dlg_RouteCase_AddRequiredConfirm_Title");break;case InternalUtilities.DialogUtilities.DialogName.RouteCase:DialogKeys=["Dlg_RouteCase_AddRequiredConfirmForSingleCase_Body","Button_Label_Route","Button_Label_Cancel","Dlg_RouteCase_AddRequiredConfirm_Title"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=DialogStrings["Dlg_RouteCase_AddRequiredConfirmForSingleCase_Body"].toString();confirmDialogStrings.confirmButtonLabel=DialogStrings["Button_Label_Route"].toString();confirmDialogStrings.cancelButtonLabel=DialogStrings["Button_Label_Cancel"].toString();confirmDialogStrings.title=DialogStrings["Dlg_RouteCase_AddRequiredConfirm_Title"].toString();break;case InternalUtilities.DialogUtilities.DialogName.ReactivateCase:DialogKeys=["Case_Reactivate_Dlg_Title","Web.CS.cases.dlg_reactivate.aspx_50","Button_Label_Reactivate","Button_Label_Cancel"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.title=DialogStrings["Case_Reactivate_Dlg_Title"].toString();confirmDialogStrings.text=DialogStrings["Web.CS.cases.dlg_reactivate.aspx_50"].toString();confirmDialogStrings.confirmButtonLabel=DialogStrings["Button_Label_Reactivate"].toString();confirmDialogStrings.cancelButtonLabel=DialogStrings["Button_Label_Cancel"].toString();break;case InternalUtilities.DialogUtilities.DialogName.ResolveCase:DialogKeys=["Web._cs.Cases.dlg_ConfirmResolve.aspx_1","Web._cs.Cases.dlg_ConfirmResolve.aspx_3","Button_Label_Confirm","Button_Label_Cancel"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.title=DialogStrings["Web._cs.Cases.dlg_ConfirmResolve.aspx_1"].toString();confirmDialogStrings.text=DialogStrings["Web._cs.Cases.dlg_ConfirmResolve.aspx_3"].toString();confirmDialogStrings.confirmButtonLabel=DialogStrings["Button_Label_Confirm"].toString();confirmDialogStrings.cancelButtonLabel=DialogStrings["Button_Label_Cancel"].toString();break;case InternalUtilities.DialogUtilities.DialogConstants.resolveCaseNoValidStatusReasonTransition:DialogKeys=["Web.Record.NoValidStatusReasonTransition.Window_Title01","Web.Record.NoValidStatusReasonTransition01","Button_Label_OK","Button_Label_Cancel"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.title=DialogStrings["Web.Record.NoValidStatusReasonTransition.Window_Title01"].toString();confirmDialogStrings.text=DialogStrings["Web.Record.NoValidStatusReasonTransition01"].toString();confirmDialogStrings.confirmButtonLabel=DialogStrings["Button_Label_OK"].toString();confirmDialogStrings.cancelButtonLabel=DialogStrings["Button_Label_Cancel"].toString();break;case InternalUtilities.DialogUtilities.DialogName.CancelCaseDialog:DialogKeys=["Web._cs.Cases.dlg_ConfirmResolve.aspx_4","Button_Label_Confirm","Button_Label_Cancel","Web._cs.Cases.dlg_ConfirmCancel.aspx_2"];DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=DialogStrings["Web._cs.Cases.dlg_ConfirmResolve.aspx_4"].toString();confirmDialogStrings.confirmButtonLabel=DialogStrings["Button_Label_Confirm"].toString();confirmDialogStrings.cancelButtonLabel=DialogStrings["Button_Label_Cancel"].toString();confirmDialogStrings.title=DialogStrings["Web._cs.Cases.dlg_ConfirmCancel.aspx_2"].toString();break;case InternalUtilities.DialogUtilities.DialogName.ApplyEmailTemplate:confirmDialogStrings.text=InternalUtilities.GenericUtilities.getLocalResourceString("Web._cs.ApplyEmailTemplate.dlg_ConfirmResolveText");confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_OK");confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Cancel");confirmDialogStrings.title=InternalUtilities.GenericUtilities.getLocalResourceString("Web._cs.ApplyEmailTemplate.dlg_ConfirmResolveTitle");break;case InternalUtilities.DialogUtilities.DialogName.UpdateAttachment:confirmDialogStrings.text=InternalUtilities.GenericUtilities.getLocalResourceString("AddTemplateWithoutAttachment");confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_OK");confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.getLocalResourceString("Button_Label_Cancel");confirmDialogStrings.title=InternalUtilities.GenericUtilities.getLocalResourceString("Web._cs.ApplyEmailTemplate.dlg_ConfirmResolveTitle");break;default:return false}return true};DialogUtilities.GetDefaultStringsForDeleteDialog=function(confirmDialogStrings,displayName){var DialogKeys=["Dialog_Delete_Description","Button_Label_Delete","Button_Label_Cancel","Web._grid.cmds.dlg_delete.aspx_26"],DialogStrings={};DialogKeys.forEach(function(key){DialogStrings[key]=InternalUtilities.GenericUtilities.getLocalResourceString(key)||key});confirmDialogStrings.text=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Dialog_Delete_Description"].toString(),[displayName]);confirmDialogStrings.confirmButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Delete"].toString(),[displayName]);confirmDialogStrings.cancelButtonLabel=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Button_Label_Cancel"].toString(),[displayName]);confirmDialogStrings.title=InternalUtilities.GenericUtilities.stringFormat(DialogStrings["Web._grid.cmds.dlg_delete.aspx_26"].toString(),[]);confirmDialogStrings.subtitle=""};DialogUtilities.openAlertDialogForMultipleErrors=function(gridControl){var alertDialogStrings={text:InternalUtilities.GenericUtilities.getLocalResourceString("Error_Message_Action_MultipleErrorsFound")};Xrm.Navigation.openAlertDialog(alertDialogStrings,null).then(function(success){gridControl&&gridControl.refresh()})};return DialogUtilities}();InternalUtilities.DialogUtilities=DialogUtilities;var DialogUtilities;(function(DialogUtilities){var DialogName=function(){function DialogName(){}DialogName.RouteCase="routecase";DialogName.SaveAndRouteCase="saveandroutecase";DialogName.DeleteDialog="delete";DialogName.AddToQueueDialog="AddToQueue";DialogName.ReactivateCase="ReactivateCase";DialogName.ResolveCase="ResolveCase";DialogName.QueueItemPickDialog="QueueItemPick";DialogName.RouteQueuedItemDialog="RouteQueuedItem";DialogName.Assign="Assign";DialogName.AssignQueue="AssignQueue";DialogName.CancelCaseDialog="CancelCase";DialogName.SetRegarding="SetRegarding";DialogName.ConvertActivityDialog="ConvertActivity";DialogName.ConvertToCaseDialog="ConvertToCase";DialogName.ConvertToKnowledgeArticleDialog="ConvertToKnowledgeArticle";DialogName.CloseOpportunity="CloseOpportunity";DialogName.CloseOrder="CloseOrder";DialogName.CloseInvoice="InvoiceClose";DialogName.CloseQuote="CloseQuote";DialogName.CreateOrder="CreateOrder";DialogName.SetStateDialog="SetStateDialog";DialogName.RecommendationModelDialog="RecommendationModelDialog";DialogName.SeriesActionDialog="SeriesActionDialog";DialogName.DupWarningDialog="DupWarning";DialogName.ApplyEmailTemplate="ApplyEmailTemplate";DialogName.SelectTemplateRecipient="SelectTemplateRecipient";DialogName.UpdateAttachment="UpdateAttachment";DialogName.Lookup="Lookup";DialogName.CreateSlaDialog="CreateSlaDialog";DialogName.AssociateCase="AssociateCase";DialogName.MergeCase="MergeCase";DialogName.RecommendedDocument="RecommendedDocument";DialogName.DocumentSuggestions="DocumentSuggestions";DialogName.OtherDocumentSuggestions="OtherDocumentSuggestions";DialogName.EntityImageUpload="EntityImageUpload";DialogName.DeviceSettings="DeviceSettings";DialogName.DeviceSettingsConsentDialog="DeviceSettingsConsentDialog";DialogName.MicrosoftFlowsDialog="MicrosoftFlowsDialog";DialogName.ShareDialog="Share";return DialogName}();DialogUtilities.DialogName=DialogName;var DialogConstants=function(){function DialogConstants(){}DialogConstants.DialogOkId="ok_id";DialogConstants.DialogCancelId="cancel_id";DialogConstants.DialogMerge="Merge";DialogConstants.DialogSet="Set";DialogConstants.EntityId="entity_id";DialogConstants.EntityName="entity_name";DialogConstants.ActionCardId="actionCardId";DialogConstants.CardType="cardType";DialogConstants.LastButtonClicked="last_button_clicked";DialogConstants.ProgressValue=40;DialogConstants.ProgressMinValue=0;DialogConstants.ProgressMaxValue=100;DialogConstants.GridControl="gridControl";DialogConstants.Records="entity_records";DialogConstants.resolveCaseNoValidStatusReasonTransition="ResolveCaseNOvalidStatusReasonTransition";DialogConstants.EntityTypeCode="entityTypeCode";DialogConstants.DefaultStatus=-1;DialogConstants.BusinessQueuesLookupId="businessqueues_id";DialogConstants.incidentActiveState="Active";DialogConstants.statusReasonId="setcasestatus_id";DialogConstants.statusReasonLabelId="lbl_setcasestatus";DialogConstants.noValidStatusTransitionAlertTextResourceString="Web.Record.NoValidStatusReasonTransition03";DialogConstants.timeSpent="timeSpent";DialogConstants.isTimeAllotment="bIsTimeAllotment";DialogConstants.allotmentsRemaining="iAllotmentsRemaining";DialogConstants.resolutionType="resolutionType_id";DialogConstants.resolution="resolution_id";DialogConstants.totalTime="totaltime_id";DialogConstants.billableTime="billabletime_id";DialogConstants.remarks="remarks_id";DialogConstants.closeCaseConfirmAllotments="Case_Resolve_Dlg_Confirm_Allotments";DialogConstants.closeCaseString="Web.CS.cases.dlg_closecase.aspx_27";DialogConstants.closeCaseStringForNullSubject="Web.CS.cases.dlg_closecase.aspx_50";DialogConstants.closeCaseConfirmParent="Case_Resolve_Dlg_Confirm_Parent";DialogConstants.closeCaseConfirmContractDetailState="Case_Resolve_Dlg_Confirm_ContractDetailState";DialogConstants.resolvedState="Resolved";DialogConstants.RemoveQueueItemPickId="checkboxpick_id";DialogConstants.QueueItemPickHeaderText="lbl_headerdescription";DialogConstants.QueueItemRouteToId="routeto_id";DialogConstants.QueueItemUserLookupId="crmUserLookupControl_id";DialogConstants.QueueItemQueueLookupId="crmQueueLookupControl_id";DialogConstants.QueueItemRemoveId="chkBoxRemoveItem_id";DialogConstants.QueueItemAssignedToUserText="lbl_assignedtouser";DialogConstants.QueueItemAssignedToQueueText="lbl_addtoqueue";DialogConstants.QueueItemRouteHeaderText="lbl_headerdescription";DialogConstants.AssignQueueDialogLabel="label_DialogDescription";DialogConstants.AssignTomeOption="rdoMe_id";DialogConstants.SelectedRecordsCount="selected_records_count";DialogConstants.SystemUserViewId="systemuserview_id";DialogConstants.statusCodeId="statusCode_id";DialogConstants.CancelStatus="Canceled";DialogConstants.Id="Id";DialogConstants.regardingObjectColumnName="regardingobjectid";DialogConstants.regardingObjectTypeColumnName="regardingobjecttypecode";DialogConstants.regardingControlName="regarding_id";DialogConstants.activity="Activity";DialogConstants.activityLogicalName="activitypointer";DialogConstants.OpenNewId="cbOpenNew_id";DialogConstants.OpenNewRecord="openNewRecord";DialogConstants.SaveActivityId="cbSaveActivity_id";DialogConstants.SaveActivity="saveActivity";DialogConstants.LogResponseId="cbLogResponse_id";DialogConstants.Subject="subject";DialogConstants.LeadLookup="leadLookup";DialogConstants.CustomerLookup="customerLookup";DialogConstants.CurrencyLookup="currencyLookup";DialogConstants.CampaignLookup="campaignassociatedview_id";DialogConstants.SubjectLookup="subject_id";DialogConstants.LeadId="leadId";DialogConstants.OwnerId="owner_id";DialogConstants.OwnerType="owner_type";DialogConstants.OwnerName="owner_name";DialogConstants.OpportunityId="opportunityId";DialogConstants.CaseId="incidentId";DialogConstants.TransactionCurrencyId="transactioncurrencyid";DialogConstants.StateCode="statecode";DialogConstants.Caller="caller";DialogConstants.CallerParameters="callerparameters";DialogConstants.EstimatedValue="estimatedvalue";DialogConstants.ActualRevenueId="actualrevenue_id";DialogConstants.OpportunityStatusReasonId="statusreason_id";DialogConstants.CompetitorId="competitor_id";DialogConstants.CloseDateId="closedate_id";DialogConstants.DescriptionId="description_id";DialogConstants.Won="won";DialogConstants.WonString="Won";DialogConstants.LostString="Lost";DialogConstants.LabelSubtitle="lbl_closedescription";DialogConstants.DescriptionMaxLength=200;DialogConstants.HeaderTitleId="header_title_id";DialogConstants.TitleId="title_id";DialogConstants.MessageId="message_id";DialogConstants.StateId="state_id";DialogConstants.StatusId="status_id";DialogConstants.selectedState="selected_state";DialogConstants.allowedTransitions="allowed_transitions";DialogConstants.action="action_name";DialogConstants.activate="activate";DialogConstants.deactivate="deactivate";DialogConstants.defaultCloseState="default_close_state";DialogConstants.Completed=1;DialogConstants.Canceled=2;DialogConstants.Inactive=1;DialogConstants.Active=0;DialogConstants.DeleteOccurrence="deleteoccurrence_id";DialogConstants.DeleteSeriesKeepCompleted="deleteserieskeepcompleted_id";DialogConstants.DeleteSeriesAllInstances="deleteseriesallinstances_id";DialogConstants.DeleteDescriptionId="deletedescription_id";DialogConstants.SeriesId="seriesId";DialogConstants.AttachementSubGridControl="attachmentsGrid";DialogConstants.ControlNullError=" control cannot be null";DialogConstants.CursorInfoData="cursorInfo";DialogConstants.DefaultGuidString="00000000-0000-0000-0000-000000000000";DialogConstants.DefaultFormattedGuidString="{00000000-0000-0000-0000-000000000000}";DialogConstants.DefaultLookupName="default";DialogConstants.DescriptionAttribute="description";DialogConstants.EmailTemplateControlName="emailtemplates_id";DialogConstants.EmailSubject="emailsubject";DialogConstants.EmailDescription="emaildescription";DialogConstants.EmailEntityName="email";DialogConstants.EmailEntityId="id";DialogConstants.EmailEntityType="entityType";DialogConstants.EmailFormData="emailFormData";DialogConstants.EmailToField="to";DialogConstants.EmailCcField="cc";DialogConstants.EntityType="type";DialogConstants.EntityTypeInfo="entityTypeInfo";DialogConstants.FieldControlName="fieldname_id";DialogConstants.KeyPresent="KeyPresent";DialogConstants.LanguageId="language_id";DialogConstants.RecordControlName="record_id";DialogConstants.RegardingObject="regardingobjectid";DialogConstants.RecipientNames="name";DialogConstants.SelectControlName="select_id";DialogConstants.SubjectAttribute="subject";DialogConstants.TemplateEntityName="template";DialogConstants.TemplateId="templateId";DialogConstants.ParentAccountLookupId="parentAccountLookup_id";DialogConstants.ParentContactLookupId="parentContactLookup_id";DialogConstants.QualifyStatus="qualifyStatus";DialogConstants.ParentAccountId="parentAccountId";DialogConstants.ParentAccountName="parentAccountName";DialogConstants.ParentContactId="parentContactId";DialogConstants.ParentContactName="parentContactName";DialogConstants.qualifyLeadCommandName="QualifyLead";DialogConstants.convertActivityCommandName="ConvertActivity";DialogConstants.loseOpportunityCommandName="LoseOpportunity";DialogConstants.winOpportunityCommandName="WinOpportunity";DialogConstants.resolveCaseCommandName="CloseIncident";DialogConstants.setState="SetState";DialogConstants.closeActivityCommandName="CloseActivity";DialogConstants.commaSeperator=",";DialogConstants.defaultIndex=0;DialogConstants.firstIndex=1;DialogConstants.logicalName="LogicalName";DialogConstants.StatusCode="statuscode";DialogConstants.IncidentTitle="incident_title";DialogConstants.IncidentDescription="incident_description";DialogConstants.IncidentResolution="incident_resolution";DialogConstants.IncidentResolutionDescription="incidentresolution_description";DialogConstants.ConvertToKnowledgeArticleTitle="title_id";DialogConstants.ConvertToKnowledgeArticleContent="content_id";DialogConstants.ConvertToKnowledgeArticleId="knowledgeArticleId";DialogConstants.ConvertToKnowledgeArticleOwnerId="owner_id";DialogConstants.ConvertToKnowledgeArticleSubjectId="subject_id";DialogConstants.SubjectId="subjectId";DialogConstants.SubjectName="subjectName";DialogConstants.ConvertToKnowledgeArticleSubjectName="subjectName";DialogConstants.ConvertToKnowledgeArticleOwnerType="ownerType";DialogConstants.slaName="name_id";DialogConstants.SLASelectedEnity="applicableEntity_id";DialogConstants.PriceLevelId="pricelevelid";DialogConstants.SuggestionsSource="SuggestionsSource";DialogConstants.IsCustomLineItemEntity="isCustomLineItemEntity";DialogConstants.LineItemMetaData="lineItemMetaData";DialogConstants.PanoramaItemDialog="PanoramaItemDialog";DialogConstants.EntityLogicalNameParameter="entitylogicalname_id";DialogConstants.EntityPrimaryAttributeParameter="entityprimaryattribute_id";DialogConstants.EntityIdParameter="entity_id";DialogConstants.EntityImageUrlParameter="entityimageurl_id";DialogConstants.EntityPrimaryImageAttribute="formattedPrimaryImage_Attribute";DialogConstants.CameraEnabledParameter="cameraenabled_id";DialogConstants.EntityImageDataParameter="entityimagedata_id";DialogConstants.EntityImagePreviewId="entityimagepreview_id";DialogConstants.TakePhotoId="takephoto_id";DialogConstants.UploadImageId="uploadimage_id";DialogConstants.UseDefaultId="usedefault_id";DialogConstants.DeviceSettings="device_settings";DialogConstants.FlowId="flow_id";DialogConstants.EntityIdCollection="entity_ids";DialogConstants.FlowsEnvironmentId="environment_id";DialogConstants.OrgUniqueName="org_unique_name";DialogConstants.EntityLogicalCollectionName="entity_logical_collection_name";DialogConstants.EntityLogicalName="entity_logical_name";DialogConstants.Dynamics365AccessToken="dynamics365_access_token";DialogConstants.FlowsDestinationURL="flows_destination_url";DialogConstants.FlowsFPISiteURL="flows_fpi_site_url";DialogConstants.FlowsAuthenticationString="flows_authentication_string";DialogConstants.FlowsEnableWidgetV2="flows_enable_widget_v2";DialogConstants.OfflineSync="offlineSync";DialogConstants.ShowAssignToMeOption="show_assign_to_me_option";DialogConstants.AssignRequest="assign_request";DialogConstants.Task="task";return DialogConstants}();DialogUtilities.DialogConstants=DialogConstants})(DialogUtilities=InternalUtilities.DialogUtilities||(InternalUtilities.DialogUtilities={}))})(InternalUtilities=XrmCore.InternalUtilities||(XrmCore.InternalUtilities={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var InternalUtilities;(function(InternalUtilities){var EntityUtilities=function(){function EntityUtilities(){}EntityUtilities.isStateCodeReversed=function(entityName){switch(entityName){case InternalUtilities.EntityUtilities.EntityNames.Entitlement:case InternalUtilities.EntityUtilities.EntityNames.RoutingRule:case InternalUtilities.EntityUtilities.EntityNames.ConvertRule:case InternalUtilities.EntityUtilities.EntityNames.SLA:case InternalUtilities.EntityUtilities.EntityNames.Workflow:return true;default:return false}};return EntityUtilities}();InternalUtilities.EntityUtilities=EntityUtilities;var EntityUtilities;(function(EntityUtilities){var ProductStructureType=function(){function ProductStructureType(){}ProductStructureType.Product=1;ProductStructureType.ProductFamily=2;ProductStructureType.ProductBundle=3;return ProductStructureType}();EntityUtilities.ProductStructureType=ProductStructureType;var EntityNames=function(){function EntityNames(){}EntityNames.None="none";EntityNames.Account="account";EntityNames.ActionCard="actioncard";EntityNames.SyncError="syncerror";EntityNames.AccountLeads="accountleads";EntityNames.ActivityMimeAttachment="activitymimeattachment";EntityNames.ActivityParty="activityparty";EntityNames.ActivityPointer="activitypointer";EntityNames.AdvancedSimilarityRule="advancedsimilarityrule";EntityNames.Annotation="annotation";EntityNames.AnnualFiscalCalendar="annualfiscalcalendar";EntityNames.ApplicationFile="applicationfile";EntityNames.Appointment="appointment";EntityNames.AsyncOperation="asyncoperation";EntityNames.Attachment="attachment";EntityNames.AttributeMap="attributemap";EntityNames.Audit="audit";EntityNames.AzureServiceConnection="azureserviceconnection";EntityNames.BaseAddEntityObjectTypeCode="baseaddentityobjecttypecode";EntityNames.BulkDeleteFailure="bulkdeletefailure";EntityNames.BulkDeleteOperation="bulkdeleteoperation";EntityNames.BulkOperation="bulkoperation";EntityNames.BulkOperationLog="bulkoperationlog";EntityNames.BusinessDataLocalizedLabel="businessdatalocalizedlabel";EntityNames.BusinessUnit="businessunit";EntityNames.BusinessUnitMap="businessunitmap";EntityNames.BusinessUnitNewsArticle="businessunitnewsarticle";EntityNames.Calendar="calendar";EntityNames.CalendarRule="calendarrule";EntityNames.Campaign="campaign";EntityNames.CampaignActivity="campaignactivity";EntityNames.CampaignActivityItem="campaignactivityitem";EntityNames.CampaignItem="campaignitem";EntityNames.CampaignResponse="campaignresponse";EntityNames.ChannelProperty="channelproperty";EntityNames.ChannelPropertyGroup="channelpropertygroup";EntityNames.ClientUpdate="clientupdate";EntityNames.ColumnMapping="columnmapping";EntityNames.Commitment="commitment";EntityNames.Competitor="competitor";EntityNames.CompetitorAddress="competitoraddress";EntityNames.CompetitorProduct="competitorproduct";EntityNames.CompetitorSalesLiterature="competitorsalesliterature";EntityNames.ComplexControl="complexcontrol";EntityNames.Connection="connection";EntityNames.ConnectionRole="connectionrole";EntityNames.ConnectionRoleAssociation="connectionroleassociation";EntityNames.ConnectionRoleObjectTypeCode="connectionroleobjecttypecode";EntityNames.ConvertRule="convertrule";EntityNames.ConvertRuleItem="convertruleitem";EntityNames.ConstraintBasedGroup="constraintbasedgroup";EntityNames.Contact="contact";EntityNames.ContactInvoices="contactinvoices";EntityNames.ContactLeads="contactleads";EntityNames.ContactOrders="contactorders";EntityNames.ContactQuotes="contactquotes";EntityNames.Contract="contract";EntityNames.ContractDetail="contractdetail";EntityNames.ContractTemplate="contracttemplate";EntityNames.CustomerAddress="customeraddress";EntityNames.CustomerOpportunityRole="customeropportunityrole";EntityNames.CustomerRelationship="customerrelationship";EntityNames.Dependency="dependency";EntityNames.DependencyNode="dependencynode";EntityNames.Discount="discount";EntityNames.DiscountType="discounttype";EntityNames.DisplayString="displaystring";EntityNames.DisplayStringMap="displaystringmap";EntityNames.DocumentIndex="documentindex";EntityNames.DocumentTemplate="documenttemplate";EntityNames.DuplicateRecord="duplicaterecord";EntityNames.DuplicateRule="duplicaterule";EntityNames.DuplicateRuleCondition="duplicaterulecondition";EntityNames.DynamicProperty="dynamicproperty";EntityNames.DelveActionHub="delveactionhub";EntityNames.DynamicPropertyOptionSetItem="dynamicpropertyoptionsetitem";EntityNames.Email="email";EntityNames.EmailHash="emailhash";EntityNames.EmailSearch="emailsearch";EntityNames.EmailServerProfile="emailserverprofile";EntityNames.EmailSignature="emailsignature";EntityNames.Entitlement="entitlement";EntityNames.EntityMap="entitymap";EntityNames.Equipment="equipment";EntityNames.EntitlementChannel="entitlementchannel";EntityNames.EntitlementTemplateChannel="entitlementtemplatechannel";EntityNames.Fax="fax";EntityNames.FieldPermission="fieldpermission";EntityNames.FieldSecurityProfile="fieldsecurityprofile";EntityNames.FilterTemplate="filtertemplate";EntityNames.FixedMonthlyFiscalCalendar="fixedmonthlyfiscalcalendar";EntityNames.Goal="goal";EntityNames.GoalRollupQuery="goalrollupquery";EntityNames.Import="import";EntityNames.ImportData="importdata";EntityNames.ImportEntityMapping="importentitymapping";EntityNames.ImportFile="importfile";EntityNames.ImportJob="importjob";EntityNames.ImportLog="importlog";EntityNames.ImportMap="importmap";EntityNames.Incident="incident";EntityNames.IncidentResolution="incidentresolution";EntityNames.IntegrationStatus="integrationstatus";EntityNames.InternalAddress="internaladdress";EntityNames.InterProcessLock="interprocesslock";EntityNames.InvalidDependency="invaliddependency";EntityNames.Invoice="invoice";EntityNames.InvoiceDetail="invoicedetail";EntityNames.IsvConfig="isvconfig";EntityNames.KbArticle="kbarticle";EntityNames.KbArticleComment="kbarticlecomment";EntityNames.KbArticleTemplate="kbarticletemplate";EntityNames.KnowledgeArticleTemplate="msdyn_knowledgearticletemplate";EntityNames.NewKbArticle="newkbarticle";EntityNames.KnowledgeArticle="knowledgearticle";EntityNames.KnowledgeArticlesCategories="knowledgearticlescategories";EntityNames.KnowledgeArticleIncident="knowledgearticleincident";EntityNames.KnowledgeArticleViews="knowledgearticleviews";EntityNames.KnowledgeSearchModel="knowledgesearchmodel";EntityNames.LanguageLocale="languagelocale";EntityNames.Lead="lead";EntityNames.LeadAddress="leadaddress";EntityNames.LeadCompetitors="leadcompetitors";EntityNames.LeadProduct="leadproduct";EntityNames.Letter="letter";EntityNames.License="license";EntityNames.List="list";EntityNames.ListMember="listmember";EntityNames.LookUpMapping="lookupmapping";EntityNames.Mailbox="mailbox";EntityNames.MailMergeTemplate="mailmergetemplate";EntityNames.Metric="metric";EntityNames.MobileOfflineProfile="mobileofflineprofile";EntityNames.MobileOfflineProfileItem="mobileofflineprofileitem";EntityNames.MonthlyFiscalCalendar="monthlyfiscalcalendar";EntityNames.Notification="notification";EntityNames.Notes="annotation";EntityNames.OfficeDocument="officedocument";EntityNames.Opportunity="opportunity";EntityNames.OpportunityClose="opportunityclose";EntityNames.OpportunityCompetitors="opportunitycompetitors";EntityNames.OpportunityProduct="opportunityproduct";EntityNames.OrderClose="orderclose";EntityNames.Organization="organization";EntityNames.OrganizationStatistic="organizationstatistic";EntityNames.OrganizationUI="organizationui";EntityNames.Owner="owner";EntityNames.OwnerMapping="ownermapping";EntityNames.PersonalDocumentTemplate="personaldocumenttemplate";EntityNames.PhoneCall="phonecall";EntityNames.PickListMapping="picklistmapping";EntityNames.PluginAssembly="pluginassembly";EntityNames.PluginType="plugintype";EntityNames.PluginTypeStatistic="plugintypestatistic";EntityNames.PluginTraceLog="plugintracelog";EntityNames.Post="post";EntityNames.PostComment="postcomment";EntityNames.PostFollow="postfollow";EntityNames.PostLike="postlike";EntityNames.PostRegarding="postregarding";EntityNames.PostRole="postrole";EntityNames.PriceLevel="pricelevel";EntityNames.PrincipalAttributeAccessMap="principalattributeaccessmap";EntityNames.PrincipalEntityMap="principalentitymap";EntityNames.PrincipalObjectAccess="principalobjectaccess";EntityNames.PrincipalObjectAccessReadSnapshot="principalobjectaccessreadsnapshot";EntityNames.PrincipalObjectAttributeAccess="principalobjectattributeaccess";EntityNames.Privilege="privilege";EntityNames.PrivilegeObjectTypeCodes="privilegeobjecttypecodes";EntityNames.ChannelAccessProfileEntityAccessLevel="channelaccessprofileentityaccesslevel";EntityNames.ProcessSession="processsession";EntityNames.Product="product";EntityNames.ProductAssociation="productassociation";EntityNames.ProductPriceLevel="productpricelevel";EntityNames.ProductSalesLiterature="productsalesliterature";EntityNames.ProductSubstitute="productsubstitute";EntityNames.Publisher="publisher";EntityNames.PublisherAddress="publisheraddress";EntityNames.QuarterlyFiscalCalendar="quarterlyfiscalcalendar";EntityNames.Queue="queue";EntityNames.QueueItem="queueitem";EntityNames.Quote="quote";EntityNames.QuoteClose="quoteclose";EntityNames.QuoteDetail="quotedetail";EntityNames.RecommendationModel="recommendationmodel";EntityNames.RecommendationModelVersion="recommendationmodelversion";EntityNames.RecordCountSnapshot="recordcountsnapshot";EntityNames.RecurrenceRule="recurrencerule";EntityNames.RecurringAppointmentMaster="recurringappointmentmaster";EntityNames.RelationshipRole="relationshiprole";EntityNames.RelationshipRoleMap="relationshiprolemap";EntityNames.ReplicationBacklog="replicationbacklog";EntityNames.Report="report";EntityNames.ReportCategory="reportcategory";EntityNames.ReportEntity="reportentity";EntityNames.ReportLink="reportlink";EntityNames.ReportVisibility="reportvisibility";EntityNames.Resource="resource";EntityNames.ResourceGroup="resourcegroup";EntityNames.ResourceGroupExpansion="resourcegroupexpansion";EntityNames.ResourceSpec="resourcespec";EntityNames.RibbonCommand="ribboncommand";EntityNames.RibbonContextGroup="ribboncontextgroup";EntityNames.RibbonCustomization="ribboncustomization";EntityNames.RibbonDiff="ribbondiff";EntityNames.RibbonRule="ribbonrule";EntityNames.RibbonTabToCommandMap="ribbontabtocommandmap";EntityNames.Role="role";EntityNames.RolePrivileges="roleprivileges";EntityNames.RoleTemplate="roletemplate";EntityNames.RoleTemplatePrivileges="roletemplateprivileges";EntityNames.RollupField="rollupfield";EntityNames.SalesLiterature="salesliterature";EntityNames.SalesLiteratureItem="salesliteratureitem";EntityNames.SalesOrder="salesorder";EntityNames.SalesOrderDetail="salesorderdetail";EntityNames.SalesProcessInstance="salesprocessinstance";EntityNames.SavedQuery="savedquery";EntityNames.SavedQueryVisualization="savedqueryvisualization";EntityNames.SdkMessage="sdkmessage";EntityNames.SdkMessageFilter="sdkmessagefilter";EntityNames.SdkMessagePair="sdkmessagepair";EntityNames.SdkMessageProcessingStep="sdkmessageprocessingstep";EntityNames.SdkMessageProcessingStepImage="sdkmessageprocessingstepimage";EntityNames.SdkMessageProcessingStepSecureConfig="sdkmessageprocessingstepsecureconfig";EntityNames.SdkMessageRequest="sdkmessagerequest";EntityNames.SdkMessageRequestField="sdkmessagerequestfield";EntityNames.SdkMessageResponse="sdkmessageresponse";EntityNames.SdkMessageResponseField="sdkmessageresponsefield";EntityNames.SemiAnnualFiscalCalendar="semiannualfiscalcalendar";EntityNames.Service="service";EntityNames.ServiceAppointment="serviceappointment";EntityNames.ServiceContractContacts="servicecontractcontacts";EntityNames.ServiceEndpoint="serviceendpoint";EntityNames.SharePointDocumentLocation="sharepointdocumentlocation";EntityNames.SharePointData="sharepointdata";EntityNames.SharePointDocument="sharepointdocument";EntityNames.SharePointSite="sharepointsite";EntityNames.Site="site";EntityNames.SiteMap="sitemap";EntityNames.Solution="solution";EntityNames.SocialActivity="socialactivity";EntityNames.SocialProfile="socialprofile";EntityNames.SolutionComponent="solutioncomponent";EntityNames.StatusMap="statusmap";EntityNames.StringMap="stringmap";EntityNames.Subject="subject";EntityNames.Subscription="subscription";EntityNames.SubscriptionClients="subscriptionclients";EntityNames.SubscriptionManuallyTrackedObject="subscriptionmanuallytrackedobject";EntityNames.SubscriptionSyncInfo="subscriptionsyncinfo";EntityNames.SubscriptionTrackingDeletedObject="subscriptiontrackingdeletedobject";EntityNames.SystemForm="systemform";EntityNames.SystemUser="systemuser";EntityNames.Position="position";EntityNames.SystemUserBusinessUnitEntityMap="systemuserbusinessunitentitymap";EntityNames.SystemUserLicenses="systemuserlicenses";EntityNames.SystemUserPrincipals="systemuserprincipals";EntityNames.SystemUserProfiles="systemuserprofiles";EntityNames.SystemUserRoles="systemuserroles";EntityNames.Task="task";EntityNames.Team="team";EntityNames.TeamMembership="teammembership";EntityNames.TeamProfiles="teamprofiles";EntityNames.TeamRoles="teamroles";EntityNames.TeamTemplate="teamtemplate";EntityNames.Template="template";EntityNames.Territory="territory";EntityNames.Theme="theme";EntityNames.TimeZoneDefinition="timezonedefinition";EntityNames.TimeZoneLocalizedName="timezonelocalizedname";EntityNames.TimeZoneRule="timezonerule";EntityNames.TopicModel="topicmodel";EntityNames.TransactionCurrency="transactioncurrency";EntityNames.TransformationMapping="transformationmapping";EntityNames.TransformationParameterMapping="transformationparametermapping";EntityNames.UnresolvedAddress="unresolvedaddress";EntityNames.UoM="uom";EntityNames.UoMSchedule="uomschedule";EntityNames.UserEntityInstanceData="userentityinstancedata";EntityNames.UserEntityUISettings="userentityuisettings";EntityNames.UserFiscalCalendar="userfiscalcalendar";EntityNames.UserForm="userform";EntityNames.UserQuery="userquery";EntityNames.UserQueryVisualization="userqueryvisualization";EntityNames.UserSettings="usersettings";EntityNames.WebResource="webresource";EntityNames.WebWizard="webwizard";EntityNames.WizardAccessPrivilege="wizardaccessprivilege";EntityNames.WizardPage="wizardpage";EntityNames.Workflow="workflow";EntityNames.WorkflowDependency="workflowdependency";EntityNames.WorkflowLog="workflowlog";EntityNames.WorkflowWaitSubscription="workflowwaitsubscription";EntityNames.RoutingRule="routingrule";EntityNames.RoutingRuleItem="routingruleitem";EntityNames.HierarchyRule="hierarchyrule";EntityNames.SLA="sla";EntityNames.SLAItem="slaitem";EntityNames.SLAKPIInstance="slakpiinstance";EntityNames.DataPerformance="dataperformance";EntityNames.ChannelAccessProfileRule="channelaccessprofilerule";EntityNames.ChannelAccessProfileRuleItem="channelaccessprofileruleitem";EntityNames.ExternalParty="externalparty";EntityNames.ExternalPartyItem="externalpartyitem";EntityNames.Category="category";EntityNames.AccountAddress="accountaddress";EntityNames.ActivityScheduling="activityscheduling";EntityNames.AppLicense="applicense";EntityNames.AppOfflineFilter="appofflinefilter";EntityNames.AppSalesPerson="appsalesperson";EntityNames.AppWorkflowInstance="appworkflowinstance";EntityNames.Attribute="attribute";EntityNames.AttributePicklistValue="attributepicklistvalue";EntityNames.BulkDeleteWizardDialog="bulkdeletewizarddialog";EntityNames.ContactAddress="contactaddress";EntityNames.DuplicateDetectionDialog="duplicatedetectiondialog";EntityNames.Entity="entity";EntityNames.EntityRelationship="entityrelationship";EntityNames.EntityRelationshipRole="entityrelationshiprole";EntityNames.HolidayCalendarRule="HolidayCalendarRule";EntityNames.ImportEntity="importentity";EntityNames.ImportWizardDialog="importwizarddialog";EntityNames.LocalizedLabel="localizedlabel";EntityNames.MobileOfflineProfileItemAssociation="mobileofflineprofileitemassociation";EntityNames.NotWorkingWorkShift="notworkingworkshift";EntityNames.OccurrenceCalendarRule="OccurrenceCalendarRule";EntityNames.OccurringWorkShift="occurringworkshift";EntityNames.OptionSet="optionset";EntityNames.RecurrenceCalendarRule="recurrencecalendarrule";EntityNames.RecurringWorkShift="recurringworkShift";EntityNames.Relationship="relationship";EntityNames.ScriptErrorDetailsDialog="scripterrordetailsdialog";EntityNames.ScriptErrorDialog="scripterrordialog";EntityNames.ServiceRestrictionCalendarRule="servicerestrictioncalendarrule";EntityNames.SolutionExportWizard="solutionexportwizard";EntityNames.SolutionImportWizard="solutionimportwizard";EntityNames.TimeOffCalendarRule="timeoffcalendarrule";EntityNames.UnresolvedEmailParty="unresolvedemailparty";EntityNames.ViewAttribute="viewattribute";EntityNames.MailboxStatistics="mailboxstatistics";EntityNames.EntityDashboard="entitydashboard";EntityNames.ReportPropertyDialog="reportpropertydialog";EntityNames.UntrackedEmail="untrackedemail";return EntityNames}();EntityUtilities.EntityNames=EntityNames})(EntityUtilities=InternalUtilities.EntityUtilities||(InternalUtilities.EntityUtilities={}))})(InternalUtilities=XrmCore.InternalUtilities||(XrmCore.InternalUtilities={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var InternalUtilities;(function(InternalUtilities){var GenericUtilities=function(){function GenericUtilities(){}GenericUtilities.getLocalResourceString=function(locLabel){return Xrm.Utility.getResourceString("Main_system_library",locLabel)};GenericUtilities.showGenericProgressIndicator=function(){Xrm.Utility.showProgressIndicator(GenericUtilities.getLocalResourceString("Msg_Progress_MOCA_Dialog"))};GenericUtilities.createChainedEntityMetadataMapWithCallback=function(uniqueEntityTypes,currentIndex,entityNameToMetadataMap,callback){if(currentIndex<uniqueEntityTypes.length)Xrm.Utility.getEntityMetadata(uniqueEntityTypes[currentIndex]).then(function(metadata){entityNameToMetadataMap[uniqueEntityTypes[currentIndex]]=metadata;GenericUtilities.createChainedEntityMetadataMapWithCallback(uniqueEntityTypes,currentIndex+1,entityNameToMetadataMap,callback)},function(error){GenericUtilities.createChainedEntityMetadataMapWithCallback(uniqueEntityTypes,currentIndex+1,entityNameToMetadataMap,callback)});else callback(entityNameToMetadataMap)};GenericUtilities.HandleErrorMessage=function(errorResponse){var errorDialogOptions={message:errorResponse.message,errorCode:errorResponse.errorCode};Xrm.Navigation.openErrorDialog(errorDialogOptions)};GenericUtilities.stringFormat=function(stringToFormat,args){if(!args||stringToFormat===undefined||stringToFormat===null)return stringToFormat||"";return stringToFormat.replace(/{(\d+)}/g,function(match,number){return args[number]!=null&&args[number]!=undefined?args[number]:match})};GenericUtilities.Format=function(format){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];for(var returnValue=format,i=1;i<arguments.length;i++){var actualValue=typeof arguments[i]=="undefined"||arguments[i]==null?"":arguments[i].toString();returnValue=returnValue.replace(new RegExp("\\{"+(i-1)+"\\}","g"),actualValue)}return returnValue};GenericUtilities.isNullOrEmpty=function(s){return s==null||s.length===0};GenericUtilities.isNullOrWhitespace=function(s){return s==null||s.trim().length===0};GenericUtilities.isNullUndefinedOrWhitespace=function(s){return s==null||s==undefined||s.trim().length===0};GenericUtilities.EqualsIgnoreCase=function(string1,string2){var isString1Null=string1==null,isString2Null=string2==null,isString1Undefined=string1==undefined,isString2Undefined=string2==undefined;if(isString1Null&&isString2Null||isString1Undefined&&isString2Undefined)return true;if(isString1Null!=isString2Null||isString1Undefined!=isString2Undefined)return false;return string1.toUpperCase()===string2.toUpperCase()};GenericUtilities.ReplaceLineBreaksWithBrTags=function(text){return text.replace(/(?:\r\n|&#13;&#10;|\r|&#13;|\n|&#10;)/g,"<br />")};GenericUtilities.ConvertEntityRefToLookUp=function(entityRef){return {entityType:entityRef.TypeName,id:entityRef.Id,name:entityRef.Name}};GenericUtilities.Empty="";return GenericUtilities}();InternalUtilities.GenericUtilities=GenericUtilities})(InternalUtilities=XrmCore.InternalUtilities||(XrmCore.InternalUtilities={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var SdkContracts;(function(SdkContracts){var RetrieveDocumentTemplatesRequest=function(){function RetrieveDocumentTemplatesRequest(entityTypeCode,documentType,entityset){this.EntityTypeCode=entityTypeCode;this.DocumentType=documentType;this.entityset=entityset}RetrieveDocumentTemplatesRequest.prototype.getMetadata=function(){var metadata={boundParameter:"entityset",parameterTypes:{entityset:{typeName:"mscrm.documenttemplate",structuralProperty:4},EntityTypeCode:{typeName:"Edm.Int32",structuralProperty:1},DocumentType:{typeName:"Edm.Int32",structuralProperty:1}},operationName:"RetrieveDocumentTemplates",operationType:1};return metadata};return RetrieveDocumentTemplatesRequest}();SdkContracts.RetrieveDocumentTemplatesRequest=RetrieveDocumentTemplatesRequest})(SdkContracts=XrmCore.SdkContracts||(XrmCore.SdkContracts={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var InternalUtilities;(function(InternalUtilities){var ExportUtilities=function(){function ExportUtilities(){}ExportUtilities.retrievePersonalDocumentTemplates=function(entityTypeName,documentType){var entityTypeCode=Xrm.Internal.getEntityCode(entityTypeName),fetchXml="<fetch mapping='logical'> <entity name='personaldocumenttemplate'> <attribute name='personaldocumenttemplateid' /> <attribute name='name' /> <order attribute='name' ascending='true' /><filter type = 'and'> <condition attribute='associatedentitytypecode' operator='eq' value='"+entityTypeCode+"' /> <condition attribute='documenttype' operator='eq' value='"+documentType+"' /> <condition attribute='status' operator= 'eq' value= '0' /> </filter> </entity> </fetch>",deferred=Xrm.WebApi.online.retrieveMultipleRecords("personaldocumenttemplate","?fetchXml="+fetchXml).then(function(response){for(var personalTemplates=[],templates=response.entities,i=0;i<templates.length;i++){var curT={Id:templates[i].personaldocumenttemplateid,Name:templates[i].name};personalTemplates.push(curT)}return personalTemplates},function(e){console.error(e);return null});return deferred};ExportUtilities.retrieveSystemDocumentTemplates=function(entityTypeName,documentType){var systemTemplates=[],entityTypeCode=Xrm.Internal.getEntityCode(entityTypeName),fetchXml="<fetch mapping='logical'> <entity name='documenttemplate'> <attribute name='documenttemplateid' /> <attribute name='name' /><attribute name='clientdata' /> <order attribute='name' descending='false' /><filter type = 'and'> <condition attribute='associatedentitytypecode' operator='eq' value='"+entityTypeCode+"' /> <condition attribute='documenttype' operator='eq' value='"+documentType+"' /> <condition attribute='status' operator= 'eq' value= '0' /> </filter> </entity> </fetch>",deferred=Xrm.WebApi.online.retrieveMultipleRecords("documenttemplate","?fetchXml="+fetchXml).then(function(response){if(response!=null&&response.entities!=null){var templates_1=response.entities,serverURL=Xrm.Utility.getGlobalContext().getClientUrl(),url=serverURL+'/api/data/v9.0/GetClientMetadata(ClientMetadataQuery=@ClientMetadataQuery)?@ClientMetadataQuery={"MetadataType":null,"MetadataSubtype":null,"EntityLogicalName":null,"MetadataId":null,"MetadataName":null,"GetDefault":null,"DependencyDepth":"UserContext","ChangedAfter":null,"Exclude":[],"AppId":null}';return ExportUtilities.ExecuteODataApi(url).then(function(userContextResponse){var metadata=JSON.parse(userContextResponse.Metadata);if(metadata!=null&&metadata.UserContext!=null&&metadata.UserContext.length>0){for(var parentRootRoles=metadata.UserContext[0].ParentRootRoles,userRoles=Xrm.Utility.getGlobalContext()&&Xrm.Utility.getGlobalContext().userSettings&&Xrm.Utility.getGlobalContext().userSettings.securityRoles,i=0;i<templates_1.length;i++)if(ExportUtilities.isValidForCurrentUser(templates_1[i].clientdata,userRoles,parentRootRoles)){var currentTemplate={Id:templates_1[i].documenttemplateid,Name:templates_1[i].name};systemTemplates.push(currentTemplate)}return systemTemplates}},function(error){ExportUtilities.logTelemetryForFailure("GetClientMetadata:UserContext",error,entityTypeName,documentType);return null})}},function(error){ExportUtilities.logTelemetryForFailure("SystemDocumentTemplates.Retrieve",error,entityTypeName,documentType);return null});return deferred};ExportUtilities.isValidForCurrentUser=function(clientData,userRoles,parentRootRoles){var isValidUser=false;if(clientData!=null){var parsedClientData=JSON.parse(Xrm.Encoding.htmlDecode(clientData));if(parsedClientData&&parsedClientData.DisplayConditions){var templateDocment=ExportUtilities.getXmlDOMFromString(parsedClientData.DisplayConditions);if(templateDocment)if(templateDocment.getElementsByTagName("Everyone").length>0)isValidUser=true;else{for(var templateRoles=templateDocment.getElementsByTagName("Role"),templateRoleIds=[],i=0;i<templateRoles.length;i++)templateRoleIds[i]=templateRoles[i].getAttribute("Id").toLowerCase();for(var i=0;i<userRoles.length;i++)if(templateRoleIds.indexOf("{"+userRoles[i].toLowerCase()+"}")>-1){isValidUser=true;break}if(!isValidUser)for(var i=0;i<parentRootRoles.length;i++)if(templateRoleIds.indexOf("{"+parentRootRoles[i].toLowerCase()+"}")>-1){isValidUser=true;break}}}}return isValidUser};ExportUtilities.ExecuteODataApi=function(url){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.onload=function(){if(xhr.readyState==4&&xhr.status==200)if(xhr.response!=null)resolve(JSON.parse(xhr.response));else resolve(xhr.response);else reject(Error(xhr.statusText))};xhr.onerror=function(){reject(Error("Network Error"))};xhr.setRequestHeader("cache-control","no-cache");xhr.setRequestHeader("Content-type","application/json");xhr.setRequestHeader("Accept-Language","en-US,en;q=0.8");xhr.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");xhr.send()})};ExportUtilities.retrieveCreateTemplates=function(){var createTemplate=[{Id:"UploadTemplate",Name:Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Group_UploadTemplate")},{Id:"DownloadTemplate",Name:Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Group_DownloadTemplate")}];return createTemplate};ExportUtilities.retrieveOnlineButton=function(){var createTemplate=[{Id:"OpenExcelOnline",Name:Xrm.Utility.getResourceString("Main_system_library","Menu_Label_OpenExcelOnline")},{Id:"Download",Name:Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Download")}];return createTemplate};ExportUtilities.determineRibbonMenuId=function(entityLogicalName,isForm,ribbonContextType,ribbonRelationshipType,documentType,isOnline){var relType="NoRelationship";if(ribbonRelationshipType===0)relType="OneToMany";else if(ribbonRelationshipType===1)relType="ManyToMany";var contextWithId="SubGrid",ribbonContext="SubGridAssociated";if(isForm){contextWithId="Form";ribbonContext="Form"}else if(ribbonContextType==0){contextWithId="HomepageGrid";ribbonContext="HomePageGrid"}var template="";if(isOnline)template=documentType===2?"WordOnlineTemplates":"DocumentOnlineTemplates";else template=documentType===2?"WordTemplates":"DocumentTemplates";var menuButtonId=entityLogicalName+"|"+relType+"|"+ribbonContext+"|Mscrm."+contextWithId+"."+entityLogicalName+"."+template+".Menu";return menuButtonId};ExportUtilities.determinCreateRibbonCommandId=function(entityLogicalName,isForm,ribbonContextType,documentType,isUpload){var relType="NoRelationship",ribbonContext="SubGridAssociated";if(isForm)ribbonContext="Form";else if(ribbonContextType==0)ribbonContext="HomePageGrid";var docStr=documentType===2?"Word":"Document",opStr="TemplatesMenu",cmdStr=entityLogicalName+"|"+relType+"|"+ribbonContext+"|Mscrm."+docStr+"Template."+opStr;if(documentType===2){var contextStr=isForm?"Form":"Grid";cmdStr=cmdStr+"."+contextStr}return cmdStr};ExportUtilities.determinRibbonCommandId=function(entityLogicalName,isForm,ribbonContextType,ribbonRelationshipType,documentType,isCreate){var relType="NoRelationship";if(ribbonRelationshipType===0)relType="OneToMany";else if(ribbonRelationshipType===1)relType="ManyToMany";var ribbonContext="SubGridAssociated";if(isForm)ribbonContext="Form";else if(ribbonContextType==0)ribbonContext="HomePageGrid";var docStr=documentType===2?"Word":"Document",opStr=isCreate?"Create"+docStr+"Template":"TemplatesMenu",cmdStr=entityLogicalName+"|"+relType+"|"+ribbonContext+"|Mscrm."+docStr+"Template."+opStr;if(documentType===2){var contextStr=isForm?"Form":"Grid";cmdStr=cmdStr+"."+contextStr}return cmdStr};ExportUtilities.buildControlsForCreate=function(menuId,commandId,templates,isUpload,documentType){for(var buttons=[],tempStr=isUpload?"Upload":"Download",docStr=documentType===1?"Excel":"Word",controlsPrefix=menuId+"."+docStr+"Templates.Controls",image="",i=0;i<templates.length;i++){if(image==="")image="SharePointUploadDocument";else image="Download";var button={ControlType:"Button",Id:controlsPrefix+"."+templates[i].Id,Command:commandId,Sequence:String(i*10+10),ToolTipDescription:templates[i].Name,Alt:templates[i].Name,LabelText:templates[i].Name,ModernImage:image};buttons.push(button)}var controls={Id:controlsPrefix,Items:buttons};return controls};ExportUtilities.buildControlsFromTemplates=function(menuId,onlineMenuId,commandId,templates,isSystemTemplate,documentType){var buttons=[],flyoutButtons=[],tempStr=isSystemTemplate?"":"Personal",docStr=documentType===1?"Excel":"Word",image=isSystemTemplate?"SystemDocumentTemplates":"MyDocumentTemplates",onlinecontrolsPrefix=menuId+"."+tempStr+docStr+"Templates.Controls",isOnPrem=Xrm.Utility.getGlobalContext().isOnPremises(),templateButtonForOnline=ExportUtilities.retrieveOnlineButton(),button={ControlType:"Button",Id:"ViewAllMyTemplatesId",Command:commandId,Sequence:String(i*10+10),ToolTipDescription:Xrm.Utility.getResourceString("Main_system_library","View_All_My_Templates"),Alt:Xrm.Utility.getResourceString("Main_system_library","View_All_My_Templates"),LabelText:Xrm.Utility.getResourceString("Main_system_library","View_All_My_Templates"),ModernImage:"ViewAllMyDocumentTemplates"};if(!isOnPrem&&documentType===1&&Xrm.Utility.getGlobalContext().client.getClient()===Xrm.Constants.ClientNames.web){!isSystemTemplate&&flyoutButtons.push(button);for(var i=0;i<templates.length;i++){onlineMenuId=""+onlineMenuId;var flyoutButtonsButtonsControl=InternalUtilities.ExportUtilities.buildOnlineControlsFromTemplates(onlineMenuId,commandId,templateButtonForOnline,templates[i],isSystemTemplate,true,documentType),menuSectionOnline=InternalUtilities.ExportUtilities.buildOnlineMenuSection(onlineMenuId,templates[i],isSystemTemplate,documentType,false,i*10+10,flyoutButtonsButtonsControl),menuSectionsOnline=[];menuSectionsOnline.push(menuSectionOnline);var menuOnline=InternalUtilities.ExportUtilities.buildMenu(onlineMenuId,menuSectionsOnline),flyoutButton={ControlType:"FlyoutAnchor",Id:onlinecontrolsPrefix+"."+templates[i].Id,Command:commandId,Sequence:String(i*10+10),ToolTipDescription:templates[i].Name,Alt:templates[i].Name,LabelText:templates[i].Name,ModernImage:image,Menu:menuOnline};flyoutButtons.push(flyoutButton)}var controls={Id:onlinecontrolsPrefix,Items:flyoutButtons};return controls}else{var controlsPrefix=menuId+"."+tempStr+docStr+"Templates.Controls";!isSystemTemplate&&buttons.push(button);for(var i=0;i<templates.length;i++){var button_1={ControlType:"Button",Id:controlsPrefix+"."+templates[i].Id,Command:commandId,Sequence:String(i*10+10),ToolTipDescription:templates[i].Name,Alt:templates[i].Name,LabelText:templates[i].Name,ModernImage:image};buttons.push(button_1)}var controls={Id:controlsPrefix,Items:buttons};return controls}};ExportUtilities.buildOnlineControlsFromTemplates=function(menuId,commandId,Onlinetemplates,template,isSystemTemplate,isOnline,documentType){for(var buttons=[],tempStr=isSystemTemplate?"":"Personal",docStr=documentType===1?"Excel":"Word",controlsPrefix=menuId+"."+tempStr+docStr+"Templates.Controls",i=0;i<Onlinetemplates.length;i++){var image=Onlinetemplates[i].Id==="OpenExcelOnline"?"ExportToExcel":"DocumentTemplates",button={ControlType:"Button",Id:controlsPrefix+"."+Onlinetemplates[i].Id+"."+template.Id,Command:commandId,Sequence:String(i*10+10),ToolTipDescription:Onlinetemplates[i].Name+" "+template.Name,Alt:Onlinetemplates[i].Name,LabelText:Onlinetemplates[i].Name+" "+template.Name,ModernImage:image};buttons.push(button)}var controls={Id:controlsPrefix+"."+template.Id,Items:buttons};return controls};ExportUtilities.buildMenuSection=function(menuId,isSystemTemplate,documentType,isCreate,sequenceNum,controls){var tempStr=isSystemTemplate?"":"Personal",docStr=documentType===2?"Word":"Excel",sectionStr=isCreate?"CreateTemplates":""+tempStr+docStr+"Templates",titleStr="";if(isCreate)if(documentType==1)titleStr=Xrm.Utility.getResourceString("Main_system_library","Menu_Label_CreateExcelTemplate");else titleStr=Xrm.Utility.getResourceString("Main_system_library","Menu_Label_CreateWordTemplate");else if(documentType==1)if(isSystemTemplate)titleStr=Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Group_ExcelTemplates");else titleStr=Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Group_PersonalExcelTemplates");else if(isSystemTemplate)titleStr=Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Group_WordTemplates");else titleStr=Xrm.Utility.getResourceString("Main_system_library","Menu_Label_Group_PersonalWordTemplates");var section={Id:menuId+"."+sectionStr,Sequence:String(sequenceNum),DisplayMode:6,Title:titleStr,Item:controls};return section};ExportUtilities.buildOnlineMenuSection=function(menuId,template,isSystemTemplate,documentType,isCreate,sequenceNum,controls){var tempStr=isSystemTemplate?"":"Personal",docStr=documentType===2?"Word":"Excel",sectionStr=""+tempStr+docStr+"Templates."+template.Id,titleStr="",section={Id:menuId+"."+sectionStr,Sequence:String(sequenceNum),DisplayMode:6,Title:titleStr,Item:controls};return section};ExportUtilities.buildMenu=function(menuId,menuSections){var menu={Id:menuId,MenuSection:menuSections};return menu};ExportUtilities.generateExportFileName=function(prefix,documentType){var ext=documentType===2?".docx":".xlsx";if(typeof Xrm.Utility.getGlobalContext()!="undefined"&&Xrm.Utility.getGlobalContext()!=null&&typeof Xrm.Utility.getGlobalContext().userSettings!="undefined"&&Xrm.Utility.getGlobalContext().userSettings!=null&&prefix&&prefix.length!=0){var now=new Date,datePattern=Xrm.Utility.getGlobalContext().userSettings.dateFormattingInfo.ShortDatePattern,timePattern=Xrm.Utility.getGlobalContext().userSettings.dateFormattingInfo.LongTimePattern,dateSeparator=Xrm.Utility.getGlobalContext().userSettings.dateFormattingInfo.DateSeparator,timeSeparator=Xrm.Utility.getGlobalContext().userSettings.dateFormattingInfo.TimeSeparator,fileName=prefix+" "+now.format(datePattern)+" "+now.format(timePattern);fileName=fileName.split(dateSeparator).join("-").split(timeSeparator).join("-");return ""+fileName+ext}if(prefix&&prefix.length!=0)return ""+prefix+ext;return "Export"+ext};ExportUtilities.getXmlDOMFromString=function(xmlStr){if(window.ActiveXObject&&window.GetObject){var dom=new ActiveXObject("Microsoft.XMLDOM");dom.loadXML(xmlStr);return dom}if(window.DOMParser)return (new DOMParser).parseFromString(xmlStr,"text/xml");throw new Error("No XML parser available")};ExportUtilities.getXmlAsString=function(xmlDom){return typeof XMLSerializer!=="undefined"?(new window.XMLSerializer).serializeToString(xmlDom):xmlDom.xml};ExportUtilities.getEventParams=function(entityTypeName,documentType){var eventParams=[],entityTypeParam={name:"entityTypeName",value:entityTypeName},documentTypeParam={name:"documentType",value:documentType};eventParams.push(entityTypeParam);eventParams.push(documentTypeParam);return eventParams};ExportUtilities.logTelemetryForFailure=function(componentName,error,entityTypeName,documentType){var errorMessage;if(error.message&&error.message!=null&&error.message!="")errorMessage=error.message;else if(error.innerror&&error.innerror.message&&error.innerror.message!=null&&error.innerror.message!="")errorMessage=error.innerror.message;else errorMessage="Rerteive DocumentTemplates Failed with unknown error";if(Xrm!=null&&Xrm.Reporting!=null){var errorParam={name:"ErrorResponse",message:errorMessage},eventParams=ExportUtilities.getEventParams(entityTypeName,documentType==1?"Excel":"Word");Xrm.Reporting.reportFailure(componentName,errorParam,"",eventParams)}};return ExportUtilities}();InternalUtilities.ExportUtilities=ExportUtilities})(InternalUtilities=XrmCore.InternalUtilities||(XrmCore.InternalUtilities={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var InternalUtilities;(function(InternalUtilities){var oDataVersion="v9.0/",oDataPath="/api/data/"+oDataVersion,formApiPath="/systemforms",headers=[["Prefer",'odata.include-annotations="*"']],fetchXml='<fetch mapping="logical" count="1"><entity name="{0}"><attribute name="{3}" /><filter type="or"><condition attribute="{3}" operator= "eq" value= "{1}" /><filter type="and" ><condition attribute="{2}" operator= "eq" value= "{1}" /><condition attribute="{3}" operator= "not-null" /></filter></filter></entity></fetch>',HierarchyUtilities=function(){function HierarchyUtilities(){}HierarchyUtilities.getEntityRecordUrl=function(entity,name,recordId){var currentEntity={entityType:entity,name:name,id:recordId},currentUrl=Xrm.Internal.getCurrentPageUrl(currentEntity);return currentUrl.replace("pagetype=entityrecord","pagetype=control&controlName=MscrmControls.HierarchyControl.HierarchyControl")};HierarchyUtilities.sendRequest=function(url){var fetch=window.fetch;return fetch(url,{headers:headers}).then(function(response){if(response.ok)return response.text();else throw new Error("Error code: "+response.status)})};HierarchyUtilities.retrieveRelationshipForEntityMetadata=function(entitySetName,encodedFetchXml){var url=this.generateoDataUrlForDataFetch(entitySetName,encodedFetchXml);return this.sendRequest(url)};HierarchyUtilities.generateoDataUrlForDataFetch=function(entitySetName,encodedFetchXml){var hostUrl=Xrm.Utility.getGlobalContext().getClientUrl(),oDataUrl=hostUrl+oDataPath+entitySetName+"?fetchXml="+encodedFetchXml;return oDataUrl};HierarchyUtilities.checkifRecordHierarchyEnabled=function(entityLogicalName,Id,entitySetName,relationship){var result=false;try{return this.retrieveRelationshipForEntityMetadata(entitySetName,InternalUtilities.GenericUtilities.stringFormat(fetchXml,[entityLogicalName,Id,relationship.ReferencedAttribute,relationship.ReferencingAttribute])).then(function(relResponse){var parsedChildResponse=JSON.parse(relResponse);if(parsedChildResponse.value.length>0)result=true;return result})}catch(ex){return Promise.reject(result)}};return HierarchyUtilities}();InternalUtilities.HierarchyUtilities=HierarchyUtilities})(InternalUtilities=XrmCore.InternalUtilities||(XrmCore.InternalUtilities={}))})(XrmCore||(XrmCore={}));var XrmCore;(function(XrmCore){var InternalUtilities;(function(InternalUtilities){var LegacyUtilities=function(){function LegacyUtilities(){}LegacyUtilities.getIFrameForWebClient=function(isForm){var origin=document.origin;try{var currentWindow=window,parent_1=window.parent;while(currentWindow.document.origin===origin){try{if((isForm&&currentWindow.self._IsRefreshForm||!isForm&&!currentWindow.self._IsRefreshForm)&&currentWindow.Mscrm&&currentWindow.Mscrm.RibbonActions)return currentWindow}catch(e){}if(currentWindow===currentWindow.parent)break;currentWindow=currentWindow.parent}currentWindow=window;parent_1=window.parent;while(currentWindow!==parent_1&&parent_1.document.origin===origin){for(var ind=0;ind<parent_1.frames.length;ind++)try{var currentIframe=parent_1.frames[ind];if((isForm&&currentIframe.self._IsRefreshForm||!isForm&&!currentIframe.self._IsRefreshForm)&&currentIframe.Mscrm&&currentIframe.Mscrm.RibbonActions)return currentIframe}catch(e){}currentWindow=parent_1;parent_1=parent_1.parent}return window}catch(e){return window}};return LegacyUtilities}();InternalUtilities.LegacyUtilities=LegacyUtilities})(InternalUtilities=XrmCore.InternalUtilities||(XrmCore.InternalUtilities={}))})(XrmCore||(XrmCore={}));var Mscrm;(function(Mscrm){var ManageProcessActionDialogActions=function(){function ManageProcessActionDialogActions(){}ManageProcessActionDialogActions.onClickOk=function(eventContext){var formContext=eventContext.getFormContext();ManageProcessActionDialogActions.setLastButtonClicked(formContext,XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId);if(Xrm.Page.data.isValid())formContext.ui.close();else ManageProcessActionDialogActions.setLastButtonClicked(formContext,null)};ManageProcessActionDialogActions.onClickCancel=function(eventContext){var formContext=eventContext.getFormContext();ManageProcessActionDialogActions.setLastButtonClicked(formContext,XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogCancelId);formContext.ui.close()};ManageProcessActionDialogActions.setLastButtonClicked=function(formContext,buttonId){var lastButtonClicked=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked);lastButtonClicked&&lastButtonClicked.setValue(buttonId)};return ManageProcessActionDialogActions}();Mscrm.ManageProcessActionDialogActions=ManageProcessActionDialogActions})(Mscrm||(Mscrm={}));var Mscrm;(function(Mscrm){var WorkflowWebResource=function(){function WorkflowWebResource(){}WorkflowWebResource.ShowAbandon=function(){if(Xrm.Page.data.process){var businessProcessFlowInstanceStatus=Xrm.Page.data.process.getStatus();if(businessProcessFlowInstanceStatus)return businessProcessFlowInstanceStatus==WorkflowWebResource.ActiveBusinessProcessFlowInstanceStatus}return false};WorkflowWebResource.ShowFinish=function(){if(Xrm.Page.data.process){var businessProcessFlowInstanceStatus=Xrm.Page.data.process.getStatus(),isBusinessProcessStatusActive=businessProcessFlowInstanceStatus&&businessProcessFlowInstanceStatus==WorkflowWebResource.ActiveBusinessProcessFlowInstanceStatus;if(isBusinessProcessStatusActive==true){var activePath=Xrm.Page.data.process.getActivePath(),activeStage=Xrm.Page.data.process.getActiveStage();if(activePath&&activeStage){var lastStageInPath=activePath.get(activePath.getLength()-1);return activeStage.getId()===lastStageInPath.getId()}}}return false};WorkflowWebResource.ShowReactivate=function(){if(Xrm.Page.data.process){var businessProcessFlowInstanceStatus=Xrm.Page.data.process.getStatus();if(businessProcessFlowInstanceStatus)return businessProcessFlowInstanceStatus!=WorkflowWebResource.ActiveBusinessProcessFlowInstanceStatus}return false};WorkflowWebResource.CanSwitchProcess=function(){if(Xrm.Internal.isUci())return !XrmCore.InternalUtilities.DialogUtilities.isOffline();return true};WorkflowWebResource.CanEditProcess=function(){return WorkflowWebResource.IsBusinessProcessPresent()};WorkflowWebResource.IsBusinessProcessPresent=function(){if(Xrm.Page.ui.process)return true;else return false};WorkflowWebResource.SwitchProcess=function(){if(Xrm.Internal.isUci()){var dialogParams={};dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityIdParameter]=Xrm.Page.data.entity.getId();dialogParams[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.EntityName]=Xrm.Page.data.entity.getEntityName();dialogParams["process_instance_name"]=Xrm.Page.data.process.getInstanceName();var dialogOptions={height:Math.min(500,.9*window.outerHeight),width:Math.min(600,.9*window.outerWidth),position:1};Xrm.Navigation.openDialog("SwitchProcess",dialogOptions,dialogParams).then(function(successParameter){if(successParameter&&successParameter.parameters)if(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId===successParameter.parameters[XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked])if(successParameter.parameters["process_instance_id"])Xrm.Page.data.process.setActiveProcessInstance(successParameter.parameters["process_instance_id"],function(){WorkflowWebResource.SwitchProcessCallBack(successParameter)});else successParameter.parameters["process_id"]&&Xrm.Page.data.process.setActiveProcess(successParameter.parameters["process_id"],function(){WorkflowWebResource.SwitchProcessCallBack(successParameter)})},null)}else Xrm.Page.data.process.switchProcess()};WorkflowWebResource.IsBPFCommandsAvaialableOffline=function(){if(Xrm.Internal.isUci()&&XrmCore.InternalUtilities.DialogUtilities.isOffline())return Xrm.Internal.isFeatureEnabled("EnableBPFOffline");else return true};WorkflowWebResource.SwitchProcessCallBack=function(dialogParams){};WorkflowWebResource.AbandonProcess=function(){Xrm.Page.data.process.abandonProcess()};WorkflowWebResource.ReactivateProcess=function(){Xrm.Page.data.process.reactivateProcess()};WorkflowWebResource.SetActiveStage=function(){var selectedStage=Xrm.Page.data.process.getSelectedStage();selectedStage&&Xrm.Page.data.process.setActiveStage(selectedStage.getId())};WorkflowWebResource.FinishProcess=function(){Xrm.Page.data.process.completeProcess()};WorkflowWebResource.ActiveBusinessProcessFlowInstanceStatus="active";return WorkflowWebResource}();Mscrm.WorkflowWebResource=WorkflowWebResource})(Mscrm||(Mscrm={}));var Mscrm;(function(Mscrm){var ManageSwitchProcessDialogActions=function(){function ManageSwitchProcessDialogActions(){}ManageSwitchProcessDialogActions.onClickCancel=function(eventContext){var formContext=eventContext.getFormContext();ManageSwitchProcessDialogActions.setLastButtonClicked(formContext,XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogCancelId);formContext.ui.close()};ManageSwitchProcessDialogActions.onClickOk=function(eventContext){var formContext=eventContext.getFormContext(),processInstanceIdAttribute=formContext.data.attributes.get("process_instance_id");if(processInstanceIdAttribute&&processInstanceIdAttribute.getValue()==="invalid"){Xrm.Navigation.openAlertDialog({text:XrmCore.InternalUtilities.GenericUtilities.getLocalResourceString("Grid_Action_Too_Many_Custom_Messages_Selected_Alert")});return}ManageSwitchProcessDialogActions.setLastButtonClicked(formContext,XrmCore.InternalUtilities.DialogUtilities.DialogConstants.DialogOkId);formContext.ui.close()};ManageSwitchProcessDialogActions.setLastButtonClicked=function(formContext,buttonId){var lastButtonClicked=formContext.data.attributes.get(XrmCore.InternalUtilities.DialogUtilities.DialogConstants.LastButtonClicked);lastButtonClicked&&lastButtonClicked.setValue(buttonId)};return ManageSwitchProcessDialogActions}();Mscrm.ManageSwitchProcessDialogActions=ManageSwitchProcessDialogActions})(Mscrm||(Mscrm={}))
//# sourceURL=/%7b637836889830000131%7d/webresources/Main_system_library.js</script></body></html>