(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/mds.js?v=1.4.3886-master"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[135,86,127],{"4S6y":function(e,t,a){"use strict";
/*!
 * Copyright (C) Microsoft Corporation. All rights reserved.
 */Object.defineProperty(t,"__esModule",{value:!0}),t.PowerAppsSharedAppHostIframeId=t.PackageKind=t.AuthMode=t.Endpoint=void 0,function(e){e.Local="https://apps.local.powerapps.com:44329",e.Dev="https://apps.dev.powerapps.com",e.Test="https://apps.test.powerapps.com",e.Int="https://apps.int.powerapps.com",e.Preprod="https://apps.preprod.powerapps.com",e.Preview="https://apps.preview.powerapps.com",e.Prod="https://apps.powerapps.com",e.Gcc="https://apps.gov.powerapps.us",e.GccHigh="https://apps.high.powerapps.us",e.Dod="https://play.apps.appsplatform.us",e.Mooncake="https://apps.powerapps.cn"}(t.Endpoint||(t.Endpoint={})),function(e){e[e.Default=0]="Default",e[e.AuthFlowProxy=5]="AuthFlowProxy"}(t.AuthMode||(t.AuthMode={})),function(e){e[e.split=0]="split",e[e.zip=1]="zip",e[e.unknown=2]="unknown"}(t.PackageKind||(t.PackageKind={})),t.PowerAppsSharedAppHostIframeId="PowerAppsSharedAppHostIframe"},"6rnm":function(e,t,a){"use strict";a.d(t,"a",(function(){return f})),a.d(t,"b",(function(){return l}));const r=Symbol("Comlink.proxy"),n=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),i=new WeakSet,s=new Map([["proxy",{canHandle:e=>e&&e[r],serialize(e){const{port1:t,port2:a}=new MessageChannel;return function e(t,a=self){a.addEventListener("message",(function r(n){if(!n||!n.data)return;const{id:o,type:s,path:l}=Object.assign({path:[]},n.data),u=(n.data.argumentList||[]).map(g);let d;try{const a=l.slice(0,-1).reduce((e,t)=>e[t],t),r=l.reduce((e,t)=>e[t],t);switch(s){case 0:d=r;break;case 1:a[l.slice(-1)[0]]=g(n.data.value),d=!0;break;case 2:d=r.apply(a,u);break;case 3:d=f(new r(...u));break;case 4:{const{port1:a,port2:r}=new MessageChannel;e(t,r),d=function(e,t){return p.set(e,t),e}(a,[a])}break;case 5:d=void 0}}catch(e){d=e,i.add(e)}Promise.resolve(d).catch(e=>(i.add(e),e)).then(e=>{const[t,n]=m(e);a.postMessage(Object.assign(Object.assign({},t),{id:o}),n),5===s&&(a.removeEventListener("message",r),c(a))})})),a.start&&a.start()}(e,t),[a,[a]]},deserialize:e=>(e.start(),l(e))}],["throw",{canHandle:e=>i.has(e),serialize(e){const t=e instanceof Error;let a=e;return t&&(a={isError:t,message:e.message,stack:e.stack}),[a,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error,e);throw e}}]]);function c(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function l(e){return function e(t,a=[]){let r=!1;const i=new Proxy((function(){}),{get(n,s){if(u(r),s===o)return()=>E(t,{type:5,path:a.map(e=>e.toString())}).then(()=>{c(t),r=!0});if("then"===s){if(0===a.length)return{then:()=>i};const e=E(t,{type:0,path:a.map(e=>e.toString())}).then(g);return e.then.bind(e)}return e(t,[...a,s])},set(e,n,o){u(r);const[i,s]=m(o);return E(t,{type:1,path:[...a,n].map(e=>e.toString()),value:i},s).then(g)},apply(o,i,s){u(r);const c=a[a.length-1];if(c===n)return E(t,{type:4}).then(g);if("bind"===c)return e(t,a.slice(0,-1));const[l,p]=d(s);return E(t,{type:2,path:a.map(e=>e.toString()),argumentList:l},p).then(g)},construct(e,n){u(r);const[o,i]=d(n);return E(t,{type:3,path:a.map(e=>e.toString()),argumentList:o},i).then(g)}});return i}(e)}function u(e){if(e)throw new Error("Proxy has been released and is not useable")}function d(e){const t=e.map(m);return[t.map(e=>e[0]),(a=t.map(e=>e[1]),Array.prototype.concat.apply([],a))];var a}const p=new WeakMap;function f(e){return Object.assign(e,{[r]:!0})}function m(e){for(const[t,a]of s)if(a.canHandle(e)){const[r,n]=a.serialize(e);return[{type:3,name:t,value:r},n]}return[{type:0,value:e},p.get(e)||[]]}function g(e){switch(e.type){case 3:return s.get(e.name).deserialize(e.value);case 0:return e.value}}function E(e,t,a){return new Promise(r=>{const n=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");e.addEventListener("message",(function t(a){a.data&&a.data.id&&a.data.id===n&&(e.removeEventListener("message",t),r(a.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:n},t),a)})}},CsVN:function(e,t,a){"use strict";a.r(t),a.d(t,"MetadataCachingLevelName",(function(){return Nt})),a.d(t,"IsRoleBasedShimEnabled",(function(){return Dt})),a.d(t,"SWGCMRefreshInBackground",(function(){return At})),a.d(t,"setSendRequest",(function(){return Ht})),a.d(t,"initializeExpressionRuntime",(function(){return qt})),a.d(t,"loadExpressionScripts",(function(){return Gt})),a.d(t,"executeExpressionFunction",(function(){return Bt})),a.d(t,"waitForExpressionRuntimeToBeInitialized",(function(){return zt})),a.d(t,"initializeRetrieveMultipleCache",(function(){return Yt})),a.d(t,"getRetrieveMultipleCache",(function(){return Qt})),a.d(t,"initializeRetrieveCache",(function(){return Kt})),a.d(t,"initializeMDSPromiseCache",(function(){return Zt})),a.d(t,"initializeCache",(function(){return ea})),a.d(t,"getExecutorContext",(function(){return aa})),a.d(t,"execute",(function(){return ra})),a.d(t,"executeSerializedRequest",(function(){return na})),a.d(t,"executeOData",(function(){return ia})),a.d(t,"shouldUseCommonPromiseCache",(function(){return sa})),a.d(t,"retrieve",(function(){return ca})),a.d(t,"retrieveMultiple",(function(){return Oa})),a.d(t,"getClientMetadata",(function(){return ba})),a.d(t,"getRetrievalStrategy",(function(){return Sa})),a.d(t,"getUserContext",(function(){return _a})),a.d(t,"handleOfflineError",(function(){return Na})),a.d(t,"shouldReportFailure",(function(){return Da})),a.d(t,"getRecentItems",(function(){return xa})),a.d(t,"updateRecentItems",(function(){return ka})),a.d(t,"getIsActivityFlags",(function(){return Ua})),a.d(t,"IsAllowedToExecuteRetrieveMultipleInOffline",(function(){return Fa})),a.d(t,"addGCMServerCacheFlagIfNeeded",(function(){return Ha})),a.d(t,"addGCMServiceWorkerRefreshFlagIfNeeded",(function(){return qa})),a.d(t,"addRoleBasedShimEnabledFlagIfNeeded",(function(){return Ga})),a.d(t,"normalizeSLAErrorDetails",(function(){return Ba}));var r=a("5UJb"),n=a.n(r),o=a("+wex"),i=a("Wc7r"),s=a("w1eR"),c=a("3/02"),l=a("Lyxw"),u=a("pEXn"),d=a("EW4s"),p=a("odYE"),f=a("SAYH"),m=a("504W"),g=a("zmAS"),E=a("TwA0"),h=a("sZ+8"),O=a("37s6"),b=a("17x/"),v=a("GYEz"),S=a("Wiik"),y=a("x/BX"),w=a("X37l"),_=a("8nT0"),R=a("t/PV"),j=a("+pAH"),I=a("aRLb"),T=a("K7RF");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class C{constructor(e,t){this.FileAttributeName=e,this.Target=t}getMetadata(){return{boundParameter:null,operationName:"GetFileSasUrl",operationType:1,parameterTypes:{Target:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},FileAttributeName:{typeName:"Edm.String",structuralProperty:1}}}}}var M=a("4r2D"),P=a("SRlt"),N=a("/oKV");var D=a("FZDd"),A=a("WOnu"),L=a("CB5L"),x=a("plj2"),k=a("x/aW"),U=a("hWcn"),F=a("/A5N"),$=a("QRGJ"),H=a("JZmp"),q=a("Zit9"),G=a("Qu5s"),B=a("49Vs"),z=a("c0fp"),V=a("UKgB"),X=a("/JYk"),Y=a("AEtR"),Q=a("Oawc"),W=a("f07+"),K=a("eeMP"),J=a("tHtE"),Z=a("Cxkq"),ee=a("OcZc"),te=a("x0oY"),ae=a("Rvih"),re=a("IuCO"),ne=a("/Zy9"),oe=a("E5IU"),ie=a("LbMF"),se=a("5Oca"),ce=a("iZ7K"),le=a("BDhr"),ue=a("uIhY"),de=a("69Qu"),pe=a("wCzE"),fe=a("IqkD"),me=a("5KQF"),ge=a("Uv1Y"),Ee=a("3c7c"),he=a("TFb5"),Oe=a("qAG9"),be=a("g22U"),ve=a("1TGm"),Se=a("z+5+"),ye=a("7F2l"),we=a("Er26"),_e=a("fYtF"),Re=a("uAlF"),je=a("umme"),Ie=a("H4dV"),Te=a("l3Ef"),Ce=a("vnfk"),Me=a("iJGp"),Pe=a("BSqk"),Ne=a("0lM4"),De=a("16wZ"),Ae=a("YGjz"),Le=a("WWG3"),xe=a("WRF3"),ke=a("jZCH");class Ue{getFormattedvalue(e,t,a,r,n){const o=ke.a.get_DefaultInstance().get_Store().getState(),i=Object(ie.d)(o,e);return Object(te.i)(o,i,t,a,r,Object(De.a)(n)?null:new xe.a(Ae.b,n),e)}parseIntegerValue(e){return Le.a.get_instance().parseIntegerValue(e)}parseDecimalValue(e,t){return Le.a.get_instance().parseDecimalValue(e,t)}parseInvariant(e,t){return Date.parseInvariant(e,t)}async ensureMetadataPresent(e,t,a){const r=ke.a.get_DefaultInstance().get_Store();await r.dispatch(Object(D.f)(e,!1,t,a))}}var Fe=a("2F73"),$e=a("XvL5"),He=a("rO1J"),qe=a("d+dp"),Ge=a("2JG5"),Be=a("UMB/"),ze=a("ai6P"),Ve=a("JdSN"),Xe=a("0rLi"),Ye=a("hs84"),Qe=a("/Viv"),We=a("nxt5"),Ke=a("Xe7f"),Je=a("hirD"),Ze=a("v3UX"),et=a("PF3G"),tt=a("3sOn"),at=a("jjPz"),rt=a("CrQY"),nt=a("SZCI"),ot=a("fMBw"),it=a.n(ot),st=a("sra9"),ct=a("gQ5I"),lt=a("pgSX"),ut=a("si7p"),dt=a("EY5k"),pt=a("YxC/"),ft=a("tICD");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const mt="https://go.microsoft.com/fwlink/?LinkID=398563&";function gt(e,t){return{type:"HANDLE_CUSTOMPAGE_INIT_ERROR",async execute({dispatch:a,getState:r},n){var o,i,s,c,l,u,d,p;const f={type:"error"},m=["Button_Label_OK","Web.Dialog.ErrorCode_Caption","L_Show_Details_Text","L_Client_Session_Id","L_Server_Activity_Id","L_Current_Time","Error_Title_Generic","Crm.GenericErrorMessage","L_CustomPage_ErrorCode","L_CustomPage_ErrorDescription"];let g=null===(o=null==t?void 0:t.errorInfo)||void 0===o?void 0:o.localizedMessage;const E=["Error_Title_Generic","Crm.GenericErrorMessage"];try{await a(Object(dt.e)(m));const o=Object(pt.e)(r(),m),E=Object(pt.c)(o,"Error_Title_Generic"),h=Object(pt.c)(o,"Crm.GenericErrorMessage");g=g||h;const O=Object(pt.c)(o,"Button_Label_OK"),b=Object(pt.c)(o,"L_Show_Details_Text"),v=Object(pt.c)(o,"L_Client_Session_Id"),S=Object(pt.c)(o,"L_Current_Time"),y=Object(pt.c)(o,"L_Server_Activity_Id"),w=Object(pt.c)(o,"L_CustomPage_ErrorCode"),_=Object(pt.c)(o,"L_CustomPage_ErrorDescription"),R=v.replace("{0}",n.EventManager.getCurrentSessionId()),j=y.replace("{0}",n.EventManager.getActivityId()),I=S.replace("{0}",""+new Date),T=(null===(i=null==t?void 0:t.errorInfo)||void 0===i?void 0:i.code)?w.replace("{0}",null===(s=null==t?void 0:t.errorInfo)||void 0===s?void 0:s.code):void 0,C=(null===(c=null==t?void 0:t.errorInfo)||void 0===c?void 0:c.description)?_.replace("{0}",null===(l=null==t?void 0:t.errorInfo)||void 0===l?void 0:l.description):void 0,M=[g,R,j,I];T&&M.push(T),C&&M.push(C);const P=function(e,t,a,r){const n=a?"&Error="+encodeURIComponent(a):"",o=r?"&ErrorDescription="+encodeURIComponent(r):"",i=mt+"client="+encodeURIComponent("CustomPage")+n+o+"&sessionId="+e+"&activityId="+t;return{errorCode:a,helpURL:i}}(n.EventManager.getCurrentSessionId(),n.EventManager.getActivityId(),null===(u=null==t?void 0:t.errorInfo)||void 0===u?void 0:u.code,null===(d=null==t?void 0:t.errorInfo)||void 0===d?void 0:d.description),N=await a(Object(lt.a)(ut.d,g,f,O,E,g,O,b,M,!0,e,P));if(0!==N.status)throw N.error;await a(Object(ft.a)(N.pageId));n.TraceManager.getTracer("CUSTOMPAGE_ERROR_TRACER_CATEGORY").error(g,[{name:"code",value:null===(p=null==t?void 0:t.errorInfo)||void 0===p?void 0:p.code},{name:"errordetails",value:null==t?void 0:t.errorInfo.description},{name:"timestamp",value:null==t?void 0:t.errorInfo.timestamp}]),a(Object(ct.e)(e,"dismiss"))}catch(o){if(t&&t.errorInfo){n.TraceManager.getTracer("CUSTOMPAGE_ERROR_TRACER_CATEGORY").error(g,[{name:"code",value:t.errorInfo.code},{name:"errordetails",value:t.errorInfo.description},{name:"timestamp",value:t.errorInfo.timestamp}])}await a(Object(dt.e)(E));const i=Object(pt.e)(r(),E),s=Object(pt.c)(i,"Error_Title_Generic"),c=Object(pt.c)(i,"Crm.GenericErrorMessage");await a(Object(lt.a)(ut.d,"",f,"",s,c)),a(Object(ct.e)(e,"dismiss"))}}}}var Et=a("pF61"),ht=a("WWXV"),Ot=a("zBbx"),bt=a("iF9X"),vt=a("HkYq"),St=a("eZ32");function yt(e,t){let a="[]";return e&&e.length>0&&(a=e.sort().toString()),`${t}_${a}`}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class wt{constructor(e,t){this._promiseTimeout=3e5,this._cachedPromises={},this._tracer=e,(void 0!==t||null!==t)&&t>0&&(this._promiseTimeout=t)}put(e,t,a,r){var n,o;if(Object(m.b)(e)){const e=new ge.a("Promise cache key must not be empty");throw null===(n=this._tracer)||void 0===n||n.error(`${we.p.ModernDataSourcePromiseCache} ${e.message}`),e}if(this.containsKey(e)){const t=new ge.a("Another promise exists with this key");throw null===(o=this._tracer)||void 0===o||o.error(`${we.p.ModernDataSourcePromiseCache} ${t.message} ${e}:${r}`),t}let i;const s=new Promise((t,n)=>{i=setTimeout(()=>{var t,o;null===(t=this._tracer)||void 0===t||t.info(we.p.ModernDataSourcePromiseCache+" Promise cache timeout exceeded");const i=new ge.a("Promise cache timed out. Operation: "+r,void 0,void 0,new ge.a(`Promise cache timeout Operation: ${r}. CacheKey: ${e}. Cache timeout: ${this._promiseTimeout}`));null===(o=this._tracer)||void 0===o||o.warn(`${we.p.ModernDataSourcePromiseCache} ${i.message}`),Object(m.a)(a)||Object(m.a)(a.get_Stack())||(i.stack=a.get_Stack()),n(i)},this._promiseTimeout)}),c=Promise.race([s,t]);return c.finally(()=>{var t,a;const r=this.get(e);null===(t=this._tracer)||void 0===t||t.info(we.p.ModernDataSourcePromiseCache+" Promise cache attempting to clear cache entry after timeout/fulfillment"),Object(m.a)(r)?null===(a=this._tracer)||void 0===a||a.info(`${we.p.ModernDataSourcePromiseCache} Cache object with key=${e} is undefined`):delete this._cachedPromises[e],window.clearTimeout(i)}),this._cachedPromises[e]=c,c}get(e){return this._cachedPromises[e]}containsKey(e){return e in this._cachedPromises}}var _t=a("lKf0");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function Rt(e,t,a,r,n,o,i,s){return{type:"promiseCache.executeOperationWithCommonPromiseCache.async",async execute({getState:c,dispatch:l},u){try{if(function(e,t,a){if(e&&t){const e=a();if(!Object(m.b)(e)&&e.length<=jt)return!0}return!1}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */(e,t,a)){const e=a();if(t.containsKey(e))return t.get(e);return await t.put(e,l(r),s,n)}return await l(r)}catch(e){const t=ge.a.toLegacyErrorStatus(Object(ge.c)(e));throw null==o||o.error(`${n} failed. Unexpected error ${t.get_Message()}`,i),t}}}}const jt=P.c.RETRIEVE_MULTIPLE_URL_LENGTH_LIMIT;const It={Create:$.a,Update:re.a,Delete:H.a,ExecuteMultiple:G.a,Retrieve:te.f,RetrievePrincipalAccess:Z.a,InitializeFrom:Q.a,RetrieveProcessControlData:ee.a,RetrieveMultiple:J.c,Disassociate:q.a,ExecuteQuickFind:B.a,GetClientMetadata:X.a},Tt=it.a.createEvent(nt.z,nt.G),Ct=it.a.createEvent(nt.z,nt.D),Mt=it.a.createEvent("ParseMetadata",nt.G),Pt=it.a.createEvent("ParseMetadata",nt.D),Nt="x-ms-metadatacachinglevel",Dt="x-ms-rolebasedprofileshim",At="x-ms-sw-refreshinbackground";var Lt,xt;let kt,Ut,Ft,$t;function Ht(e){e.sendRequest=(e,t,a,r,n,o,i,s,c)=>(a.info(La()+" Execute custom page request."),Ta(e,t,a,c,r,n,o,i,s))}function qt(e,t,a){return kt||(kt=new Promise(async(r,n)=>{const o=[];Object(Se.a)(o,be.d.EXPRESSION_FUNCTION),o.push({name:we.f.OPERATION_SUB_TYPE,value:be.c.Initialization});const i=a.TraceManager.getTracer(we.k.ExpressionRuntime),s=performance.now();try{const n=await Object(x.b)(e,(e,t)=>Ta(e,t,a.TraceManager.getTracer(we.k.ModernDataSource),void 0,N.a.Default,a),t,i,a,o);if(Ut=null==n?void 0:n.executeRequest,Ft=null==n?void 0:n.executeFunction,$t=null==n?void 0:n.loadAdditionalScripts,Ut&&Ft&&$t){t.dispatch(Object(R.b)(t.getState(),!0));const e=performance.now()-s;o.push({name:P.c.RESPONSE_TIME,value:e}),a.EventManager.ReportComponentSuccess(we.k.ExpressionRuntime,o)}r()}catch(e){t.dispatch(Object(R.b)(t.getState(),!1));const r=performance.now()-s;o.push({name:P.c.RESPONSE_TIME,value:r}),a.EventManager.ReportComponentFailure(we.k.ExpressionRuntime,e,void 0,o);const c=Object(st.b)(t.getState());c&&t.dispatch(gt(Object(Et.c)(t.getState()),c)),i.error(`[${we.p.ExpressionRuntimeHost}] Expression runtime failed to initialize: ${e.message}`),n(e)}}),kt)}async function Gt(e,t,a,r){var n;const o=null===(n=null==t?void 0:t.TraceManager)||void 0===n?void 0:n.getTracer(we.k.ExpressionRuntime);if(await zt(),$t||Vt(o,a,r,"load scripts"),e&&Object.keys(e).length>0){const a=[];Object(Se.a)(a,be.d.EXPRESSION_FUNCTION),a.push({name:we.f.OPERATION_SUB_TYPE,value:be.c.LoadAdditionalScripts}),a.push({name:"NumberOfScripts",value:Object.keys(e).length});const r=performance.now();try{await $t(e);const n=performance.now()-r;a.push({name:P.c.RESPONSE_TIME,value:n}),t.EventManager.ReportComponentSuccess(we.k.ExpressionRuntime,a)}catch(e){const n=performance.now()-r;throw a.push({name:P.c.RESPONSE_TIME,value:n}),t.EventManager.ReportComponentFailure(we.k.ExpressionRuntime,e,void 0,a),e}}}async function Bt(e,t,a,r,n,o,i,s){var c;const l=null===(c=null==s?void 0:s.TraceManager)||void 0===c?void 0:c.getTracer(we.k.ExpressionRuntime);return await zt(),Ft||Vt(l,n,o,"ExecuteExpressionFunction"),Ft(e,t,a,r,i)}async function zt(){if(kt)try{await kt}finally{kt=void 0}}function Vt(e,t,a,r){if(Ie.a.getInstance().get_IsBrowserIE())throw null==e||e.warn(`[${we.p.ExpressionRuntimeHost}] There was an error initializing expression runtime. Internet explorer is not supported`),new ge.a(Object(pt.b)(t(),_t.k));const n=Object(st.b)(t());if(n&&(null==e||e.warn(`[${we.p.ExpressionRuntimeHost}] There was an error initializing expression runtime. There was an error initializing AppHost Client`),a(gt(Object(Et.c)(t()),n))),r)throw new ge.a(r+" endpoint is not initialized");throw new ge.a("There was an error initializing expression runtime")}!function(e){e[e.None=0]="None",e[e.EntityMetadataReduction=1]="EntityMetadataReduction",e[e.UserContextMetadataReduction=2]="UserContextMetadataReduction",e[e.EntityMetadataReductionPhase2=4]="EntityMetadataReductionPhase2"}(Lt||(Lt={})),function(e){e[e.None=0]="None",e[e.Form=1]="Form"}(xt||(xt={}));let Xt=null;function Yt(){Xt=new Pe.a}function Qt(){return Xt}let Wt=null;function Kt(){return Wt=new Qe.a,Wt}let Jt=null;function Zt(e){var t;return Jt=new wt(null===(t=null==e?void 0:e.TraceManager)||void 0===t?void 0:t.getTracer(we.k.ModernDataSource)),Jt}function ea(e,t){Object(Se.g)(e.getState())&&Zt(t),!Object(Se.i)(e.getState())&&Object(Se.p)(e.getState())&&Kt(),Object(Se.n)(e.getState())&&Yt()}let ta=null;function aa(e,t){var a,r;const n=e(),i={TraceManager:null!==(a=null==t?void 0:t.TraceManager)&&void 0!==a?a:new o.ConsoleTraceManager,EventManager:null!==(r=null==t?void 0:t.EventManager)&&void 0!==r?r:new o.ConsoleEventManager,SqlExecutor:new Ce.SqlExecutorImpl,AdditionalParameters:{EnableOptimizedDependency:!Object(m.a)(e)&&Object(l.f)(e(),c.dc)&&Object(v.a)(e())===s.a.MobileApplication,EnableDependency:!1,SingletonExecutor:!Object(m.a)(e)&&Object(l.f)(e(),c.Oe),isEntityPayloadReductionRequested:!Object(m.a)(e)&&Object(l.f)(e(),c.Hc),isSecondPhasePayloadReductionEnabled:!Object(m.a)(e)&&Object(l.f)(e(),c.Ic)},Formatter:new Ue};return Object(l.f)(n,c.ke)&&(i.ApplicationState=n),i}function ra(e,t,a,r=N.a.Default,n,o=[],i={}){return{type:"modernDataSource.execute.legacy.async",async execute({getState:s,dispatch:c},l){const u=l.TraceManager.getTracer(we.k.ModernDataSource);u.info(La()+" Execute legacy request."),null==n||n.AppendCallStack(La()+".execute");const d=await async function(e,t,a){if(t instanceof Ke.a||t instanceof et.a||t instanceof Je.a||t instanceof rt.a)return await e.dispatch(function(e,t){return{type:"RETRIEVE_ADDITIONAL_METADATA_FOR_LEGACY_REQUEST",execute({dispatch:a,getState:r},n){const o=function e(t,a,r){if(a instanceof Je.a)for(const n of a.get_requests())t=e(t,n,r);else if(a instanceof Ke.a||a instanceof et.a){const e=a.get_target(),n=Object(se.c)(r,e);Object(I.a)(t,e.get_identifier().LogicalName,n)}return t}({},e,r());return a(Object(D.e)(o,t)).then(()=>{const n=function e(t,a,r){if(a instanceof Je.a)for(const n of a.get_requests())t=e(t,n,r);else if(a instanceof Ke.a||a instanceof et.a){const e=a.get_target(),n=Object(se.y)(r,e);for(const e of n)t[e]=[]}return t}({},e,r());if(Object.keys(n).length>0)return a(Object(D.e)(n,t))})}}}(t,a)),Object(U.h)(e.getState(),t)}(t,e,a);if(!d){const t=new ge.a(`Unable to convert legacy request ${e.get_name()} to ODataContract`);throw u.error(`${La()} ${t.message}`),t}const p=await c(Object(U.l)(d,a,r,n,i)),f=c(function(e,t,a){return{type:"modernDataSource.tolegacyresponse.async",async execute({dispatch:a}){const r=t.get_name();if(!It[r])return e;{const n=It[r](e,t),o=await a(n);if(o instanceof We.a)return o}}}}(await Ta(p,s,u,a,r,l,!1,o),e));return oa(c,s(),d,p,u),f}}}function na(e,t,a,r=N.a.Remote){return{type:"modernDataSource.execute.serialized.request.async",async execute({getState:n,dispatch:o},i){const s=[],c=i.TraceManager.getTracer(we.k.ModernDataSource);c.info(La()+" Execute serialized request.");const l=Object(U.c)(n(),i,e);Object(U.b)(l,s),a&&a.push({name:P.c.CLIENT_REQUEST_ID,value:Object(U.n)(l)});return await Ta(l,n,c,t,r,i,!0,s)}}}function oa(e,t,a,r,n){var o,s;if(Se.f.indexOf(a.getMetadata().operationName)>-1&&(null===(o=r.additionalHeaders)||void 0===o?void 0:o[i.HEADER.EXECUTION_HINT])===i.EXECUTION_HINTS.OFFLINE&&"true"!==r.additionalHeaders[i.HEADER.UPSYNC_REQUEST_HINT]&&Object(oe.r)(t)&&Object(de.d)(t)){const r=Object(I.c)(t,n)({},a),o=[];o.push({name:"entities",value:null===(s=Object.keys(r))||void 0===s?void 0:s.join(",")}),e(Object(g.initializeOfflineUpsyncProcessAsyncAction)(!0,o))}}function ia(e,t=N.a.Default,a,r=[],n={},o,i){return{type:"modernDataSource.execute.odata.async",async execute({getState:s,dispatch:c},l){var u,d;const p=l.TraceManager.getTracer(we.k.ModernDataSource);p.info(La()+" Execute Odata request."),null==a||a.AppendCallStack(La()+".executeOData");const f=await c(Object(U.l)(e,o,t,a,n,i));if(f.serializationFailure)throw new ge.a("Cannot serialize request: "+f.serializationFailure);e instanceof V.a&&(qa(e.ClientMetadataQuery,f,r),Ga(s(),e.ClientMetadataQuery,f,r),(null===(u=e.ClientMetadataQuery)||void 0===u?void 0:u.MetadataType)&&r.push({name:we.f.METADATA_TYPE,value:e.ClientMetadataQuery.MetadataType}),(null===(d=e.ClientMetadataQuery)||void 0===d?void 0:d.DependencyDepth)&&r.push({name:we.f.METADATA_TYPE,value:e.ClientMetadataQuery.DependencyDepth}),r.push({name:"GCMRequestExecuteViaSQLBatchV2",value:Object(b.k)(s())}));const m=sa(a,s());if(m){const n=Object(be.f)(f),i=()=>function(e){var t;return null!==(t=null==e?void 0:e.urlParameters)&&void 0!==t?t:null}(f),s=function(e,t,a,r=N.a.Default,n,o=[],i){return{type:"moderndatasource.execute.odata.internal.async",async execute({getState:s,dispatch:c},l){const u=await Ta(e,s,t,a,r,n,!1,o);return oa(c,s(),i,e,t),u}}}(f,p,o,t,l,r,e),u=`${n.type}-${n.source}`;return await c(Rt(m,Jt,i,s,u,p,r,a))}const g=await Ta(f,s,p,o,t,l,!1,r);return oa(c,s(),e,f,p),g}}}function sa(e,t){return Object(Se.g)(t)&&e&&"function"==typeof e.get_UseCommonPromiseCache&&e.get_UseCommonPromiseCache()}function ca(e,t,a,r,n,o,i){return{type:"moderndatasource.retrieve.async",async execute({getState:s,dispatch:u},g){const O=g.TraceManager.getTracer(we.k.ModernDataSource),v=[];v.push({name:"EntityLogicalName",value:e.etn}),v.push({name:"EntityRecordId",value:f.a.toString(e.id)}),t&&v.push({name:"ColumnSet",value:t.join(",")}),r&&v.push({name:"BPFRequest",value:r.toString()});const S=function(e,t,a,r,n,o,i,s){return{type:"moderndatasource.retrieve.async",async execute({getState:u,dispatch:g},O){const v=O.TraceManager.getTracer(we.k.ModernDataSource),S=t?new $e.a(t):new Fe.a,y=new d.a;if(!Object(Se.i)(u()))if(Wt){const t=function(e,t,a,r){const n=f.a.toString(e.id)+"-with-BPF",o=f.a.toString(e.id);return t||(null==Wt?void 0:Wt.get(n,a,r))?n:o}(e,r,S,s),n=Wt.get(t,S,s);if(n)return v.info(La()+" returning retrieve result from cache",o),n;Wt.put(y,t,S,s,a)}else v.error(La()+" Retrieve promise cache was not initialized",o);try{v.info(La()+" Starting retrieve operation",o),a.AppendCallStack(La()+".retrieve"),await Object(Se.G)(e.etn,t,u,g,o,n);const d=u();if(Object(b.i)(d)&&Object(h.n)(d,e.etn)&&(s=N.a.Local),!Object(de.d)(d)&&Object(E.isOfflineAvailableForUse)(d)&&!Object(h.n)(d,e.etn)){const t=new ge.a(Object(Re.a)(-2147093999),-2147093999,null,ge.a.fromErrorCode(d,-2147093987,f.a.toString(e.id),e.etn),$a(d,void 0,N.a.Local),null,null,o,null,null,a.get_Stack());return v.error(La()+" Retrieve failed because entity is not available offline",o),y.reject(ge.a.toLegacyErrorStatus(t))}if(!Object(de.d)(d)&&Object(E.isOfflineAvailableForUse)(d)||s===N.a.Local){Object(l.f)(d,c.of)||(i=null);if(!Object(ce.h)(d,e.etn).IsBusinessProcessEnabled||!r){const r=await ma(e,t,O,a,g,u(),o,n,i,N.a.Local);return y.resolve(r)}const s=[new W.i(p.a.toExternalEntityReference(e),t,i),r],f=await ua(y,e,t,i,s,a,O,g,u,o,v,n,null,N.a.Local);return y.resolve(f)}if(Object(de.d)(d)){const s=Object(ce.h)(d,e.etn);if(Ge.a.hasAccessRights(e.etn,O.DataSource.get_MetadataCache())){if(!s){const e=new ge.a("Retrieve - Entity metadata not found.");v.error(La()+" Retrieve failed when trying to get entity descriptor from state",o);const t=ge.a.toLegacyErrorStatus(e);return Object(Se.a)(o,be.d.RETRIEVE),wa(O,o,t,u(),we.k.ModernDataSourceRetrieve),y.reject(t)}if(s.IsChildEntity){t&&t.length>0&&t.indexOf(s.ParentEntityReferencingAttribute)<0&&t.push(s.ParentEntityReferencingAttribute);const r=await ma(e,t,O,a,g,u(),o,n,i,N.a.Remote),c=p.a.fromLegacyEntityReference(r.getValue(s.ParentEntityReferencingAttribute)),l=[new W.g(p.a.toExternalEntityReference(c),{id:f.a.toString(Object(fe.q)(u())),entityType:"systemuser"})];let d;if(!ga(s,t,u,v,o)){const e=ne.c.fromXml(ha(c));e.skipPagingDefaults=!0,d=e.getQueryState(),d.entityLogicalName="principalobjectattributeaccess"}const m=await la(e,t,i,l,a,O,g,u,o,n,d,N.a.Remote);return r.set_accessRights(m.retrievePrincipalAccessResponse.get_accessRights()),m.retrieveUserSharedAttributePermissionsResponse&&r.set_userSharedAttributePrivileges(Ea(m.retrieveUserSharedAttributePermissionsResponse)),y.resolve(r)}const c=[new W.i(p.a.toExternalEntityReference(e),t,i),new W.g(p.a.toExternalEntityReference(e),{id:f.a.toString(Object(fe.q)(u())),entityType:"systemuser"})];(s.IsBusinessProcessEnabled||s.IsBPFEntity)&&r&&c.push(r);let l;if(!ga(s,t,u,v,o)){const t=ne.c.fromXml(ha(e));t.skipPagingDefaults=!0,l=t.getQueryState(),l.entityLogicalName="principalobjectattributeaccess"}const d=await ua(y,e,t,i,c,a,O,g,u,o,v,n,l,N.a.Remote);return y.resolve(d)}if(!s||!s.IsBusinessProcessEnabled||!r){const r=await ma(e,t,O,a,g,u(),o,n,i,N.a.Remote);return y.resolve(r)}const c=[new W.i(p.a.toExternalEntityReference(e),t,i),r],l=await ua(y,e,t,i,c,a,O,g,u,o,v,n,null,N.a.Remote);return l.get_globalNavigationData()&&(l.fields[Be.a]=l.get_globalNavigationData().fields[Be.a].Id,l.fields[Be.c]=l.get_globalNavigationData().fields[Be.b],l.fields[Be.d]=l.get_globalNavigationData().fields[Be.d]),y.resolve(l)}v.error(La()+" Retrieve failed. Offline not ready for use and server is not available",o);const m=ge.a.fromErrorCode(d,-2147093999);m.errorSource=$a(d,void 0,s);const S=ge.a.toLegacyErrorStatus(m);return Object(Se.a)(o,be.d.RETRIEVE),wa(O,o,S,u(),we.k.ModernDataSourceRetrieve,"Retrieve failed. Offline not ready for use and server is not available"),y.reject(S)}catch(e){const t=ge.a.toLegacyErrorStatus(Object(ge.c)(e));return v.error(`${La()} Retrieve failed. Unexpected error ${t.get_Message()}`,o),Object(Se.a)(o,be.d.RETRIEVE),(Object(m.a)(e._errorSource)||e._errorSource===ht.a.Unknown)&&wa(O,o,t,u(),we.k.ModernDataSource),y.reject(e)}}}}(e,t,a,r,n,v,o,i);if(Object(Se.i)(s())){if(Jt){let n=
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function(e,t,a){if(void 0!==a&&void 0===N.a[a])throw new ge.a("Unknown retrieval strategy");const r=f.a.toString(e.id)+"-with-BPF";return`${yt(t,a)}_${r}`}(e,t,i);if(r||Jt.containsKey(n)||(n=function(e,t,a){if(void 0!==a&&void 0===N.a[a])throw new ge.a("Unknown retrieval strategy");const r=f.a.toString(e.id);return`${yt(t,a)}_${r}`}(e,t,i)),Jt.containsKey(n))return Jt.get(n);return await Jt.put(n,u(S),a,be.d.RETRIEVE)}null==O||O.error(La()+" MDS promise cache is not initialized",v)}return await u(S)}}}async function la(e,t,a,r,n,o,i,s,c,l,u,d=N.a.Default){const p=o.TraceManager.getTracer(we.k.ModernDataSource),f=new W.f(r),m=await i(Object(U.l)(f,l,d,n));if(!m||m.serializationFailure)throw c.push({name:we.f.OPERATION_TYPE,value:be.d.RETRIEVE}),c.push({name:we.f.OPERATION_SUB_TYPE,value:be.c.Retrieve}),c.push({name:we.f.ENTITY_NAME,value:e.etn}),new ge.a("Cannot serialize Retrieve request : "+(null==m?void 0:m.serializationFailure));m.additionalParameters||(p.warn(La()+" additional parameters for batch request was unexpectedly null",c),m.additionalParameters={}),m.additionalParameters[be.a.TYPE]=be.d.RETRIEVE,m.additionalParameters[be.a.SUB_TYPE]=be.c.Retrieve,m.additionalParameters[we.e]=e.etn;const g=await Ta(m,s,p,l,d,o),E=await Object(K.b)(g);let h=null,O=null,b=null,v=null;u&&(v=await i(Oa(u,n,l)));for(const r of E){if(!r.ok){p.warn(`${La()} One of the results of a batch call returned error ${r.statusText}`,c);continue}const n=(await r.json())["@odata.context"];n.indexOf("RetrievePrincipalAccess")>0?h=await i(Object(Z.a)(r,null)):n.indexOf("RetrieveProcessControlData")>0?b=await i(Object(ee.a)(r,null,l)):O=await i(da(r,e,t,a,l))}return{retrieveResponse:O,retrieveProcessControlDataResponse:b,retrievePrincipalAccessResponse:h,retrieveUserSharedAttributePermissionsResponse:v}}async function ua(e,t,a,r,n,o,i,s,c,l,u,d,p,f=N.a.Default){var g;const E=await la(t,a,r,n,o,i,s,c,l,d,p,f);null==o||o.AppendCallStack(La()+".retrieveEntityWithPermissions");let h=E.retrieveResponse;if(Object(m.a)(h)){throw je.a.fromErrorCode(-2147220969)}return r&&f===N.a.Remote&&(h=await fa(c(),t,h,r,s,u,d)),E.retrievePrincipalAccessResponse&&h.set_accessRights(E.retrievePrincipalAccessResponse.get_accessRights()),E.retrieveProcessControlDataResponse&&(h.set_entityRecordForProcess(E.retrieveProcessControlDataResponse.get_entity()),h.get_entityRecordForProcess()&&(null===(g=h.get_entityRecordForProcess())||void 0===g||g.mergeEntityRecordFields(h),h.mergeEntityRecordFields(h.get_entityRecordForProcess())),E.retrieveProcessControlDataResponse.get_globalNavigationData()&&E.retrieveProcessControlDataResponse.get_globalNavigationData().fields&&(h.set_globalNavigationData(E.retrieveProcessControlDataResponse.get_globalNavigationData()),Object(de.d)(c())&&(h.get_globalNavigationData().fields.bpfDefinitionVersionNumber=E.retrieveProcessControlDataResponse.get_bpfDefinitionVersionNumber()))),E.retrieveUserSharedAttributePermissionsResponse&&h.set_userSharedAttributePrivileges(Ea(E.retrieveUserSharedAttributePermissionsResponse)),h.set_clientRetrieveOptions(new qe.a(0,f)),e.resolve(h)}function da(e,t,a,r,n){return{type:"moderndatasource.retrievemultiple.async",execute:async({getState:o,dispatch:i},s)=>(await i(Object(te.f)(e,new Ze.a(p.a.toLegacyEntityReference(t),a&&a.length>0?new $e.a(a):new Fe.a,void 0,void 0,void 0,r),n))).get_entity()}}async function pa(e,t,a,r,n,o){const i=new d.a,s=[];try{t.fields[_.w]=await r(
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function(e,t,a){return{type:"GetSasUrl",async execute({dispatch:r,getState:n},o){const i=o.TraceManager.getTracer("GetSasUrl");try{const n=new C(e,p.a.toExternalEntityReference(t)),o=new M.a(f.a.newGuid().guid),i=await r(ia(n,N.a.Remote,o,void 0,void 0,a));return(await Object(P.g)(i)).Result.SasUrl}catch(a){const r=[];throw r.push({name:"FileAttributeName",value:e}),r.push({name:"EntityName",value:t.etn}),r.push({name:"Error",value:a}),i.error("GetSasUrl failed",r),a}}}}(a,e,o)),i.resolve(t)}catch(r){const o=ge.a.toLegacyErrorStatus(Object(ge.c)(r));s.push({name:"Error",value:o.get_Message()}),s.push({name:"AttributeName",value:a}),s.push({name:"EntityName",value:e.etn}),n.error(La()+" Failed to retrieve sas url for one attribute of record",s),i.resolve(t)}return i}async function fa(e,t,a,r,n,o,i){try{const s=[],c=[];if(r)for(const c of r){const r=c.get_relationShipName(),l=a.getValue(r);if(l)for(const a of l){const c=a.get_identifier().LogicalName;if(c===Te.C||c===Te.w){if((c===Te.C?a.getValue(_.i):a.getValue(_.j))>j.d){const l=c===Te.C?Object(ce.z)(e,t.etn,r).ReferencingAttribute.substring(0,Object(ce.z)(e,t.etn,r).ReferencingAttribute.lastIndexOf("id")):a.getValue(_.u);s.push(pa(t,a,l,n,o,i))}}}}if(s.length>0)return c.push({name:"SasUrlRequestCount",value:s.length}),c.push({name:"EntityName",value:t.etn}),Promise.all(s).then(()=>a).catch(e=>{const t=ge.a.toLegacyErrorStatus(Object(ge.c)(e));return c.push({name:"Error",value:t.get_Message()}),o.error(La()+" Failed to retrieve sas urls for the record",c),a})}catch(e){const t=ge.a.toLegacyErrorStatus(Object(ge.c)(e));o.error(`${La()} Failed to retrieve sas url ${t.get_Message()}`)}return a}async function ma(e,t,a,r,n,o,i,s,c,l=N.a.Default){const u=a.TraceManager.getTracer(we.k.ModernDataSource);null==r||r.AppendCallStack(La()+".retrieveSingleEntity");const d=new W.i(p.a.toExternalEntityReference(e),t,c),f=await n(ia(d,l,r,i,void 0,s));let m=await n(da(f,e,t,c,s));return m.set_clientRetrieveOptions(new qe.a(0,l)),c&&l===N.a.Remote&&(m=await fa(o,e,m,c,n,u,s)),m}function ga(e,t,a,r,n){try{const r=Object(ie.k)(a(),e.EntityLogicalName,t),n=Object(fe.n)(a());let o=!0;for(const e in r)if(r[e].IsSecured){const t=r[e].Id?n[f.a.toString(r[e].Id)]:null;if(!t||!t.canRead||!t.canUpdate){o=!1;break}}return o}catch(e){return r.error(La()+" Error occurred when checking secured attribute permissions",n),!1}}function Ea(e){const t={};for(let a=0;a<e.get_count();a++){const r=e.get_item(a).getValue("attributeid"),n=1===e.get_item(a).getValue("readaccess").get_value(),o=1===e.get_item(a).getValue("updateaccess").get_value();if(r.toString()in t&&(n||o)){const e=new He.a(r,!1,n||t[r.toString()].get_CanRead(),o||t[r.toString()].get_CanUpdate());t[r.toString()]=e}else r.toString()in t||(t[r.toString()]=new He.a(r,!1,n,o))}return t}function ha(e){return'<fetch distinct="false" no-lock="false" mapping="logical"><entity name="principalobjectattributeaccess"><attribute name="attributeid" /><attribute name="readaccess" /><attribute name="updateaccess" /><filter type="and"><condition attribute="objectid" operator="eq" value="'+f.a.toString(e.id)+'" /><condition attribute="principalid" operator="eq-useroruserteams" /></filter></entity></fetch>'}function Oa(e,t,a){return{type:"moderndatasource.retrievemultiple.async",async execute({getState:r,dispatch:n},o){const i=o.TraceManager.getTracer(we.k.ModernDataSource);i.info(La()+" Retrieve multiple is executing");const s=[];s.push({name:"queryKey",value:null==e?void 0:e.publicKey});const c=new d.a;if(!(null==e?void 0:e.fetchXml))return i.error(La()+" Empty query or Invalid fetch XML",s),c.reject(je.a.fromErrorCode(-2147220733));if(Xt){const t=Xt.get(e.key);if(!Object(m.a)(t))return t.getPromise();Xt.put(e.key,new Ne.a(c,e.key,"RetrieveMultiple"))}else i.error(La()+" RetrieveMultiple promise cache was not initialized",s);const l=Object(he.p)(e.fetchXml);if(!Object(de.d)(r())&&Object(E.isOfflineAvailableForUse)(r())&&!Fa(e.fetchXml,r(),l,i,s)){const a=new ge.a(Object(Re.a)(-2147093999),-2147093999,null,ge.a.fromErrorCode(r(),-2147093987,e.publicKey),$a(r(),void 0,N.a.Local),null,null,s,null,null,t.get_Stack());return i.error(`${La()} RetrieveMultiple failed because one or more entities are not available offline '${e.publicKey}'`,s),c.reject(ge.a.toLegacyErrorStatus(a))}await n(Object(D.e)(l,a));const u=await n(Object(U.m)(e)),p=Object(J.d)(r(),e.fetchXml);if(p&&p.additionalColumns&&p.additionalColumns.length>0&&Object(U.e)(u,p.additionalColumns,i),Object(m.a)(t)){const e=Object(U.n)(u);t=new M.a(e,!1)}t.AppendCallStack(La()+".retrieveMultiple"),Object(U.b)(u,s),Object(_e.d)(u,s);try{const n=await Ta(u,r,i,a,N.a.Default,o,!1,s,!1,t,e.key),l=await Object(P.g)(n),d=Object(J.a)(r(),e,p,l);return c.resolve(d)}catch(a){if(a instanceof je.a&&Object(Se.j)(a)){const n=ge.a.fromErrorCode(r(),-2147093987,e.publicKey),o=new ge.a(Object(Re.a)(-2147093999),-2147093999,null,n,null,null,null,s,null,null,t.get_Stack()),l=a.get_Message()||"Not available for offline usage";return i.warn(`${La()} ${l} with key '${e.publicKey}' and entity ${e.entityLogicalName}`,s),c.reject(je.a.fromGenericError(o))}const n=`${La()} RetrieveMultiple with key ${e.publicKey} failed with error ${null==a?void 0:a.message}.`;i.error(n,s);return wa(o,s,ge.a.toLegacyErrorStatus(Object(ge.c)(a)),r(),we.k.ModernDataSourceRM,n),c.reject(a)}}}}function ba(e,t,a,r=N.a.LocalAndRemote){return Object(at.a)(arguments,{type:"moderndatasource.getclientmetadata.async",async execute({dispatch:n,getState:o},s,u){const d=s.TraceManager.getTracer(we.k.ModernDataSource);d.info(La()+" Get Client Metadata is executing"),null==t||t.AppendCallStack(La()+".getClientMetadata");const p=Object(k.b)(e),g=o();!g&&e.MetadataType&&d.warn(`${La()} Trying to execute a ${e.MetadataType} GCM call with depth ${e.DependencyDepth} when state is null`);null===f.a.tryParseOrNull(Object(oe.k)(g))&&e.MetadataType===i.APP_ENTITY&&(p.AppId=f.a.fromLegacyGuid(e.MetadataId));const E=Object(l.f)(g,c.Pd),h=E?new z.a:new V.a;h.ClientMetadataQuery=p;const v=await n(Object(U.k)(h,t));let w,_;if(Object(m.a)(v.additionalParameters)&&(v.additionalParameters={}),v.additionalParameters[we.i]=r,v.urlParameters&&Object(ve.a)(e.MetadataType,e.DependencyDepth)){const e=Object(pe.a)(g),t=Object(le.b)(g);w=e.currentVersion?e.currentVersion:-1,_=t.currentVersion?t.currentVersion:-1,v.urlParameters=v.urlParameters+`&umv=${w.toString()}&mv=${_.toString()}`}const R=[];if(qa(e,v,R),Ha(g,e,v,R),v.urlParameters=v.urlParameters+P.c.API_FRAGMENT_9_1,Object(y.a)(g)&&(v.additionalHeaders.Consistency="Strong",n(Object(S.b)(!1))),Object(l.f)(g,c.Hc)){let e=Lt.EntityMetadataReduction;Object(l.f)(g,c.Ic)&&(e|=Lt.EntityMetadataReductionPhase2),v.additionalHeaders["x-ms-metadatareductionlevel"]=e.toString()}Ga(g,e,v,R),R.push({name:"GCMRequestExecuteViaSQLBatchV2",value:Object(b.k)(g)});const j=!!Object(m.a)(Object(O.w)(g))||Object(O.w)(g)===St.a.Available&&(Object(b.e)(g)||!Object(bt.e)(g)),I=!!Object(m.a)(Object(O.w)(g))||Object(O.k)(g),T=s.DataSource.get_IsLocalDataSourceAvailable()&&(j||I);if(Object(m.a)(t)){const e=Object(U.n)(v);t=new M.a(e,!1)}R.push({name:"InputRetrievalStrategy",value:N.a[r]}),R.push({name:"isFirstApplyApplicationMetadataChangesDone",value:Object(O.k)(g)}),R.push({name:"LocalDSAvailable",value:T}),R.push({name:"RemoteDSAvailable",value:Object(de.d)(g)}),R.push({name:"IgnoreCodeCache",value:Object(O.E)(g,!1)}),va(e,v,w,_,R);const C=e.DependencyDepth===L.b.UserContext;C&&(v.additionalHeaders["x-ms-metadatareductionlevel"]=Lt.UserContextMetadataReduction.toString());const D=(e,a,r)=>ya(e,o,a,E,n,d,s,t,R,C,r);if((r=Sa(r,g,e,R,s))!==N.a.LocalAndRemote){if(r===N.a.Local){if(T){const r=await D(v,N.a.Local,a);if((Object(m.a)(r)||0===Object.keys(r).length)&&!C){const a=je.a.fromLocalStoreError(-2147093987,`Not in local store ${e.MetadataType} ${e.MetadataSubtype}`);return a.set_Stack(t.get_Stack()),d.warn(La()+" Entity was validated against local store, but empty response",R),d.error(`${La()} ${a.get_Message()}`,R),{}}return r}return d.warn(La()+" local data source is not available and retrieval strategy is Local.",R),{}}if(r===N.a.Remote&&Object(de.d)(g))return D(v,N.a.Remote,a);{const e=je.a.fromErrorCode(-2147093999);throw e.set_Stack(t.get_Stack()),d.error(La()+" Remote data source is not available and retrieval strategy is remote, so error in GCM",R),wa(s,R,e,o(),we.k.ModernDataSourceGCM,"getClientMetadata failed (known allowed error)"),e}}if(!T){if(Object(de.d)(g))return D(v,N.a.Remote,a);{const e=je.a.fromErrorCode(-2147093999);throw e.set_Stack(t.get_Stack()),d.error(La()+" remote and local data sources are not available so error in GCM",R),wa(s,R,e,o(),we.k.ModernDataSourceGCM,"getClientMetadata failed (known allowed error)"),e}}try{const e=await D(v,N.a.Local,a);if(!Object(l.f)(o(),c.Je)&&(Object(m.a)(e)||0===Object.keys(e).length)&&!C){const e=je.a.fromErrorCode(-2147093987);throw d.warn(La()+" Entity was validated against local store, but empty response",R),e}return e}catch(e){if(d.warn(`${La()} error in local data source GCM, retrying with remote data source. Error is: ${Object(ge.d)(e)}`,R),Object(de.d)(g))return D(v,N.a.Remote,a);const r=je.a.fromLocalStoreError(-2147093999,La()+" remote data source is not available and error in local data source GCM");throw r.set_InnerError(e),r.set_Stack(t.get_Stack()),d.error(`${La()} ${r.get_Message()}`,R),wa(s,R,r,o(),we.k.ModernDataSourceGCM,"getClientMetadata failed (known allowed error)"),r}}})}function va(e,t,a,r,n){var o;e.MetadataType&&n.push({name:we.f.METADATA_TYPE,value:e.MetadataType}),e.MetadataSubtype&&n.push({name:we.f.METADATA_SUB_TYPE,value:e.MetadataSubtype}),(null===(o=e.MetadataNames)||void 0===o?void 0:o.length)>0&&n.push({name:we.f.METADATA_NAMES,value:JSON.stringify(e.MetadataNames)}),e.DependencyDepth&&n.push({name:we.f.DEPENDENCY_DEPTH,value:e.DependencyDepth}),e.GetDefault&&n.push({name:we.f.GET_DEFAULT,value:e.GetDefault}),e.IsPreloadCall&&n.push({name:we.f.IS_PRELOAD_CALL,value:e.IsPreloadCall}),e.ChangedAfter&&n.push({name:we.f.CHANGED_AFTER,value:e.ChangedAfter}),e.EntityLogicalName?n.push({name:we.f.ENTITY_LOGICAL_NAME,value:e.EntityLogicalName}):e.MetadataType===D.a&&n.push({name:we.f.ENTITY_LOGICAL_NAME,value:JSON.stringify(Object.keys(JSON.parse(Object(Ee.c)(e.MetadataSubtype))))}),e.MetadataId&&n.push({name:we.f.METADATA_ID,value:e.MetadataId.toString()}),e.Exclude&&e.Exclude.length>0&&n.push({name:we.f.EXCLUDE,value:JSON.stringify(e.Exclude.map(e=>e.toString()))}),a&&n.push({name:we.f.UMV,value:a}),r&&n.push({name:we.f.MV,value:r}),t.additionalHeaders&&t.additionalHeaders["x-ms-metadatareductionlevel"]&&n.push({name:we.f.METADATA_REDUCTION_LEVEL,value:t.additionalHeaders["x-ms-metadatareductionlevel"]}),Object(U.b)(t,n,!0)}function Sa(e,t,a,r,n){let o=!1;try{return e===N.a.LocalAndRemote&&Object(O.E)(t,!1)&&Object(de.d)(t)&&(o=Object(l.f)(t,c.qe),a.EntityLogicalName?e=o&&Object(h.o)(t,a.EntityLogicalName)||Object(h.n)(t,a.EntityLogicalName)?N.a.Local:N.a.Remote:a.MetadataType===D.a&&(e=0===Object.keys(JSON.parse(Object(Ee.c)(a.MetadataSubtype))).filter(e=>o?!Object(h.o)(t,e)&&!Object(h.n)(t,e):!Object(h.n)(t,e)).length?N.a.Local:N.a.Remote)),r.push({name:"UseSyncedMetadata",value:o}),e}catch(e){r.push({name:"UseSyncedMetadata",value:o});const a=je.a.fromGenericError(e);throw wa(n,r,a,t,we.k.ModernDataSourceGCM,"getClientMetadata failed (known allowed error)"),a}}async function ya(e,t,a,r,n,o,i,s,c,l,u){c.push({name:"FinalRetrievalStrategy",value:N.a[a]});try{null==s||s.AppendCallStack(La()+"._sendGCMRequestInternal");const d=await Ta(e,t,o,u,a,i,!0,c,!1,s),p=await n(Object(U.s)(d,r,s,o));return null==s||s.AppendCallStack(La()+".toGCMResponse.Complete"),!Object(m.a)(p)&&Object.keys(p).length>0&&!l&&(p.finalRetrievalStrategy=a),null==s||s.AppendCallStack(La()+"._sendGCMRequestInternal.Complete"),p}catch(e){const a=ge.a.toLegacyErrorStatus(Object(ge.c)(e));throw o.error(`${La()} Get Client Metadata failed with error: ${a.get_Message()}`,c),wa(i,c,a,t(),we.k.ModernDataSourceGCM,"getClientMetadata failed (known allowed error)"),a}}function wa(e,t,a,r,n,o){const i=ge.a.fromLegacyErrorStatus(a,r),s=Ba(i,t);if(t.push({name:P.c.CRM_ERROR_CODE,value:i.errorCode}),Object(ye.b)(n,i.errorCode,Object(ge.d)(i)))e.EventManager.ReportComponentFailure(n,s,null,t);else{e.TraceManager.getTracer(n).error(`${La()} ${o||a.get_Message()}`,t)}}function _a(e,t){return{type:"moderndatasource.getusercontext.async",async execute({dispatch:a,getState:r},n){const o=n.TraceManager.getTracer(we.k.ModernDataSource);o.info(La()+" Get User Context is executing");const i=r(),s=Object(oe.k)(i),c=new Xe.a(null,null,null,null,[],!1,Me.a.UserContext,null,[],f.a.toLegacyGuid(f.a.tryParseOrNull(s))),l=new M.a(f.a.toString(f.a.newGuid()));null==l||l.AppendCallStack(La()+".getUserContext");const u=[];u.push({name:P.c.CLIENT_REQUEST_ID,value:l.RequestId()}),u.push({name:"InputRetrievalStrategy",value:N.a[e]});const d=await a(ba(c,l,t,e));if(!d||!d.UserContext||!d.UserContext[0]){if(u.push({name:P.c.OTHER_DETAILS,value:"UserContext call failed in MDL via "+N.a[e]}),e!==N.a.Local||e===N.a.Local&&!Object(de.d)(i)?(n.EventManager.ReportComponentFailure(we.k.ModernDataSourceUserContext,u),o.error(`${La()} User Context was not returned from MDL. Strategy ${e}`,u)):o.warn(`${La()} User Context was not returned from MDL. Strategy ${e}`,u),e===N.a.Local)return null;throw new Ve.a(null,"error","UserContext was not returned from GetClientMetadata call")}if(Object.keys(d).length>1){o.info(`${La()} UserContext call with strategy ${e} returned additional metadata`);const t=Object(me.a)(d,null,null,i,null,null,o,s);t.webResourcesContent=null,a(Object(T.c)(t))}return u.push({name:P.c.OTHER_DETAILS,value:"UserContext call succeeded in MDL via "+N.a[e]}),e===N.a.Local?(n.EventManager.ReportComponentSuccess(we.k.ModernDataSourceUserContext,u),tt.a.createFromObjectData(d.UserContext[0])):(n.EventManager.ReportComponentSuccess(we.k.ModernDataSourceUserContext,u),Object(ze.a)(d.UserContext[0]))}}}function Ra(e,t){return Object(E.getIsOfflineEnabled)(e)&&Object(E.isOfflineAvailableForUse)(e)&&Object(U.r)(e,t)}function ja(e){return Object(E.getIsOfflineEnabled)(e)?Object(E.isOfflineAvailableForUse)(e)?"related entity is not enabled for offline":"offline is not yet available":"the app is not offline enabled"}async function Ia(e,t,a,r,i){null==r||r.AppendCallStack(La()+"._sendRequestInternal");const s=null==a?void 0:a.TraceManager.getTracer(we.k.ModernDataSource);null==s||s.info(La()+" Execute the request in Modern Data Layer Component");const u=function(e,t){let a;if(Object(l.f)(e(),c.Oe)){if(!ta){const a=aa(e,t);ta=new o.ODataExecutor(null,a)}a=ta}else{const r=aa(e,t);a=new o.ODataExecutor(null,r)}return a}(t,a),d=n.a.trackWork("MDS");await function(e,t){const a=ke.a.get_DefaultInstance();return new Promise((r,n)=>{if(Object(o.getClientType)(Object(Se.F)(e))!==we.c.remote||!a||!a.get_IsWaitingForNetwork())return r();{const o=[];Object(U.b)(e,o),null==t||t.warn(`${La()} ${we.x}`);a.get_WaitingForNetworkPromise().always(e=>a.get_IsNetworkAvailable()?(o.push({name:we.y,value:"Success"}),null==t||t.warn(`${La()}\n\t\t\t\t\t\t${we.z}`,o),r()):(o.push({name:we.y,value:"Failed"}),null==t||t.error(`${La()} ${we.w}`,o),n()))}}).catch(()=>{throw je.a.fromErrorCode(-2147093999)})}(e,s);const p=await u.execute(Object(Se.F)(e),i);return d(),null==r||r.AppendCallStack(La()+"._sendRequestInternal.Complete"),p}async function Ta(e,t,a,r,n=N.a.Default,u,d=!1,p=[],f=!1,m=null,g=null){var E,h,O;const S=performance.now();null==m||m.AppendCallStack(La()+"._sendRequest"),function(e,t,a=N.a.Default,r=!1,n){try{let n;if(t.additionalHeaders||(t.additionalHeaders={}),e)switch(a){case N.a.Local:if(!r&&!Ra(e,t)){const t=ja(e);throw je.a.fromErrorCodeAndMessage(-2147093999,"Can't execute 'Offline' request as "+t)}n=i.EXECUTION_HINTS.OFFLINE;break;case N.a.Remote:if(!r&&!Object(de.d)(e))throw je.a.fromErrorCodeAndMessage(-2147093999,"Can't execute 'Online' request as server is NOT available");n=i.EXECUTION_HINTS.ONLINE;break;case N.a.Default:if(t.additionalHeaders[i.HEADER.EXECUTION_HINT])return;if(Object(oe.r)(e)&&Object(de.d)(e)&&Ra(e,t)){t.additionalHeaders.clientType=we.c.local;const e={[we.j]:!0};t.additionalParameters=t.additionalParameters?Object.assign(Object.assign({},t.additionalParameters),e):e,n=i.EXECUTION_HINTS.OFFLINE}else if(Object(de.d)(e))n=i.EXECUTION_HINTS.ONLINE;else{if(!Ra(e,t)){const t=ja(e);throw je.a.fromErrorCodeAndMessage(-2147093999,"Can't execute 'Default' request as the server is NOT available and "+t)}n=i.EXECUTION_HINTS.OFFLINE}break;default:throw je.a.FromMessage("Currently MDL does not support the strategy: "+a)}else n=a===N.a.Local?i.EXECUTION_HINTS.OFFLINE:i.EXECUTION_HINTS.ONLINE;t.additionalHeaders[i.HEADER.EXECUTION_HINT]=n}catch(a){const r=[];throw Object(U.b)(t,r),wa(n,r,ge.a.toLegacyErrorStatus(Object(ge.c)(a)),e,we.k.ModernDataSource),a}}(t(),e,n,d,u),function(e,t=null){let a=N.a.Default;if((null==e?void 0:e.additionalHeaders[i.HEADER.EXECUTION_HINT])===i.EXECUTION_HINTS.OFFLINE?a=N.a.Local:(null==e?void 0:e.additionalHeaders[i.HEADER.EXECUTION_HINT])===i.EXECUTION_HINTS.ONLINE?a=N.a.Remote:(null==e?void 0:e.additionalHeaders[i.HEADER.EXECUTION_HINT])===i.EXECUTION_HINTS.OFFLINE_THEN_ONLINE&&(a=N.a.LocalAndRemote),t&&(null==Xt?void 0:Xt.containsKey(t))){const e=Xt.get(t);e.getRetrievalStrategy()!==N.a.Local&&e.setRetrievalStrategy(a)}}(e,g);if(Object(l.f)(t(),c.De)&&e.expressionRuntimeSupportedRequest){const o=[];Object(U.b)(e,o);const i=Ut&&await Ut(e,r);if(i)return Ca(t,i,e,n,S,u,a,!0,r,o);a.warn(La()+" No Data Component handled this request - Response is Null",o)}let y=e;(f=f||function(e){return"GET"===e.method&&"remote"===Object(o.getClientType)(Object(Se.F)(e))&&Object(ue.c)(e.urlParameters).length>P.c.VERY_LONG_URL}(e)||function(e,t){return Object(l.f)(e(),c.y)&&"GET"===t.method&&"remote"===Object(o.getClientType)(Object(Se.F)(t))&&t.additionalParameters&&t.additionalParameters[be.a.TYPE]===be.d.RETRIEVE_MULTIPLE&&Object(v.a)(e())===s.a.MobileApplication&&!0===Ie.a.getInstance().get_IsAndroid()&&Object(ue.c)(t.urlParameters).length>P.c.RETRIEVE_MULTIPLE_URL_LENGTH_LIMIT}(t,e))&&(p.push({name:"isConvertToBatchRequestNeeded",value:f}),y=Object(U.g)(t(),e)),Object(U.d)(y),Object(U.b)(e,p),Object(b.b)(t(),p);const w={};w[nt.w]=null===(E=y.additionalParameters)||void 0===E?void 0:E[be.a.TYPE],w[nt.F]=P.c.canLogDetailsOfRequest(y.urlParameters)?y.urlParameters:P.c.trimUrl(y.urlParameters),w.requestId=Object(U.n)(e);const _=(null===(h=y.additionalHeaders)||void 0===h?void 0:h[i.HEADER.EXECUTION_HINT])===i.EXECUTION_HINTS.ONLINE?Tt.startStopwatch(w):Ct.startStopwatch(w),R={eventParameters:[]};let j=await Ia(y,t,u,m,R);const I=(null===(O=y.additionalHeaders)||void 0===O?void 0:O[i.HEADER.EXECUTION_HINT])===i.EXECUTION_HINTS.ONLINE?Mt.startStopwatch(w):Pt.startStopwatch(w);f&&(j=await async function(e,t,a){const r=await Object(K.b)(e);if(r&&r.length>0)return r[0];return t.warn(La()+" Invalid response list returned from parseBatchResponse",a),e}(j,a,p));const T=Ca(t,j,e,n,S,u,a,!1,r,p,R);return I(),_(),T}async function Ca(e,t,a,r,n,o,s,c,l,u=[],d){const p=performance.now()-n;if(u.push({name:P.c.RESPONSE_TIME,value:p}),function(e,t,a){const r=(null==e?void 0:e.headers)?Object(Oe.a)(e.headers,i.HEADER.SERVER_REQUEST_ID):P.c.UNKNOWN,n=(null==e?void 0:e.status)?e.status:null,o=(null==e?void 0:e.type)?e.type:null,s=(null==e?void 0:e.statusText)?e.statusText:null,c=(null==e?void 0:e.url)?P.c.trimUrl(e.url):null,l=(null==e?void 0:e.headers)?Object(Oe.a)(e.headers,"Content-Length"):P.c.UNKNOWN;t.push({name:P.c.RESPONSE_URL,value:c}),t.push({name:P.c.HTTP_STATUS_CODE,value:n}),t.push({name:P.c.HTTP_RESPONSE_TYPE,value:o}),t.push({name:P.c.HTTP_RESPONSE_STATUSTEXT,value:s}),t.push({name:P.c.SERVER_REQUEST_ID,value:r}),t.push({name:P.c.RESPONSE_SIZE_IN_BYTES,value:l}),t.push({name:P.c.IS_BATCH_REQUEST,value:!1}),t.push({name:"IS_EXPRESSION_RUNTIME_REQUEST",value:a})}(t,u,c),t.ok){const e=(null==d?void 0:d.eventParameters)||[];return o.EventManager.ReportComponentSuccess(we.k.ModernDataSource,u.concat(e)),t}if(401!==t.status)return"GET"===a.method&&414===t.status?Ma(e,o,s,a,r,u,l):t.url&&-1!==t.url.indexOf("$batch")||a&&a.urlParameters&&-1!==a.urlParameters.indexOf("$batch")?Object(K.b)(t).then(r=>{if(r){const n=r.find(e=>!e.ok)||t;return Pa(e(),n,o,a,u,s)}let n=null;throw n=new Ve.a(t,t.statusText,"Batch request failed with http Status : "+t.status),n}):(null==s||s.error(La()+" Modern Data Layer component returns Error Response - Convert error to CRM Error.",u),Pa(e(),t,o,a,u,s).catch(t=>{if("GET"===a.method&&Aa(t))return Ma(e,o,s,a,r,u,l);throw t}));{null==s||s.error(La()+" Modern Data Layer : 401 response from server.",u);const t=ke.a.get_DefaultInstance().get_RemoteCallRetryHandler();try{return await t.handleAuthError(a),null==s||s.error(La()+" Modern Data Layer : 401 response from server, handleAuthError() was successful, retrying the request.",u),Object(Ot.a)(e(),a),Ta(a,e,s,l,r,o,!0,u)}catch(e){throw s&&s.error(La()+" Error in 401 error handling",u),e}}}async function Ma(e,t,a,r,n,o,i){o.push({name:"RetriedAsBatch",value:!0}),a.warn(`${La()} ${P.c.LONG_URL_RETRY}`,o);return await Ta(r,e,a,i,n,t,!1,o,!0)}function Pa(e,t,a,r,n,o){try{return t.text().then(s=>{var c,l;const d=function(e,t,a,r){let n=null;const o=e&&e.toLowerCase().indexOf("<!doctype html")>-1;n=o?Ve.a.createFromHtml(e,t):new Ve.a(t,t.statusText,e);const s=t.headers?Object(Oe.a)(t.headers,"Retry-After"):null;n.set_retryAfter(s);const c=t.headers?Object(Oe.a)(t.headers,"Content-ID"):null;if(c){const e=Number.parseInt(c,10);e>-1&&n.set_contentId(e)}const l=t.headers?Object(Oe.a)(t.headers,i.HEADER.SERVER_REQUEST_ID):P.c.UNKNOWN,u=Object(U.n)(a);n.set_serverResponseId(l),n.set_clientRequestId(u);const d=t.headers&&Object(Oe.a)(t.headers,"Date")?new Date(Object(Oe.a)(t.headers,"Date")):null;n.set_date(d);const p=t&&0===t.status;return n.set_isErrorInOffline(p),r.push({name:P.c.ODATA_ERROR_RESPONSE_IS_HTML_TYPE,value:o}),r.push({name:P.c.IS_ERROR_IN_OFFLINE,value:p}),n}(s,t,r,n);P.c.canLogDetailsOfRequest(t.url)&&(n.push({name:P.c.ODATA_ERROR_RESPONSE_COMPLETE_TEXT,value:s}),n.push({name:P.c.CRM_ERROR_RESPONSE_COMPLETE_TEXT_FROM_ODATA_RESPONSE,value:JSON.stringify(d)}));let p=null,f=null,m=d&&d.get_message?d.get_message():null;if(d.get_organizationServiceFault&&d.get_organizationServiceFault()){f=d.get_organizationServiceFault().get_errorCode();try{null==m&&(m=d.get_error())}catch(e){n.push({name:P.c.CRM_ERROR_RESPONSE_GET_ERROR,value:P.c.FAILED})}try{const e=JSON.parse(d.get_error());p=e.error&&e.error.innererror?e.error.innererror.stacktrace:null}catch(e){n.push({name:P.c.CRM_ERROR_RESPONSE_GET_ERROR_PARSING,value:P.c.FAILED})}}let g=m||P.c.REQUEST_FAILURE;(!Object(ye.a)(f)||r&&P.c.isSearchRequest(r.endpoint))&&(g=P.c.UCIMONITOR_ERROR_MESSAGE),n.push({name:P.c.CRM_ERROR_CODE,value:f}),n.push({name:P.c.CRM_CALL_STACK,value:p}),n.push({name:P.c.CRM_ERROR_MESSAGE,value:g});const E=t?t.status:null;if(null===(c=r.additionalParameters)||void 0===c?void 0:c[we.j]){let t,a;(t=Object(F.c)(r.urlParameters))&&(a=Object(h.b)(e,t)).error&&n.push({name:we.f.ERROR_DETAIL,value:"Linked entity is not available offline"},{name:u.b.RelatedEntityUnavailableOffline,value:a.relatedEntityUnavailableOffline})}const O=Ye.a.GetErrorStatusFromErrorResponse(d);if(O.set_ErrorSource($a(e,null===(l=r.additionalHeaders)||void 0===l?void 0:l[i.HEADER.EXECUTION_HINT])),0===f&&0!==O.get_ErrorCode()&&(f=O.get_ErrorCode()),Da(r,E,f,O,a,e)){const e=new ge.a(g,f,null,null,null,null,null,n,null,null,null,null,null,null,E,d.get_clientRequestId(),d.get_serverResponseId());a.EventManager.ReportComponentFailure(we.k.ModernDataSource,e,void 0,n)}else o&&o.error(`${La()} ${g}`,n);throw Object(de.d)(e)&&!d.get_isErrorInOffline()||(O.set_ErrorCode(-2147093999),O.set_Message(je.a.fromErrorCode(-2147093999).get_Message()),O.set_InnerError(Ye.a.GetErrorStatusFromErrorResponse(d)),Na(a,d,e,o,n)),O})}catch(t){null==o||o.error(La()+" Modern Data Layer component : Exception occurred while creating error response.",n);let a=-2147093999;Object(de.d)(e)&&(a=-2147015419);throw je.a.fromErrorCode(a)}}function Na(e,t,a,r,n){var o;const i=Object(m.a)(t.get_request())?-1:t.get_request().status,s=e.DataSource;n.push({name:"InitialServerAvailability",value:s.get_IsServerAvailable()}),n.push({name:"NetworkAvailability",value:Object(de.b)(a)}),n.push({name:"OrgServiceFaultErrorCode",value:null===(o=t.get_organizationServiceFault())||void 0===o?void 0:o.get_errorCode()}),n.push({name:"HttpStatusCode",value:i}),n.push({name:"IsErrorInOffline",value:t.get_isErrorInOffline()}),Object(l.f)(a,c.Qg)&&!Object(b.e)(a)&&Object(de.d)(a)&&Object(de.b)(a)&&!Object(E.getIsOfflineEnabled)(a)&&t.get_isErrorInOffline()&&(s.set_IsServerAvailable(!1),n.push({name:"NewServerAvailability",value:s.get_IsServerAvailable()}),r.warn(`${La()} [_handleOfflineError] Received 'Failed to fetch'. Setting server availability to: ${s.get_IsServerAvailable()}`,n))}function Da(e,t,a,r,n,i){return!("GET"===e.method&&Aa(r))&&!(function(e){return function(e){return e.additionalParameters&&e.additionalParameters[we.f.OPERATION_SOURCE]?e.additionalParameters[we.f.OPERATION_SOURCE]:be.b.Default}(e).startsWith(we.b)&&Object(o.getClientType)(Object(Se.F)(e))===we.c.remote}(e)&&400===t)&&[400,404,500,503].indexOf(t)>-1&&Object(ye.b)(we.k.ModernDataSource,a,Object(ge.d)(r))&&Object(ye.c)(Object(be.f)(e),a,e,i)}function Aa(e){return e instanceof je.a&&e.get_isRequestTooLong()||e instanceof ge.a&&e.isRequestTooLong}function La(e){return`[${e||we.p.ModernDataSource}]`}function xa(e,t,a,r,n,o,i,s){return{type:"moderndatasource.getRecentItems",async execute({getState:c,dispatch:l},u){const d=u.TraceManager.getTracer(we.k.ModernDataSource),p=new Y.a;p.entityNames=t,p.preferredPinnedItems=a,p.preferredPinnedItemsPerEntity=n,p.preferredUnpinnedItems=r,p.preferredUnpinnedItemsPerEntity=o,p.appId=f.a.toString(f.a.fromLegacyGuid(e));const m=await l(ia(p,N.a.Remote,i,void 0,void 0,s));return(await Object(P.g)(m,d,i)).recentItems}}}function ka(e,t,a){return{type:"moderndatasource.updateRecentItems",async execute({getState:r,dispatch:n},o){const i=new ae.a;i.items=function(e,t,a){const r=[];for(const n of e){if(!(n.hasOwnProperty("LastAccessedStr")&&n.hasOwnProperty("EntityTypeName")&&n.hasOwnProperty("ObjectId")&&n.hasOwnProperty("RecordType")&&n.hasOwnProperty("Title")))throw ge.a.fromErrorCode(t,-2147220992,null);const e=new A.a;if(e.LastAccessedStr=n.LastAccessedStr,e.EntityTypeName=n.EntityTypeName,e.ObjectId=n.ObjectId,e.RecordType=w.b[n.RecordType],e.Title=n.Title,e.PinStatus=null==n?void 0:n.PinStatus,e.IconPath=null==n?void 0:n.IconPath,e.IsDeleted=null==n?void 0:n.IsDeleted,e.IsUserView=null==n?void 0:n.IsUserView,e.ObjectId!==f.a.EMPTYGUIDSTRING&&e.ObjectId!==f.a.EMPTYSTRING)r.push(e);else{const t=[];t.push({name:"ObjectId",value:e.ObjectId?"Expected to get a non-empty string for ObjectId.guid when we create new recent.":"Expected to get correct value for ObjectId when we create new recent."}),e.Title="",t.push({name:"RecentItem",value:JSON.stringify(e)}),t.push({name:"IsDeleted",value:n.isDeleted}),a.EventManager.ReportComponentFailure(we.k.ModernDataSource,new Error("Recent item has empty ObjectId data."),null,t)}}return r}(e,r(),o);return(await n(ia(i,N.a.Remote,t,void 0,void 0,a))).status}}}function Ua(e){return{type:"moderndatasource.entitydefinition.async",async execute({getState:t,dispatch:a},r){const n=r.TraceManager.getTracer(we.k.ModernDataSource),o=[];let i;const s=()=>async function(e,t,a,r,n){try{const o=Object(U.c)(e(),a,Object(U.p)());Object(U.b)(o,r);const i=await Ta(o,e,t,n,N.a.Remote,a,!0,r);return await Object(P.g)(i,t)}catch(n){const o=ge.a.toLegacyErrorStatus(Object(ge.c)(n));throw t.error(`${La()} getIsActivityFlags failed with error: ${o.get_Message()||o}`,r),wa(a,r,n,e(),we.k.ModernDataSourceEntityDefinition),n}}(t,n,r,o,e),c=window.__uciServerPreload;if(c&&c.activityFlags)try{const e=await c.activityFlags;c.activityFlags=null;const t=P.c.PRELOAD_ACTIVITY_CALL_DETAILS;if(P.c.addCommonParametersToEventParameters(e,o),o.push({name:P.c.CLIENT_ACTIVITY_ID,value:window.__preload.initialActivityId}),e.ok){const a=await Object(P.g)(e,n);a.value?(i=a,o.push({name:P.c.OTHER_DETAILS,value:"Preload IsActivity call was successful."}),Object(Se.a)(o,be.d.GCM),o.push({name:we.f.OPERATION_SUB_TYPE,value:be.c.PreloadGCM}),o.push({name:we.f.METADATA_TYPE,value:vt.a.isActivityFlags}),o.push({name:we.f.OPERATION_SOURCE,value:be.b.Preload}),r.EventManager.ReportComponentSuccess(we.k.ModernDataSource,o)):(o.push({name:P.c.OTHER_DETAILS,value:"Preload isActitivty call was successful but response does not have any value. Request in the usual flow again."}),n.error(`${La()} ${t}`,o),i=await s())}else o.push({name:P.c.OTHER_DETAILS,value:"Preload IsActivity call wasn't successful. Request in the usual flow again."}),n.error(`${La()} ${t}`,o),i=await s()}catch(e){const t=je.a.fromGenericError(e);throw n.error(`${La()} ${e.get_Message()||e}`,o),t}else i=await s();return i}}}function Fa(e,t,a,r,n){return function(e,t,a,r){for(const n of t)if(!Object(h.n)(e,n))return a.error(`${La()} RetrieveMultiple: Entity ${n} not available offline`,r),!1;return!0}(t,Object.keys(a),r,n)&&!Object(h.b)(t,e).error}function $a(e,t,a){const r=Object(de.d)(e);switch(t||(a===N.a.Local?t=i.EXECUTION_HINTS.OFFLINE:a===N.a.Remote&&(t=i.EXECUTION_HINTS.ONLINE)),t){case i.EXECUTION_HINTS.ONLINE:return ht.a.RemoteStore;case i.EXECUTION_HINTS.OFFLINE:return r?ht.a.LocalStoreWhileOnline:ht.a.LocalStoreWhileOffline}return ht.a.RemoteStore}function Ha(e,t,a,r){if(Object(l.f)(e,c.if)&&!0===t.UseServerCache&&a.urlParameters&&"form"===t.MetadataType&&"Main"===t.MetadataSubtype){const e=xt.Form.toString();a.urlParameters+="&metadatacachinglevel="+e,a.additionalHeaders[Nt]=e,r.push({name:"MetadataCachingLevel",value:e})}}function qa(e,t,a){e&&e.MetadataType===k.a.AppModules&&(t.additionalHeaders[At]="1",a.push({name:At,value:"1"}))}function Ga(e,t,a,r){!Object(l.g)(e,"MobileClientOneDbPerProfile")||t.DependencyDepth!==L.b.UserContext&&t.MetadataType!==k.a.AppModules||(a.additionalHeaders[Dt]="1",a.urlParameters=a.urlParameters+"&rbps=1",r.push({name:"RoleBasedProfileInShimEnabled",value:1}))}function Ba(e,t){const a=Object(ge.d)(e);let r,n;return a&&a.startsWith(we.m)?(r=a.split(":"),n=we.d):a&&a.startsWith(we.n)?(r=a.split(":"),n=we.u):a&&a.startsWith(we.q)&&(r=a.split("'",2),n=we.s),r&&2===r.length&&(e.message=r[0].trim(),t.push({name:n,value:r[1].trim()})),e}},VpHT:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var r=a("NjDY"),n=a("99zj"),o=a("V6aM"),i=a("3mEc"),s=a("69Qu");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const c=["JQUERY","JQUERY.JS"];let l,u,d;function p(e){return{type:"customcontrol.loadresources",execute({dispatch:t,getState:a},p){const m=[],g=a(),E=Object(r.x)(g),h=e.Properties.Resources.filter((e,t,a)=>(0===e.Type||4===e.Type||1===e.Type)&&!(e.LibraryName&&-1!==c.indexOf(e.LibraryName.toUpperCase())||p.AssetLoader.isResourceLoaded(E+e.Name))).sort((e,t)=>e.LoadOrder-t.LoadOrder),O=e.Properties.Resources.filter((e,t,a)=>5===e.Type);if(h.length>0){let e;const a=!Object(s.c)(g),r=Object(s.b)(g),n=()=>async function(e,t,a,r,n,i){let s=[],c=i[0].LoadOrder,u=0;for(;u<i.length;){t&&i[u].LoadOrder!==c&&(await Promise.all(s),s=[],c=i[u].LoadOrder);const d=i[u];let p,m=d.Name,g=r;if(l&&l[d.Name])g=window.__public_path__+"control",m=l[d.Name];else if(0===d.Type){const e=d.LibraryName+".js";l&&l[e]&&(g=window.__public_path__+"control",m=l[e])}switch(d.Type){case 0:case 4:p=f(n,m,g,3,t=>e(Object(o.a)(t)),t,a,!1);break;case 1:p=f(n,m,g,2,t=>e(Object(o.a)(t)),t,a);break;default:p=null}p&&s.push(p),u++}await Promise.all(s)}(t,a,r,E,p.AssetLoader,h);e=!function(){null==d&&(d=window.location.search.toLocaleLowerCase().indexOf("uselocal=true")>=0);return d}()||l?n():function(){if(u)return u;if("/uclient/"!==window.__public_path__){if(!l){const e=window.__public_path__+"controlFileMap.json";u=-1!==navigator.userAgent.indexOf("MSIE")||navigator.appVersion.indexOf("Trident/")>0?new Promise(t=>{const a=new XMLHttpRequest;a.addEventListener("load",(function(){let e={};try{e=JSON.parse(this.responseText)}catch(e){}t(e)})),a.addEventListener("error",()=>{t({})}),a.open("GET",e),a.send()}):fetch(e).then(e=>e.json(),()=>({})),u.then(e=>{l=e},()=>{l={}})}}else l={},u=Promise.resolve({});return u}().then(n,n),e&&m.push(e)}const b=Object(i.k)(g);for(let e=0;e<O.length;e++)if(!b||!b.hasOwnProperty(O[e].Name)){const a=t(Object(n.c)(O[e].Name)).then(a=>{let r=!1;for(const t of a)t&&t.webResourceDescriptorsByName&&t.webResourceDescriptorsByName.hasOwnProperty(O[e].Name)&&(r=!0);!r&&t(Object(n.b)(O[e].Name))});m.push(a)}return m.length>0?Promise.all(m):null},sync:!0}}function f(e,t,a,r,n,o,i,s=!0){return e.loadWebResource(t,a,r,n,o,s).catch(c=>{if(o&&i)return e.resetFilePromiseForRetry(a,t,r),e.loadWebResource(t,a,r,n,!1,s);throw c})}},YGjz:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return n}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const r="systemuser",n="transactioncurrency"},vnfk:function(e,t,a){"use strict";a.r(t),a.d(t,"SqlExecutorImpl",(function(){return T})),a.d(t,"addRoleBasedProfileInformationInSQLRequest",(function(){return C})),a.d(t,"isRetryNeededForRoleBasedProfileRequest",(function(){return M})),a.d(t,"retryHandlerForSQLBatchRequest",(function(){return P}));var r=a("umme"),n=a("jZCH"),o=a("EW4s"),i=a("a475"),s=a("paR0"),c=a("+Szo"),l=a("17x/"),u=a("iJxC"),d=a("ufH1"),p=a("Div0"),f=a("UDbe"),m=a("BSGX"),g=a("hgKT");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
async function E(e){try{const t="[MDL BrowserOffline]",a=`SQL: [${e.sqlStatements.toString()}], params: [${e.sqlParameters.toString()}]`;console.log(`${t} executing ${a}`);const r=n.a.get_DefaultInstance().get_LocalDataSource().get_localStore(),o=r.get_localStoreSchema(),i=[],s=[];for(let t=0;t<e.sqlStatements.length;t++){const a=e.sqlStatements[t],n=e.sqlParameters[t],{table:c,query:l,columns:u}=h(a,n,o);s[t]=u,i.push(r.retrieveMultipleByQuery(l,c,null).nativePromise())}const l=await Promise.all(i);let u=0;const d=l.map((e,t)=>{const a=e.get_results();u+=a.length;const r={insertId:0,rowsAffected:a.length,columnNames:s[t],rows:a.map(e=>s[t].map(t=>function(e,t){switch(e){case"id":return t.get_key();case"json":return JSON.stringify(t.get_value());default:return t.get_value()[e]}}(t,e)))};return{insertId:0,rowsAffected:a.length,columnNames:s[t],rows:new c.a(r)}});return console.log(`${t} SUCCESS (total rows: ${u}) ${a}`),d}catch(t){throw Object(d.b)("Error executing SQL against indexed db",p.a.storage,e.sqlStatements.join("; ")),t}}function h(e,t,a){const r=e.match(/select (\*|[\w, ]+)\s*from \[?(\w+)\]?\s*(where (.*))?/i);if(!r)throw new Error("Unable to parse SQL: "+e);const n=r[2],o="*"===r[1]?["id","json"].concat(a.getSchemaFromObjectStoreName(n).get_indexes().map(e=>e.get_name())):r[1].split(",").map(e=>e.trim());return{table:n,query:function(e,t,a,r){let n=null;if((null==t?void 0:t.length)>0){const o=t.match(/\[?(\w+)\]?\s*(=|in)\s*\(?([?, ]+)\)?(\s*and\s*\[?(\w+)\]?\s*(=|in)\s*\(?([?, ]+)\)?)?/i);if(!o)throw new Error("Unable to parse whereClause: "+t);{const t=o[1];let i,s=0;if("="===o[2])i=a[s++];else{const e=v(o[3],a,s);i=e.params,s=e.paramIndex}if(o[4]){const c=o[5];let l;if("="===o[6])l=a[s++];else{const e=v(o[7],a,s);l=e.params,s=e.paramIndex}const u=r.getSchemaFromObjectStoreName(e).get_indexes().find(e=>e.get_name()===`${t}_${c}`||e.get_name()===`${l}_${i}`);if(!u)throw new Error(`No index found for columns ${t} and ${c}`);const d=new f.a(u.get_name());n=u.get_name()===`${t}_${c}`?b(d,i,l):b(d,l,i)}else n=isNaN(Number(i))?"string"==typeof i?new m.a(new f.a(t),i):new g.a(new f.a(t),i):new m.a(new f.a(t),Number(i));if(s!==a.length)throw new Error("Number of parameters provided does not match query: "+a.length)}}return new u.a(n,[])}(n,r[4],t,a),columns:o}}function O(e,t){return`${e}_${t}`}function b(e,t,a){return"string"==typeof t&&"string"==typeof a?new m.a(e,`${t}_${a}`):"object"==typeof t&&"string"==typeof a?new g.a(e,t.map(e=>O(e,a))):"string"==typeof t&&"object"==typeof a?new g.a(e,a.map(e=>O(t,e))):"object"==typeof t&&"object"==typeof a?new g.a(e,t.reduce((e,t)=>e.concat(a.map(e=>O(t,e))),[])):void 0}function v(e,t,a){return{params:e.split(",").map(e=>{if(a>=t.length)throw new Error("Number of parameters provided does not match query: "+t.length);return t[a++]}),paramIndex:a}}var S=a("E5IU"),y=a("IqkD"),w=a("Wc7r"),_=a("504W"),R=a("XjOj"),j=a("SAYH"),I=a("z+5+");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class T{executeSqlStatementsOnOfflineDB(e){return n.a.get_DefaultInstance().get_LocalDataSource().get_offlineDataStore().ExecuteSqlStatements(e)}executeSqlStatementsOnMetadataDB(e){const t=n.a.get_DefaultInstance().get_Store();if(Object(l.j)(t.getState()))return E(e);const a=[],u=new o.a,d=i.a.get_Instance().get_sql(),f=new s.a(d,"MetadataRequest",!0),m=function(e){a.push({insertId:e.insertId,rowsAffected:e.rowsAffected,columnNames:e.columnNames,rows:new c.a(e)})},g=function(e){u.reject(r.a.fromErrorCodeAndMessage(e.code,e.message))};for(let t=0;t<e.sqlStatements.length;t++)f.addRequest(e.sqlStatements[t],e.sqlParameters[t],m,g);const h=t.getState(),O=e=>M(e,h),b=(e,t)=>{e&&P(),u.resolve(a)};if(Object(l.k)(h)){let t=e.additionalParameters&&!Object(_.b)(e.additionalParameters[w.HEADER.CLIENT_REQUEST_ID])?e.additionalParameters[w.HEADER.CLIENT_REQUEST_ID]:null;t||(t=j.a.toString(j.a.newGuid()),Object(R.i)(p.a.sqlBatch,"SQL Query requests do not contain client-request-id, generated local request-id: "+t)),f.addRequestId(t,m,g),Object(l.l)(h)&&Object(I.w)(e)&&C(f,Object(S.k)(h),j.a.toString(Object(y.e)(h)),!1,m,g),f.executeV2(b,O)}else f.execute(()=>{b(!1)});return new Promise((e,t)=>{u.then(t=>e(t)).catch(e=>t(e))})}attachFileToEntity(e){return n.a.get_DefaultInstance().get_LocalDataSource().get_offlineDataStore().get_Plugin().attachFileToEntity(e)}attachImageToEntity(e){return n.a.get_DefaultInstance().get_LocalDataSource().get_offlineDataStore().get_Plugin().attachImageToEntity(e)}deleteAttachment(e){return n.a.get_DefaultInstance().get_LocalDataSource().get_offlineDataStore().get_Plugin().deleteAttachment(e)}}function C(e,t,a,r,n,o){Object(_.b)(t)||t===j.a.EMPTYGUIDSTRING||(e.addExtraParameters("appId",t,n,o),e.addExtraParameters("failOnMismatch",r.toString(),n,o),Object(_.b)(a)||a===j.a.EMPTYGUIDSTRING||e.addExtraParameters("profileId",a,n,o))}function M(e,t){return e.mappingState&&Object(l.k)(t)&&Object(l.l)(t)&&(e.mappingState===l.a.MappingInconsistency?Object(R.i)(p.a.sqlBatch,`RoleBasedProfile executeSqlStatementsOnMetadataDB return with MappingInconsistency state. ${e.currentProfileId||""} and UsedProfileId: ${e.usedProfileId||""} `):e.mappingState===l.a.NoDefaultMapping?Object(R.i)(p.a.sqlBatch,"RoleBasedProfile executeSqlStatementsOnMetadataDB return with NoDefaultMapping state."):e.mappingState===l.a.ProfileSwitch?Object(R.i)(p.a.sqlBatch,`RoleBasedProfile executeSqlStatementsOnMetadataDB return with ProfileSwitch mapping state. CurrentProfileId: ${e.currentProfileId||""} and UsedProfileId: ${e.usedProfileId||""}`):e.mappingState===l.a.UnknownMapping&&Object(R.i)(p.a.sqlBatch,"RoleBasedProfile executeSqlStatementsOnMetadataDB return with UnknownMapping state. Shim is using UCI provided profileId information:  "+(e.usedProfileId||""))),!1}function P(){Object(R.i)(p.a.sqlBatch,"Retry sql batch request for role based profile")}}}]),window.bundleExecutionMarkers["scripts/mds.js?v=1.4.3886-master"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();